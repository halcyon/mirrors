<!DOCTYPE html>
<html lang="en-US" class="no-js">

<!-- Mirrored from stuartsierra.com/author/stuart/page/7 by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 02 Sep 2016 17:06:05 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="profile" href="http://gmpg.org/xfn/11">
		<script>(function(html){html.className = html.className.replace(/\bno-js\b/,'js')})(document.documentElement);</script>
<title>Stuart &#8211; Page 7 &#8211; Digital Digressions by Stuart Sierra</title>
<link rel='dns-prefetch' href='http://s0.wp.com/'>
<link rel='dns-prefetch' href='http://secure.gravatar.com/'>
<link rel='dns-prefetch' href='http://fonts.googleapis.com/'>
<link rel='dns-prefetch' href='http://s.w.org/'>
<link rel="alternate" type="application/rss+xml" title="Digital Digressions by Stuart Sierra &raquo; Feed" href="http://feeds2.feedburner.com/StuartSierra" />
<link rel="alternate" type="application/rss+xml" title="Digital Digressions by Stuart Sierra &raquo; Comments Feed" href="../../../comments/feed" />
<link rel="alternate" type="application/rss+xml" title="Digital Digressions by Stuart Sierra &raquo; Posts by Stuart Feed" href="http://feeds2.feedburner.com/StuartSierra" />
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/stuartsierra.com\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.6"}};
			!function(a,b,c){function d(a){var c,d,e,f,g,h=b.createElement("canvas"),i=h.getContext&&h.getContext("2d"),j=String.fromCharCode;if(!i||!i.fillText)return!1;switch(i.textBaseline="top",i.font="600 32px Arial",a){case"flag":return i.fillText(j(55356,56806,55356,56826),0,0),!(h.toDataURL().length<3e3)&&(i.clearRect(0,0,h.width,h.height),i.fillText(j(55356,57331,65039,8205,55356,57096),0,0),c=h.toDataURL(),i.clearRect(0,0,h.width,h.height),i.fillText(j(55356,57331,55356,57096),0,0),d=h.toDataURL(),c!==d);case"diversity":return i.fillText(j(55356,57221),0,0),e=i.getImageData(16,16,1,1).data,f=e[0]+","+e[1]+","+e[2]+","+e[3],i.fillText(j(55356,57221,55356,57343),0,0),e=i.getImageData(16,16,1,1).data,g=e[0]+","+e[1]+","+e[2]+","+e[3],f!==g;case"simple":return i.fillText(j(55357,56835),0,0),0!==i.getImageData(16,16,1,1).data[0];case"unicode8":return i.fillText(j(55356,57135),0,0),0!==i.getImageData(16,16,1,1).data[0];case"unicode9":return i.fillText(j(55358,56631),0,0),0!==i.getImageData(16,16,1,1).data[0]}return!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g,h,i;for(i=Array("simple","flag","unicode8","diversity","unicode9"),c.supports={everything:!0,everythingExceptFlag:!0},h=0;h<i.length;h++)c.supports[i[h]]=d(i[h]),c.supports.everything=c.supports.everything&&c.supports[i[h]],"flag"!==i[h]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[i[h]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link rel='stylesheet' id='twentysixteen-jetpack-css'  href='../../../wp-content/plugins/jetpack/modules/theme-tools/compat/twentysixteen3a05.css?ver=4.2.2' type='text/css' media='all' />
<link rel='stylesheet' id='twentysixteen-fonts-css'  href='https://fonts.googleapis.com/css?family=Merriweather%3A400%2C700%2C900%2C400italic%2C700italic%2C900italic%7CMontserrat%3A400%2C700%7CInconsolata%3A400&amp;subset=latin%2Clatin-ext' type='text/css' media='all' />
<link rel='stylesheet' id='genericons-css'  href='../../../wp-content/plugins/jetpack/_inc/genericons/genericons/genericons128b.css?ver=3.1' type='text/css' media='all' />
<link rel='stylesheet' id='twentysixteen-style-css'  href='../../../wp-content/themes/twentysixteen/style167b.css?ver=4.6' type='text/css' media='all' />
<!--[if lt IE 10]>
<link rel='stylesheet' id='twentysixteen-ie-css'  href='https://stuartsierra.com/wp-content/themes/twentysixteen/css/ie.css?ver=20160816' type='text/css' media='all' />
<![endif]-->
<!--[if lt IE 9]>
<link rel='stylesheet' id='twentysixteen-ie8-css'  href='https://stuartsierra.com/wp-content/themes/twentysixteen/css/ie8.css?ver=20160816' type='text/css' media='all' />
<![endif]-->
<!--[if lt IE 8]>
<link rel='stylesheet' id='twentysixteen-ie7-css'  href='https://stuartsierra.com/wp-content/themes/twentysixteen/css/ie7.css?ver=20160816' type='text/css' media='all' />
<![endif]-->
<link rel='stylesheet' id='jetpack_css-css'  href='../../../wp-content/plugins/jetpack/css/jetpack3a05.css?ver=4.2.2' type='text/css' media='all' />
<script type='text/javascript' src='../../../wp-includes/js/jquery/jqueryb8ff.js?ver=1.12.4'></script>
<script type='text/javascript' src='../../../wp-includes/js/jquery/jquery-migrate.min330a.js?ver=1.4.1'></script>
<!--[if lt IE 9]>
<script type='text/javascript' src='https://stuartsierra.com/wp-content/themes/twentysixteen/js/html5.js?ver=3.7.3'></script>
<![endif]-->
<link rel='https://api.w.org/' href='../../../wp-json/index.html' />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="../../../xmlrpc0db0.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="../../../wp-includes/wlwmanifest.xml" /> 
<meta name="generator" content="WordPress 4.6" />

<link rel='dns-prefetch' href='http://v0.wordpress.com/'>

<!-- Jetpack Open Graph Tags -->
<meta property="og:type" content="profile" />
<meta property="og:title" content="Stuart" />
<meta property="og:url" content="https://stuartsierra.com/" />
<meta property="profile:first_name" content="Stuart" />
<meta property="profile:last_name" content="Sierra" />
<meta property="og:site_name" content="Digital Digressions by Stuart Sierra" />
<meta property="og:image" content="https://secure.gravatar.com/avatar/55878d0196b91803f9cb2c372b0551d3?s=200&amp;d=blank&amp;r=g" />
<meta property="og:locale" content="en_US" />
</head>

<body class="archive paged author author-stuart author-1 paged-7 author-paged-7 hfeed">
<div id="page" class="site">
	<div class="site-inner">
		<a class="skip-link screen-reader-text" href="#content">Skip to content</a>

		<header id="masthead" class="site-header" role="banner">
			<div class="site-header-main">
				<div class="site-branding">
					
											<p class="site-title"><a href="../../../index.html" rel="home">Digital Digressions by Stuart Sierra</a></p>
											<p class="site-description">From programming to everything else</p>
									</div><!-- .site-branding -->

									<button id="menu-toggle" class="menu-toggle">Menu</button>

					<div id="site-header-menu" class="site-header-menu">
													<nav id="site-navigation" class="main-navigation" role="navigation" aria-label="Primary Menu">
								<div class="menu-main-menu-container"><ul id="menu-main-menu" class="primary-menu"><li id="menu-item-635" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-635"><a href="../../../about-me.html">About Me</a></li>
<li id="menu-item-633" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-633"><a href="../../../writing.html">Writing</a></li>
<li id="menu-item-634" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-634"><a href="../../../presentations.html">Presentations</a></li>
<li id="menu-item-636" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-636"><a href="../../../software.html">Software</a></li>
<li id="menu-item-637" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-637"><a href="../../../contact.html">Contact</a></li>
</ul></div>							</nav><!-- .main-navigation -->
						
											</div><!-- .site-header-menu -->
							</div><!-- .site-header-main -->

											<div class="header-image">
					<a href="../../../index.html" rel="home">
						<img src="../../../wp-content/uploads/2015/12/header.jpg" srcset="https://stuartsierra.com/wp-content/uploads/2015/12/header-300x70.jpg 300w, https://stuartsierra.com/wp-content/uploads/2015/12/header-768x179.jpg 768w, https://stuartsierra.com/wp-content/uploads/2015/12/header-1024x239.jpg 1024w, https://stuartsierra.com/wp-content/uploads/2015/12/header.jpg 1200w" sizes="(max-width: 709px) 85vw, (max-width: 909px) 81vw, (max-width: 1362px) 88vw, 1200px" width="1200" height="280" alt="Digital Digressions by Stuart Sierra">
					</a>
				</div><!-- .header-image -->
					</header><!-- .site-header -->

		<div id="content" class="site-content">

	<div id="primary" class="content-area">
		<main id="main" class="site-main" role="main">

		
			<header class="page-header">
				<h1 class="page-title">Author: <span class="vcard">Stuart</span></h1>			</header><!-- .page-header -->

			
<article id="post-432" class="post-432 post type-post status-publish format-standard hentry category-programming tag-clojure">
	<header class="entry-header">
		
		<h2 class="entry-title"><a href="../../../2010/01/15/keyword-arguments-in-clojure.html" rel="bookmark">Keyword Arguments in Clojure, the Right Way</a></h2>	</header><!-- .entry-header -->

	
	
	<div class="entry-content">
		<p><strong>Update Feb. 10, 2010: I was wrong.  Recent discussions indicate that placing optional arguments in-line, as in my first example, is preferred.  In the future, Clojure may have destructuring support for this style.  For now, this post remains a useful guide to map destructuring.</strong></p>
<p>Many languages, such as Python and Ruby, allow functions arguments to be passed as name-value pairs.</p>
<p>People often ask for the same thing in <a href="http://clojure.org/">Clojure</a>, and they end up writing something like this:</p>
<pre>(defn foo [a b & options]
  (let [opts (apply hash-map options)]
    ...))

(foo 1 2 :optionA 3 :optionB 4)</pre>
<p>That works, but it&#8217;s not very efficient.  Every time you call foo, it has to construct a hash-map from its arguments.  That&#8217;s a fair amount of overhead for what is usually a small map of options.</p>
<p>A better way is to use Clojure&#8217;s <em>map binding forms</em>.  The syntax is tricky, but very powerful.</p>
<p>Let&#8217;s look at the general syntax of Clojure&#8217;s local binding form, <strong>let</strong>:</p>
<pre>(let [<em>bindings...</em>] <em>expressions...</em>)</pre>
<p>The <em>bindings</em> are pairs consisting of a <em>binding form</em> and an <em>initialization expression</em>.  The simplest binding pair is just name-value:</p>
<pre>(let [a 1, b 2]
  (list a b))
;;=> (1 2)</pre>
<p>So far, so good.  You probably know that you can use a vector as the binding form to bind sequential things like lists, vectors, and even strings:</p>
<pre>(let [[a b c] "foo"]
  (list a b c))
;;=> (\f \o \o)</pre>
<p>Moving on:  A <em>map binding</em> uses a map as the binding form.  Well, duh.  Let&#8217;s call it the <em>binding map</em>.  (catchy, no?)</p>
<p>The <em>keys</em> of the binding map are the local variables you want to create.  The <em>values</em> of the binding map are <em>keys</em> in the initialization expression.  The locals will be bound to the values of corresponding keys.</p>
<p>How about an example?</p>
<pre>      ; binding form      ; init expression
(let [{a :keyA, b :keyB}  {:keyA 1, :keyB 2}]
  (list a b))
;;=> (1 2)</pre>
<p>You can use the same technique for function arguments:</p>
<pre>(defn foo [{a :keyA, b :keyB}]
  (list a b))

(foo {:keyA 1 :keyB 2})
;;=> (1 2)</pre>
<p>Notice that we&#8217;re calling <strong>foo</strong> with a single argument, a map.  This may be slightly less pretty than having key/value pairs directly in the function arguments, but it is more efficient, since the compiler knows exactly how big the argument map is.  It&#8217;s also more flexible, because we can construct the argument map elsewhere and then pass it to the function:</p>
<pre>(def options {:keyA 3, :keyB 4})

(foo options)
;;=> (3 4)</pre>
<p>You can also mix normal, positional arguments with map arguments:</p>
<pre>(defn foo [a b {c :keyC, d :keyD}]
  (list a b c d))

(foo 1 2 {:keyC 3, :keyD 4})
;;=> (1 2 3 4)</pre>
<p>In the most common case, you probably want your local variables to have the same names as the keywords in the initialization expression.  Clojure has a shortcut for that, a special key in the binding map called, appropriately enough, <strong>:keys</strong>:</p>
<pre>(defn foo [{:keys [a b]}]
  (list a b))

(foo {:a 5, :b 6})
;;=> (5 6)</pre>
<p>You can also supply a map of default values using another special key in the binding map, the <strong>:or</strong> key:</p>
<pre>(defn foo [{:keys [a b c], :or {c 42}}]
  (list a b c))

(foo {:a 7, :b 8, :c 9})
;;=> (7 8 9)

(foo {:a 20, :b 30})
;;=> (20 30 42)</pre>
<p>Finally, what if you want to enforce a requirement that certain keys be present?  Clojure 1.1 introduced a great way to do that with <a href="http://clojure.org/special_forms#toc9">pre- and postconditions</a>.  You can set a pre-condition that will throw an exception if a particular binding is nil:</p>
<pre>(defn foo [{:keys [a b c]}]
  {:pre [(not (nil? c))]}
  (list a b c))

(foo {:a 1, :c 3})
;;=> (1 nil 3)

(foo {:b 2})
;;=> java.lang.AssertionError: Assert failed: (not (nil? c))</pre>
<p>There are even more features of map binding that I haven&#8217;t covered here.  But this should give you enough background to understand the <a href="http://clojure.org/special_forms#toc4">full documentation</a>.</p>
	</div><!-- .entry-content -->

	<footer class="entry-footer">
		<span class="byline"><span class="author vcard"><img alt='' src='https://secure.gravatar.com/avatar/55878d0196b91803f9cb2c372b0551d3?s=49&amp;d=blank&amp;r=g' srcset='https://secure.gravatar.com/avatar/55878d0196b91803f9cb2c372b0551d3?s=98&amp;d=blank&amp;r=g 2x' class='avatar avatar-49 photo' height='49' width='49' /><span class="screen-reader-text">Author </span> <a class="url fn n" href="../../stuart.html">Stuart</a></span></span><span class="posted-on"><span class="screen-reader-text">Posted on </span><a href="../../../2010/01/15/keyword-arguments-in-clojure.html" rel="bookmark"><time class="entry-date published" datetime="2010-01-15T12:42:18+00:00">January 15, 2010</time><time class="updated" datetime="2010-02-10T17:26:19+00:00">February 10, 2010</time></a></span><span class="cat-links"><span class="screen-reader-text">Categories </span><a href="../../../category/programming.html" rel="category tag">Programming</a></span><span class="tags-links"><span class="screen-reader-text">Tags </span><a href="../../../tag/clojure.html" rel="tag">Clojure</a></span><span class="comments-link"><a href="../../../2010/01/15/keyword-arguments-in-clojure.html#comments">5 Comments<span class="screen-reader-text"> on Keyword Arguments in Clojure, the Right Way</span></a></span>			</footer><!-- .entry-footer -->
</article><!-- #post-## -->

<article id="post-425" class="post-425 post type-post status-publish format-standard hentry category-uncategorized">
	<header class="entry-header">
		
		<h2 class="entry-title"><a href="../../../2010/01/12/clojure-hadoop-1-1-0-release.html" rel="bookmark">clojure-hadoop 1.1.0 release</a></h2>	</header><!-- .entry-header -->

	
	
	<div class="entry-content">
		<p>I&#8217;ve made a new version of my <a href="../../../2010/01/11/clojure-hadoop-1-0-0.html">clojure-hadoop library</a>.  Downloads are on the <a href="../../../2010/01/11/clojure-hadoop-1-0-0.html">main page</a>.</p>
<p><a href="http://github.com/stuartsierra/clojure-hadoop/blob/1.1.0/CHANGES.txt">List of changes here</a>.  This fixes some missing pieces in the first release, and adds some more Hadoop configuration options.</p>
	</div><!-- .entry-content -->

	<footer class="entry-footer">
		<span class="byline"><span class="author vcard"><img alt='' src='https://secure.gravatar.com/avatar/55878d0196b91803f9cb2c372b0551d3?s=49&amp;d=blank&amp;r=g' srcset='https://secure.gravatar.com/avatar/55878d0196b91803f9cb2c372b0551d3?s=98&amp;d=blank&amp;r=g 2x' class='avatar avatar-49 photo' height='49' width='49' /><span class="screen-reader-text">Author </span> <a class="url fn n" href="../../stuart.html">Stuart</a></span></span><span class="posted-on"><span class="screen-reader-text">Posted on </span><a href="../../../2010/01/12/clojure-hadoop-1-1-0-release.html" rel="bookmark"><time class="entry-date published" datetime="2010-01-12T12:53:59+00:00">January 12, 2010</time><time class="updated" datetime="2010-01-12T12:55:59+00:00">January 12, 2010</time></a></span><span class="cat-links"><span class="screen-reader-text">Categories </span><a href="../../../category/uncategorized.html" rel="category tag">Uncategorized</a></span>			</footer><!-- .entry-footer -->
</article><!-- #post-## -->

<article id="post-419" class="post-419 post type-post status-publish format-standard hentry category-programming tag-clojure tag-hadoop">
	<header class="entry-header">
		
		<h2 class="entry-title"><a href="../../../2010/01/11/clojure-hadoop-1-0-0.html" rel="bookmark">Clojure-Hadoop 1.0.0</a></h2>	</header><!-- .entry-header -->

	
	
	<div class="entry-content">
		<p>At long last, I have made a formal release of my <a href="../../../2010/01/11/clojure-hadoop-1-0-0.html">clojure-hadoop</a> library.  Downloads and more information <a href="../../../2010/01/11/clojure-hadoop-1-0-0.html">here</a>.</p>
<p>The 1.0.0 release is documented, but not in exhaustive detail.  Other people have used this successfully, but it may not support all possible Hadoop configurations.</p>
<p>Watch video of <a href="http://vimeo.com/7669741">my presentation at HadoopWorld NYC</a>.</p>
	</div><!-- .entry-content -->

	<footer class="entry-footer">
		<span class="byline"><span class="author vcard"><img alt='' src='https://secure.gravatar.com/avatar/55878d0196b91803f9cb2c372b0551d3?s=49&amp;d=blank&amp;r=g' srcset='https://secure.gravatar.com/avatar/55878d0196b91803f9cb2c372b0551d3?s=98&amp;d=blank&amp;r=g 2x' class='avatar avatar-49 photo' height='49' width='49' /><span class="screen-reader-text">Author </span> <a class="url fn n" href="../../stuart.html">Stuart</a></span></span><span class="posted-on"><span class="screen-reader-text">Posted on </span><a href="../../../2010/01/11/clojure-hadoop-1-0-0.html" rel="bookmark"><time class="entry-date published" datetime="2010-01-11T13:35:43+00:00">January 11, 2010</time><time class="updated" datetime="2010-01-11T13:36:47+00:00">January 11, 2010</time></a></span><span class="cat-links"><span class="screen-reader-text">Categories </span><a href="../../../category/programming.html" rel="category tag">Programming</a></span><span class="tags-links"><span class="screen-reader-text">Tags </span><a href="../../../tag/clojure.html" rel="tag">Clojure</a>, <a href="../../../tag/hadoop.html" rel="tag">Hadoop</a></span>			</footer><!-- .entry-footer -->
</article><!-- #post-## -->

<article id="post-395" class="post-395 post type-post status-publish format-standard hentry category-programming tag-clojure tag-swing">
	<header class="entry-header">
		
		<h2 class="entry-title"><a href="../../../2010/01/08/agents-of-swing.html" rel="bookmark">Agents of Swing</a></h2>	</header><!-- .entry-header -->

	
	
	<div class="entry-content">
		<p>The title of this post would make a good name for a band.</p>
<p>Anyway, today I&#8217;m going to talk about Swing and concurrency and <a href="http://clojure.org/">Clojure</a>.</p>
<p>The Swing framework is <a href="http://java.sun.com/docs/books/tutorial/uiswing/concurrency/dispatch.html">not thread-safe</a>.  That may sound strange at first, but there&#8217;s actually some <a href="http://weblogs.java.net/blog/kgh/archive/2004/10/multithreaded_t.html">sound technical reasoning</a> behind it.</p>
<p>Basically, the Swing designers realized that, in order to have a multi-threaded GUI, you need locks everywhere, which typically means you have bugs everywhere.</p>
<p>That&#8217;s not to say a Swing application can&#8217;t be multi-threaded.  Swing merely requires that the <em>GUI</em> be single-threaded.  In Swing, all GUI-related code must run on a special thread called the <em>event dispatch thread</em>, which is automatically created by the Swing framework.</p>
<p>By design, event listeners such as <a href="http://java.sun.com/javase/6/docs/api/java/awt/event/ActionListener.html#actionPerformed%28java.awt.event.ActionEvent%29">ActionListener.actionPerformed</a> always run on the event dispatch thread.  To run arbitrary code on the event dispatch thread, you can use the <a href="http://java.sun.com/javase/6/docs/api/javax/swing/SwingUtilities.html#invokeLater%28java.lang.Runnable%29">SwingUtilities.invokeLater</a> method.</p>
<p>As was pointed out in a comment on my <a href="../../../2010/01/06/heating-up-clojure-swing.html">last post</a>, this is how all of my example apps <em>should</em> be started.  The invokeLater method takes a <a title="Runnable API docs" href="http://java.sun.com/javase/6/docs/api/java/lang/Runnable.html">Runnable</a> argument.  In Clojure, this is easy, because all Clojure functions are Runnable.  So, for example, the <strong>temp-app</strong> program should be started like this:</p>
<pre>(SwingUtilities/invokeLater temp-app)</pre>
<p>As a consequence of running all GUI code on a single thread, any GUI code that blocks can &#8220;freeze&#8221; the entire application.  Event listeners, therefore, must execute quickly and delegate long operations like I/O to other threads.</p>
<p>Java 6 provides the <a title="SwingWorker API docs" href="http://java.sun.com/javase/6/docs/api/javax/swing/SwingWorker.html">SwingWorker</a> class to manage long-running background tasks.  Unfortunately, the implementation of SwingWorker is heavily dependent on protected methods and concrete inheritance, features that are awkward to use in Clojure.</p>
<p>But wait, wasn&#8217;t Clojure <em>designed</em> for concurrency?  Yes it was, and we can replace SwingWorker with Clojure&#8217;s more-powerful tools.</p>
<p>In this post, I will recreate the <a href="http://java.sun.com/docs/books/tutorial/uiswing/concurrency/interim.html">Flipper application</a> from the Swing tutorials.</p>
<p>* * *</p>
<p>The point of Flipper is to test the &#8220;fairness&#8221; of Java&#8217;s random number generator.  It uses <a href="http://java.sun.com/javase/6/docs/api/java/util/Random.html">java.util.Random</a> to generate random booleans, simulating a series of coin flips.  The number of &#8220;heads&#8221; (boolean true) should converge to half of the total number of flips.</p>
<p>The Java version of Flipper (<a title="Flipper.java" href="http://java.sun.com/docs/books/tutorial/uiswing/examples/concurrency/FlipperProject/src/concurrency/Flipper.java">source here</a>) does the coin flips in a SwingWorker thread, which sends intermediate results to a GUI.</p>
<p>Our version will use <a href="http://clojure.org/agents">Clojure Agents</a>, a much more flexible and powerful alternative.</p>
<p>Lets dig into some code.  First, we need a function to create a &#8220;Flipper&#8221; agent:</p>
<pre>(defn new-flipper []
  (agent {:total 0, :heads 0,
          :running false,
          :random (java.util.Random.)}))</pre>
<p>This sets up the initial state of the agent, with its own random number generator, two counters, and a boolean flag to designate whether or not the flipper is running.</p>
<p>The flipper agent will have three actions.  An agent <em>action</em> is just a function taking one argument, which is the <em>current</em> state of the agent.  Whatever the function returns becomes the <em>new</em> state of the agent.</p>
<p>Additionally, in the body of the action, the special Var <strong>*agent*</strong> is bound to the agent itself.  The action function can <strong>send</strong> other actions to <strong>*agent*</strong>; those actions will not run until <em>after</em> the current action completes.</p>
<p>Our flipper&#8217;s first action is <strong>calculate</strong>:</p>
<pre>(defn calculate [state]
  (if (:running state)
    (do (send *agent* calculate)
        (assoc state
          :total (inc (:total state))
          :heads (if (.nextBoolean (:random state))
                   (inc (:heads state))
                   (:heads state))))
    state))</pre>
<p>If the flipper is currently &#8220;running,&#8221; <strong>calculate</strong> will call the random number generator and update the counters.  It will also <strong>send</strong> itself to the agent again, creating a loop.</p>
<p>If the flipper is not &#8220;running,&#8221; <strong>calculate</strong> does nothing, but it must still return the original state.</p>
<p>The remaining two actions control the &#8220;running&#8221; state of the agent:</p>
<pre>(defn start [state]
  (send *agent* calculate)
  (assoc state :running true))

(defn stop [state]
  (assoc state :running false))</pre>
<p>These actions just change the value of <strong>:running</strong> in the agent&#8217;s state.  The <strong>start</strong> action also sends the <strong>calculate</strong> action to kickstart the calculation loop.</p>
<p>To watch the agent in action, try this at the REPL:</p>
<pre>(def flipper (new-flipper))
(send flipper start)</pre>
<p>The flipper is now running in the background.  At any time, you can retrieve the current state of the flipper with <strong>(deref&nbsp;flipper)</strong>, or simply <strong>@flipper</strong>.  Try it a few times and see how the counters change, as in this sample REPL session:</p>
<pre><strong>user&gt;</strong> @flipper
{:total 365067, :heads 182253, :running true, ...
<strong>user&gt;</strong> @flipper
{:total 679283, :heads 338549, :running true, ...
<strong>user&gt;</strong> @flipper
{:total 1030204, :heads 513767, :running true, ...</pre>
<p>To stop the calculation, type</p>
<pre>(send flipper stop)</pre>
<p>Subsequent calls to <strong>@flipper</strong> will all show the same value.  You can restart the calculation by typing <strong>(send&nbsp;flipper&nbsp;start)</strong> again.</p>
<p>We need one more function to make our flipper complete.  We want to compute the &#8220;unfairness&#8221; of the random number generator, or how far it is from 0.5.  This is easy:</p>
<pre>(defn error [state]
  (if (zero? (:total state)) 0.0
      (- (/ (double (:heads state))
            (:total state))
         0.5)))</pre>
<p>The <strong>if</strong> expression is just there to avoid divide-by-zero errors in the initial case.  </p>
<p>Note that, although I used the same argument name, <strong>state</strong>, as in the actions, the <strong>error</strong> function is <em>not</em> meant to be called as an action with <strong>send</strong>.  Instead, we will call it on the current state of the agent like this:</p>
<pre>(error @flipper)</pre>
<p>* * *</p>
<p>The nice thing about this flipper is that, unlike the Java version, it is completely decoupled from the GUI.  We can design and test it at the REPL before writing any GUI code at all.</p>
<p>(The Java version <em>could</em> have been decoupled.  But because Swing requires you to create so many classes anyway, the temptation is always there to combine GUI code with &#8220;process&#8221; code.)</p>
<p>So let&#8217;s get this GUI going.  Unlike the Java example, which used callbacks from the flipper to update the GUI, our GUI will update at a fixed rate of 10 times per second.  To do this we will use a <a href="http://java.sun.com/javase/6/docs/api/javax/swing/Timer.html">javax.swing.Timer</a>, which fires an event every <em>n</em> milliseconds.</p>
<p>First, some imports and a helper function to create the text fields with common attributes:</p>
<pre>(import '(javax.swing JPanel JFrame JButton JTextField
                      JLabel Timer SwingUtilities))

(defn text-field [value]
  (doto (JTextField. value 15)
    (.setEnabled false)
    (.setHorizontalAlignment JTextField/RIGHT)))</pre>
<p>Next, we will reuse the <strong>on-action</strong> macro from an earlier post, except I&#8217;ve renamed it <strong>with-action</strong> because my editor&#8217;s automatic indentation looks better that way.</p>
<pre>(defmacro with-action [component event & body]
  `(. ~component addActionListener
      (proxy [java.awt.event.ActionListener] []
        (actionPerformed [~event] ~@body))))</pre>
<p>And now we&#8217;re ready for the app itself:</p>
<pre>(defn flipper-app []
  ;; Construct components:
  (let [flipper (new-flipper)
        b-start (JButton. "Start")
        b-stop (doto (JButton. "Stop")
                 (.setEnabled false))
        total (text-field "0")
        heads (text-field "0")
        t-error (text-field "0.0")
        timer (Timer. 100 nil)]

    ;; Setup actions:
    (with-action timer e
      (let [state @flipper]
        (.setText total (str (:total state)))
        (.setText heads (str (:heads state)))
        (.setText t-error (format "%.10g" (error state)))))
    (with-action b-start e
      (send flipper start)
      (.setEnabled b-stop true)
      (.setEnabled b-start false)
      (.start timer))
    (with-action b-stop e
      (send flipper stop)
      (.setEnabled b-stop false)
      (.setEnabled b-start true)
      (.stop timer))

    ;; Create window and layout:
    (doto (JFrame. "Flipper")
      (.setContentPane
       (doto (JPanel.)
         (.add (JLabel. "Total:"))
         (.add total)
         (.add (JLabel. "Heads:"))
         (.add heads)
         (.add (JLabel. "Error:"))
         (.add t-error)
         (.add b-start)
         (.add b-stop)))
      (.pack)
      (.setVisible true))))</pre>
<p>The GUI has three text fields showing the total number of flips, the number of &#8220;heads,&#8221; and the error rate.  The &#8220;Start&#8221; button starts the flipper; the &#8220;Stop&#8221; button suspends it.  You can start and stop as many times as you like without losing the results of the calculation (another improvement over the Java version, which restarts at zero each time).</p>
<p>The important code is in the <strong>with-action</strong> bodies.  (Don&#8217;t confuse Swing ActionListeners with Agent actions.)  Remember, event listeners must execute quickly, so all they do is update the visible parts of the GUI.</p>
<p>The &#8220;Start&#8221; button kicks off the flipper and activates the Timer.  The Timer fires every 100 milliseconds, updating the text fields from the current state of the flipper.  The &#8220;Stop&#8221; button suspends both the Timer and the flipper.</p>
<p>Run the application like this:</p>
<pre>(SwingUtilities/invokeLater flipper-app)</pre>
<p>We didn&#8217;t do any fancy layout because it wasn&#8217;t necessary for the example.  But if you want something prettier, here&#8217;s another version using the GridBagLayout macros from my last post:</p>
<pre>(import '(java.awt GridBagLayout Insets))

(defmacro set-grid! [constraints field value]
  `(set! (. ~constraints ~(symbol (name field)))
         ~(if (keyword? value)
            `(. java.awt.GridBagConstraints
                ~(symbol (name value)))
            value)))

(defmacro grid-bag-layout [container & body]
  (let [c (gensym "c")
        cntr (gensym "cntr")]
    `(let [~c (new java.awt.GridBagConstraints)
           ~cntr ~container]
       ~@(loop [result '() body body]
           (if (empty? body)
             (reverse result)
             (let [expr (first body)]
               (if (keyword? expr)
                 (recur (cons `(set-grid! ~c ~expr
                                          ~(second body))
                              result)
                        (next (next body)))
                 (recur (cons `(.add ~cntr ~expr ~c)
                              result)
                        (next body)))))))))

(defn flipper-app2 []
  ;; Construct components:
  (let [flipper (new-flipper)
        b-start (JButton. "Start")
        b-stop (doto (JButton. "Stop")
                 (.setEnabled false))
        total (text-field "0")
        heads (text-field "0")
        t-error (text-field "0.0")
        timer (Timer. 100 nil)]

    ;; Setup actions:
    (with-action timer e
      (let [state @flipper]
        (.setText total (str (:total state)))
        (.setText heads (str (:heads state)))
        (.setText t-error (format "%.10g" (error state)))))
    (with-action b-start e
      (send flipper start)
      (.setEnabled b-stop true)
      (.setEnabled b-start false)
      (.start timer))
    (with-action b-stop e
      (send flipper stop)
      (.setEnabled b-stop false)
      (.setEnabled b-start true)
      (.stop timer))

    ;; Create window and layout:
    (doto (JFrame. "Flipper")
      (.setContentPane
       (doto (JPanel. (GridBagLayout.))
         (grid-bag-layout
          :insets (Insets. 5 5 5 5)

          :gridx 0, :anchor :LINE_END
          :gridy 0, (JLabel. "Total:")
          :gridy 1, (JLabel. "Heads:")
          :gridy 2, (JLabel. "Error:")

          :gridx 1, :anchor :LINE_START
          :gridy 0, total
          :gridy 1, heads
          :gridy 2, t-error

          :gridx 0, :gridy 3, :gridwidth 2, :anchor :CENTER
          (doto (JPanel.)
            (.add b-start)
            (.add b-stop)))))
      (.pack)
      (.setVisible true))))</pre>
<p>I centered the buttons below the text fields by embedding them in a nested JPanel that spans the full width of the window.</p>
<p>Run this example as:</p>
<pre>(SwingUtilities/invokeLater flipper-app2)</pre>
<p>Enjoy!</p>
	</div><!-- .entry-content -->

	<footer class="entry-footer">
		<span class="byline"><span class="author vcard"><img alt='' src='https://secure.gravatar.com/avatar/55878d0196b91803f9cb2c372b0551d3?s=49&amp;d=blank&amp;r=g' srcset='https://secure.gravatar.com/avatar/55878d0196b91803f9cb2c372b0551d3?s=98&amp;d=blank&amp;r=g 2x' class='avatar avatar-49 photo' height='49' width='49' /><span class="screen-reader-text">Author </span> <a class="url fn n" href="../../stuart.html">Stuart</a></span></span><span class="posted-on"><span class="screen-reader-text">Posted on </span><a href="../../../2010/01/08/agents-of-swing.html" rel="bookmark"><time class="entry-date published updated" datetime="2010-01-08T13:45:34+00:00">January 8, 2010</time></a></span><span class="cat-links"><span class="screen-reader-text">Categories </span><a href="../../../category/programming.html" rel="category tag">Programming</a></span><span class="tags-links"><span class="screen-reader-text">Tags </span><a href="../../../tag/clojure.html" rel="tag">Clojure</a>, <a href="../../../tag/swing.html" rel="tag">Swing</a></span><span class="comments-link"><a href="../../../2010/01/08/agents-of-swing.html#comments">9 Comments<span class="screen-reader-text"> on Agents of Swing</span></a></span>			</footer><!-- .entry-footer -->
</article><!-- #post-## -->

<article id="post-388" class="post-388 post type-post status-publish format-standard hentry category-programming tag-clojure tag-swing">
	<header class="entry-header">
		
		<h2 class="entry-title"><a href="../../../2010/01/06/heating-up-clojure-swing.html" rel="bookmark">Heating Up Clojure &#038; Swing</a></h2>	</header><!-- .entry-header -->

	
	
	<div class="entry-content">
		<p>Most Swing examples don&#8217;t translate well into <a href="http://clojure.org/">Clojure</a> because they are so thoroughly embedded in the object-oriented paradigm.</p>
<p>A typical Swing example has a main class that extends a container class and implements some *Listener interface.  Clojure beginners who try to port these examples may think they need to mimic that same structure.</p>
<p>In fact, there are few situations where Swing <em>forces</em> you to create a subclass.  Most involve event listeners and can be handled adequately with Clojure&#8217;s <strong>proxy</strong>.</p>
<p>In this post, we&#8217;ll develop a complete, albeit small, Swing application: the classic <a title="Java Temperature Converter tutorial" href="http://java.sun.com/docs/books/tutorial/uiswing/learn/">Temperature Converter</a> tutorial.  But ours will be better.  It can convert both Celsius to Fahrenheit and vice-versa, and it does the conversion immediately without waiting for a button click.</p>
<p>Gentleman, start your REPLs.</p>
<p>Start by importing all the classes we will need for this example:</p>
<pre>(import '(javax.swing JLabel JPanel JFrame JTextField)
        '(javax.swing.event DocumentListener)
        '(java.awt GridBagLayout GridBagConstraints Insets))</pre>
<p>Before we get to any GUI stuff, we need two functions to convert between degrees Celsius and degrees Fahrenheit:</p>
<pre>(defn f-to-c [f]
  (* (- f 32) 5/9))

(defn c-to-f [c]
  (+ (* c 9/5) 32))</pre>
<p>Note the use of Clojure Ratios.</p>
<p>Next, we need a couple of helper functions.  First, the <strong>parse</strong> function will take a String typed by the user and convert it to a number.  If the user types an invalid number, <strong>parse</strong> returns nil, but it can handle extra spaces:</p>
<pre>(defn parse [s]
  (try (Double/parseDouble (.trim s))
       (catch NumberFormatException e nil)))</pre>
<p>The <strong>display</strong> function does the opposite.  It takes a number, rounds it to the nearest Integer (because Integers are prettier), and returns a String.</p>
<pre>(defn display [n]
  (str (Math/round (float n))))</pre>
<p>You can test these functions in the REPL:</p>
<pre>(f-to-c 212) ;; =&gt; 100
(c-to-f 0)   ;; =&gt; 32

(parse "22.5")   ;; =&gt; 22.5
(parse " 22 ")   ;; =&gt; 22.0
(parse "foobar") ;; =&gt; nil

(display 22.5) ;; =&gt; "23"
(display 22/7) ;; =&gt; "3"</pre>
<p>Now, time for some GUI goo!</p>
<p>Our temperature converter will have two text fields, one for Celsius and one for Fahrenheit, like this:</p>
<p><a href="../../../wp-content/uploads/2010/01/tempconvert-demo1.png"><img class="alignnone size-full wp-image-390" title="tempconvert-demo1" src="../../../wp-content/uploads/2010/01/tempconvert-demo1.png" alt="Temperature Converter GUI screenshot" width="181" height="58" /></a></p>
<p>As soon as the user types in either text field, the other text field will immediately change to show the converted value.  So to convert Celsius to Fahrenheit, just type into the &#8220;Celsius&#8221; box.  To go the other way, type into the &#8220;Fahrenheit&#8221; box.</p>
<p>I chose this design because it has two elements that behave very similarly, allowing me to show off some higher-order functions.</p>
<p>Let&#8217;s start with updating.  We have two text fields.  We want to update one, call it the &#8220;target&#8221; field, by converting the value of the other, call it the &#8220;source&#8221; field.  But we never want to update a field while the user is typing in it!  That would then trigger another update, causing an infinite loop.</p>
<p>Here&#8217;s the function:</p>
<pre>(defn update-temp [source target convert]
  (when (.isFocusOwner source)
    (if-let [n (parse (.getText source))]
      (.setText target (display (convert n)))
      (.setText target ""))))</pre>
<p>The <strong>source</strong> and <strong>target</strong> arguments are <a title="JTextField API docs" href="http://java.sun.com/javase/6/docs/api/javax/swing/JTextField.html">JTextField</a>s, which we will create later.  The <strong>update-temp</strong> function will be called every time one of the text fields emits a change event, so first we have to make sure that the <strong>source</strong> field (the one that triggered the event) has the keyboard focus.  If it does, we try to read the source field&#8217;s contents.  If <strong>parse</strong> is successful, we can calculate the value for the <strong>target</strong> field using the supplied <strong>convert</strong> function, otherwise we just set the target to be blank.</p>
<p>To make this work, we need to attach listeners to each of the JTextFields.  We can write a function for that too:</p>
<pre>(defn listen-temp [source target f]
  (.. source getDocument
      (addDocumentListener
       (proxy [DocumentListener] []
         (insertUpdate [e] (update-temp source target f))
         (removeUpdate [e] (update-temp source target f))
         (changedUpdate [e] )))))</pre>
<p>Swing implements a Model-View-Controller paradigm for text fields.  So to listen for changes in a text field, we actually want to listen to the <a title="Document API docs" href="http://java.sun.com/javase/6/docs/api/javax/swing/text/Document.html">Document</a> model associated with that text field.  The <a title="DocumentListener API docs" href="http://java.sun.com/javase/6/docs/api/javax/swing/event/DocumentListener.html">DocumentListener</a> insertUpdate and removeUpdate methods are called whenever the Document changes. The changedUpdate method is not interesting to us, but we still have to provide an empty implementation in the proxy.</p>
<p>So now we&#8217;ve got general-purpose functions for updating one text field whenever another changes.  Suppose we create two text fields named <strong>celsius</strong> and <strong>fahrenheit</strong>.  Wiring them together only takes 2 lines:</p>
<pre>(listen-temp celsius fahrenheit c-to-f)
(listen-temp fahrenheit celsius f-to-c)</pre>
<p>And that&#8217;s exactly what you&#8217;ll see in the final app, below.</p>
<p>All that&#8217;s left is the layout.  I&#8217;ll re-use the GridBagLayout macros from my <a href="../../../2010/01/05/taming-the-gridbaglayout.html">previous post</a>. Here they are again, for those of you following along at home:</p>
<pre>(defmacro set-grid! [constraints field value]
  `(set! (. ~constraints ~(symbol (name field)))
         ~(if (keyword? value)
            `(. GridBagConstraints ~(symbol (name value)))
            value)))

(defmacro grid-bag-layout [container &amp; body]
  (let [c (gensym "c")
        cntr (gensym "cntr")]
    `(let [~c (new java.awt.GridBagConstraints)
           ~cntr ~container]
       ~@(loop [result '() body body]
           (if (empty? body)
             (reverse result)
             (let [expr (first body)]
               (if (keyword? expr)
                 (recur (cons `(set-grid! ~c ~expr
                                          ~(second body))
                              result)
                        (next (next body)))
                 (recur (cons `(.add ~cntr ~expr ~c)
                              result)
                        (next body)))))))))</pre>
<p>And, last but not least, here&#8217;s the app itself:</p>
<pre>(defn temp-app []
  (let [celsius (JTextField. 3)
        fahrenheit (JTextField. 3)
        panel (doto (JPanel. (GridBagLayout.))
                (grid-bag-layout
                 :gridx 0, :gridy 0, :anchor :LINE_END
                 :insets (Insets. 5 5 5 5)
                 (JLabel. "Degrees Celsius:")
                 :gridy 1
                 (JLabel. "Degrees Fahrenheit:")
                 :gridx 1, :gridy 0, :anchor :LINE_START
                 celsius
                 :gridy 1
                 fahrenheit))]
    (listen-temp celsius fahrenheit c-to-f)
    (listen-temp fahrenheit celsius f-to-c)
    (doto (JFrame. "Temperature Converter")
      (.setContentPane panel)
      (.pack)
      (.setVisible true))))</pre>
<p>Run the function <strong>(temp-app)</strong> and you&#8217;ve got yourself a temperature converter.  Makes me feel all warm and GUI inside.</p>
	</div><!-- .entry-content -->

	<footer class="entry-footer">
		<span class="byline"><span class="author vcard"><img alt='' src='https://secure.gravatar.com/avatar/55878d0196b91803f9cb2c372b0551d3?s=49&amp;d=blank&amp;r=g' srcset='https://secure.gravatar.com/avatar/55878d0196b91803f9cb2c372b0551d3?s=98&amp;d=blank&amp;r=g 2x' class='avatar avatar-49 photo' height='49' width='49' /><span class="screen-reader-text">Author </span> <a class="url fn n" href="../../stuart.html">Stuart</a></span></span><span class="posted-on"><span class="screen-reader-text">Posted on </span><a href="../../../2010/01/06/heating-up-clojure-swing.html" rel="bookmark"><time class="entry-date published updated" datetime="2010-01-06T17:32:34+00:00">January 6, 2010</time></a></span><span class="cat-links"><span class="screen-reader-text">Categories </span><a href="../../../category/programming.html" rel="category tag">Programming</a></span><span class="tags-links"><span class="screen-reader-text">Tags </span><a href="../../../tag/clojure.html" rel="tag">Clojure</a>, <a href="../../../tag/swing.html" rel="tag">Swing</a></span><span class="comments-link"><a href="../../../2010/01/06/heating-up-clojure-swing.html#comments">5 Comments<span class="screen-reader-text"> on Heating Up Clojure &#038; Swing</span></a></span>			</footer><!-- .entry-footer -->
</article><!-- #post-## -->

<article id="post-374" class="post-374 post type-post status-publish format-standard hentry category-programming tag-clojure tag-swing">
	<header class="entry-header">
		
		<h2 class="entry-title"><a href="../../../2010/01/05/taming-the-gridbaglayout.html" rel="bookmark">Taming the GridBagLayout</a></h2>	</header><!-- .entry-header -->

	
	
	<div class="entry-content">
		<p>GUI layout is hard.  You&#8217;d be crazy to do it without a GUI designer like Netbeans.</p>
<p>Well, I&#8217;m pretty crazy.  So I&#8217;m going to do some GUI layout in <a href="http://clojure.org/">Clojure</a>.  And I&#8217;m going to use the most intimidating of Java&#8217;s GUI layout classes, the <a title="GridBagLayout API docs" href="http://java.sun.com/javase/6/docs/api/java/awt/GridBagLayout.html">GridBagLayout</a>.</p>
<p>Conceptually, GridBagLayout is pretty straightforward.  It places components on a flexible grid, in which each column and row is automatically sized to fit the largest component.  A set of constraints placed on each component determines its exact placement, size, and alignment.</p>
<p>The devil, as usual, is in the details.  <a title="GridBagConstraints API docs" href="http://java.sun.com/javase/6/docs/api/java/awt/GridBagConstraints.html">GridBagConstraints</a> has 11 fields and 32 constants to control the layout of each component.  I won&#8217;t try to explain how it works; <a title="GridBagLayout tutorial" href="http://java.sun.com/docs/books/tutorial/uiswing/layout/gridbag.html">read the tutorial</a> a few times instead.</p>
<p>The problem with GridBagConstraints, from a Clojure point of view, is that it&#8217;s a mutable object with public instance fields.  This isn&#8217;t a problem for concurrency, because the object is used in only one place, but the syntax is awkward:</p>
<pre>(import 'java.awt.GridBagConstraints)
(def c (GridBagConstraints.))
(set! (. c gridx) 1)
(set! (. c gridy) GridBagConstraints/RELATIVE)</pre>
<p>Since I will have to do a lot of set!s, I can try to pare it down a bit with a macro:</p>
<pre>(defmacro set-grid! [constraints field value]
  `(set! (. ~constraints ~(symbol (name field)))
         ~(if (keyword? value)
            `(. java.awt.GridBagConstraints
                ~(symbol (name value)))
            value)))</pre>
<p>This macro takes a field name as a keyword and sets the value of that field.  I used keywords instead of bare symbols because they tend to signal names or constants in Clojure code.</p>
<p>The macro has one other trick up its sleeve: if the <em>value</em> of a field is a keyword, it gets used as the name of a static field (constant) in GridBagConstraints.</p>
<p>With this macro, the set!s in the previous example become:</p>
<pre>(set-grid! c :gridx 1)
(set-grid! c :gridy :RELATIVE)</pre>
<p>So far, so good.  But we&#8217;ve only replaced a bunch of set!s with a bunch of set-grid!s.</p>
<p>What we really want is a terse syntax for specifying constraints.  There are many ways to do this.  I could write a macro that creates a new GridBagConstraints for each component.  But that would require a lot of repetition.</p>
<p>Often one wants to reuse the same constraint for several components in a row.  The tutorial examples achieve this by using a single instance of GridBagConstraints and modifying its fields for each component.  (The definition of GridBagLayout explicitly permits this.)</p>
<p>So what I want is a macro that allows me to add components to a container, in any order, specifying only the constraints that need to change for each component.  Here&#8217;s what it will look like:</p>
<pre>(grid-bag-layout container
  :gridx 0, :gridy 0
  component-one
  :gridx :RELATIVE, :gridwidth 2
  component-two
  ;; ... more components &amp; constraints ...
  )</pre>
<p>The first argument to the macro is a container with a GridBagLayout as its layout manager.  What follows is a mixture of components and constraints. Each component is added to the layout with the current set of constraints.  A keyword signals a change to a constraint field, and is immediately followed by its value.  Once a field is set, it retains its value until it is set again.</p>
<p>The line breaks and commas are just whitespace; what matters is the order.</p>
<p>Here&#8217;s the macro:</p>
<pre>(defmacro grid-bag-layout [container & body]
  (let [c (gensym "c")
        cntr (gensym "cntr")]
    `(let [~c (new java.awt.GridBagConstraints)
           ~cntr ~container]
       ~@(loop [result '() body body]
           (if (empty? body)
             (reverse result)
             (let [expr (first body)]
               (if (keyword? expr)
                 (recur (cons `(set-grid! ~c ~expr
                                          ~(second body))
                              result)
                        (next (next body)))
                 (recur (cons `(.add ~cntr ~expr ~c)
                              result)
                        (next body)))))))))</pre>
<p>You&#8217;ll have to take my word for it that this macro was not especially difficult to write.  As for what it does, it loops through the body and recursively constructs code for the result.  When it encounters a keyword, it uses the set-grid! macro I defined earlier.  Otherwise, it assumes the expression is a component, and adds it to the container.  (The manual gensyms are necessary because of the nested backquotes.)</p>
<p>Here&#8217;s an example that creates a layout with three buttons, as in this screenshot:</p>
<p><a href="../../../wp-content/uploads/2010/01/gridbag-demo1.png"><img title="gridbag-demo1" src="../../../wp-content/uploads/2010/01/gridbag-demo1.png" alt="GridBagLayout example" width="150" height="70" /></a></p>
<pre>(import '(javax.swing JFrame JPanel JButton)
        '(java.awt GridBagLayout Insets))

(def panel
     (doto (JPanel. (GridBagLayout.))
       (grid-bag-layout
        :fill :BOTH, :insets (Insets. 5 5 5 5)
        :gridx 0, :gridy 0
        (JButton. "One")
        :gridy 1
        (JButton. "Two")
        :gridx 1, :gridy 0, :gridheight 2
        (JButton. "Three"))))

(def frame
     (doto (JFrame. "GridBagLayout Test")
       (.setContentPane panel)
       (.pack)
       (.setVisible true)))</pre>
<p>Admittedly, this is not all that much shorter than the equivalent Java code.   But it&#8217;s still shorter, without diminishing the power or flexibility of the original API.</p>
<p>This is the kind of mini-language for which Lisp is famous.  And it&#8217;s only the beginning.  We could go on to define a more complete, expressive, and functional language for designing GUIs.  But that will have to wait for another post.</p>
	</div><!-- .entry-content -->

	<footer class="entry-footer">
		<span class="byline"><span class="author vcard"><img alt='' src='https://secure.gravatar.com/avatar/55878d0196b91803f9cb2c372b0551d3?s=49&amp;d=blank&amp;r=g' srcset='https://secure.gravatar.com/avatar/55878d0196b91803f9cb2c372b0551d3?s=98&amp;d=blank&amp;r=g 2x' class='avatar avatar-49 photo' height='49' width='49' /><span class="screen-reader-text">Author </span> <a class="url fn n" href="../../stuart.html">Stuart</a></span></span><span class="posted-on"><span class="screen-reader-text">Posted on </span><a href="../../../2010/01/05/taming-the-gridbaglayout.html" rel="bookmark"><time class="entry-date published" datetime="2010-01-05T16:20:20+00:00">January 5, 2010</time><time class="updated" datetime="2010-01-05T16:24:40+00:00">January 5, 2010</time></a></span><span class="cat-links"><span class="screen-reader-text">Categories </span><a href="../../../category/programming.html" rel="category tag">Programming</a></span><span class="tags-links"><span class="screen-reader-text">Tags </span><a href="../../../tag/clojure.html" rel="tag">Clojure</a>, <a href="../../../tag/swing.html" rel="tag">Swing</a></span><span class="comments-link"><a href="../../../2010/01/05/taming-the-gridbaglayout.html#comments">7 Comments<span class="screen-reader-text"> on Taming the GridBagLayout</span></a></span>			</footer><!-- .entry-footer -->
</article><!-- #post-## -->

<article id="post-366" class="post-366 post type-post status-publish format-standard hentry category-programming tag-clojure tag-swing">
	<header class="entry-header">
		
		<h2 class="entry-title"><a href="../../../2010/01/03/doto-swing-with-clojure.html" rel="bookmark">doto Swing with Clojure</a></h2>	</header><!-- .entry-header -->

	
	
	<div class="entry-content">
		<p>One of the great things about <a href="http://clojure.org/">Clojure</a> is how it can make Java programming easier and less verbose.</p>
<p>Take Swing.  It takes a ton of code to render even a simple GUI.  Most tutorials don&#8217;t even tackle it without an IDE like NetBeans.</p>
<p>But we&#8217;ve got something Java lacks: macros!</p>
<p>In this post, I&#8217;ll build a simple counter application, using Clojure macros to make the code shorter and simpler.</p>
<p>Our app has two components: a label showing the current value of the counter, and a button to increment the counter.  Here&#8217;s the basic structure:</p>
<pre>(import '(javax.swing JLabel JButton JPanel JFrame))

(defn counter-app []
  (let [label (JLabel. "Counter: 0")
        button (JButton. "Add 1")
        panel (JPanel.)
        frame (JFrame. "Counter App")]
    (.setOpaque panel true)
    (.add panel label)
    (.add panel button)
    (.setContentPane frame panel)
    (.setSize frame 300 100)
    (.setVisible frame true)))
</pre>
<p>You can run <strong>counter-app</strong> at the REPL and see the resulting GUI layout, although the button doesn&#8217;t do anything yet.</p>
<p>The annoying thing about this code is the imperative style Swing forces on us: construct local variables and hammer at them with method calls.</p>
<p>Fortunately, Clojure has a handy built-in macro for just this kind of situation: <a title="doto API doc" href="http://richhickey.github.com/clojure/clojure.core-api.html#clojure.core/doto">doto</a>.  The <strong>doto</strong> macro takes a body of expressions.  It evaluates the first expression and saves it in a temporary variable, and then inserts that variable as the first argument in each of the following expressions.  Finally, doto returns the value of the temporary variable.  An example will make more sense:</p>
<pre>;; This code:
(doto (make-thing)
 (foo 1 2)
 (bar 3 4))

;; Expands to this:
(let [x (make-thing)]
 (foo x 1 2)
 (bar x 3 4)
 x)
</pre>
<p>The object created on the first line gets <em>threaded through</em> each of the following expressions and returned at the end.</p>
<p>We can use this to clean up our counter-app code:</p>
<pre>(defn counter-app []
  (let [label (JLabel. "Counter: 0")
        button (JButton. "Add 1")
        panel (doto (JPanel.)
                (.setOpaque true)
                (.add label)
                (.add button))]
    (doto (JFrame. "Counter App")
      (.setContentPane panel)
      (.setSize 300 100)
      (.setVisible true))))
</pre>
<p>Notice that we have eliminated one local variable (frame) entirely.  Furthermore, all the expressions dealing with the JPanel are neatly grouped together.</p>
<p>For this to work out neatly, the order of definitions is important.  We start at the inner-most components, JLabel and JButton, and move outward to the containing window.</p>
<p>Moving on!  In my <a href="../../../2010/01/02/swing-into-actions-with-clojure.html">last post</a>, I showed you how to proxy ActionListener to handle events like button clicks.  Rather than typing out the proxy code each time, let&#8217;s make a macro:</p>
<pre>(defmacro on-action [component event &amp; body]
  `(. ~component addActionListener
      (proxy [java.awt.event.ActionListener] []
        (actionPerformed [~event] ~@body))))</pre>
<p>The <strong>on-action</strong> macro&#8217;s first argument is any component (such as <a title="JButton API docs" href="http://java.sun.com/j2se/1.5.0/docs/api/javax/swing/JButton.html">JButton</a>) that has an addActionListener method.  The <strong>body</strong> of the macro is the code that will be executed when the <a title="ActionListener API docs" href="http://java.sun.com/j2se/1.5.0/docs/api/java/awt/event/ActionListener.html">ActionListener</a> is triggered.  The <strong>event</strong> argument is just a symbol; it will be bound to the <a title="ActionEvent API docs" href="http://java.sun.com/j2se/1.5.0/docs/api/java/awt/event/ActionEvent.html">ActionEvent</a> that triggered the listener.  (We could have used a fixed symbol like &#8220;this&#8221;, but that would be bad macro design.)</p>
<p>With this macro, the definition of our JButton can look like this:</p>
<pre>(doto (JButton. "Add 1")
  (on-action event
    ;; ... code to run when button is clicked ...
  ))</pre>
<p>We&#8217;re almost done!  We just need a place to store the current value of the counter.  Since we&#8217;re not worried about synchronization at this point, we can use an atom:</p>
<pre>;; Initialize the counter
(let [counter (atom 0)]
  ;; ... later on ...
  ;; Update the counter:
  (swap! counter inc))
</pre>
<p>Bringing it all together, our final app looks like this:</p>
<pre>(defn counter-app []
  (let [counter (atom 0)
        label (JLabel. "Counter: 0")
        button (doto (JButton. "Add 1")
                 (on-action evnt  ;; evnt is not used
                   (.setText label
                      (str "Counter: " (swap! counter inc)))))
        panel (doto (JPanel.)
                (.setOpaque true)
                (.add label)
                (.add button))]
    (doto (JFrame. "Counter App")
      (.setContentPane panel)
      (.setSize 300 100)
      (.setVisible true))))</pre>
<p>Run <strong>counter-app</strong> at the REPL and you have a working GUI application.  Not bad for about 50 lines!</p>
	</div><!-- .entry-content -->

	<footer class="entry-footer">
		<span class="byline"><span class="author vcard"><img alt='' src='https://secure.gravatar.com/avatar/55878d0196b91803f9cb2c372b0551d3?s=49&amp;d=blank&amp;r=g' srcset='https://secure.gravatar.com/avatar/55878d0196b91803f9cb2c372b0551d3?s=98&amp;d=blank&amp;r=g 2x' class='avatar avatar-49 photo' height='49' width='49' /><span class="screen-reader-text">Author </span> <a class="url fn n" href="../../stuart.html">Stuart</a></span></span><span class="posted-on"><span class="screen-reader-text">Posted on </span><a href="../../../2010/01/03/doto-swing-with-clojure.html" rel="bookmark"><time class="entry-date published updated" datetime="2010-01-03T13:34:33+00:00">January 3, 2010</time></a></span><span class="cat-links"><span class="screen-reader-text">Categories </span><a href="../../../category/programming.html" rel="category tag">Programming</a></span><span class="tags-links"><span class="screen-reader-text">Tags </span><a href="../../../tag/clojure.html" rel="tag">Clojure</a>, <a href="../../../tag/swing.html" rel="tag">Swing</a></span><span class="comments-link"><a href="../../../2010/01/03/doto-swing-with-clojure.html#comments">5 Comments<span class="screen-reader-text"> on doto Swing with Clojure</span></a></span>			</footer><!-- .entry-footer -->
</article><!-- #post-## -->

<article id="post-356" class="post-356 post type-post status-publish format-standard hentry category-programming tag-clojure tag-swing">
	<header class="entry-header">
		
		<h2 class="entry-title"><a href="../../../2010/01/02/swing-into-actions-with-clojure.html" rel="bookmark">Swing Into Actions with Clojure</a></h2>	</header><!-- .entry-header -->

	
	
	<div class="entry-content">
		<p>My <a href="../../../2010/01/02/first-steps-with-clojure-swing.html">previous post</a> left you with a Clojure/Swing GUI consisting of one window and one button.  Boring!  Let&#8217;s make it do something.</p>
<p>To catch up, start a Clojure REPL and type:</p>
<pre>(import '(javax.swing JFrame JPanel JButton))
(def button (JButton. "Click Me!"))
(def panel (doto (JPanel.)
             (.add button)))
(def frame (doto (JFrame. "Hello Frame")
             (.setSize 200 200)
             (.setContentPane panel)
             (.setVisible true)))
</pre>
<p>Boom, one window-and-button on the screen.</p>
<p>Let&#8217;s make our button do something.  First, we&#8217;ll define a function for what we want to do:</p>
<pre>(import 'javax.swing.JOptionPane)
(defn say-hello []
  (JOptionPane/showMessageDialog
    nil "Hello, World!" "Greeting"
    JOptionPane/INFORMATION_MESSAGE))</pre>
<p>You can call the say-hello function directly; it pops up a dialog box, using the utilities in <a title="JOptionPane API docs" href="http://java.sun.com/j2se/1.5.0/docs/api/javax/swing/JOptionPane.html">JOptionPane</a>.</p>
<p>To connect this function to our button, we have to provide a class implementing the <a title="ActionListener API docs" href="http://java.sun.com/j2se/1.5.0/docs/api/java/awt/event/ActionListener.html">ActionListener</a> interface.  Clojure&#8217;s <strong>proxy</strong> feature is the easiest way to do this:</p>
<pre>(import 'java.awt.event.ActionListener)
(def act (proxy [ActionListener] []
           (actionPerformed [event] (say-hello))))
</pre>
<p>Now <strong>act</strong> is an instance of an anonymous class implementing the <strong>actionPerformed</strong> method.  We can attach this class as a <em>listener</em> of our button:</p>
<pre>(.addActionListener button act)
</pre>
<p>And we&#8217;re done!  Click the button, and a dialog box pops up.</p>
	</div><!-- .entry-content -->

	<footer class="entry-footer">
		<span class="byline"><span class="author vcard"><img alt='' src='https://secure.gravatar.com/avatar/55878d0196b91803f9cb2c372b0551d3?s=49&amp;d=blank&amp;r=g' srcset='https://secure.gravatar.com/avatar/55878d0196b91803f9cb2c372b0551d3?s=98&amp;d=blank&amp;r=g 2x' class='avatar avatar-49 photo' height='49' width='49' /><span class="screen-reader-text">Author </span> <a class="url fn n" href="../../stuart.html">Stuart</a></span></span><span class="posted-on"><span class="screen-reader-text">Posted on </span><a href="../../../2010/01/02/swing-into-actions-with-clojure.html" rel="bookmark"><time class="entry-date published" datetime="2010-01-02T17:47:04+00:00">January 2, 2010</time><time class="updated" datetime="2010-01-03T11:33:42+00:00">January 3, 2010</time></a></span><span class="cat-links"><span class="screen-reader-text">Categories </span><a href="../../../category/programming.html" rel="category tag">Programming</a></span><span class="tags-links"><span class="screen-reader-text">Tags </span><a href="../../../tag/clojure.html" rel="tag">Clojure</a>, <a href="../../../tag/swing.html" rel="tag">Swing</a></span><span class="comments-link"><a href="../../../2010/01/02/swing-into-actions-with-clojure.html#comments">4 Comments<span class="screen-reader-text"> on Swing Into Actions with Clojure</span></a></span>			</footer><!-- .entry-footer -->
</article><!-- #post-## -->

<article id="post-348" class="post-348 post type-post status-publish format-standard hentry category-programming tag-clojure tag-swing">
	<header class="entry-header">
		
		<h2 class="entry-title"><a href="../../../2010/01/02/first-steps-with-clojure-swing.html" rel="bookmark">First Steps With Clojure &#038; Swing</a></h2>	</header><!-- .entry-header -->

	
	
	<div class="entry-content">
		<p><a title="The Java Swing Tutorial" href="http://java.sun.com/docs/books/tutorial/uiswing/">Swing</a> is the GUI standard for Java.  <a href="http://clojure.org/">Clojure</a> is the awesomeness standard for Java.  Let&#8217;s make an awesome GUI.</p>
<h1>Make a Window</h1>
<p>Interactive development is fun.  Fire up a Clojure REPL, and type this:</p>
<pre>(import 'javax.swing.JFrame)
(def frame (JFrame. "Hello Frame"))
(.setSize frame 200 200)
(.setVisible frame true)
</pre>
<p>Hey Presto, there&#8217;s a window!  (It might not pop to the front, so check your task bar.)</p>
<p><a title="JFrame API docs" href="http://java.sun.com/j2se/1.5.0/docs/api/javax/swing/JFrame.html">JFrame</a> is Swing&#8217;s all-purpose window class.  This example created a frame, set its dimensions to 200&#215;200 pixels, and &#8220;turned it on&#8221; by calling setVisible.</p>
<h1>Containers and Frames</h1>
<p>Our new frame doesn&#8217;t look like much; let&#8217;s give it some content.  More specifically, let&#8217;s give it a <em>container</em>.  Swing GUIs are laid out as a nested hierarchy of containers.  All containers &#8212; <strong>except</strong> the top-level window &#8212; are sub-classes of <a title="JComponent API docs" href="http://java.sun.com/j2se/1.5.0/docs/api/javax/swing/JComponent.html">JComponent</a>.  This is called the <a title="Container hierarchy tutorial" href="http://java.sun.com/docs/books/tutorial/uiswing/components/toplevel.html#general">containment hierarchy</a>.</p>
<p>Although it&#8217;s technically possible to add GUI elements directly to a top-level container like JFrame, it&#8217;s more correct to use a <a title="Content pane tutorial" href="http://java.sun.com/docs/books/tutorial/uiswing/components/toplevel.html#contentpane">content pane</a>.  We&#8217;ll use JPanel, a general-purpose container:</p>
<pre>(import 'javax.swing.JPanel)
(def panel (JPanel.))
(.setContentPane frame panel)</pre>
<p>A panel by itself doesn&#8217;t show anything, so lets make a button and add it to the panel.</p>
<pre>(import 'javax.swing.JButton)
(def button (JButton. "Click Me!"))
(.add panel button)
</pre>
<p>Hey, it&#8217;s not there!  That&#8217;s because Swing wasn&#8217;t designed with interactive development in mind.  To make your button visible, call:</p>
<pre>(.revalidate button)
</pre>
<p>The <a href="http://java.sun.com/j2se/1.5.0/docs/api/javax/swing/JComponent.html#revalidate%28%29">revalidate method</a> is not something you&#8217;ll read about in most Swing tutorials, because in pre-compiled Java it&#8217;s rarely necessary.  Basically, it tells Swing, &#8220;I just changed the layout, you need to redraw stuff.&#8221;  Starting at our JButton, Swing searches up the containment hierarchy to the top-level container, and redraws it.</p>
<p>Next step: Action!  My <a href="../../../2010/01/02/swing-into-actions-with-clojure.html">next post</a> will talk about enabling GUI events with ActionListener.</p>
	</div><!-- .entry-content -->

	<footer class="entry-footer">
		<span class="byline"><span class="author vcard"><img alt='' src='https://secure.gravatar.com/avatar/55878d0196b91803f9cb2c372b0551d3?s=49&amp;d=blank&amp;r=g' srcset='https://secure.gravatar.com/avatar/55878d0196b91803f9cb2c372b0551d3?s=98&amp;d=blank&amp;r=g 2x' class='avatar avatar-49 photo' height='49' width='49' /><span class="screen-reader-text">Author </span> <a class="url fn n" href="../../stuart.html">Stuart</a></span></span><span class="posted-on"><span class="screen-reader-text">Posted on </span><a href="../../../2010/01/02/first-steps-with-clojure-swing.html" rel="bookmark"><time class="entry-date published" datetime="2010-01-02T16:52:32+00:00">January 2, 2010</time><time class="updated" datetime="2010-01-02T17:49:14+00:00">January 2, 2010</time></a></span><span class="cat-links"><span class="screen-reader-text">Categories </span><a href="../../../category/programming.html" rel="category tag">Programming</a></span><span class="tags-links"><span class="screen-reader-text">Tags </span><a href="../../../tag/clojure.html" rel="tag">Clojure</a>, <a href="../../../tag/swing.html" rel="tag">Swing</a></span><span class="comments-link"><a href="../../../2010/01/02/first-steps-with-clojure-swing.html#comments">4 Comments<span class="screen-reader-text"> on First Steps With Clojure &#038; Swing</span></a></span>			</footer><!-- .entry-footer -->
</article><!-- #post-## -->

<article id="post-336" class="post-336 post type-post status-publish format-standard hentry category-programming tag-clojure tag-oop">
	<header class="entry-header">
		
		<h2 class="entry-title"><a href="../../../2009/12/14/objects-are-not-adts.html" rel="bookmark">Objects Are Not Abstract Data Types</a></h2>	</header><!-- .entry-header -->

	
	
	<div class="entry-content">
		<p>I was lucky enough to see a talk by Barbara Liskov, the grande dame of computer science.  The talk was titled &#8220;The Power of Abstraction,&#8221; and it covered Liskov&#8217;s work on programming languages in the 1970s and 1980s, primarily a language called CLU.</p>
<p><strong>Update 1/14/2010:</strong> Video of the same talk is available here: <a href="http://www.infoq.com/presentations/liskov-power-of-abstraction">OOPSLA Keynote: The Power Of Abstraction</a></p>
<p>CLU had a number of interesting features that were ahead of its time &#8212; heap-based garbage collection, typed exceptions, and iterators.  Many of these features made their way into object-oriented languages such as Java.  But CLU itself is not object-oriented.</p>
<p>Object-oriented languages, Liskov said, tend to conflate the concrete representation of a type with the interface used to access it.  Think of a classic Java class in an introductory OOP text.  The class contains both instance fields and methods to manipulate them.  Even though the fields are private, the interface is tied to a specific implementation.  You can&#8217;t substitute a different implementation, not even by subclassing.</p>
<p>CLU provides separate structures for fields and methods.  Fields are defined in <em>types</em>, which are more or less like C structs.  Methods are defined in <em>clusters</em>, from which the name CLU derives.  A cluster is a named set of method implementations, associated with one particular type.  Users only work with clusters, not types.  A cluster may be substituted by a another cluster that implements the same methods.</p>
<p>Why is this interesting now?  Because we&#8217;re just catching up to where Liskov was in the seventies.  Modern Java designs often favor interface-based APIs with no concrete inheritance and no public constructors.</p>
<p>This is even more interesting to me, because <a href="http://clojure.org/">my favorite programming language</a> will soon have features very similar to CLU&#8217;s types and clusters.  The &#8220;new&#8221; branch of Clojure defines two new abstractions: <a href="http://www.assembla.com/wiki/show/clojure/Datatypes">datatypes</a> and <a href="http://www.assembla.com/wiki/show/clojure/Protocols">protocols</a>.</p>
<p>A <em>protocol</em> is a set of function signatures, with no implementation.  Conceptually, it&#8217;s similar to a Java interface.  You could use a protocol to define an API to model some real-world object, such as Employee, Department, etc.</p>
<p>A <em>datatype</em> is a set of named fields, with optional type declarations.  Conceptually, it&#8217;s similar to a C struct.  However, a datatype can also declare support for any number of protocols, and supply methods to implement those protocols.  For example, Clojure will probably have a <em>Countable</em> protocol with a single method <em>count</em>.  Clojure datatypes like Lists and Vectors can provide their own implementations of <em>count</em>.  At that level, the datatype is like a concrete class implementing several interfaces.</p>
<p>What&#8217;s really cool is that you can <em>extend</em> protocols for existing types, even Java classes.  So, for example, we could implement <em>Countable</em> for java.lang.String by writing a <em>count</em> method that calls String.length().  This means you can create new protocols for Java classes that you do not control.  This is like <em>interface injection</em>, a proposed but as-yet unimplemented feature for Java.</p>
<p>Protocol method calls are dispatched dynamically based on the type of their first argument, very similar to (and at the same speed as) Java method calls.</p>
	</div><!-- .entry-content -->

	<footer class="entry-footer">
		<span class="byline"><span class="author vcard"><img alt='' src='https://secure.gravatar.com/avatar/55878d0196b91803f9cb2c372b0551d3?s=49&amp;d=blank&amp;r=g' srcset='https://secure.gravatar.com/avatar/55878d0196b91803f9cb2c372b0551d3?s=98&amp;d=blank&amp;r=g 2x' class='avatar avatar-49 photo' height='49' width='49' /><span class="screen-reader-text">Author </span> <a class="url fn n" href="../../stuart.html">Stuart</a></span></span><span class="posted-on"><span class="screen-reader-text">Posted on </span><a href="../../../2009/12/14/objects-are-not-adts.html" rel="bookmark"><time class="entry-date published" datetime="2009-12-14T15:39:18+00:00">December 14, 2009</time><time class="updated" datetime="2010-01-14T17:02:50+00:00">January 14, 2010</time></a></span><span class="cat-links"><span class="screen-reader-text">Categories </span><a href="../../../category/programming.html" rel="category tag">Programming</a></span><span class="tags-links"><span class="screen-reader-text">Tags </span><a href="../../../tag/clojure.html" rel="tag">Clojure</a>, <a href="../../../tag/oop.html" rel="tag">OOP</a></span><span class="comments-link"><a href="../../../2009/12/14/objects-are-not-adts.html#comments">18 Comments<span class="screen-reader-text"> on Objects Are Not Abstract Data Types</span></a></span>			</footer><!-- .entry-footer -->
</article><!-- #post-## -->

	<nav class="navigation pagination" role="navigation">
		<h2 class="screen-reader-text">Posts navigation</h2>
		<div class="nav-links"><a class="prev page-numbers" href="6.html">Previous page</a>
<a class='page-numbers' href='../index.html'><span class="meta-nav screen-reader-text">Page </span>1</a>
<span class="page-numbers dots">&hellip;</span>
<a class='page-numbers' href='6.html'><span class="meta-nav screen-reader-text">Page </span>6</a>
<span class='page-numbers current'><span class="meta-nav screen-reader-text">Page </span>7</span>
<a class='page-numbers' href='8.html'><span class="meta-nav screen-reader-text">Page </span>8</a>
<span class="page-numbers dots">&hellip;</span>
<a class='page-numbers' href='24.html'><span class="meta-nav screen-reader-text">Page </span>24</a>
<a class="next page-numbers" href="8.html">Next page</a></div>
	</nav>
		</main><!-- .site-main -->
	</div><!-- .content-area -->


	<aside id="secondary" class="sidebar widget-area" role="complementary">
		<section id="search-3" class="widget widget_search">
<form role="search" method="get" class="search-form" action="https://stuartsierra.com/">
	<label>
		<span class="screen-reader-text">Search for:</span>
		<input type="search" class="search-field" placeholder="Search &hellip;" value="" name="s" />
	</label>
	<button type="submit" class="search-submit"><span class="screen-reader-text">Search</span></button>
</form>
</section><section id="text-4" class="widget widget_text">			<div class="textwidget"><ul>
<li><a href="http://feeds2.feedburner.com/StuartSierra" title="Syndicate this site using RSS 2.0">Entries <abbr title="Really Simple Syndication">RSS</abbr></a></li>
<li><a href="../../../comments/feed" title="The latest comments to all posts in RSS">Comments <abbr title="Really Simple Syndication">RSS</abbr></a></li>
</ul>
<ul>
<li><a href="https://twitter.com/stuartsierra">Twitter</a></li>
<li><a href="https://github.com/stuartsierra">GitHub</a></li>
</ul></div>
		</section><section id="tag-widget-2" class="widget TagWidget"><h2 class="widget-title">Clojure Do’s and Don’ts</h2><ul class = "posts-by-tag-list"><li class="posts-by-tag-item Clojure do's and don'ts" id="posts-by-tag-item-883"><a class = "posts-by-tag-item-title" href="../../../2015/08/25/clojure-donts-lazy-effects.html">Clojure Don’ts: Lazy Effects</a></li><li class="posts-by-tag-item Clojure do's and don'ts" id="posts-by-tag-item-877"><a class = "posts-by-tag-item-title" href="../../../2015/08/10/clojure-donts-redundant-map.html">Clojure Don’ts: Redundant map</a></li><li class="posts-by-tag-item Clojure do's and don'ts" id="posts-by-tag-item-870"><a class = "posts-by-tag-item-title" href="../../../2015/06/16/clojure-donts-single-branch-if.html">Clojure Don’ts: Single-branch if</a></li><li class="posts-by-tag-item Clojure do's and don'ts" id="posts-by-tag-item-854"><a class = "posts-by-tag-item-title" href="../../../2015/06/10/clojure-donts-heisenparameter.html">Clojure Don’ts: The Heisenparameter</a></li><li class="posts-by-tag-item Clojure do's and don'ts" id="posts-by-tag-item-849"><a class = "posts-by-tag-item-title" href="../../../2015/06/01/clojure-donts-optional-arguments-with-varargs.html">Clojure Don’ts: Optional Arguments with Varargs</a></li><li class="posts-by-tag-item Clojure do's and don'ts errors" id="posts-by-tag-item-836"><a class = "posts-by-tag-item-title" href="../../../2015/05/27/clojure-uncaught-exceptions.html">Clojure Do’s: Uncaught Exceptions</a></li><li class="posts-by-tag-item Clojure do's and don'ts" id="posts-by-tag-item-831"><a class = "posts-by-tag-item-title" href="../../../2015/05/17/clojure-record-constructors.html">Record Constructors</a></li><li class="posts-by-tag-item Clojure do's and don'ts" id="posts-by-tag-item-826"><a class = "posts-by-tag-item-title" href="../../../2015/05/10/clojure-namespace-aliases.html">Clojure Do’s: Namespace Aliases</a></li><li class="posts-by-tag-item Clojure do's and don'ts" id="posts-by-tag-item-820"><a class = "posts-by-tag-item-title" href="../../../2015/05/02/clojure-donts-isa.html">Clojure Don’ts: isa?</a></li><li class="posts-by-tag-item Clojure do's and don'ts" id="posts-by-tag-item-812"><a class = "posts-by-tag-item-title" href="../../../2015/04/26/clojure-donts-concat.html">Clojure Don’ts: Concat</a></li></ul></section>	</aside><!-- .sidebar .widget-area -->

		</div><!-- .site-content -->

		<footer id="colophon" class="site-footer" role="contentinfo">
							<nav class="main-navigation" role="navigation" aria-label="Footer Primary Menu">
					<div class="menu-main-menu-container"><ul id="menu-main-menu-1" class="primary-menu"><li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-635"><a href="../../../about-me.html">About Me</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-633"><a href="../../../writing.html">Writing</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-634"><a href="../../../presentations.html">Presentations</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-636"><a href="../../../software.html">Software</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-637"><a href="../../../contact.html">Contact</a></li>
</ul></div>				</nav><!-- .main-navigation -->
			
			
			<div class="site-info">
								<span class="site-title"><a href="../../../index.html" rel="home">Digital Digressions by Stuart Sierra</a></span>
				<a href="https://wordpress.org/">Proudly powered by WordPress</a>
			</div><!-- .site-info -->
		</footer><!-- .site-footer -->
	</div><!-- .site-inner -->
</div><!-- .site -->

	<div style="display:none">
	<div class="grofile-hash-map-55878d0196b91803f9cb2c372b0551d3">
	</div>
	</div>
<script type='text/javascript' src='https://s0.wp.com/wp-content/js/devicepx-jetpack.js?ver=201635'></script>
<script type='text/javascript' src='https://secure.gravatar.com/js/gprofiles.js?ver=2016Sepaa'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var WPGroHo = {"my_hash":""};
/* ]]> */
</script>
<script type='text/javascript' src='../../../wp-content/plugins/jetpack/modules/wpgroho167b.js?ver=4.6'></script>
<script type='text/javascript' src='../../../wp-content/themes/twentysixteen/js/skip-link-focus-fix8de4.js?ver=20160816'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var screenReaderText = {"expand":"expand child menu","collapse":"collapse child menu"};
/* ]]> */
</script>
<script type='text/javascript' src='../../../wp-content/themes/twentysixteen/js/functions8de4.js?ver=20160816'></script>
<script type='text/javascript' src='../../../wp-includes/js/wp-embed.min167b.js?ver=4.6'></script>
<script type='text/javascript' src='https://stats.wp.com/e-201635.js' async defer></script>
<script type='text/javascript'>
	_stq = window._stq || [];
	_stq.push([ 'view', {v:'ext',j:'1:4.2.2',blog:'2702563',post:'0',tz:'-4',srv:'stuartsierra.com'} ]);
	_stq.push([ 'clickTrackerInit', '2702563', '0' ]);
</script>
</body>

<!-- Mirrored from stuartsierra.com/author/stuart/page/7 by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 02 Sep 2016 17:06:06 GMT -->
</html>

<!-- Dynamic page generated in 0.436 seconds. -->
<!-- Cached page generated by WP-Super-Cache on 2016-09-02 13:03:50 -->

<!-- Compression = gzip -->