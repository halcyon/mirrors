<!DOCTYPE html>
<html lang="en-US" class="no-js">

<!-- Mirrored from stuartsierra.com/author/stuart/page/2 by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 02 Sep 2016 16:57:19 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="profile" href="http://gmpg.org/xfn/11">
		<script>(function(html){html.className = html.className.replace(/\bno-js\b/,'js')})(document.documentElement);</script>
<title>Stuart &#8211; Page 2 &#8211; Digital Digressions by Stuart Sierra</title>
<link rel='dns-prefetch' href='http://s0.wp.com/'>
<link rel='dns-prefetch' href='http://secure.gravatar.com/'>
<link rel='dns-prefetch' href='http://fonts.googleapis.com/'>
<link rel='dns-prefetch' href='http://s.w.org/'>
<link rel="alternate" type="application/rss+xml" title="Digital Digressions by Stuart Sierra &raquo; Feed" href="http://feeds2.feedburner.com/StuartSierra" />
<link rel="alternate" type="application/rss+xml" title="Digital Digressions by Stuart Sierra &raquo; Comments Feed" href="../../../comments/feed" />
<link rel="alternate" type="application/rss+xml" title="Digital Digressions by Stuart Sierra &raquo; Posts by Stuart Feed" href="http://feeds2.feedburner.com/StuartSierra" />
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/stuartsierra.com\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.6"}};
			!function(a,b,c){function d(a){var c,d,e,f,g,h=b.createElement("canvas"),i=h.getContext&&h.getContext("2d"),j=String.fromCharCode;if(!i||!i.fillText)return!1;switch(i.textBaseline="top",i.font="600 32px Arial",a){case"flag":return i.fillText(j(55356,56806,55356,56826),0,0),!(h.toDataURL().length<3e3)&&(i.clearRect(0,0,h.width,h.height),i.fillText(j(55356,57331,65039,8205,55356,57096),0,0),c=h.toDataURL(),i.clearRect(0,0,h.width,h.height),i.fillText(j(55356,57331,55356,57096),0,0),d=h.toDataURL(),c!==d);case"diversity":return i.fillText(j(55356,57221),0,0),e=i.getImageData(16,16,1,1).data,f=e[0]+","+e[1]+","+e[2]+","+e[3],i.fillText(j(55356,57221,55356,57343),0,0),e=i.getImageData(16,16,1,1).data,g=e[0]+","+e[1]+","+e[2]+","+e[3],f!==g;case"simple":return i.fillText(j(55357,56835),0,0),0!==i.getImageData(16,16,1,1).data[0];case"unicode8":return i.fillText(j(55356,57135),0,0),0!==i.getImageData(16,16,1,1).data[0];case"unicode9":return i.fillText(j(55358,56631),0,0),0!==i.getImageData(16,16,1,1).data[0]}return!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g,h,i;for(i=Array("simple","flag","unicode8","diversity","unicode9"),c.supports={everything:!0,everythingExceptFlag:!0},h=0;h<i.length;h++)c.supports[i[h]]=d(i[h]),c.supports.everything=c.supports.everything&&c.supports[i[h]],"flag"!==i[h]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[i[h]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link rel='stylesheet' id='twentysixteen-jetpack-css'  href='../../../wp-content/plugins/jetpack/modules/theme-tools/compat/twentysixteen3a05.css?ver=4.2.2' type='text/css' media='all' />
<link rel='stylesheet' id='twentysixteen-fonts-css'  href='https://fonts.googleapis.com/css?family=Merriweather%3A400%2C700%2C900%2C400italic%2C700italic%2C900italic%7CMontserrat%3A400%2C700%7CInconsolata%3A400&amp;subset=latin%2Clatin-ext' type='text/css' media='all' />
<link rel='stylesheet' id='genericons-css'  href='../../../wp-content/plugins/jetpack/_inc/genericons/genericons/genericons128b.css?ver=3.1' type='text/css' media='all' />
<link rel='stylesheet' id='twentysixteen-style-css'  href='../../../wp-content/themes/twentysixteen/style167b.css?ver=4.6' type='text/css' media='all' />
<!--[if lt IE 10]>
<link rel='stylesheet' id='twentysixteen-ie-css'  href='https://stuartsierra.com/wp-content/themes/twentysixteen/css/ie.css?ver=20160816' type='text/css' media='all' />
<![endif]-->
<!--[if lt IE 9]>
<link rel='stylesheet' id='twentysixteen-ie8-css'  href='https://stuartsierra.com/wp-content/themes/twentysixteen/css/ie8.css?ver=20160816' type='text/css' media='all' />
<![endif]-->
<!--[if lt IE 8]>
<link rel='stylesheet' id='twentysixteen-ie7-css'  href='https://stuartsierra.com/wp-content/themes/twentysixteen/css/ie7.css?ver=20160816' type='text/css' media='all' />
<![endif]-->
<link rel='stylesheet' id='jetpack_css-css'  href='../../../wp-content/plugins/jetpack/css/jetpack3a05.css?ver=4.2.2' type='text/css' media='all' />
<script type='text/javascript' src='../../../wp-includes/js/jquery/jqueryb8ff.js?ver=1.12.4'></script>
<script type='text/javascript' src='../../../wp-includes/js/jquery/jquery-migrate.min330a.js?ver=1.4.1'></script>
<!--[if lt IE 9]>
<script type='text/javascript' src='https://stuartsierra.com/wp-content/themes/twentysixteen/js/html5.js?ver=3.7.3'></script>
<![endif]-->
<link rel='https://api.w.org/' href='../../../wp-json/index.html' />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="../../../xmlrpc0db0.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="../../../wp-includes/wlwmanifest.xml" /> 
<meta name="generator" content="WordPress 4.6" />

<link rel='dns-prefetch' href='http://v0.wordpress.com/'>

<!-- Jetpack Open Graph Tags -->
<meta property="og:type" content="profile" />
<meta property="og:title" content="Stuart" />
<meta property="og:url" content="https://stuartsierra.com/" />
<meta property="profile:first_name" content="Stuart" />
<meta property="profile:last_name" content="Sierra" />
<meta property="og:site_name" content="Digital Digressions by Stuart Sierra" />
<meta property="og:image" content="https://secure.gravatar.com/avatar/55878d0196b91803f9cb2c372b0551d3?s=200&amp;d=blank&amp;r=g" />
<meta property="og:locale" content="en_US" />
</head>

<body class="archive paged author author-stuart author-1 paged-2 author-paged-2 hfeed">
<div id="page" class="site">
	<div class="site-inner">
		<a class="skip-link screen-reader-text" href="#content">Skip to content</a>

		<header id="masthead" class="site-header" role="banner">
			<div class="site-header-main">
				<div class="site-branding">
					
											<p class="site-title"><a href="../../../index.html" rel="home">Digital Digressions by Stuart Sierra</a></p>
											<p class="site-description">From programming to everything else</p>
									</div><!-- .site-branding -->

									<button id="menu-toggle" class="menu-toggle">Menu</button>

					<div id="site-header-menu" class="site-header-menu">
													<nav id="site-navigation" class="main-navigation" role="navigation" aria-label="Primary Menu">
								<div class="menu-main-menu-container"><ul id="menu-main-menu" class="primary-menu"><li id="menu-item-635" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-635"><a href="../../../about-me.html">About Me</a></li>
<li id="menu-item-633" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-633"><a href="../../../writing.html">Writing</a></li>
<li id="menu-item-634" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-634"><a href="../../../presentations.html">Presentations</a></li>
<li id="menu-item-636" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-636"><a href="../../../software.html">Software</a></li>
<li id="menu-item-637" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-637"><a href="../../../contact.html">Contact</a></li>
</ul></div>							</nav><!-- .main-navigation -->
						
											</div><!-- .site-header-menu -->
							</div><!-- .site-header-main -->

											<div class="header-image">
					<a href="../../../index.html" rel="home">
						<img src="../../../wp-content/uploads/2015/12/header.jpg" srcset="https://stuartsierra.com/wp-content/uploads/2015/12/header-300x70.jpg 300w, https://stuartsierra.com/wp-content/uploads/2015/12/header-768x179.jpg 768w, https://stuartsierra.com/wp-content/uploads/2015/12/header-1024x239.jpg 1024w, https://stuartsierra.com/wp-content/uploads/2015/12/header.jpg 1200w" sizes="(max-width: 709px) 85vw, (max-width: 909px) 81vw, (max-width: 1362px) 88vw, 1200px" width="1200" height="280" alt="Digital Digressions by Stuart Sierra">
					</a>
				</div><!-- .header-image -->
					</header><!-- .site-header -->

		<div id="content" class="site-content">

	<div id="primary" class="content-area">
		<main id="main" class="site-main" role="main">

		
			<header class="page-header">
				<h1 class="page-title">Author: <span class="vcard">Stuart</span></h1>			</header><!-- .page-header -->

			
<article id="post-870" class="post-870 post type-post status-publish format-standard hentry category-programming tag-clojure tag-dos-and-donts">
	<header class="entry-header">
		
		<h2 class="entry-title"><a href="../../../2015/06/16/clojure-donts-single-branch-if.html" rel="bookmark">Clojure Don’ts: Single-branch if</a></h2>	</header><!-- .entry-header -->

	
	
	<div class="entry-content">
		<p>A short <a href="../../../tag/dos-and-donts.html">Clojure don’t</a> for today. This one is my style preference.</p>
<p>You have a single expression which should run if a condition is true, otherwise return <code>nil</code>.</p>
<p>Most Clojure programmers would probably write this:</p>
<div class="org-src-container">
<pre class="src src-clojure">(when (condition? ...)
  (then-expression ...))
</pre>
</div>
<p>But you could also write this:</p>
<div class="org-src-container">
<pre class="src src-clojure">(if (condition? ...)
  (then-expression ...)
  nil)
</pre>
</div>
<p>Or even this, because the “else” branch of <code>if</code> defaults to <code>nil</code>:</p>
<div class="org-src-container">
<pre class="src src-clojure">(if (condition? ...)
  (then-expression ...))
</pre>
</div>
<p>There’s an argument to be made for any one of these.</p>
<p>The second variant, <code>if ... nil</code>, makes it very explicit that you want to return <code>nil</code>. The <code>nil</code> might be semantically meaningful in this context instead of just a “default” value.</p>
<p>Some people like the third variant, <code>if</code> with no “else” branch, because they think <code>when</code> is only for side-effects, leaving the single-branch <code>if</code> for “pure” code.</p>
<p>But for me it comes down, as usual, to readability.</p>
<p>The vast majority of the time, <code>if</code> contains both “then” and “else” expressions.</p>
<p>Sometimes a long “then” branch leaves the “else” branch dangling below it. I’m expecting this, so when I read an <code>if</code> my eyes automatically scan down to find the “else” branch.</p>
<p>If I see an <code>if</code> but don’t find an “else” branch, I get momentarily confused. Maybe a line is missing or the code is mis-indented.</p>
<p>Likewise, if I see an <code>if</code> explicitly returing <code>nil</code>, it looks like a mistake because I know it could be written as <code>when</code>. This is a universal pattern in Clojure: lots of expressions (<code>cond</code>, <code>get</code>, <code>some</code>) return <code>nil</code> as their default case, so it’s jarring to see a literal <code>nil</code> as a return value.</p>
<p>So my preferred style is the first version. In general terms:</p>
<p><b>An <code>if</code> should always have both “then” and “else” branches.</b><br />
Use <code>when</code> for a condition which should return <code>nil</code> in the negative case.</p>
	</div><!-- .entry-content -->

	<footer class="entry-footer">
		<span class="byline"><span class="author vcard"><img alt='' src='https://secure.gravatar.com/avatar/55878d0196b91803f9cb2c372b0551d3?s=49&amp;d=blank&amp;r=g' srcset='https://secure.gravatar.com/avatar/55878d0196b91803f9cb2c372b0551d3?s=98&amp;d=blank&amp;r=g 2x' class='avatar avatar-49 photo' height='49' width='49' /><span class="screen-reader-text">Author </span> <a class="url fn n" href="../../stuart.html">Stuart</a></span></span><span class="posted-on"><span class="screen-reader-text">Posted on </span><a href="../../../2015/06/16/clojure-donts-single-branch-if.html" rel="bookmark"><time class="entry-date published" datetime="2015-06-16T20:25:00+00:00">June 16, 2015</time><time class="updated" datetime="2015-06-16T20:28:42+00:00">June 16, 2015</time></a></span><span class="cat-links"><span class="screen-reader-text">Categories </span><a href="../../../category/programming.html" rel="category tag">Programming</a></span><span class="tags-links"><span class="screen-reader-text">Tags </span><a href="../../../tag/clojure.html" rel="tag">Clojure</a>, <a href="../../../tag/dos-and-donts.html" rel="tag">do's and don'ts</a></span><span class="comments-link"><a href="../../../2015/06/16/clojure-donts-single-branch-if.html#comments">3 Comments<span class="screen-reader-text"> on Clojure Don’ts: Single-branch if</span></a></span>			</footer><!-- .entry-footer -->
</article><!-- #post-## -->

<article id="post-854" class="post-854 post type-post status-publish format-standard hentry category-programming tag-clojure tag-dos-and-donts">
	<header class="entry-header">
		
		<h2 class="entry-title"><a href="../../../2015/06/10/clojure-donts-heisenparameter.html" rel="bookmark">Clojure Don’ts: The Heisenparameter</a></h2>	</header><!-- .entry-header -->

	
	
	<div class="entry-content">
		<p>A <a href="../../../tag/dos-and-donts.html">pattern</a> I particularly dislike: Function parameters which may or may not be collections.</p>
<p>Say you have a function that does some operation on a batch of inputs:</p>
<div class="org-src-container">
<pre class="src src-clojure">(<span class="org-keyword">defn</span> <span class="org-function-name">process-batch</span> [items]
  <span class="org-comment-delimiter">;; </span><span class="org-comment">... do some work with items ...</span>
  )
</pre>
</div>
<p>Say further that, for this process, the fundamental unit of work is always a batch. Processing one thing is just a batch size of one.</p>
<p>Lots of processes are like this: I/O (arrays of bytes), database APIs (transactions of rows), and so on.</p>
<p>But maybe you have lots of code that mostly deals with one thing at a time, and only occasionally makes a larger batch. In the name of “convenience,” people write things like this:</p>
<div class="org-src-container">
<pre class="src src-clojure">(<span class="org-keyword">defn</span> <span class="org-function-name">wrap-coll</span>
  <span class="org-doc">"Wraps argument in a vector if it is not already a collection."</span>
  [arg]
  (<span class="org-keyword">if</span> (coll? arg)
    arg
    [arg]))

(<span class="org-keyword">defn</span> <span class="org-function-name">process</span>
  <span class="org-doc">"Processes a single input or a collection of inputs."</span>
  [input]
  (process-batch (wrap-coll input)))
</pre>
</div>
<p>This is prevalent in dynamically-typed languages of all stripes. I think it’s a case of mistakenly choosing convenience over clarity.</p>
<p>This leads easily to mistakes like iterating over a collection, calling <code>process</code> on each element, when the same work could be done more efficiently in a batch.</p>
<p>Now imagine reading some code when you encounter a call to this function:</p>
<div class="org-src-container">
<pre class="src src-clojure">(process stuff)
</pre>
</div>
<p>Is <code>stuff</code> a collection or a single object? Who knows?</p>
<p>When you read code, there’s a kind of ad-hoc, mental type-inference going on. This is true regardless of what typing scheme your language uses. Narrowing the range of possible types something can be makes it easier to reason about what type it actually is.</p>
<p>The more general principle:<br />
<b>Be explicit about your types even when they’re dynamic.</b></p>
<p>If the operation requires a collection, then pass it a collection every time.</p>
<p>A &#8220;helper&#8221; like <code>wrap-coll</code> saves you a whopping two characters over just wrapping the argument in a literal vector, at the cost of lost clarity and specificity.</p>
<hr />
<p>If you often forget to wrap the argument correctly, consider adding a type check:</p>
<div class="org-src-container">
<pre class="src src-clojure">(<span class="org-keyword">defn</span> <span class="org-function-name">process-batch</span> [items]
  {<span class="org-clojure-keyword">:pre</span> [(coll? items)]}
  <span class="org-comment-delimiter">;; </span><span class="org-comment">... </span>
  )
</pre>
</div>
<hr />
<p>If there actually are two distinct operations, one for a single object and one for a batch, then they should be separate functions:</p>
<div class="org-src-container">
<pre class="src src-clojure">(<span class="org-keyword">defn</span> <span class="org-function-name">process-one</span> [item]
  <span class="org-comment-delimiter">;; </span><span class="org-comment">...</span>
  )

(<span class="org-keyword">defn</span> <span class="org-function-name">process-batch</span> [items]
  <span class="org-comment-delimiter">;; </span><span class="org-comment">...</span>
  )
</pre>
</div>
	</div><!-- .entry-content -->

	<footer class="entry-footer">
		<span class="byline"><span class="author vcard"><img alt='' src='https://secure.gravatar.com/avatar/55878d0196b91803f9cb2c372b0551d3?s=49&amp;d=blank&amp;r=g' srcset='https://secure.gravatar.com/avatar/55878d0196b91803f9cb2c372b0551d3?s=98&amp;d=blank&amp;r=g 2x' class='avatar avatar-49 photo' height='49' width='49' /><span class="screen-reader-text">Author </span> <a class="url fn n" href="../../stuart.html">Stuart</a></span></span><span class="posted-on"><span class="screen-reader-text">Posted on </span><a href="../../../2015/06/10/clojure-donts-heisenparameter.html" rel="bookmark"><time class="entry-date published" datetime="2015-06-10T13:18:00+00:00">June 10, 2015</time><time class="updated" datetime="2015-06-16T13:40:55+00:00">June 16, 2015</time></a></span><span class="cat-links"><span class="screen-reader-text">Categories </span><a href="../../../category/programming.html" rel="category tag">Programming</a></span><span class="tags-links"><span class="screen-reader-text">Tags </span><a href="../../../tag/clojure.html" rel="tag">Clojure</a>, <a href="../../../tag/dos-and-donts.html" rel="tag">do's and don'ts</a></span><span class="comments-link"><a href="../../../2015/06/10/clojure-donts-heisenparameter.html#comments">5 Comments<span class="screen-reader-text"> on Clojure Don’ts: The Heisenparameter</span></a></span>			</footer><!-- .entry-footer -->
</article><!-- #post-## -->

<article id="post-849" class="post-849 post type-post status-publish format-standard hentry category-programming tag-clojure tag-dos-and-donts">
	<header class="entry-header">
		
		<h2 class="entry-title"><a href="../../../2015/06/01/clojure-donts-optional-arguments-with-varargs.html" rel="bookmark">Clojure Don’ts: Optional Arguments with Varargs</a></h2>	</header><!-- .entry-header -->

	
	
	<div class="entry-content">
		<p>Another <a href="../../../tag/dos-and-donts.html">Clojure don’t</a> today. This one is a personal style preference, but I’ll try to back it up.</p>
<p>Say you want to define a function with a mix of required and optional arguments. I’ve often seen this:</p>
<div class="org-src-container">
<pre class="src src-clojure">(<span class="org-keyword">defn</span> <span class="org-function-name">foo</span> [a &amp; [b]]
  (println <span class="org-string">"Required argument a is"</span> a)
  (println <span class="org-string">"Optional argument b is"</span> b))
</pre>
</div>
<p>This is a clever trick. It works because <code>&amp; [b]</code> destructures the sequence of arguments passed to the function after <code>a</code>. Sequential destructuring doesn’t require that the number of symbols match the number of elements in the sequence being bound. If there are more symbols than values, they are bound to <code>nil</code>.</p>
<div class="org-src-container">
<pre class="src src-clojure">(foo 3 4)
<span class="org-comment-delimiter">;; </span><span class="org-comment">Required argument a is 3</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">Optional argument b is 4</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">=&gt; nil</span>

(foo 9)
<span class="org-comment-delimiter">;; </span><span class="org-comment">Required argument a is 9</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">Optional argument b is nil</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">=&gt; nil</span>
</pre>
</div>
<p>I don’t like this pattern for two reasons.</p>
<p><b>One.</b> Because it’s variable arity, the function <code>foo</code> accepts <b>any</b> number of arguments. You won’t get an error if you call it with extra arguments, they will just be silently ignored.</p>
<div class="org-src-container">
<pre class="src src-clojure">(foo 5 6 7 8)
<span class="org-comment-delimiter">;; </span><span class="org-comment">Required argument a is 5</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">Optional argument b is 6</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">=&gt; nil</span>
</pre>
</div>
<p><b>Two.</b> It muddles the intent. The presence of <code>&amp;</code> in the parameter vector suggests that this function is <b>meant</b> to be variable-arity. Reading this code, I might start to wonder why. Or I might miss the <code>&amp;</code> and think this function is meant to be called with a sequence as its second argument.</p>
<p>A couple more lines make it clearer:</p>
<div class="org-src-container">
<pre class="src src-clojure">(<span class="org-keyword">defn</span> <span class="org-function-name">foo</span>
  ([a]
   (foo a <span class="org-constant">nil</span>))
  ([a b]
   (println <span class="org-string">"Required argument a is"</span> a)
   (println <span class="org-string">"Optional argument b is"</span> b)))
</pre>
</div>
<p>The intent here is unambiguous: The function takes either one or two arguments, with <code>b</code> defaulting to <code>nil</code>. Trying to call it with more than two arguments will throw an exception, telling you that you did something wrong.</p>
<p>And one more thing: it’s faster. Variable-arity function calls have to allocate a sequence to hold the arguments, then go through <code>apply</code>. Timothy Baldridge did a quick <a href="https://gist.github.com/halgari/5d7780e6f068ae217bb2">performance comparison</a> showing that calls to a function with multiple, fixed arities can be much faster than variable-arity (varargs) function calls.</p>
	</div><!-- .entry-content -->

	<footer class="entry-footer">
		<span class="byline"><span class="author vcard"><img alt='' src='https://secure.gravatar.com/avatar/55878d0196b91803f9cb2c372b0551d3?s=49&amp;d=blank&amp;r=g' srcset='https://secure.gravatar.com/avatar/55878d0196b91803f9cb2c372b0551d3?s=98&amp;d=blank&amp;r=g 2x' class='avatar avatar-49 photo' height='49' width='49' /><span class="screen-reader-text">Author </span> <a class="url fn n" href="../../stuart.html">Stuart</a></span></span><span class="posted-on"><span class="screen-reader-text">Posted on </span><a href="../../../2015/06/01/clojure-donts-optional-arguments-with-varargs.html" rel="bookmark"><time class="entry-date published" datetime="2015-06-01T20:34:00+00:00">June 1, 2015</time><time class="updated" datetime="2015-06-06T08:11:16+00:00">June 6, 2015</time></a></span><span class="cat-links"><span class="screen-reader-text">Categories </span><a href="../../../category/programming.html" rel="category tag">Programming</a></span><span class="tags-links"><span class="screen-reader-text">Tags </span><a href="../../../tag/clojure.html" rel="tag">Clojure</a>, <a href="../../../tag/dos-and-donts.html" rel="tag">do's and don'ts</a></span><span class="comments-link"><a href="../../../2015/06/01/clojure-donts-optional-arguments-with-varargs.html#comments">4 Comments<span class="screen-reader-text"> on Clojure Don’ts: Optional Arguments with Varargs</span></a></span>			</footer><!-- .entry-footer -->
</article><!-- #post-## -->

<article id="post-836" class="post-836 post type-post status-publish format-standard hentry category-programming tag-clojure tag-dos-and-donts tag-errors">
	<header class="entry-header">
		
		<h2 class="entry-title"><a href="../../../2015/05/27/clojure-uncaught-exceptions.html" rel="bookmark">Clojure Do’s: Uncaught Exceptions</a></h2>	</header><!-- .entry-header -->

	
	
	<div class="entry-content">
		<p>Some more <a href="../../../tag/dos-and-donts.html">do’s and don’ts</a> for you. This time it’s a ‘do.’</p>
<p>In the JVM, when an exception is thrown on a thread other than the main thread, and nothing is there to catch it, <b>nothing happens</b>. The thread <b>dies silently</b>.</p>
<p>This is bad news if you needed that thread to do some work. If all the worker threads die, the application could appear to be “up” but cease to do any useful work. And you’ll never know why.</p>
<p>In Clojure, this could happen on any thread you created with <code>core.async/thread</code>, a worker thread used by <code>core.async/go</code>, or a thread that was created for you by a Java framework such as a Servlet container.</p>
<p>One solution is to just wrap the body of every <code>thread</code> or <code>go</code> in a try/catch block. There are good reasons for doing this: you can get fine-grained control over how exceptions are handled. But it’s easy to forget, and it’s tedious to repeat if you can’t do anything useful with the exception besides log it.</p>
<p>So at a minimum, I recommend always including this snippet of code somewhere in the start-up procedure of your application:</p>
<div class="org-src-container">
<pre class="src src-clojure"><span class="org-comment-delimiter">;; </span><span class="org-comment">Assuming require [clojure.tools.logging :as log]</span>
(<span class="org-type">Thread</span>/<span class="org-clojure-interop-method">setDefaultUncaughtExceptionHandler</span>
 (reify <span class="org-type">Thread$UncaughtExceptionHandler</span>
   (<span class="org-clojure-interop-method">uncaughtException</span> [_ thread ex]
     (<span class="org-type">log</span>/error ex <span class="org-string">"Uncaught exception on"</span> (<span class="org-clojure-interop-method">.getName</span> thread)))))
</pre>
</div>
<p>This bit of code has saved my bacon more times than I can count.</p>
<p>This is a <b>global, JVM-wide</b> setting. There can be only one default uncaught exception handler. Individual Threads and ThreadGroups can have their own handlers, which get called in preference to the default handler. See <a href="http://docs.oracle.com/javase/8/docs/api/java/lang/Thread.html#setDefaultUncaughtExceptionHandler-java.lang.Thread.UncaughtExceptionHandler-">Thread.setDefaultUncaughtExceptionHandler</a>.</p>
<p>I’ve tried more aggressive measures, such as terminating the whole JVM process on any uncaught exception. While I think this is technically the correct thing to do, it turns out to be annoying in development.</p>
<p>Also annoying is the fact that some Java frameworks are <b>designed</b> to let threads fail silently. They just allocate a new thread in a pool and keep going. If your application is logging lots of uncaught exceptions but appears to be working normally, look to your container framework to see if that’s expected behavior.</p>
<div id="outline-container-unnumbered-1" class="outline-2">
<h2 id="unnumbered-1">The Hidden Future</h2>
<div id="text-unnumbered-1" class="outline-text-2">
<p>Another wrinkle: exceptions inside a <code>future</code> are <b>always</b> caught by the Future. The exception will not be thrown until something calls <a href="http://docs.oracle.com/javase/8/docs/api/java/util/concurrent/Future.html#get--">Future.get</a> (<code>deref</code> in Clojure).</p>
<p>Be aware that <a href="http://docs.oracle.com/javase/8/docs/api/java/util/concurrent/ExecutorService.html#submit-java.util.concurrent.Callable-">ExecutorService.submit</a> returns a Future, so if you’re using an ExecutorService you need to make sure something is eventually going to consume that Future to surface any exceptions it might have caught.</p>
<p>The parent interface <a href="http://docs.oracle.com/javase/8/docs/api/java/util/concurrent/Executor.html#execute-java.lang.Runnable-">Executor.execute</a> does <b>not</b> return a Future, so exeptions <b>will</b> reach the default exception handler.</p>
<p>Using ExecutorService.submit instead of Executor.execute was a bug in very early versions of core.async.</p>
</div>
</div>
	</div><!-- .entry-content -->

	<footer class="entry-footer">
		<span class="byline"><span class="author vcard"><img alt='' src='https://secure.gravatar.com/avatar/55878d0196b91803f9cb2c372b0551d3?s=49&amp;d=blank&amp;r=g' srcset='https://secure.gravatar.com/avatar/55878d0196b91803f9cb2c372b0551d3?s=98&amp;d=blank&amp;r=g 2x' class='avatar avatar-49 photo' height='49' width='49' /><span class="screen-reader-text">Author </span> <a class="url fn n" href="../../stuart.html">Stuart</a></span></span><span class="posted-on"><span class="screen-reader-text">Posted on </span><a href="../../../2015/05/27/clojure-uncaught-exceptions.html" rel="bookmark"><time class="entry-date published" datetime="2015-05-27T06:09:00+00:00">May 27, 2015</time><time class="updated" datetime="2015-05-28T03:40:38+00:00">May 28, 2015</time></a></span><span class="cat-links"><span class="screen-reader-text">Categories </span><a href="../../../category/programming.html" rel="category tag">Programming</a></span><span class="tags-links"><span class="screen-reader-text">Tags </span><a href="../../../tag/clojure.html" rel="tag">Clojure</a>, <a href="../../../tag/dos-and-donts.html" rel="tag">do's and don'ts</a>, <a href="../../../tag/errors.html" rel="tag">errors</a></span><span class="comments-link"><a href="../../../2015/05/27/clojure-uncaught-exceptions.html#comments">3 Comments<span class="screen-reader-text"> on Clojure Do’s: Uncaught Exceptions</span></a></span>			</footer><!-- .entry-footer -->
</article><!-- #post-## -->

<article id="post-831" class="post-831 post type-post status-publish format-standard hentry category-programming tag-clojure tag-dos-and-donts">
	<header class="entry-header">
		
		<h2 class="entry-title"><a href="../../../2015/05/17/clojure-record-constructors.html" rel="bookmark">Record Constructors</a></h2>	</header><!-- .entry-header -->

	
	
	<div class="entry-content">
		<p>Some more <a href="../../../tag/dos-and-donts.html">Clojure Do’s and Don’ts</a> for you. This week: record constructors.</p>
<div id="outline-container-unnumbered-1" class="outline-2">
<h2 id="unnumbered-1">Don’t use interop syntax to construct records</h2>
<div id="text-unnumbered-1" class="outline-text-2">
<p><code>defrecord</code> and <code>deftype</code> compile into Java classes, so it is possible to construct them using Java interop syntax like this:</p>
<div class="org-src-container">
<pre class="src src-clojure">(<span class="org-keyword">defrecord</span> <span class="org-type">Foo</span> [a b])

(<span class="org-type">Foo.</span> 1 2)
<span class="org-comment-delimiter">;;</span><span class="org-comment">=&gt; #user.Foo{:a 1, :b 2}</span>
</pre>
</div>
<p>But don’t do that. Interop syntax is for interop with Java libraries.</p>
<p>Since Clojure version 1.3, <code>defrecord</code> and <code>deftype</code> automatically create constructor functions. Use those instead of interop syntax.</p>
<p>For records, you get two constructor functions: one taking the values of fields in the same order they appear in the <code>defrecord</code>:</p>
<div class="org-src-container">
<pre class="src src-clojure">(<span class="org-keyword">defrecord</span> <span class="org-type">Foo</span> [a b])

(-&gt;Foo 1 2)
<span class="org-comment-delimiter">;;</span><span class="org-comment">=&gt; #user.Foo{:a 1 :b 2}</span>
</pre>
</div>
<p>And another taking a map whose keys are keywords with the same names as the fields:</p>
<div class="org-src-container">
<pre class="src src-clojure">(map-&gt;Foo {<span class="org-clojure-keyword">:b</span> 4 <span class="org-clojure-keyword">:a</span> 3})
<span class="org-comment-delimiter">;;</span><span class="org-comment">=&gt; #user.Foo{:a 3, :b 4}</span>
</pre>
</div>
<p><code>deftype</code> only creates the first kind of constructor, taking the field values in order.</p>
<div class="org-src-container">
<pre class="src src-clojure">(<span class="org-keyword">deftype</span> <span class="org-type">Bar</span> [c d])

(-&gt;Bar 5 6)
<span class="org-comment-delimiter">;;</span><span class="org-comment">=&gt; #&lt;Bar user.Bar@2168aeae&gt;</span>
</pre>
</div>
<p>Constructor functions are ordinary Clojure Vars. You can pass them to higher-order functions and <code>:require :as</code> or <code>:refer</code> them into other namespaces just like any other function.</p>
</div>
</div>
<div id="outline-container-unnumbered-2" class="outline-2">
<h2 id="unnumbered-2">Do add your own constructor functions</h2>
<div id="text-unnumbered-2" class="outline-text-2">
<p>You cannot modify or customize the constructor functions that <code>defrecord</code> and <code>deftype</code> create.</p>
<p>It’s common to want additional functionality around constructing an object, such as validation and default values. To get this, just define your own constructor function that wraps the default constructor.</p>
<div class="org-src-container">
<pre class="src src-clojure">(<span class="org-keyword">defrecord</span> <span class="org-type">Customer</span> [id name phone email])

(<span class="org-keyword">defn</span> <span class="org-function-name">customer</span>
  <span class="org-doc">"Creates a new customer record."</span>
  [{<span class="org-clojure-keyword">:keys</span> [name phone email]}]
  {<span class="org-clojure-keyword">:pre</span> [(string? name)
         (valid-phone? phone)
         (valid-email? email)]}
  (-&gt;Customer (next-id) name phone email))
</pre>
</div>
<p>You don’t necessarily have to use <code>:pre</code> conditions for validation; that’s just how I wrote this example.</p>
<p>It’s up to you to maintain a convention to always use your custom constructor function instead of the automatically-generated one.<sup><a id="fnr.1" class="footref" href="#fn.1">1</a></sup></p>
<p>I frequently define a custom constructor function for every new record type, even if I don&#8217;t need it right away. That gives me a place to add validation later, without searching for and replacing every instance of the default constructor.</p>
<p>Even custom constructor functions should follow the <a href="http://www.ibm.com/developerworks/library/j-jtp0618/">rules for safe constructors</a>. In general, that means no side effects and no “publishing” the object to another place before the constructor is finished. Keep the “creation” of an object (the constructor) separate from “starting” or “using” it, whatever that means for your code.</p>
</div>
</div>
<div id="footnotes">
<h2 class="footnotes">Footnotes:</h2>
<div id="text-footnotes">
<div class="footdef"><sup><a id="fn.1" class="footnum" href="#fnr.1">1</a></sup></p>
<p class="footpara">Theoretically you could make the default constructors private with <code>alter-meta!</code>, but I&#8217;ve never found it necessary.</p>
</div>
</div>
</div>
	</div><!-- .entry-content -->

	<footer class="entry-footer">
		<span class="byline"><span class="author vcard"><img alt='' src='https://secure.gravatar.com/avatar/55878d0196b91803f9cb2c372b0551d3?s=49&amp;d=blank&amp;r=g' srcset='https://secure.gravatar.com/avatar/55878d0196b91803f9cb2c372b0551d3?s=98&amp;d=blank&amp;r=g 2x' class='avatar avatar-49 photo' height='49' width='49' /><span class="screen-reader-text">Author </span> <a class="url fn n" href="../../stuart.html">Stuart</a></span></span><span class="posted-on"><span class="screen-reader-text">Posted on </span><a href="../../../2015/05/17/clojure-record-constructors.html" rel="bookmark"><time class="entry-date published" datetime="2015-05-17T05:19:00+00:00">May 17, 2015</time><time class="updated" datetime="2015-05-18T05:51:25+00:00">May 18, 2015</time></a></span><span class="cat-links"><span class="screen-reader-text">Categories </span><a href="../../../category/programming.html" rel="category tag">Programming</a></span><span class="tags-links"><span class="screen-reader-text">Tags </span><a href="../../../tag/clojure.html" rel="tag">Clojure</a>, <a href="../../../tag/dos-and-donts.html" rel="tag">do's and don'ts</a></span><span class="comments-link"><a href="../../../2015/05/17/clojure-record-constructors.html#comments">2 Comments<span class="screen-reader-text"> on Record Constructors</span></a></span>			</footer><!-- .entry-footer -->
</article><!-- #post-## -->

<article id="post-826" class="post-826 post type-post status-publish format-standard hentry category-programming tag-clojure tag-dos-and-donts">
	<header class="entry-header">
		
		<h2 class="entry-title"><a href="../../../2015/05/10/clojure-namespace-aliases.html" rel="bookmark">Clojure Do’s: Namespace Aliases</a></h2>	</header><!-- .entry-header -->

	
	
	<div class="entry-content">
		<p>Third in a <a href="../../../tag/dos-and-donts.html">series</a>, this time with some style recommendations based on my personal experience.</p>
<p>In a small project with only a few developers, things like naming and style conventions don’t matter all that much, because almost everyone has worked with almost all of the code.</p>
<p>With bigger teams and bigger code bases — think tens of developers, tens of thousands of lines of Clojure — there’s a good chance that anyone reading the code has <b>never seen it before</b>. For that reader, a few conventions can be a big help.</p>
<p>Optimizing for readability usually means being more verbose. Don’t abbreviate unless you have to.</p>
<p>It also means optimizing for a reader who is not necessarily familiar with the entire code base, or even an entire file. They’ve just jumped to a function definition in their editor, or maybe pulled a line number from a stack trace. They don’t want to take the time to understand how all the different namespaces relate. They especially don’t want to have to scroll to the top of the file just to see where a symbol comes from.</p>
<p>So these conventions are about maximizing readability at the level of single function definitions. Yes, it means more typing. But it makes it much easier to navigate a large codebase maintained by multiple people.</p>
<p>As a general first rule, make the alias the same as the namespace name with the leading parts removed.</p>
<div class="org-src-container">
<pre class="src src-clojure">(<span class="org-keyword">ns</span> <span class="org-type">com.example.application</span>
  (<span class="org-clojure-keyword">:require</span>
   [<span class="org-type">clojure.java.io</span> <span class="org-clojure-keyword">:as</span> io]
   [<span class="org-type">clojure.string</span> <span class="org-clojure-keyword">:as</span> string]))
</pre>
</div>
<p>Keep enough trailing parts to make each alias unique. Did you know that namespace aliases can have dots in them?</p>
<div class="org-src-container">
<pre class="src src-clojure">[<span class="org-type">clojure.data.xml</span> <span class="org-clojure-keyword">:as</span> <span class="org-type">data.xml</span>]
[<span class="org-type">clojure.xml</span> <span class="org-clojure-keyword">:as</span> xml]
</pre>
</div>
<p>Eliminate redundant words such as “core” and “clj” in aliases.</p>
<div class="org-src-container">
<pre class="src src-clojure">[clj-http <span class="org-clojure-keyword">:as</span> http]
[<span class="org-type">clj-time.core</span> <span class="org-clojure-keyword">:as</span> time]
[<span class="org-type">clj-time.format</span> <span class="org-clojure-keyword">:as</span> <span class="org-type">time.format</span>]
</pre>
</div>
<p>Use <code>:refer</code> sparingly. It’s good for symbols that have no alphabetic characters, such as <code>&gt;! &lt;! &gt;!! &lt;!!</code> in <code>core.async</code>, or heavily-used macros such those in <code>clojure.test</code>.</p>
<p>You can combine <code>:refer</code> and <code>:as</code> in the same <code>:require</code> clause.</p>
<div class="org-src-container">
<pre class="src src-clojure">[<span class="org-type">clojure.core.async</span> <span class="org-clojure-keyword">:as</span> async <span class="org-clojure-keyword">:refer</span> [&lt;! &gt;! &lt;!! &gt;!!]]
[<span class="org-type">clojure.test</span> <span class="org-clojure-keyword">:refer</span> [deftest is]]
</pre>
</div>
<p>There are always exceptions. For example, some namespaces have established conventions for aliases:</p>
<div class="org-src-container">
<pre class="src src-clojure">[<span class="org-type">datomic.api</span> <span class="org-clojure-keyword">:as</span> d]
</pre>
</div>
<p>Whatever convention you adopt, use consistent aliases everywhere. This makes it easier for everyone to read the code, and makes it possible to search for code with text-based tools like <code>grep</code>.</p>
	</div><!-- .entry-content -->

	<footer class="entry-footer">
		<span class="byline"><span class="author vcard"><img alt='' src='https://secure.gravatar.com/avatar/55878d0196b91803f9cb2c372b0551d3?s=49&amp;d=blank&amp;r=g' srcset='https://secure.gravatar.com/avatar/55878d0196b91803f9cb2c372b0551d3?s=98&amp;d=blank&amp;r=g 2x' class='avatar avatar-49 photo' height='49' width='49' /><span class="screen-reader-text">Author </span> <a class="url fn n" href="../../stuart.html">Stuart</a></span></span><span class="posted-on"><span class="screen-reader-text">Posted on </span><a href="../../../2015/05/10/clojure-namespace-aliases.html" rel="bookmark"><time class="entry-date published" datetime="2015-05-10T16:23:00+00:00">May 10, 2015</time><time class="updated" datetime="2015-05-11T07:45:35+00:00">May 11, 2015</time></a></span><span class="cat-links"><span class="screen-reader-text">Categories </span><a href="../../../category/programming.html" rel="category tag">Programming</a></span><span class="tags-links"><span class="screen-reader-text">Tags </span><a href="../../../tag/clojure.html" rel="tag">Clojure</a>, <a href="../../../tag/dos-and-donts.html" rel="tag">do's and don'ts</a></span><span class="comments-link"><a href="../../../2015/05/10/clojure-namespace-aliases.html#comments">4 Comments<span class="screen-reader-text"> on Clojure Do’s: Namespace Aliases</span></a></span>			</footer><!-- .entry-footer -->
</article><!-- #post-## -->

<article id="post-820" class="post-820 post type-post status-publish format-standard hentry category-programming tag-clojure tag-dos-and-donts">
	<header class="entry-header">
		
		<h2 class="entry-title"><a href="../../../2015/05/02/clojure-donts-isa.html" rel="bookmark">Clojure Don’ts: isa?</a></h2>	</header><!-- .entry-header -->

	
	
	<div class="entry-content">
		<p>Dynamic typing is cool, but sometimes you just want to know the type of something.</p>
<p>I&#8217;ve seen people write this:</p>
<div class="org-src-container">
<pre class="src src-clojure">(isa? (type x) <span class="org-type">SomeJavaClass</span>)
</pre>
</div>
<p>As its docstring describes, <code>isa?</code> checks inheritance relationships, which may come from <b>either</b> Java class inheritance or Clojure hierarchies.</p>
<p><code>isa?</code> manually walks the class inheritance tree, and has special cases for vectors of types to support multiple-argument dispatch in multimethods.</p>
<div class="org-src-container">
<pre class="src src-clojure"><span class="org-comment-delimiter">;; </span><span class="org-comment">isa? with a vector of types.</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">Both sequences and vectors are java.util.List.</span>
(isa? [(type (range)) (type [1 2 3])]
      [<span class="org-type">java.util.List</span> <span class="org-type">java.util.List</span>])
<span class="org-comment-delimiter">;;</span><span class="org-comment">=&gt; true</span>
</pre>
</div>
<p>Hierarchies are an interesting but rarely-used feature of Clojure.</p>
<div class="org-src-container">
<pre class="src src-clojure">(derive <span class="org-type">java.lang.String</span> <span class="org-clojure-keyword">::immutable</span>)

(isa? (type <span class="org-string">"Hello"</span>) <span class="org-clojure-keyword">::immutable</span>)
<span class="org-comment-delimiter">;;</span><span class="org-comment">=&gt; true</span>
</pre>
</div>
<p>If all you want to know is “Is x a Foo?” where Foo is a Java type, then <code>(instance? Foo x)</code> is simpler and faster than <code>isa?</code>.</p>
<p>Some examples:</p>
<div class="org-src-container">
<pre class="src src-clojure">(instance? <span class="org-type">String</span> <span class="org-string">"hello"</span>)
<span class="org-comment-delimiter">;;</span><span class="org-comment">=&gt; true</span>

(instance? <span class="org-type">Double</span> 3.14)
<span class="org-comment-delimiter">;;</span><span class="org-comment">=&gt; true</span>

(instance? <span class="org-type">Number</span> 3.14)
<span class="org-comment-delimiter">;;</span><span class="org-comment">=&gt; true</span>

(instance? <span class="org-type">java.util.Date</span> #inst <span class="org-string">"2015-01-01"</span>)
<span class="org-comment-delimiter">;;</span><span class="org-comment">=&gt; true</span>
</pre>
</div>
<p>Note that <code>instance?</code> takes the type first, opposite to the argument order of <code>isa?</code>. This works nicely with <code>condp</code>:</p>
<div class="org-src-container">
<pre class="src src-clojure">(<span class="org-keyword">defn</span> <span class="org-function-name">make-bigger</span> [x]
  (<span class="org-keyword">condp</span> instance? x
    <span class="org-type">String</span> (<span class="org-type">clojure.string</span>/upper-case x)
    <span class="org-type">Number</span> (* x 1000)))

(make-bigger 42)
<span class="org-comment-delimiter">;;</span><span class="org-comment">=&gt; 42000</span>

(make-bigger <span class="org-string">"Hi there"</span>)
<span class="org-comment-delimiter">;;</span><span class="org-comment">=&gt; "HI THERE"</span>
</pre>
</div>
<p><code>instance?</code> maps directly to Java&#8217;s <a href="http://docs.oracle.com/javase/8/docs/api/java/lang/Class.html#isInstance-java.lang.Object-">Class.isInstance(Object)</a>. It works for both classes and interfaces, but does not accept <code>nil</code> as a type.</p>
<div class="org-src-container">
<pre class="src src-clojure">(isa? <span class="org-type">String</span> <span class="org-constant">nil</span>)      <span class="org-comment-delimiter">;;</span><span class="org-comment">=&gt; false</span>

(instance? <span class="org-type">String</span> <span class="org-constant">nil</span>) <span class="org-comment-delimiter">;;</span><span class="org-comment">=&gt; false</span>

(isa? <span class="org-constant">nil</span> <span class="org-constant">nil</span>)         <span class="org-comment-delimiter">;;</span><span class="org-comment">=&gt; true</span>

(instance? <span class="org-constant">nil</span> <span class="org-constant">nil</span>)    <span class="org-comment-delimiter">;; </span><span class="org-comment">NullPointerException</span>
</pre>
</div>
<p>Remember that <code>defrecord</code> and <code>deftype</code> produce Java classes as well:</p>
<div class="org-src-container">
<pre class="src src-clojure">(<span class="org-keyword">defrecord</span> <span class="org-type">FooBar</span> [a])

(instance? <span class="org-type">FooBar</span> (-&gt;FooBar 42))
<span class="org-comment-delimiter">;;</span><span class="org-comment">=&gt; true</span>
</pre>
</div>
<p>Remember also that records and types are classes, not Vars, so to reference them from another namespace you must <code>:import</code> instead of <code>:require</code> them.</p>
<p><code>instance?</code> won&#8217;t work correctly with Clojure protocols. To check if something supports a protocol, use <code>satisfies?</code>.</p>
	</div><!-- .entry-content -->

	<footer class="entry-footer">
		<span class="byline"><span class="author vcard"><img alt='' src='https://secure.gravatar.com/avatar/55878d0196b91803f9cb2c372b0551d3?s=49&amp;d=blank&amp;r=g' srcset='https://secure.gravatar.com/avatar/55878d0196b91803f9cb2c372b0551d3?s=98&amp;d=blank&amp;r=g 2x' class='avatar avatar-49 photo' height='49' width='49' /><span class="screen-reader-text">Author </span> <a class="url fn n" href="../../stuart.html">Stuart</a></span></span><span class="posted-on"><span class="screen-reader-text">Posted on </span><a href="../../../2015/05/02/clojure-donts-isa.html" rel="bookmark"><time class="entry-date published" datetime="2015-05-02T07:39:00+00:00">May 2, 2015</time><time class="updated" datetime="2015-05-04T12:28:22+00:00">May 4, 2015</time></a></span><span class="cat-links"><span class="screen-reader-text">Categories </span><a href="../../../category/programming.html" rel="category tag">Programming</a></span><span class="tags-links"><span class="screen-reader-text">Tags </span><a href="../../../tag/clojure.html" rel="tag">Clojure</a>, <a href="../../../tag/dos-and-donts.html" rel="tag">do's and don'ts</a></span>			</footer><!-- .entry-footer -->
</article><!-- #post-## -->

<article id="post-812" class="post-812 post type-post status-publish format-standard hentry category-programming tag-clojure tag-dos-and-donts">
	<header class="entry-header">
		
		<h2 class="entry-title"><a href="../../../2015/04/26/clojure-donts-concat.html" rel="bookmark">Clojure Don’ts: Concat</a></h2>	</header><!-- .entry-header -->

	
	
	<div class="entry-content">
		<p>Welcome to what I hope will be an ongoing series of Clojure <i>do’s</i> and <i>don’ts</i>. I want to demonstrate not just good patterns to use, but also anti-patterns to avoid.</p>
<p>Some of these will be personal preferences, others will be warnings from hard-won experience. I’ll try to indicate which is which.</p>
<p>First up: <code>concat</code>.</p>
<div id="outline-container-unnumbered-1" class="outline-2">
<h2 id="unnumbered-1">Concat, the lazily-ticking time bomb</h2>
<div id="text-unnumbered-1" class="outline-text-2">
<p><code>concat</code> is a tricky little function. The name suggests a way to combine two collections. And it is, if you have <b>only</b> two collections. But it’s not as general as you might think. It’s not really a collection function at all. It’s a lazy sequence function. The difference can be important.</p>
<p>Here’s an example that I see a lot in the wild. Say you have a loop that builds up some result collection as the concatenation of several intermediate results:<sup><a id="fnr.1" class="footref" href="#fn.1">1</a></sup></p>
<div class="org-src-container">
<pre class="src src-clojure">(<span class="org-keyword">defn</span> <span class="org-function-name">next-results</span>
  <span class="org-doc">"Placeholder for function which computes some intermediate</span>
<span class="org-doc">  collection of results."</span>
  [n]
  (range 1 n))

(<span class="org-keyword">defn</span> <span class="org-function-name">build-result</span> [n]
  (<span class="org-keyword">loop</span> [counter 1
         results []]
    (<span class="org-keyword">if</span> (&lt; counter n)
      (<span class="org-keyword">recur</span> (inc counter)
             (concat results (next-results counter)))
      results)))
</pre>
</div>
<p>The devilish thing about this function is that it works just fine when <code>n</code> is small.</p>
<div class="org-src-container">
<pre class="src src-clojure">(take 21 (build-result 100))
<span class="org-comment-delimiter">;;</span><span class="org-comment">=&gt; (1 1 2 1 2 3 1 2 3 4 1 2 3 4 5 1 2 3 4 5 6)</span>
</pre>
</div>
<p>But when <code>n</code> gets sufficiently large,<sup><a id="fnr.2" class="footref" href="#fn.2">2</a></sup> suddenly this happens:</p>
<div class="org-src-container">
<pre class="src src-clojure">(first (build-result 4000))
<span class="org-comment-delimiter">;; </span><span class="org-comment">StackOverflowError   clojure.core/seq (core.clj:133)</span>
</pre>
</div>
<p>In the stack trace, we see <code>concat</code> and <code>seq</code> repeated over and over:</p>
<div class="org-src-container">
<pre class="src src-clojure">(<span class="org-clojure-interop-method">.printStackTrace</span> <span class="org-builtin">*e</span> <span class="org-builtin">*out*</span>)
<span class="org-comment-delimiter">;; </span><span class="org-comment">java.lang.StackOverflowError</span>
<span class="org-comment-delimiter">;;      </span><span class="org-comment">at clojure.core$seq.invoke(core.clj:133)</span>
<span class="org-comment-delimiter">;;      </span><span class="org-comment">at clojure.core$concat$fn__3955.invoke(core.clj:685)</span>
<span class="org-comment-delimiter">;;      </span><span class="org-comment">at clojure.lang.LazySeq.sval(LazySeq.java:40)</span>
<span class="org-comment-delimiter">;;      </span><span class="org-comment">at clojure.lang.LazySeq.seq(LazySeq.java:49)</span>
<span class="org-comment-delimiter">;;      </span><span class="org-comment">at clojure.lang.RT.seq(RT.java:484)</span>
<span class="org-comment-delimiter">;;      </span><span class="org-comment">at clojure.core$seq.invoke(core.clj:133)</span>
<span class="org-comment-delimiter">;;      </span><span class="org-comment">at clojure.core$concat$fn__3955.invoke(core.clj:685)</span>
<span class="org-comment-delimiter">;;      </span><span class="org-comment">at clojure.lang.LazySeq.sval(LazySeq.java:40)</span>
<span class="org-comment-delimiter">;;      </span><span class="org-comment">at clojure.lang.LazySeq.seq(LazySeq.java:49)</span>
<span class="org-comment-delimiter">;;      </span><span class="org-comment">at clojure.lang.RT.seq(RT.java:484)</span>
<span class="org-comment-delimiter">;;      </span><span class="org-comment">at clojure.core$seq.invoke(core.clj:133)</span>
<span class="org-comment-delimiter">;;      </span><span class="org-comment">at clojure.core$concat$fn__3955.invoke(core.clj:685)</span>
<span class="org-comment-delimiter">;;      </span><span class="org-comment">at clojure.lang.LazySeq.sval(LazySeq.java:40)</span>
<span class="org-comment-delimiter">;;      </span><span class="org-comment">at clojure.lang.LazySeq.seq(LazySeq.java:49)</span>
<span class="org-comment-delimiter">;;      </span><span class="org-comment">... hundreds more ...</span>
</pre>
</div>
<p>So we have a stack overflow. But why? We used <code>recur</code>. Our code has no stack-consuming recursion. <i>Or does it?</i> (cue ominous music)</p>
</div>
</div>
<div id="outline-container-unnumbered-2" class="outline-2">
<h2 id="unnumbered-2">Call the bomb squad</h2>
<div id="text-unnumbered-2" class="outline-text-2">
<p>Let’s look at the definition of <code>concat</code> more closely. Leaving out the extra arities and chunked sequence optimizations, it looks like this:</p>
<div class="org-src-container">
<pre class="src src-clojure">(<span class="org-keyword">defn</span> <span class="org-function-name">concat</span> [x y]
  (lazy-seq
    (<span class="org-keyword">if-let</span> [s (seq x)]
      (cons (first s) (concat (rest s) y))
      y)))
</pre>
</div>
<p><code>lazy-seq</code> is a macro that wraps its body in function and then wraps the function in a LazySeq object.</p>
<p>The loop in <code>build-result</code> calls <code>concat</code> on the LazySeq returned by the <i>previous</i> <code>concat</code>, creating a chain of LazySeqs like this:</p>
<div class="figure">
<p><img src="../../../wp-content/uploads/2015/04/wpid-LazySeq-tree.png" alt="LazySeq-tree.png" /></p>
</div>
<p>Calling <code>seq</code> forces the LazySeq to invoke its function to realize its value. Most Clojure sequence functions, such as <code>first</code>, call <code>seq</code> for you automatically. Printing a LazySeq also forces it to be realized.</p>
<p>In the case of our <code>concat</code> chain, each LazySeq’s <code>fn</code> returns another LazySeq. <code>seq</code> has to recurse through them until it finds an actual value. If this recursion goes too deep, it overflows the stack.</p>
<p>Just <b>constructing</b> the sequence doesn’t trigger the error:</p>
<div class="org-src-container">
<pre class="src src-clojure">(<span class="org-keyword">let</span> [r (build-result 4000)]
  <span class="org-constant">nil</span>)
<span class="org-comment-delimiter">;;</span><span class="org-comment">=&gt; nil</span>
</pre>
</div>
<p>It only overflows when we try to realize it:</p>
<div class="org-src-container">
<pre class="src src-clojure">(<span class="org-keyword">let</span> [r (build-result 4000)]
  (seq r)
  <span class="org-constant">nil</span>)
<span class="org-comment-delimiter">;; </span><span class="org-comment">StackOverflowError   clojure.lang.RT.seq (RT.java:484)</span>
</pre>
</div>
<p>This is a nasty bug in production code, because it could occur far away from its source, and the accumulated stack frames of <code>seq</code> prevent us from seeing where the error originated.</p>
</div>
</div>
<div id="outline-container-unnumbered-3" class="outline-2">
<h2 id="unnumbered-3">Don’t concat</h2>
<div id="text-unnumbered-3" class="outline-text-2">
<p>The fix is to avoid <code>concat</code> in the first place. Our loop is building up a result collection immediately, not lazily, so we can use a vector and call <code>into</code> to accumulate the results:</p>
<div class="org-src-container">
<pre class="src src-clojure">(<span class="org-keyword">defn</span> <span class="org-function-name">build-result-2</span> [n]
  (<span class="org-keyword">loop</span> [counter 1
         results []]
    (<span class="org-keyword">if</span> (&lt; counter n)
      (<span class="org-keyword">recur</span> (inc counter)
             (into results (next-results counter)))
      results)))
</pre>
</div>
<p>This works, at the cost of realizing the entire collection up front:</p>
<div class="org-src-container">
<pre class="src src-clojure">(time (<span class="org-keyword">doall</span> (take 21 (build-result-2 4000))))
<span class="org-comment-delimiter">;; </span><span class="org-comment">"Elapsed time: 830.66655 msecs"</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">=&gt; (1 1 2 1 2 3 1 2 3 4 1 2 3 4 5 1 2 3 4 5 6)</span>
</pre>
</div>
<p>This specific example could also be written as a proper lazy sequence like this:</p>
<div class="org-src-container">
<pre class="src src-clojure">(<span class="org-keyword">defn</span> <span class="org-function-name">build-result-3</span> [n]
  (mapcat #(range 1 <span class="org-variable-name">%</span>) (range 1 n)))
</pre>
</div>
<p>Which avoids building the whole sequence in advance:</p>
<div class="org-src-container">
<pre class="src src-clojure">(time (<span class="org-keyword">doall</span> (take 21 (build-result-3 4000))))
<span class="org-comment-delimiter">;; </span><span class="org-comment">"Elapsed time: 0.075421 msecs"</span>
<span class="org-comment-delimiter">;;</span><span class="org-comment">=&gt; (1 1 2 1 2 3 1 2 3 4 1 2 3 4 5 1 2 3 4 5 6)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-unnumbered-4" class="outline-2">
<h2 id="unnumbered-4">Don’t mix lazy and strict</h2>
<div id="text-unnumbered-4" class="outline-text-2">
<p>There’s a more general principle here:<br />
<b>Don’t use lazy sequence operations in a non-lazy loop.</b></p>
<p>If you’re using lazy sequences, make sure everything is truly lazy (or small). If you’re in a non-lazy loop, don’t build up a lazy result.</p>
<p>There are many variations of this bug, such as:</p>
<div class="org-src-container">
<pre class="src src-clojure">(first (reduce concat (map next-results (range 1 4000))))
<span class="org-comment-delimiter">;; </span><span class="org-comment">StackOverflowError   clojure.core/seq (core.clj:133)</span>
</pre>
</div>
<div class="org-src-container">
<pre class="src src-clojure">(nth (iterate #(concat <span class="org-variable-name">%</span> [1 2 3]) [1 2 3]) 4000)
<span class="org-comment-delimiter">;; </span><span class="org-comment">StackOverflowError   clojure.core/seq (core.clj:133)</span>
</pre>
</div>
<div class="org-src-container">
<pre class="src src-clojure">(first (<span class="org-clojure-keyword">:a</span> (apply merge-with concat
                  (map (<span class="org-keyword">fn</span> [n] {<span class="org-clojure-keyword">:a</span> (range 1 n)})
                       (range 1 4000)))))
<span class="org-comment-delimiter">;; </span><span class="org-comment">StackOverflowError   clojure.core/seq (core.clj:133)</span>
</pre>
</div>
<p>It’s not just <code>concat</code> either — any lazy sequence function could potentially cause this. <code>concat</code> is just the most common culprit.</p>
<p><strong>Update October 3, 2015:</strong> My friend Jon Distad has come up with a way to avoid this bug with a different implementation of <code>concat</code>. See <a href="https://groups.google.com/d/topic/clojure-dev/ewBuyloeiFs/discussion">Concat implementation without stack overflow</a> on the Clojure mailing list.</p>
</div>
</div>
<div id="footnotes">
<h2 class="footnotes">Footnotes:</h2>
<div id="text-footnotes">
<div class="footdef">
<p><sup><a id="fn.1" class="footnum" href="#fnr.1">1</a></sup></p>
<p class="footpara">All these examples use Clojure version 1.6.0</p>
</div>
<div class="footdef">
<p><sup><a id="fn.2" class="footnum" href="#fnr.2">2</a></sup></p>
<p class="footpara">Depending on your JVM settings, it may take more or fewer iterations to trigger a StackOverflowError.</p>
</div>
</div>
</div>
	</div><!-- .entry-content -->

	<footer class="entry-footer">
		<span class="byline"><span class="author vcard"><img alt='' src='https://secure.gravatar.com/avatar/55878d0196b91803f9cb2c372b0551d3?s=49&amp;d=blank&amp;r=g' srcset='https://secure.gravatar.com/avatar/55878d0196b91803f9cb2c372b0551d3?s=98&amp;d=blank&amp;r=g 2x' class='avatar avatar-49 photo' height='49' width='49' /><span class="screen-reader-text">Author </span> <a class="url fn n" href="../../stuart.html">Stuart</a></span></span><span class="posted-on"><span class="screen-reader-text">Posted on </span><a href="../../../2015/04/26/clojure-donts-concat.html" rel="bookmark"><time class="entry-date published" datetime="2015-04-26T11:44:00+00:00">April 26, 2015</time><time class="updated" datetime="2015-10-03T11:40:23+00:00">October 3, 2015</time></a></span><span class="cat-links"><span class="screen-reader-text">Categories </span><a href="../../../category/programming.html" rel="category tag">Programming</a></span><span class="tags-links"><span class="screen-reader-text">Tags </span><a href="../../../tag/clojure.html" rel="tag">Clojure</a>, <a href="../../../tag/dos-and-donts.html" rel="tag">do's and don'ts</a></span><span class="comments-link"><a href="../../../2015/04/26/clojure-donts-concat.html#comments">4 Comments<span class="screen-reader-text"> on Clojure Don’ts: Concat</span></a></span>			</footer><!-- .entry-footer -->
</article><!-- #post-## -->

<article id="post-795" class="post-795 post type-post status-publish format-standard hentry category-programming tag-clojure">
	<header class="entry-header">
		
		<h2 class="entry-title"><a href="../../../2015/01/02/clojure-2014-year-in-review.html" rel="bookmark">Clojure 2014 Year in Review</a></h2>	</header><!-- .entry-header -->

	
	
	<div class="entry-content">
		<div id="outline-container-sec-1" class="outline-2">
<p>My unscientific, incomplete, thoroughly biased view of interesting things that happened with Clojure in 2014.</p>
<h2 id="sec-1">Who&#8217;s Using Clojure?</h2>
<div id="text-1" class="outline-text-2">
<p>No doubt about it: Clojure is making inroads in big business.</p>
<p><a href="http://www.threatgrid.com/new-chapter/">Cisco acquired ThreatGRID</a>, a malware/threat analysis company <a href="http://www.threatgrid.com/software-developer-clojure/">using Clojure</a>.</p>
<p>There hasn&#8217;t been what I&#8217;d call an official announcement from <a href="http://www.amazon.com/">Amazon</a>, but it&#8217;s clear from <a href="https://twitter.com/jng27/status/541334956291522560">tweets</a> and <a href="http://lispjobs.wordpress.com/2014/11/25/clojure-software-development-engineers-amazon-com/">job listings</a> that they&#8217;re using Clojure in production.</p>
<p>Also on the sort-of-announced front, <a href="http://www.walmartlabs.com/">WalmartLabs</a> showed their love for Clojure in <a href="https://twitter.com/Moocar/status/538542041152507904">tweets</a> and <a href="http://jobs.walmart.com/silicon-valley/ecommerce-software-engineering/mobile-instore-software-(clojure)-engineer-jobs">job listings</a>.</p>
<p><a href="http://puppetlabs.com/blog/new-era-application-services-puppet-labs">Puppet Labs announced</a> a big move towards Clojure and released their own framework, <a href="https://github.com/puppetlabs/trapperkeeper">Trapperkeeper</a>.</p>
<p>The U.K. <i>Daily Mail</i> reported on how they use <a href="http://www.pitheringabout.com/?p=1018">Clojure at a Newspaper</a>.</p>
<p>Greenius wrote about their <a href="http://about.greeni.us/greenius-our-tech-roots/">Tech Roots: Clojure and Datomic</a>.</p>
<p>Beanstalk told us that <a href="http://blog.beanstalkapp.com/post/23998022427/beanstalk-clojure-love-and-20x-better">Beanstalk + Clojure = Love (and 20x better performance)</a></p>
<p><a href="http://cognitect.com/">Cognitect</a> published case studies from companies succeeding with Clojure and/or Datomic:</p>
<ul class="org-ul">
<li><a href="http://blog.cognitect.com/blog/2014/6/11/rally-and-datomic">Rally Software</a></li>
<li><a href="http://blog.cognitect.com/blog/2014/7/6/room-key-innovates-on-aws-with-cognitect-clojure-and-datomic">Room Key</a></li>
<li><a href="http://blog.cognitect.com/blog/2014/6/17/the-brigade-and-datomic">The Brigade</a></li>
<li><a href="http://blog.cognitect.com/blog/2014/6/3/pellucid-analytics-and-datomic">Pellucid Analytics</a></li>
</ul>
<p>On the education front, Elena Machkasova has started gathering references for <a href="http://cda.morris.umn.edu/~elenam/index.html#clojure">Clojure in undergraduate CS curriculum</a>.</p>
</div>
</div>
<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2">Radars &amp; Rankings</h2>
<div id="text-2" class="outline-text-2">
<p><a href="http://assets.thoughtworks.com/assets/technology-radar-jan-2014-en.pdf">Thoughtworks Radar January 2014 (PDF)</a> placed Clojure firmly in the &#8220;adopt&#8221; category, as did <a href="http://www.element84.com/technology-radar-2014.html">element 84&#8217;s Technology Radar 2014</a>.</p>
<p>Also in January, Clojure entered the top 20 in <a href="http://redmonk.com/sogrady/2014/01/22/language-rankings-1-14/">The RedMonk Programming Language Rankings</a>.</p>
<p>By the time of <a href="http://thoughtworks.fileburst.com/assets/technology-radar-july-2014-en.pdf">Thoughtworks Radar July 2014 (PDF)</a>, the editors didn&#8217;t even consider Clojure a question, having moved on to &#8220;trial&#8221; for <a href="https://github.com/clojure/core.async">core.async</a> and &#8220;assess&#8221; for <a href="https://github.com/swannodette/om">Om</a>.</p>
</div>
</div>
<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3">Conferences &amp; Events</h2>
<div id="text-3" class="outline-text-2">
<p>We started the year off right with <a href="http://www.clojurewest.org/">Clojure/West</a> in San Francisco (<a href="https://www.youtube.com/playlist?list=PLZdCLR02grLp__wRg5OTavVj4wefg69hM">videos on YouTube</a>). I <a href="https://www.youtube.com/watch?v=13cmHf_kt-Q">introduced Component</a>, my not-quite-a-framework. Aaron Bedra threw down the gauntlet for <a href="https://www.youtube.com/watch?v=CBL59w7fXw4">securing Clojure web applications</a>, leading to a flurry of activity making Clojure web frameworks more secure by default.</p>
<p><a href="http://euroclojure.com/2014/">EuroClojure 2014</a> came to Krakow, Poland (<a href="http://vimeo.com/channels/781458/videos">videos on Vimeo</a>).</p>
<p>At <a href="http://www.lambdajam.com/">Lambda Jam 2014</a> in Chicago (<a href="https://www.youtube.com/playlist?list=PLIpl4GKFQR6d5C03HoQN8ubYyMrBlDAAl">videos on YouTube</a>), Rich Hickey <a href="http://blog.cognitect.com/blog/2014/7/22/transit">introduced Transit</a> (<a href="https://github.com/cognitect/transit-format">Transit on GitHub</a>).</p>
<p>At <a href="https://thestrangeloop.com/">Strange Loop 2014</a> in St. Louis (<a href="https://www.youtube.com/channel/UC_QIfHvN9auy2CoOdSfMWDw">videos on YouTube</a>), Rich Hickey <a href="https://www.youtube.com/watch?v=6mTbuzafcII">introduced Transducers</a>. Ramsey Nasser and Tims Gardner <a href="https://www.youtube.com/watch?v=tJr_TD1BtF0">introduced Clojure + Unity 3D</a>, now named <a href="https://github.com/arcadia-unity/Arcadia">Arcadia</a>. Ambrose Bonnaire Sergeant talked about <a href="https://www.youtube.com/watch?v=a0gT0syAXsY">Typed Clojure in Practice</a>. Michael Nygard talked about <a href="https://www.youtube.com/watch?v=N5HyVUPuU0E">Simulation Testing</a>.</p>
<p>Rich Hickey made an appearance at <a href="https://www.oracle.com/javaone/index.html">JavaOne 2014</a> in San Francisco with <a href="https://oracleus.activeevents.com/2014/connect/sessionDetail.ww?SESSION_ID=8870">Clojure Made Simple</a> (<a href="https://www.youtube.com/watch?v=VSdnJDO-xdg">video on YouTube</a>).</p>
<p>In November, <a href="http://clojure-conj.org/">Clojure/conj 2014</a> in Washington, D.C. (<a href="https://www.youtube.com/playlist?list=PLZdCLR02grLoc322bYirANEso3mmzvCiI">videos on YouTube</a>) was the <a href="http://blog.cognitect.com/blog/2014/12/2/clojureconj-2014-is-in-the-books">biggest Clojure/conj yet</a>. Over 500 attendees filled the beautiful Warner Theater.</p>
<p>Meanwhile, <a href="http://www.clojurebridge.org/">ClojureBridge</a> held workshops throughout the year in Sydney, San Francisco, Edinburgh, and Minneapolis, just to name a few.</p>
</div>
</div>
<div id="outline-container-sec-4" class="outline-2">
<h2 id="sec-4">Language Ecosystem</h2>
<div id="text-4" class="outline-text-2">
<p>The Clojure language itself continues to feature new and innovative ideas, this time <a href="http://clojure.org/transducers">Transducers</a>.</p>
<p><a href="http://clojuredocs.org/">ClojureDocs</a> got a huge update: it now covers Clojure 1.6 and some important libraries like <a href="http://clojuredocs.org/clojure.core.async">core.async</a> and <a href="http://clojuredocs.org/clojure.core.logic">core.logic</a>. There are also two new additions to the Clojure documentation sphere: <a href="http://conj.io/">Grimoire</a> and <a href="http://crossclj.info/">CrossClj</a>.</p>
<p>I for one am loving the surge in diversity of Clojure tooling. <a href="https://cursiveclojure.com/">Cursive for IntelliJ</a> garnered some serious attention, while <a href="https://github.com/clojure-emacs/cider">CIDER</a> and <a href="https://code.google.com/p/counterclockwise/">Counterclockwise</a> both got major new releases. <a href="http://boot-clj.com/">Boot</a> is a new build tool with a radically different approach from the still-solid <a href="http://leiningen.org/">Leiningen</a>.</p>
<p>Generative testing really started to catch on. Quick-check creator John Hughes gave a great keynote (<a href="https://www.youtube.com/watch?v=zi0rHwfiX1Q">video</a>) at Clojure/west. Ashton Kemerling talked about <a href="https://www.youtube.com/watch?v=HXGpBrmR70U">Generative Integration Tests</a> at Clojure/conj (also <a href="http://www.pivotaltracker.com/community/tracker-blog/generative-testing">blogged</a>). And of course the Clojure library simple-check became <a href="https://github.com/clojure/test.check">test.check</a>, and has grown steadily in both capability and adoption.</p>
<p>Most of the <a href="https://github.com/clojure">Clojure contrib projects</a> have gotten improvements and new releases.</p>
<p>ClojureScript growth accelerated, with three (and counting) frameworks built on top of Facebook&#8217;s <a href="http://facebook.github.io/react/">React</a>: <a href="https://github.com/swannodette/om">Om</a>, <a href="https://github.com/levand/quiescent">Quiescent</a>, and <a href="http://holmsand.github.io/reagent/">Reagent</a>.</p>
<p>Speaking of frameworks, there was a fair amount of activity around <a href="https://github.com/stuartsierra/component">Component</a>. No, I haven&#8217;t ported it to ClojureScript yet :) but there&#8217;s another <a href="https://github.com/quile/component-cljs">ClojureScript port</a>. People have started building things on top of Component, including <a href="https://github.com/juxt/modular">juxt/modular</a> and <a href="https://github.com/danielsz/system">danielsz/system</a>. uSwitch published some <a href="http://www.uswitch.com/tech/more-open-source-clojure-systems-please/">Example Component-based Apps</a>.</p>
<p>Like a Phoenix rising from the ashes, <a href="https://github.com/pedestal/pedestal/releases">new Pedestal releases</a> appeared with support for fully non-blocking I/O, Transit, and Immutant.</p>
<p>What else is going on? The <a href="http://blog.cognitect.com/blog/2014/10/24/analysis-of-the-state-of-clojure-and-clojurescript-survey-2014">State of Clojure Survey 2014 analysis</a> gave some insight into what people are thinking about Clojure.</p>
<p>Onward to 2015!</p>
<p>Thanks to Michael Fogus, Lake Denman, Alex Miller, and Paul deGrandis for their help in assembling this post.</p>
</div>
</div>
	</div><!-- .entry-content -->

	<footer class="entry-footer">
		<span class="byline"><span class="author vcard"><img alt='' src='https://secure.gravatar.com/avatar/55878d0196b91803f9cb2c372b0551d3?s=49&amp;d=blank&amp;r=g' srcset='https://secure.gravatar.com/avatar/55878d0196b91803f9cb2c372b0551d3?s=98&amp;d=blank&amp;r=g 2x' class='avatar avatar-49 photo' height='49' width='49' /><span class="screen-reader-text">Author </span> <a class="url fn n" href="../../stuart.html">Stuart</a></span></span><span class="posted-on"><span class="screen-reader-text">Posted on </span><a href="../../../2015/01/02/clojure-2014-year-in-review.html" rel="bookmark"><time class="entry-date published" datetime="2015-01-02T11:39:00+00:00">January 2, 2015</time><time class="updated" datetime="2015-12-30T16:16:09+00:00">December 30, 2015</time></a></span><span class="cat-links"><span class="screen-reader-text">Categories </span><a href="../../../category/programming.html" rel="category tag">Programming</a></span><span class="tags-links"><span class="screen-reader-text">Tags </span><a href="../../../tag/clojure.html" rel="tag">Clojure</a></span><span class="comments-link"><a href="../../../2015/01/02/clojure-2014-year-in-review.html#comments">2 Comments<span class="screen-reader-text"> on Clojure 2014 Year in Review</span></a></span>			</footer><!-- .entry-footer -->
</article><!-- #post-## -->

<article id="post-786" class="post-786 post type-post status-publish format-standard hentry category-programming tag-shellshock">
	<header class="entry-header">
		
		<h2 class="entry-title"><a href="../../../2014/09/25/shellshock-logo.html" rel="bookmark">Shellshock Logo</a></h2>	</header><!-- .entry-header -->

	
	
	<div class="entry-content">
		<p>I heard the <a href="https://securityblog.redhat.com/2014/09/24/bash-specially-crafted-environment-variables-code-injection-attack/" title="Redhat security article on Shellshock">Shellshock</a> vulnerability didn&#8217;t have a cool logo like <a href="http://heartbleed.com/">Heartbleed</a>. So I decided to draw one:</p>
<p><img src="../../../download/shellshock1.png" alt="Shellshock logo" /></p>
<p><a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/88x31.png" /></a><br />Copyright © 2014 Stuart Sierra<br />This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.</p>
	</div><!-- .entry-content -->

	<footer class="entry-footer">
		<span class="byline"><span class="author vcard"><img alt='' src='https://secure.gravatar.com/avatar/55878d0196b91803f9cb2c372b0551d3?s=49&amp;d=blank&amp;r=g' srcset='https://secure.gravatar.com/avatar/55878d0196b91803f9cb2c372b0551d3?s=98&amp;d=blank&amp;r=g 2x' class='avatar avatar-49 photo' height='49' width='49' /><span class="screen-reader-text">Author </span> <a class="url fn n" href="../../stuart.html">Stuart</a></span></span><span class="posted-on"><span class="screen-reader-text">Posted on </span><a href="../../../2014/09/25/shellshock-logo.html" rel="bookmark"><time class="entry-date published updated" datetime="2014-09-25T18:22:27+00:00">September 25, 2014</time></a></span><span class="cat-links"><span class="screen-reader-text">Categories </span><a href="../../../category/programming.html" rel="category tag">Programming</a></span><span class="tags-links"><span class="screen-reader-text">Tags </span><a href="../../../tag/shellshock.html" rel="tag">shellshock</a></span>			</footer><!-- .entry-footer -->
</article><!-- #post-## -->

	<nav class="navigation pagination" role="navigation">
		<h2 class="screen-reader-text">Posts navigation</h2>
		<div class="nav-links"><a class="prev page-numbers" href="../index.html">Previous page</a>
<a class='page-numbers' href='../index.html'><span class="meta-nav screen-reader-text">Page </span>1</a>
<span class='page-numbers current'><span class="meta-nav screen-reader-text">Page </span>2</span>
<a class='page-numbers' href='3.html'><span class="meta-nav screen-reader-text">Page </span>3</a>
<span class="page-numbers dots">&hellip;</span>
<a class='page-numbers' href='24.html'><span class="meta-nav screen-reader-text">Page </span>24</a>
<a class="next page-numbers" href="3.html">Next page</a></div>
	</nav>
		</main><!-- .site-main -->
	</div><!-- .content-area -->


	<aside id="secondary" class="sidebar widget-area" role="complementary">
		<section id="search-3" class="widget widget_search">
<form role="search" method="get" class="search-form" action="https://stuartsierra.com/">
	<label>
		<span class="screen-reader-text">Search for:</span>
		<input type="search" class="search-field" placeholder="Search &hellip;" value="" name="s" />
	</label>
	<button type="submit" class="search-submit"><span class="screen-reader-text">Search</span></button>
</form>
</section><section id="text-4" class="widget widget_text">			<div class="textwidget"><ul>
<li><a href="http://feeds2.feedburner.com/StuartSierra" title="Syndicate this site using RSS 2.0">Entries <abbr title="Really Simple Syndication">RSS</abbr></a></li>
<li><a href="../../../comments/feed" title="The latest comments to all posts in RSS">Comments <abbr title="Really Simple Syndication">RSS</abbr></a></li>
</ul>
<ul>
<li><a href="https://twitter.com/stuartsierra">Twitter</a></li>
<li><a href="https://github.com/stuartsierra">GitHub</a></li>
</ul></div>
		</section><section id="tag-widget-2" class="widget TagWidget"><h2 class="widget-title">Clojure Do’s and Don’ts</h2><ul class = "posts-by-tag-list"><li class="posts-by-tag-item Clojure do's and don'ts" id="posts-by-tag-item-883"><a class = "posts-by-tag-item-title" href="../../../2015/08/25/clojure-donts-lazy-effects.html">Clojure Don’ts: Lazy Effects</a></li><li class="posts-by-tag-item Clojure do's and don'ts" id="posts-by-tag-item-877"><a class = "posts-by-tag-item-title" href="../../../2015/08/10/clojure-donts-redundant-map.html">Clojure Don’ts: Redundant map</a></li><li class="posts-by-tag-item Clojure do's and don'ts" id="posts-by-tag-item-870"><a class = "posts-by-tag-item-title" href="../../../2015/06/16/clojure-donts-single-branch-if.html">Clojure Don’ts: Single-branch if</a></li><li class="posts-by-tag-item Clojure do's and don'ts" id="posts-by-tag-item-854"><a class = "posts-by-tag-item-title" href="../../../2015/06/10/clojure-donts-heisenparameter.html">Clojure Don’ts: The Heisenparameter</a></li><li class="posts-by-tag-item Clojure do's and don'ts" id="posts-by-tag-item-849"><a class = "posts-by-tag-item-title" href="../../../2015/06/01/clojure-donts-optional-arguments-with-varargs.html">Clojure Don’ts: Optional Arguments with Varargs</a></li><li class="posts-by-tag-item Clojure do's and don'ts errors" id="posts-by-tag-item-836"><a class = "posts-by-tag-item-title" href="../../../2015/05/27/clojure-uncaught-exceptions.html">Clojure Do’s: Uncaught Exceptions</a></li><li class="posts-by-tag-item Clojure do's and don'ts" id="posts-by-tag-item-831"><a class = "posts-by-tag-item-title" href="../../../2015/05/17/clojure-record-constructors.html">Record Constructors</a></li><li class="posts-by-tag-item Clojure do's and don'ts" id="posts-by-tag-item-826"><a class = "posts-by-tag-item-title" href="../../../2015/05/10/clojure-namespace-aliases.html">Clojure Do’s: Namespace Aliases</a></li><li class="posts-by-tag-item Clojure do's and don'ts" id="posts-by-tag-item-820"><a class = "posts-by-tag-item-title" href="../../../2015/05/02/clojure-donts-isa.html">Clojure Don’ts: isa?</a></li><li class="posts-by-tag-item Clojure do's and don'ts" id="posts-by-tag-item-812"><a class = "posts-by-tag-item-title" href="../../../2015/04/26/clojure-donts-concat.html">Clojure Don’ts: Concat</a></li></ul></section>	</aside><!-- .sidebar .widget-area -->

		</div><!-- .site-content -->

		<footer id="colophon" class="site-footer" role="contentinfo">
							<nav class="main-navigation" role="navigation" aria-label="Footer Primary Menu">
					<div class="menu-main-menu-container"><ul id="menu-main-menu-1" class="primary-menu"><li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-635"><a href="../../../about-me.html">About Me</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-633"><a href="../../../writing.html">Writing</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-634"><a href="../../../presentations.html">Presentations</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-636"><a href="../../../software.html">Software</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-637"><a href="../../../contact.html">Contact</a></li>
</ul></div>				</nav><!-- .main-navigation -->
			
			
			<div class="site-info">
								<span class="site-title"><a href="../../../index.html" rel="home">Digital Digressions by Stuart Sierra</a></span>
				<a href="https://wordpress.org/">Proudly powered by WordPress</a>
			</div><!-- .site-info -->
		</footer><!-- .site-footer -->
	</div><!-- .site-inner -->
</div><!-- .site -->

	<div style="display:none">
	<div class="grofile-hash-map-55878d0196b91803f9cb2c372b0551d3">
	</div>
	</div>
<script type='text/javascript' src='https://s0.wp.com/wp-content/js/devicepx-jetpack.js?ver=201635'></script>
<script type='text/javascript' src='https://secure.gravatar.com/js/gprofiles.js?ver=2016Sepaa'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var WPGroHo = {"my_hash":""};
/* ]]> */
</script>
<script type='text/javascript' src='../../../wp-content/plugins/jetpack/modules/wpgroho167b.js?ver=4.6'></script>
<script type='text/javascript' src='../../../wp-content/themes/twentysixteen/js/skip-link-focus-fix8de4.js?ver=20160816'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var screenReaderText = {"expand":"expand child menu","collapse":"collapse child menu"};
/* ]]> */
</script>
<script type='text/javascript' src='../../../wp-content/themes/twentysixteen/js/functions8de4.js?ver=20160816'></script>
<script type='text/javascript' src='../../../wp-includes/js/wp-embed.min167b.js?ver=4.6'></script>
<script type='text/javascript' src='https://stats.wp.com/e-201635.js' async defer></script>
<script type='text/javascript'>
	_stq = window._stq || [];
	_stq.push([ 'view', {v:'ext',j:'1:4.2.2',blog:'2702563',post:'0',tz:'-4',srv:'stuartsierra.com'} ]);
	_stq.push([ 'clickTrackerInit', '2702563', '0' ]);
</script>
</body>

<!-- Mirrored from stuartsierra.com/author/stuart/page/2 by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 02 Sep 2016 16:57:20 GMT -->
</html>

<!-- Dynamic page generated in 0.427 seconds. -->
<!-- Cached page generated by WP-Super-Cache on 2016-09-02 12:55:46 -->

<!-- Compression = gzip -->