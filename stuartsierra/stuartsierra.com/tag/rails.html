<!DOCTYPE html>
<html lang="en-US" class="no-js">

<!-- Mirrored from stuartsierra.com/tag/rails by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 02 Sep 2016 17:01:36 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="profile" href="http://gmpg.org/xfn/11">
		<script>(function(html){html.className = html.className.replace(/\bno-js\b/,'js')})(document.documentElement);</script>
<title>Rails &#8211; Digital Digressions by Stuart Sierra</title>
<link rel='dns-prefetch' href='http://s0.wp.com/'>
<link rel='dns-prefetch' href='http://secure.gravatar.com/'>
<link rel='dns-prefetch' href='http://fonts.googleapis.com/'>
<link rel='dns-prefetch' href='http://s.w.org/'>
<link rel="alternate" type="application/rss+xml" title="Digital Digressions by Stuart Sierra &raquo; Feed" href="http://feeds2.feedburner.com/StuartSierra" />
<link rel="alternate" type="application/rss+xml" title="Digital Digressions by Stuart Sierra &raquo; Comments Feed" href="../comments/feed" />
<link rel="alternate" type="application/rss+xml" title="Digital Digressions by Stuart Sierra &raquo; Rails Tag Feed" href="http://feeds2.feedburner.com/StuartSierra" />
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/stuartsierra.com\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.6"}};
			!function(a,b,c){function d(a){var c,d,e,f,g,h=b.createElement("canvas"),i=h.getContext&&h.getContext("2d"),j=String.fromCharCode;if(!i||!i.fillText)return!1;switch(i.textBaseline="top",i.font="600 32px Arial",a){case"flag":return i.fillText(j(55356,56806,55356,56826),0,0),!(h.toDataURL().length<3e3)&&(i.clearRect(0,0,h.width,h.height),i.fillText(j(55356,57331,65039,8205,55356,57096),0,0),c=h.toDataURL(),i.clearRect(0,0,h.width,h.height),i.fillText(j(55356,57331,55356,57096),0,0),d=h.toDataURL(),c!==d);case"diversity":return i.fillText(j(55356,57221),0,0),e=i.getImageData(16,16,1,1).data,f=e[0]+","+e[1]+","+e[2]+","+e[3],i.fillText(j(55356,57221,55356,57343),0,0),e=i.getImageData(16,16,1,1).data,g=e[0]+","+e[1]+","+e[2]+","+e[3],f!==g;case"simple":return i.fillText(j(55357,56835),0,0),0!==i.getImageData(16,16,1,1).data[0];case"unicode8":return i.fillText(j(55356,57135),0,0),0!==i.getImageData(16,16,1,1).data[0];case"unicode9":return i.fillText(j(55358,56631),0,0),0!==i.getImageData(16,16,1,1).data[0]}return!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g,h,i;for(i=Array("simple","flag","unicode8","diversity","unicode9"),c.supports={everything:!0,everythingExceptFlag:!0},h=0;h<i.length;h++)c.supports[i[h]]=d(i[h]),c.supports.everything=c.supports.everything&&c.supports[i[h]],"flag"!==i[h]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[i[h]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link rel='stylesheet' id='twentysixteen-jetpack-css'  href='../wp-content/plugins/jetpack/modules/theme-tools/compat/twentysixteen3a05.css?ver=4.2.2' type='text/css' media='all' />
<link rel='stylesheet' id='twentysixteen-fonts-css'  href='https://fonts.googleapis.com/css?family=Merriweather%3A400%2C700%2C900%2C400italic%2C700italic%2C900italic%7CMontserrat%3A400%2C700%7CInconsolata%3A400&amp;subset=latin%2Clatin-ext' type='text/css' media='all' />
<link rel='stylesheet' id='genericons-css'  href='../wp-content/plugins/jetpack/_inc/genericons/genericons/genericons128b.css?ver=3.1' type='text/css' media='all' />
<link rel='stylesheet' id='twentysixteen-style-css'  href='../wp-content/themes/twentysixteen/style167b.css?ver=4.6' type='text/css' media='all' />
<!--[if lt IE 10]>
<link rel='stylesheet' id='twentysixteen-ie-css'  href='https://stuartsierra.com/wp-content/themes/twentysixteen/css/ie.css?ver=20160816' type='text/css' media='all' />
<![endif]-->
<!--[if lt IE 9]>
<link rel='stylesheet' id='twentysixteen-ie8-css'  href='https://stuartsierra.com/wp-content/themes/twentysixteen/css/ie8.css?ver=20160816' type='text/css' media='all' />
<![endif]-->
<!--[if lt IE 8]>
<link rel='stylesheet' id='twentysixteen-ie7-css'  href='https://stuartsierra.com/wp-content/themes/twentysixteen/css/ie7.css?ver=20160816' type='text/css' media='all' />
<![endif]-->
<link rel='stylesheet' id='jetpack_css-css'  href='../wp-content/plugins/jetpack/css/jetpack3a05.css?ver=4.2.2' type='text/css' media='all' />
<script type='text/javascript' src='../wp-includes/js/jquery/jqueryb8ff.js?ver=1.12.4'></script>
<script type='text/javascript' src='../wp-includes/js/jquery/jquery-migrate.min330a.js?ver=1.4.1'></script>
<!--[if lt IE 9]>
<script type='text/javascript' src='https://stuartsierra.com/wp-content/themes/twentysixteen/js/html5.js?ver=3.7.3'></script>
<![endif]-->
<link rel='https://api.w.org/' href='../wp-json/index.html' />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="../xmlrpc0db0.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="../wp-includes/wlwmanifest.xml" /> 
<meta name="generator" content="WordPress 4.6" />

<link rel='dns-prefetch' href='http://v0.wordpress.com/'>
</head>

<body class="archive tag tag-rails tag-25 hfeed">
<div id="page" class="site">
	<div class="site-inner">
		<a class="skip-link screen-reader-text" href="#content">Skip to content</a>

		<header id="masthead" class="site-header" role="banner">
			<div class="site-header-main">
				<div class="site-branding">
					
											<p class="site-title"><a href="../index.html" rel="home">Digital Digressions by Stuart Sierra</a></p>
											<p class="site-description">From programming to everything else</p>
									</div><!-- .site-branding -->

									<button id="menu-toggle" class="menu-toggle">Menu</button>

					<div id="site-header-menu" class="site-header-menu">
													<nav id="site-navigation" class="main-navigation" role="navigation" aria-label="Primary Menu">
								<div class="menu-main-menu-container"><ul id="menu-main-menu" class="primary-menu"><li id="menu-item-635" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-635"><a href="../about-me.html">About Me</a></li>
<li id="menu-item-633" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-633"><a href="../writing.html">Writing</a></li>
<li id="menu-item-634" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-634"><a href="../presentations.html">Presentations</a></li>
<li id="menu-item-636" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-636"><a href="../software.html">Software</a></li>
<li id="menu-item-637" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-637"><a href="../contact.html">Contact</a></li>
</ul></div>							</nav><!-- .main-navigation -->
						
											</div><!-- .site-header-menu -->
							</div><!-- .site-header-main -->

											<div class="header-image">
					<a href="../index.html" rel="home">
						<img src="../wp-content/uploads/2015/12/header.jpg" srcset="https://stuartsierra.com/wp-content/uploads/2015/12/header-300x70.jpg 300w, https://stuartsierra.com/wp-content/uploads/2015/12/header-768x179.jpg 768w, https://stuartsierra.com/wp-content/uploads/2015/12/header-1024x239.jpg 1024w, https://stuartsierra.com/wp-content/uploads/2015/12/header.jpg 1200w" sizes="(max-width: 709px) 85vw, (max-width: 909px) 81vw, (max-width: 1362px) 88vw, 1200px" width="1200" height="280" alt="Digital Digressions by Stuart Sierra">
					</a>
				</div><!-- .header-image -->
					</header><!-- .site-header -->

		<div id="content" class="site-content">

	<div id="primary" class="content-area">
		<main id="main" class="site-main" role="main">

		
			<header class="page-header">
				<h1 class="page-title">Tag: Rails</h1>			</header><!-- .page-header -->

			
<article id="post-150" class="post-150 post type-post status-publish format-standard hentry category-programming tag-databases tag-rails tag-ruby">
	<header class="entry-header">
		
		<h2 class="entry-title"><a href="../2008/04/23/the-great-database-rewrite.html" rel="bookmark">The Great Database Rewrite</a></h2>	</header><!-- .entry-header -->

	
	
	<div class="entry-content">
		<p>I just discovered the paper <a href="http://lambda-the-ultimate.org/node/2500">The End of an Architectural Era (It&#8217;s Time for a Complete Rewrite)</a>, about re-designing database software from the ground up.  It contains some unsurprising predictions &#8212; &#8220;the next decade will bring domination by shared-nothing computer systems, often called grid computing&#8221; &#8212; and some interesting ideas:</p>
<ul>
<li>Any database smaller than 1 TB will fit entirely in main memory, distributed across multiple machines.</li>
<li>We should scrap SQL in favor of &#8220;modifying little languages [Ruby, Python, etc.] to include clean embeddings of DBMS access.&#8221;  (CouchDB is a good example of this.)</li>
<li>A database shouldn&#8217;t require an expert to tune and optimize it; instead it should all be automated to &#8220;produce a system with no visible knobs.&#8221;</li>
</ul>
<p>In their implementation, H-store, they claim to run over 70,000 transactions per second on a standard benchmark on a modest server, compared to 850/second from a commercial DB tuned by an expert.  They also plan to &#8220;move from C++ to Ruby on Rails as our stored procedure language.&#8221;  (!)</p>
	</div><!-- .entry-content -->

	<footer class="entry-footer">
		<span class="byline"><span class="author vcard"><img alt='' src='https://secure.gravatar.com/avatar/55878d0196b91803f9cb2c372b0551d3?s=49&amp;d=blank&amp;r=g' srcset='https://secure.gravatar.com/avatar/55878d0196b91803f9cb2c372b0551d3?s=98&amp;d=blank&amp;r=g 2x' class='avatar avatar-49 photo' height='49' width='49' /><span class="screen-reader-text">Author </span> <a class="url fn n" href="../author/stuart.html">Stuart</a></span></span><span class="posted-on"><span class="screen-reader-text">Posted on </span><a href="../2008/04/23/the-great-database-rewrite.html" rel="bookmark"><time class="entry-date published updated" datetime="2008-04-23T11:28:27+00:00">April 23, 2008</time></a></span><span class="cat-links"><span class="screen-reader-text">Categories </span><a href="../category/programming.html" rel="category tag">Programming</a></span><span class="tags-links"><span class="screen-reader-text">Tags </span><a href="databases.html" rel="tag">databases</a>, <a href="rails.html" rel="tag">Rails</a>, <a href="ruby.html" rel="tag">Ruby</a></span>			</footer><!-- .entry-footer -->
</article><!-- #post-## -->

<article id="post-129" class="post-129 post type-post status-publish format-standard hentry category-programming tag-console tag-rails tag-routing tag-ruby">
	<header class="entry-header">
		
		<h2 class="entry-title"><a href="../2008/01/08/testing-named-routes-in-the-rails-console.html" rel="bookmark">Testing Named Routes in the Rails Console</a></h2>	</header><!-- .entry-header -->

	
	
	<div class="entry-content">
		<p>I finally found out how to do this, from the <a href="http://www.informit.com/store/product.aspx?isbn=0321509242">Rails Routing</a> shortcut by David Black.  In the Rails console, do this:</p>
<pre>
include ActionController::UrlWriter
default_url_options[:host] = 'whatever'
</pre>
<p>Then you can call your named route methods directly from the console.</p>
	</div><!-- .entry-content -->

	<footer class="entry-footer">
		<span class="byline"><span class="author vcard"><img alt='' src='https://secure.gravatar.com/avatar/55878d0196b91803f9cb2c372b0551d3?s=49&amp;d=blank&amp;r=g' srcset='https://secure.gravatar.com/avatar/55878d0196b91803f9cb2c372b0551d3?s=98&amp;d=blank&amp;r=g 2x' class='avatar avatar-49 photo' height='49' width='49' /><span class="screen-reader-text">Author </span> <a class="url fn n" href="../author/stuart.html">Stuart</a></span></span><span class="posted-on"><span class="screen-reader-text">Posted on </span><a href="../2008/01/08/testing-named-routes-in-the-rails-console.html" rel="bookmark"><time class="entry-date published updated" datetime="2008-01-08T13:58:22+00:00">January 8, 2008</time></a></span><span class="cat-links"><span class="screen-reader-text">Categories </span><a href="../category/programming.html" rel="category tag">Programming</a></span><span class="tags-links"><span class="screen-reader-text">Tags </span><a href="console.html" rel="tag">console</a>, <a href="rails.html" rel="tag">Rails</a>, <a href="routing.html" rel="tag">routing</a>, <a href="ruby.html" rel="tag">Ruby</a></span><span class="comments-link"><a href="../2008/01/08/testing-named-routes-in-the-rails-console.html#comments">14 Comments<span class="screen-reader-text"> on Testing Named Routes in the Rails Console</span></a></span>			</footer><!-- .entry-footer -->
</article><!-- #post-## -->

<article id="post-128" class="post-128 post type-post status-publish format-standard hentry category-programming tag-altlaw tag-ferret tag-lucene tag-mysql tag-rails tag-ruby tag-solr">
	<header class="entry-header">
		
		<h2 class="entry-title"><a href="../2008/01/02/basking-in-the-solr-glow.html" rel="bookmark">Basking in the Solr Glow</a></h2>	</header><!-- .entry-header -->

	
	
	<div class="entry-content">
		<p>I am happy to report that <a href="http://altlaw.org/">AltLaw.org</a>&#8216;s switch to Solr has worked very well.  <a href="http://lucene.apache.org/solr/">Solr</a> is a RESTful search engine, built on <a href="http://lucene.apache.org/">Lucene</a>.  The setup was more complicated than just using a search library, but the rewards were worth it.  </p>
<p>Before, I was using <a href="http://ferret.davebalmain.com/trac">Ferret</a>, which I still like.  It&#8217;s a great library, and Dave Balmain has done incredible work producing a fast search engine that integrates well with Ruby.  I still use it on other sites.  But Solr was a better fit for AltLaw.</p>
<p>With Ferret, I was trying to shoe-horn large, unstructured documents into a system &#8212; ActiveRecord, MySQL, and acts_as_ferret &#8212; that is better suited to small, structured records.  Now I use Solr as both a search engine and a document store, eliminating MySQL from the picture.  That, combined with Solr&#8217;s built-in caching, has dramatically decreased the server load (from around 2.00 to under 0.30) while visibly improving search performance.</p>
<p>Also, I think it helps that Solr is <em>not</em> integrated with Ruby.  The <a href="http://wiki.apache.org/solr/solr-ruby">solr-ruby</a> gem is not well documented, but easy to figure out, as it&#8217;s just a thin wrapper over the Solr APIs.  Having the search engine in a separate process made it easier to separate the indexing &#038; searching part of the code from the web application.  As a result, the Rails code shrunk to one-fourth its former size.</p>
	</div><!-- .entry-content -->

	<footer class="entry-footer">
		<span class="byline"><span class="author vcard"><img alt='' src='https://secure.gravatar.com/avatar/55878d0196b91803f9cb2c372b0551d3?s=49&amp;d=blank&amp;r=g' srcset='https://secure.gravatar.com/avatar/55878d0196b91803f9cb2c372b0551d3?s=98&amp;d=blank&amp;r=g 2x' class='avatar avatar-49 photo' height='49' width='49' /><span class="screen-reader-text">Author </span> <a class="url fn n" href="../author/stuart.html">Stuart</a></span></span><span class="posted-on"><span class="screen-reader-text">Posted on </span><a href="../2008/01/02/basking-in-the-solr-glow.html" rel="bookmark"><time class="entry-date published updated" datetime="2008-01-02T12:31:04+00:00">January 2, 2008</time></a></span><span class="cat-links"><span class="screen-reader-text">Categories </span><a href="../category/programming.html" rel="category tag">Programming</a></span><span class="tags-links"><span class="screen-reader-text">Tags </span><a href="altlaw.html" rel="tag">AltLaw</a>, <a href="ferret.html" rel="tag">Ferret</a>, <a href="lucene.html" rel="tag">Lucene</a>, <a href="mysql.html" rel="tag">MySQL</a>, <a href="rails.html" rel="tag">Rails</a>, <a href="ruby.html" rel="tag">Ruby</a>, <a href="solr.html" rel="tag">Solr</a></span>			</footer><!-- .entry-footer -->
</article><!-- #post-## -->

<article id="post-117" class="post-117 post type-post status-publish format-standard hentry category-programming tag-rails tag-ruby">
	<header class="entry-header">
		
		<h2 class="entry-title"><a href="../2007/10/04/why-doesnt-my-rails-app-use-memcached-with-cached_model.html" rel="bookmark">Why Doesn&#8217;t My Rails App Use memcached with cached_model?</a></h2>	</header><!-- .entry-header -->

	
	
	<div class="entry-content">
		<p>Answer: you&#8217;re using the latest version of Rails (1.2.3), which slightly changes the syntax of its SQL statements.  <a href="http://dev.robotcoop.com/Libraries/">cached_model</a> relies on a regular expression to match that SQL statement.</p>
<p>To fix: Dive into the source of the cached_model gem, find the file <code>lib/cached_model.rb</code>, and change the first line after <code>def self.find_by_sql</code> to this:</p>
<pre>
    return super unless args.first =~ /^SELECT \* FROM #{table_name} WHERE \(#{table_name}\.`?#{primary_key}`? = '?(\d+)'?\) *(?:LIMIT 1)?/
</pre>
<p>And it works!</p>
	</div><!-- .entry-content -->

	<footer class="entry-footer">
		<span class="byline"><span class="author vcard"><img alt='' src='https://secure.gravatar.com/avatar/55878d0196b91803f9cb2c372b0551d3?s=49&amp;d=blank&amp;r=g' srcset='https://secure.gravatar.com/avatar/55878d0196b91803f9cb2c372b0551d3?s=98&amp;d=blank&amp;r=g 2x' class='avatar avatar-49 photo' height='49' width='49' /><span class="screen-reader-text">Author </span> <a class="url fn n" href="../author/stuart.html">Stuart</a></span></span><span class="posted-on"><span class="screen-reader-text">Posted on </span><a href="../2007/10/04/why-doesnt-my-rails-app-use-memcached-with-cached_model.html" rel="bookmark"><time class="entry-date published updated" datetime="2007-10-04T12:07:10+00:00">October 4, 2007</time></a></span><span class="cat-links"><span class="screen-reader-text">Categories </span><a href="../category/programming.html" rel="category tag">Programming</a></span><span class="tags-links"><span class="screen-reader-text">Tags </span><a href="rails.html" rel="tag">Rails</a>, <a href="ruby.html" rel="tag">Ruby</a></span>			</footer><!-- .entry-footer -->
</article><!-- #post-## -->

<article id="post-115" class="post-115 post type-post status-publish format-standard hentry category-programming tag-rails">
	<header class="entry-header">
		
		<h2 class="entry-title"><a href="../2007/08/22/get-apache-serving-static-files-with-prefixed-mongrel.html" rel="bookmark">Get Apache Serving Static Files With Prefixed Mongrel</a></h2>	</header><!-- .entry-header -->

	
	
	<div class="entry-content">
		<p>I decided to run <a href="http://altlaw.org/">AltLaw.org</a> under a &#8220;/v1&#8221; URL prefix.  It&#8217;s still beta, and the URL structure will likely change in the future.  I don&#8217;t want to break 160,000 links when that day comes.  Fortunately, Mongrel makes this pretty easy with the &#8211;prefix option to mongrel_rails.</p>
<p>I added <code>--prefix '/v1'</code> to my mongrel_rails command line.  After removing absolute URLs (those not using <code>{:controller=>...}</code>) from my views, everything worked great.</p>
<p>The only problem is, this technique prevents Apache from serving static files without hitting the Mongrel server.  A typical mod_rewrite directive like this:</p>
<pre>
RewriteCond %{DOCUMENT_ROOT}%{REQUEST_URI} -f
RewriteRule (.*) $1 [L]
</pre>
<p>doesn&#8217;t work, because the REQUEST_URIs now all start with &#8220;/v1&#8221; and the files in &#8220;MyRailsApp/public&#8221; don&#8217;t.</p>
<p>Here&#8217;s a simple workaround: make a symlink like this:</p>
<pre>
cd /path/to/MyRailsApp/public
ln -s . v1
</pre>
<p>That&#8217;s right, &#8220;v1&#8221; is a symlink that points back to the &#8220;public&#8221; directory.  I was afraid this might cause an infinite loop, but it doesn&#8217;t.  Keeping the same mod_rewrite rule above, Apache will serve the static files under &#8220;public&#8221; even if the request is prefixed with &#8220;/v1&#8221;.  Pretty cool.</p>
	</div><!-- .entry-content -->

	<footer class="entry-footer">
		<span class="byline"><span class="author vcard"><img alt='' src='https://secure.gravatar.com/avatar/55878d0196b91803f9cb2c372b0551d3?s=49&amp;d=blank&amp;r=g' srcset='https://secure.gravatar.com/avatar/55878d0196b91803f9cb2c372b0551d3?s=98&amp;d=blank&amp;r=g 2x' class='avatar avatar-49 photo' height='49' width='49' /><span class="screen-reader-text">Author </span> <a class="url fn n" href="../author/stuart.html">Stuart</a></span></span><span class="posted-on"><span class="screen-reader-text">Posted on </span><a href="../2007/08/22/get-apache-serving-static-files-with-prefixed-mongrel.html" rel="bookmark"><time class="entry-date published updated" datetime="2007-08-22T18:32:32+00:00">August 22, 2007</time></a></span><span class="cat-links"><span class="screen-reader-text">Categories </span><a href="../category/programming.html" rel="category tag">Programming</a></span><span class="tags-links"><span class="screen-reader-text">Tags </span><a href="rails.html" rel="tag">Rails</a></span>			</footer><!-- .entry-footer -->
</article><!-- #post-## -->

<article id="post-114" class="post-114 post type-post status-publish format-standard hentry category-programming tag-rails">
	<header class="entry-header">
		
		<h2 class="entry-title"><a href="../2007/08/22/darcs-with-capistrano-for-rails.html" rel="bookmark">Darcs with Capistrano for Rails</a></h2>	</header><!-- .entry-header -->

	
	
	<div class="entry-content">
		<p>I&#8217;ve used <a href="http://darcs.net/">Darcs</a> as my only version-control system for a while now.  When I got into Rails, I naturally wanted to use <a href="http://www.capify.org/">Capistrano</a>.  Unfortunately, Darcs and Capistrano don&#8217;t get along too well.  Darcs&#8217; file-based repositories don&#8217;t mesh well with Capistrano&#8217;s assumption that the repository is accessed through a server, a la <a href="http://subversion.tigris.org/">Subversion</a>.</p>
<p>I ran into problems with <code>cap deploy:update_code</code> because Darcs couldn&#8217;t find the repository. After a <a href="http://groups.google.com/group/capistrano/browse_thread/thread/d1fa2f5c7049e084/ac8f3e4380529fae">discussion on the Capistrano mailing list</a> I decided to go my own route.</p>
<p>I have two Darcs repositories, one on my development machine and one on the server.  I <code>darcs push</code> patches from development to the server.  Then I have my own custom Capistrano tasks to get the latest code from the server&#8217;s copy of the repository.  This is adapted from the Capistrano sources:</p>
<pre>
namespace :deploy do
  task :update_code, :except => { :no_release => true } do
    on_rollback { run "rm -rf #{release_path}; true" }

    run("darcs get --partial /home/myapp/repo --repo-name=#{release_path}")
    run("rm -rf #{release_path}/_darcs")

    finalize_update
  end
end
</pre>
<p>I also had to write a custom finalize_update task to add the links to the shared Rails directories:</p>
<pre>
namespace :deploy do
  task :finalize_update, :except => { :no_release => true } do
    run <<-CMD
      ln -s #{shared_path}/log   #{latest_release}/log &#038;&#038;
      ln -s #{shared_path}/tmp   #{latest_release}/tmp &#038;&#038;
      ln -s #{shared_path}/data  #{latest_release}/data &#038;&#038;
      ln -s #{shared_path}/index #{latest_release}/index &#038;&#038;
      ln -s #{shared_path}/config/database.yml #{latest_release}/config/database.yml &#038;&#038;
      ln -s #{shared_path}/public/system #{latest_release}/public/system
     CMD
  end
end
</pre>
	</div><!-- .entry-content -->

	<footer class="entry-footer">
		<span class="byline"><span class="author vcard"><img alt='' src='https://secure.gravatar.com/avatar/55878d0196b91803f9cb2c372b0551d3?s=49&amp;d=blank&amp;r=g' srcset='https://secure.gravatar.com/avatar/55878d0196b91803f9cb2c372b0551d3?s=98&amp;d=blank&amp;r=g 2x' class='avatar avatar-49 photo' height='49' width='49' /><span class="screen-reader-text">Author </span> <a class="url fn n" href="../author/stuart.html">Stuart</a></span></span><span class="posted-on"><span class="screen-reader-text">Posted on </span><a href="../2007/08/22/darcs-with-capistrano-for-rails.html" rel="bookmark"><time class="entry-date published updated" datetime="2007-08-22T18:12:25+00:00">August 22, 2007</time></a></span><span class="cat-links"><span class="screen-reader-text">Categories </span><a href="../category/programming.html" rel="category tag">Programming</a></span><span class="tags-links"><span class="screen-reader-text">Tags </span><a href="rails.html" rel="tag">Rails</a></span>			</footer><!-- .entry-footer -->
</article><!-- #post-## -->

<article id="post-112" class="post-112 post type-post status-publish format-standard hentry category-programming tag-rails">
	<header class="entry-header">
		
		<h2 class="entry-title"><a href="../2007/08/20/apache-proxy-for-rails-returns-403-forbidden.html" rel="bookmark">Apache Proxy for Rails Returns 403 Forbidden</a></h2>	</header><!-- .entry-header -->

	
	
	<div class="entry-content">
		<p>Trying to set up Apache2 as a proxy for mongrel on my new Ruby on Rails server, following the <a href="http://mongrel.rubyforge.org/docs/apache.html">instructions on the mongrel site</a>.  I kept getting &#8220;403 Forbidden&#8221; errors on every request.  I found a <a href="http://blog.codahale.com/2006/06/19/time-for-a-grown-up-server-rails-mongrel-apache-capistrano-and-you/#comment-4439">comment</a> that seemed to describe the same situation.  Sure enough, editing /etc/apache2/mods-enabled/proxy.conf to change &#8220;Deny&#8221; to &#8220;Allow&#8221; fixed the problem.  I kept <a href="http://httpd.apache.org/docs/2.0/mod/mod_proxy.html#proxyrequests">ProxyRequests</a> turned off, which is supposed to prevent my site from becoming an open proxy, but I&#8217;m still nervous about removing that &#8220;Deny&#8221; directive.  I wish there were a more authoritative source of information on this.</p>
	</div><!-- .entry-content -->

	<footer class="entry-footer">
		<span class="byline"><span class="author vcard"><img alt='' src='https://secure.gravatar.com/avatar/55878d0196b91803f9cb2c372b0551d3?s=49&amp;d=blank&amp;r=g' srcset='https://secure.gravatar.com/avatar/55878d0196b91803f9cb2c372b0551d3?s=98&amp;d=blank&amp;r=g 2x' class='avatar avatar-49 photo' height='49' width='49' /><span class="screen-reader-text">Author </span> <a class="url fn n" href="../author/stuart.html">Stuart</a></span></span><span class="posted-on"><span class="screen-reader-text">Posted on </span><a href="../2007/08/20/apache-proxy-for-rails-returns-403-forbidden.html" rel="bookmark"><time class="entry-date published" datetime="2007-08-20T13:05:49+00:00">August 20, 2007</time><time class="updated" datetime="2007-08-20T13:05:50+00:00">August 20, 2007</time></a></span><span class="cat-links"><span class="screen-reader-text">Categories </span><a href="../category/programming.html" rel="category tag">Programming</a></span><span class="tags-links"><span class="screen-reader-text">Tags </span><a href="rails.html" rel="tag">Rails</a></span><span class="comments-link"><a href="../2007/08/20/apache-proxy-for-rails-returns-403-forbidden.html#comments">3 Comments<span class="screen-reader-text"> on Apache Proxy for Rails Returns 403 Forbidden</span></a></span>			</footer><!-- .entry-footer -->
</article><!-- #post-## -->

<article id="post-100" class="post-100 post type-post status-publish format-standard hentry category-programming tag-rails tag-ruby tag-xml">
	<header class="entry-header">
		
		<h2 class="entry-title"><a href="../2007/06/07/where-does-the-xml-go.html" rel="bookmark">Where Does the XML Go?</a></h2>	</header><!-- .entry-header -->

	
	
	<div class="entry-content">
		<p>Here&#8217;s a question that&#8217;s been bugging me for a while: what&#8217;s the best way to store information that is a mixture of highly- and loosely-structured data?  For example, a collection of documents like <a href="http://www.projectposner.org/">Project Posner</a>.  Certain attributes of each document like the title, date, and citation fit easily into a normalized relational database model.  But the body can only be described with some kind of markup.</p>
<p>I could just use HTML, except for one problem: my documents have to handle footnotes, for which HTML does not provide a tag.  (As an aside, footnotes are a pain whether you&#8217;re doing web design or typesetting.)</p>
<p>On Project Posner, I compromised: everything is stored in a MySQL database, and the documents table has a &#8220;body&#8221; column that contains my own made-up XML syntax.</p>
<p>I could, in theory, normalize everything, even individual paragraphs.  But that would be a nightmare to code and deadly slow.  I could also store everything as XML documents.  But then I&#8217;d have to reinvent all the facilities that MySQL (and ActiveRecord) provide, like transaction handling, auto-incrementing IDs, and so on. </p>
<p>For another project, I&#8217;m trying to create a pseudo-database that stores everything as XML files and uses Ferret for searching.  I was going to use Ferret for full-text search anyway, so my original thought was to save overhead by not bothering with MySQL indexes.  It works, but looking over it I realize that most of the data could be normalized to fit into the standard relational model.  I&#8217;d still need a blob of XML data somewhere, but it could be in the database as easily as a file.  What have I really gained, besides an impressively large and complex pile of code?</p>
	</div><!-- .entry-content -->

	<footer class="entry-footer">
		<span class="byline"><span class="author vcard"><img alt='' src='https://secure.gravatar.com/avatar/55878d0196b91803f9cb2c372b0551d3?s=49&amp;d=blank&amp;r=g' srcset='https://secure.gravatar.com/avatar/55878d0196b91803f9cb2c372b0551d3?s=98&amp;d=blank&amp;r=g 2x' class='avatar avatar-49 photo' height='49' width='49' /><span class="screen-reader-text">Author </span> <a class="url fn n" href="../author/stuart.html">Stuart</a></span></span><span class="posted-on"><span class="screen-reader-text">Posted on </span><a href="../2007/06/07/where-does-the-xml-go.html" rel="bookmark"><time class="entry-date published updated" datetime="2007-06-07T14:18:45+00:00">June 7, 2007</time></a></span><span class="cat-links"><span class="screen-reader-text">Categories </span><a href="../category/programming.html" rel="category tag">Programming</a></span><span class="tags-links"><span class="screen-reader-text">Tags </span><a href="rails.html" rel="tag">Rails</a>, <a href="ruby.html" rel="tag">Ruby</a>, <a href="xml.html" rel="tag">XML</a></span><span class="comments-link"><a href="../2007/06/07/where-does-the-xml-go.html#comments">3 Comments<span class="screen-reader-text"> on Where Does the XML Go?</span></a></span>			</footer><!-- .entry-footer -->
</article><!-- #post-## -->

		</main><!-- .site-main -->
	</div><!-- .content-area -->


	<aside id="secondary" class="sidebar widget-area" role="complementary">
		<section id="search-3" class="widget widget_search">
<form role="search" method="get" class="search-form" action="https://stuartsierra.com/">
	<label>
		<span class="screen-reader-text">Search for:</span>
		<input type="search" class="search-field" placeholder="Search &hellip;" value="" name="s" />
	</label>
	<button type="submit" class="search-submit"><span class="screen-reader-text">Search</span></button>
</form>
</section><section id="text-4" class="widget widget_text">			<div class="textwidget"><ul>
<li><a href="http://feeds2.feedburner.com/StuartSierra" title="Syndicate this site using RSS 2.0">Entries <abbr title="Really Simple Syndication">RSS</abbr></a></li>
<li><a href="../comments/feed" title="The latest comments to all posts in RSS">Comments <abbr title="Really Simple Syndication">RSS</abbr></a></li>
</ul>
<ul>
<li><a href="https://twitter.com/stuartsierra">Twitter</a></li>
<li><a href="https://github.com/stuartsierra">GitHub</a></li>
</ul></div>
		</section><section id="tag-widget-2" class="widget TagWidget"><h2 class="widget-title">Clojure Do’s and Don’ts</h2><ul class = "posts-by-tag-list"><li class="posts-by-tag-item Clojure do's and don'ts" id="posts-by-tag-item-883"><a class = "posts-by-tag-item-title" href="../2015/08/25/clojure-donts-lazy-effects.html">Clojure Don’ts: Lazy Effects</a></li><li class="posts-by-tag-item Clojure do's and don'ts" id="posts-by-tag-item-877"><a class = "posts-by-tag-item-title" href="../2015/08/10/clojure-donts-redundant-map.html">Clojure Don’ts: Redundant map</a></li><li class="posts-by-tag-item Clojure do's and don'ts" id="posts-by-tag-item-870"><a class = "posts-by-tag-item-title" href="../2015/06/16/clojure-donts-single-branch-if.html">Clojure Don’ts: Single-branch if</a></li><li class="posts-by-tag-item Clojure do's and don'ts" id="posts-by-tag-item-854"><a class = "posts-by-tag-item-title" href="../2015/06/10/clojure-donts-heisenparameter.html">Clojure Don’ts: The Heisenparameter</a></li><li class="posts-by-tag-item Clojure do's and don'ts" id="posts-by-tag-item-849"><a class = "posts-by-tag-item-title" href="../2015/06/01/clojure-donts-optional-arguments-with-varargs.html">Clojure Don’ts: Optional Arguments with Varargs</a></li><li class="posts-by-tag-item Clojure do's and don'ts errors" id="posts-by-tag-item-836"><a class = "posts-by-tag-item-title" href="../2015/05/27/clojure-uncaught-exceptions.html">Clojure Do’s: Uncaught Exceptions</a></li><li class="posts-by-tag-item Clojure do's and don'ts" id="posts-by-tag-item-831"><a class = "posts-by-tag-item-title" href="../2015/05/17/clojure-record-constructors.html">Record Constructors</a></li><li class="posts-by-tag-item Clojure do's and don'ts" id="posts-by-tag-item-826"><a class = "posts-by-tag-item-title" href="../2015/05/10/clojure-namespace-aliases.html">Clojure Do’s: Namespace Aliases</a></li><li class="posts-by-tag-item Clojure do's and don'ts" id="posts-by-tag-item-820"><a class = "posts-by-tag-item-title" href="../2015/05/02/clojure-donts-isa.html">Clojure Don’ts: isa?</a></li><li class="posts-by-tag-item Clojure do's and don'ts" id="posts-by-tag-item-812"><a class = "posts-by-tag-item-title" href="../2015/04/26/clojure-donts-concat.html">Clojure Don’ts: Concat</a></li></ul></section>	</aside><!-- .sidebar .widget-area -->

		</div><!-- .site-content -->

		<footer id="colophon" class="site-footer" role="contentinfo">
							<nav class="main-navigation" role="navigation" aria-label="Footer Primary Menu">
					<div class="menu-main-menu-container"><ul id="menu-main-menu-1" class="primary-menu"><li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-635"><a href="../about-me.html">About Me</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-633"><a href="../writing.html">Writing</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-634"><a href="../presentations.html">Presentations</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-636"><a href="../software.html">Software</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-637"><a href="../contact.html">Contact</a></li>
</ul></div>				</nav><!-- .main-navigation -->
			
			
			<div class="site-info">
								<span class="site-title"><a href="../index.html" rel="home">Digital Digressions by Stuart Sierra</a></span>
				<a href="https://wordpress.org/">Proudly powered by WordPress</a>
			</div><!-- .site-info -->
		</footer><!-- .site-footer -->
	</div><!-- .site-inner -->
</div><!-- .site -->

	<div style="display:none">
	<div class="grofile-hash-map-55878d0196b91803f9cb2c372b0551d3">
	</div>
	</div>
<script type='text/javascript' src='https://s0.wp.com/wp-content/js/devicepx-jetpack.js?ver=201635'></script>
<script type='text/javascript' src='https://secure.gravatar.com/js/gprofiles.js?ver=2016Sepaa'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var WPGroHo = {"my_hash":""};
/* ]]> */
</script>
<script type='text/javascript' src='../wp-content/plugins/jetpack/modules/wpgroho167b.js?ver=4.6'></script>
<script type='text/javascript' src='../wp-content/themes/twentysixteen/js/skip-link-focus-fix8de4.js?ver=20160816'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var screenReaderText = {"expand":"expand child menu","collapse":"collapse child menu"};
/* ]]> */
</script>
<script type='text/javascript' src='../wp-content/themes/twentysixteen/js/functions8de4.js?ver=20160816'></script>
<script type='text/javascript' src='../wp-includes/js/wp-embed.min167b.js?ver=4.6'></script>
<script type='text/javascript' src='https://stats.wp.com/e-201635.js' async defer></script>
<script type='text/javascript'>
	_stq = window._stq || [];
	_stq.push([ 'view', {v:'ext',j:'1:4.2.2',blog:'2702563',post:'0',tz:'-4',srv:'stuartsierra.com'} ]);
	_stq.push([ 'clickTrackerInit', '2702563', '0' ]);
</script>
</body>

<!-- Mirrored from stuartsierra.com/tag/rails by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 02 Sep 2016 17:01:39 GMT -->
</html>

<!-- Dynamic page generated in 0.361 seconds. -->
<!-- Cached page generated by WP-Super-Cache on 2016-09-02 12:58:46 -->

<!-- Compression = gzip -->