<!DOCTYPE html>
<html lang="en-US" class="no-js">

<!-- Mirrored from stuartsierra.com/tag/lazytest by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 02 Sep 2016 16:58:25 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="profile" href="http://gmpg.org/xfn/11">
		<script>(function(html){html.className = html.className.replace(/\bno-js\b/,'js')})(document.documentElement);</script>
<title>Lazytest &#8211; Digital Digressions by Stuart Sierra</title>
<link rel='dns-prefetch' href='http://s0.wp.com/'>
<link rel='dns-prefetch' href='http://secure.gravatar.com/'>
<link rel='dns-prefetch' href='http://fonts.googleapis.com/'>
<link rel='dns-prefetch' href='http://s.w.org/'>
<link rel="alternate" type="application/rss+xml" title="Digital Digressions by Stuart Sierra &raquo; Feed" href="http://feeds2.feedburner.com/StuartSierra" />
<link rel="alternate" type="application/rss+xml" title="Digital Digressions by Stuart Sierra &raquo; Comments Feed" href="../comments/feed" />
<link rel="alternate" type="application/rss+xml" title="Digital Digressions by Stuart Sierra &raquo; Lazytest Tag Feed" href="http://feeds2.feedburner.com/StuartSierra" />
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/stuartsierra.com\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.6"}};
			!function(a,b,c){function d(a){var c,d,e,f,g,h=b.createElement("canvas"),i=h.getContext&&h.getContext("2d"),j=String.fromCharCode;if(!i||!i.fillText)return!1;switch(i.textBaseline="top",i.font="600 32px Arial",a){case"flag":return i.fillText(j(55356,56806,55356,56826),0,0),!(h.toDataURL().length<3e3)&&(i.clearRect(0,0,h.width,h.height),i.fillText(j(55356,57331,65039,8205,55356,57096),0,0),c=h.toDataURL(),i.clearRect(0,0,h.width,h.height),i.fillText(j(55356,57331,55356,57096),0,0),d=h.toDataURL(),c!==d);case"diversity":return i.fillText(j(55356,57221),0,0),e=i.getImageData(16,16,1,1).data,f=e[0]+","+e[1]+","+e[2]+","+e[3],i.fillText(j(55356,57221,55356,57343),0,0),e=i.getImageData(16,16,1,1).data,g=e[0]+","+e[1]+","+e[2]+","+e[3],f!==g;case"simple":return i.fillText(j(55357,56835),0,0),0!==i.getImageData(16,16,1,1).data[0];case"unicode8":return i.fillText(j(55356,57135),0,0),0!==i.getImageData(16,16,1,1).data[0];case"unicode9":return i.fillText(j(55358,56631),0,0),0!==i.getImageData(16,16,1,1).data[0]}return!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g,h,i;for(i=Array("simple","flag","unicode8","diversity","unicode9"),c.supports={everything:!0,everythingExceptFlag:!0},h=0;h<i.length;h++)c.supports[i[h]]=d(i[h]),c.supports.everything=c.supports.everything&&c.supports[i[h]],"flag"!==i[h]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[i[h]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link rel='stylesheet' id='twentysixteen-jetpack-css'  href='../wp-content/plugins/jetpack/modules/theme-tools/compat/twentysixteen3a05.css?ver=4.2.2' type='text/css' media='all' />
<link rel='stylesheet' id='twentysixteen-fonts-css'  href='https://fonts.googleapis.com/css?family=Merriweather%3A400%2C700%2C900%2C400italic%2C700italic%2C900italic%7CMontserrat%3A400%2C700%7CInconsolata%3A400&amp;subset=latin%2Clatin-ext' type='text/css' media='all' />
<link rel='stylesheet' id='genericons-css'  href='../wp-content/plugins/jetpack/_inc/genericons/genericons/genericons128b.css?ver=3.1' type='text/css' media='all' />
<link rel='stylesheet' id='twentysixteen-style-css'  href='../wp-content/themes/twentysixteen/style167b.css?ver=4.6' type='text/css' media='all' />
<!--[if lt IE 10]>
<link rel='stylesheet' id='twentysixteen-ie-css'  href='https://stuartsierra.com/wp-content/themes/twentysixteen/css/ie.css?ver=20160816' type='text/css' media='all' />
<![endif]-->
<!--[if lt IE 9]>
<link rel='stylesheet' id='twentysixteen-ie8-css'  href='https://stuartsierra.com/wp-content/themes/twentysixteen/css/ie8.css?ver=20160816' type='text/css' media='all' />
<![endif]-->
<!--[if lt IE 8]>
<link rel='stylesheet' id='twentysixteen-ie7-css'  href='https://stuartsierra.com/wp-content/themes/twentysixteen/css/ie7.css?ver=20160816' type='text/css' media='all' />
<![endif]-->
<link rel='stylesheet' id='jetpack_css-css'  href='../wp-content/plugins/jetpack/css/jetpack3a05.css?ver=4.2.2' type='text/css' media='all' />
<script type='text/javascript' src='../wp-includes/js/jquery/jqueryb8ff.js?ver=1.12.4'></script>
<script type='text/javascript' src='../wp-includes/js/jquery/jquery-migrate.min330a.js?ver=1.4.1'></script>
<!--[if lt IE 9]>
<script type='text/javascript' src='https://stuartsierra.com/wp-content/themes/twentysixteen/js/html5.js?ver=3.7.3'></script>
<![endif]-->
<link rel='https://api.w.org/' href='../wp-json/index.html' />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="../xmlrpc0db0.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="../wp-includes/wlwmanifest.xml" /> 
<meta name="generator" content="WordPress 4.6" />

<link rel='dns-prefetch' href='http://v0.wordpress.com/'>
</head>

<body class="archive tag tag-lazytest tag-103 hfeed">
<div id="page" class="site">
	<div class="site-inner">
		<a class="skip-link screen-reader-text" href="#content">Skip to content</a>

		<header id="masthead" class="site-header" role="banner">
			<div class="site-header-main">
				<div class="site-branding">
					
											<p class="site-title"><a href="../index.html" rel="home">Digital Digressions by Stuart Sierra</a></p>
											<p class="site-description">From programming to everything else</p>
									</div><!-- .site-branding -->

									<button id="menu-toggle" class="menu-toggle">Menu</button>

					<div id="site-header-menu" class="site-header-menu">
													<nav id="site-navigation" class="main-navigation" role="navigation" aria-label="Primary Menu">
								<div class="menu-main-menu-container"><ul id="menu-main-menu" class="primary-menu"><li id="menu-item-635" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-635"><a href="../about-me.html">About Me</a></li>
<li id="menu-item-633" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-633"><a href="../writing.html">Writing</a></li>
<li id="menu-item-634" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-634"><a href="../presentations.html">Presentations</a></li>
<li id="menu-item-636" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-636"><a href="../software.html">Software</a></li>
<li id="menu-item-637" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-637"><a href="../contact.html">Contact</a></li>
</ul></div>							</nav><!-- .main-navigation -->
						
											</div><!-- .site-header-menu -->
							</div><!-- .site-header-main -->

											<div class="header-image">
					<a href="../index.html" rel="home">
						<img src="../wp-content/uploads/2015/12/header.jpg" srcset="https://stuartsierra.com/wp-content/uploads/2015/12/header-300x70.jpg 300w, https://stuartsierra.com/wp-content/uploads/2015/12/header-768x179.jpg 768w, https://stuartsierra.com/wp-content/uploads/2015/12/header-1024x239.jpg 1024w, https://stuartsierra.com/wp-content/uploads/2015/12/header.jpg 1200w" sizes="(max-width: 709px) 85vw, (max-width: 909px) 81vw, (max-width: 1362px) 88vw, 1200px" width="1200" height="280" alt="Digital Digressions by Stuart Sierra">
					</a>
				</div><!-- .header-image -->
					</header><!-- .site-header -->

		<div id="content" class="site-content">

	<div id="primary" class="content-area">
		<main id="main" class="site-main" role="main">

		
			<header class="page-header">
				<h1 class="page-title">Tag: Lazytest</h1>			</header><!-- .page-header -->

			
<article id="post-490" class="post-490 post type-post status-publish format-standard hentry category-programming tag-clojure tag-lazytest">
	<header class="entry-header">
		
		<h2 class="entry-title"><a href="../2010/08/28/beware-choosing-the-most-complex-tool-for-the-job.html" rel="bookmark">Beware Choosing the Most Complex Tool for the Job</a></h2>	</header><!-- .entry-header -->

	
	
	<div class="entry-content">
		<p>I once saw a TV show about competing groups of archeologists trying to demonstrate how the ancient Egyptians raised stone obelisks weighing hundreds of tons.</p>
<p>One group of archeologists built a <a href="http://www.pbs.org/wgbh/nova/lostempires/obelisk/raises09.html">complex apparatus</a> involving a wooden frame and lots of rope. It looked impressive, but it didn&#8217;t work.</p>
<p>The other team built a <a href="http://www.pbs.org/wgbh/nova/lostempires/obelisk/raises13.html">sand pit</a>, dragged the obelisk to the top, and gradually removed sand from below the obelisk until it reached its final position. Simple, unglamorous, and it worked on the first try. (See the whole <a href="http://www.pbs.org/wgbh/nova/lostempires/obelisk/raises.html">series of photos</a>.)</p>
<p>The leader of the wooden-frame group <a href="http://www.pbs.org/wgbh/nova/lostempires/obelisk/raises10.html">admitted</a> they were mistaken in basing their design on the most complex ancient technology they could find, sailing ships. Instead, he said, &#8220;We should have asked, &#8216;What is the simplest way they could have done it?'&#8221;</p>
<p>***</p>
<p>From the ancient Egyptians, jump forward about four thousand years to me, sitting at my computer, writing a new testing framework for Clojure.  I was excited about the new Clojure features <em>datatypes</em> and <em>protocols</em>. I based my whole framework around them. It was a beast. Lots of weird edge cases and complex interactions that were hard to reason about and even harder to debug. Datatypes and protocols may be a powerful tool, but that doesn&#8217;t always make them the right tool.</p>
<p>After my fourth or fifth rewrite of Lazytest, I started asking myself, &#8220;What is the simplest way I could do this?&#8221;</p>
<p>The answer was staring me in the face. Clojure is a functional language (mostly). What&#8217;s the simplest way to do anything? Functions!</p>
<p>All of a sudden, complexity started to fall away. My protocols, most of which only had a single method anyway, became ordinary functions. My typed data structures became ordinary maps. The code shrank by many lines, and it was vastly easier to understand. Even better, I discovered new possibilities in the simpler design.</p>
<p>Functions are a fantastic abstraction because they can be composed.  In the new Lazytest, everything is a function: test cases, test suites, and contexts. The RSpec-like <code>describe</code> macros are still there, but they&#8217;re simpler. They do what macros are supposed to do: provide a convenient syntactic layer over functional definitions, not define a completely new language.</p>
<p>I haven&#8217;t completely finished the new API &#8212; fixtures, now renamed back to &#8220;contexts,&#8221; are not supported yet.  But I&#8217;m much happier with this version than with the old one.  I actually feel like this is something I&#8217;d be willing to release soon.  So <a href="http://github.com/stuartsierra/lazytest">give it a spin</a> and tell me what you think.</p>
	</div><!-- .entry-content -->

	<footer class="entry-footer">
		<span class="byline"><span class="author vcard"><img alt='' src='https://secure.gravatar.com/avatar/55878d0196b91803f9cb2c372b0551d3?s=49&amp;d=blank&amp;r=g' srcset='https://secure.gravatar.com/avatar/55878d0196b91803f9cb2c372b0551d3?s=98&amp;d=blank&amp;r=g 2x' class='avatar avatar-49 photo' height='49' width='49' /><span class="screen-reader-text">Author </span> <a class="url fn n" href="../author/stuart.html">Stuart</a></span></span><span class="posted-on"><span class="screen-reader-text">Posted on </span><a href="../2010/08/28/beware-choosing-the-most-complex-tool-for-the-job.html" rel="bookmark"><time class="entry-date published updated" datetime="2010-08-28T17:48:23+00:00">August 28, 2010</time></a></span><span class="cat-links"><span class="screen-reader-text">Categories </span><a href="../category/programming.html" rel="category tag">Programming</a></span><span class="tags-links"><span class="screen-reader-text">Tags </span><a href="clojure.html" rel="tag">Clojure</a>, <a href="lazytest.html" rel="tag">Lazytest</a></span><span class="comments-link"><a href="../2010/08/28/beware-choosing-the-most-complex-tool-for-the-job.html#comments">3 Comments<span class="screen-reader-text"> on Beware Choosing the Most Complex Tool for the Job</span></a></span>			</footer><!-- .entry-footer -->
</article><!-- #post-## -->

<article id="post-482" class="post-482 post type-post status-publish format-standard hentry category-programming tag-clojure tag-lazytest">
	<header class="entry-header">
		
		<h2 class="entry-title"><a href="../2010/08/15/assertions-and-invariants.html" rel="bookmark">Assertions and Invariants</a></h2>	</header><!-- .entry-header -->

	
	
	<div class="entry-content">
		<p>I&#8217;ve been thinking a lot about testing frameworks over the past six months, and I&#8217;m not the only Stuart doing that.  Stuart Halloway, who spent some time on his own Clojure testing framework, <a href="http://github.com/stuarthalloway/circumspec">Circumspec</a>, recently <a href="http://groups.google.com/group/clojure-dev/msg/27199e77d74823f9">wrote</a> about his experiences refactoring some of the language tests included with Clojure.</p>
<p>One of Stu&#8217;s first points is that Clojure&#8217;s <code>assert</code> macro doesn&#8217;t provide enough context when an assertion fails.  It doesn&#8217;t tell you <em>why</em> the assertion failed.</p>
<p>That&#8217;s exactly why I wrote the <code>is</code> macro in <code>clojure.test</code>.  But, as both I and the other Stuart have noted, the macros in <code>clojure.test</code> are too tightly intertwined with the reporting framework.  So I started working on <a href="http://github.com/stuartsierra/lazytest">Lazytest</a> and the <code>expect</code> macro.</p>
<p>Stu made an <a href="https://www.assembla.com/spaces/clojure/tickets/415">improved</a> <code>assert</code> that reports the current values of local variables.  I&#8217;ve <a href="http://github.com/stuartsierra/lazytest/commit/0b9fc411115e189979b0fa2d2481d12e061c2647">incorporated</a> that feature into <code>expect</code>.  Thanks, Stu!</p>
<p> ***</p>
<p>The next takeaway from Stu&#8217;s post is that thinking about invariants &mdash; properties that must always hold &mdash; is a good way to design tests.  Invariants are the basis of Haskell&#8217;s <a href="http://www.haskell.org/haskellwiki/Introduction_to_QuickCheck">QuickCheck</a>, which Meikel Brandmeyer adapted as <a href="http://kotka.de/blog/2010/06/ClojureCheck_is_back.html">ClojureCheck</a>.</p>
<p>I really like the idea of invariants, although I think invariant properties are more likely to be found in highly abstract, mathematical domains than in, say, web applications.  But Stu&#8217;s point is that there isn&#8217;t a good place to put invariants.  Complex invariants can take a long time to evaluate, so you don&#8217;t want to run them in production code.  But some assertions are cheap, and important, so you <em>do</em> want to run them in production code.</p>
<p>Stu asks if we need a &#8220;new thing.&#8221;  Perhaps that new thing is assertion <em>levels</em>, like logging levels.  Level 1 could be for simple, quick checks like argument types; level 2 for more involved consistency checks, and so on.  The assertion level, rather than simply assertions on/off, could be specified at compile time.</p>
<p> ***</p>
<p>There&#8217;s more to say Stu&#8217;s post, and about testing in general, but that will have to wait for another day.</p>
	</div><!-- .entry-content -->

	<footer class="entry-footer">
		<span class="byline"><span class="author vcard"><img alt='' src='https://secure.gravatar.com/avatar/55878d0196b91803f9cb2c372b0551d3?s=49&amp;d=blank&amp;r=g' srcset='https://secure.gravatar.com/avatar/55878d0196b91803f9cb2c372b0551d3?s=98&amp;d=blank&amp;r=g 2x' class='avatar avatar-49 photo' height='49' width='49' /><span class="screen-reader-text">Author </span> <a class="url fn n" href="../author/stuart.html">Stuart</a></span></span><span class="posted-on"><span class="screen-reader-text">Posted on </span><a href="../2010/08/15/assertions-and-invariants.html" rel="bookmark"><time class="entry-date published updated" datetime="2010-08-15T22:17:55+00:00">August 15, 2010</time></a></span><span class="cat-links"><span class="screen-reader-text">Categories </span><a href="../category/programming.html" rel="category tag">Programming</a></span><span class="tags-links"><span class="screen-reader-text">Tags </span><a href="clojure.html" rel="tag">Clojure</a>, <a href="lazytest.html" rel="tag">Lazytest</a></span>			</footer><!-- .entry-footer -->
</article><!-- #post-## -->

<article id="post-472" class="post-472 post type-post status-publish format-standard hentry category-programming tag-clojure tag-lazytest">
	<header class="entry-header">
		
		<h2 class="entry-title"><a href="../2010/07/31/slightly-less-typed-assertions.html" rel="bookmark">Slightly Less Typed Assertions</a></h2>	</header><!-- .entry-header -->

	
	
	<div class="entry-content">
		<p>A couple of weeks ago I wrote about <a href="../2010/07/19/typed-assertions.html">typed assertions for Lazytest</a>.</p>
<p>Like so many things, it seemed like a good idea at the time. Define typed objects for each kind of assertion (e.g., equality, instanceof). When a test fails, throw an exception with one such object as the payload. The type of the object describes the failure (e.g., not equal, not instance of) and its fields describe the components of the failure (e.g., X was not equal to Y).</p>
<p>It worked, but as Rich Hickey himself pointed out, it was redundant. All these typed objects have no methods, just different kinds of fields. Furthermore, most of the fields aren&#8217;t even that different. Every &#8220;failure&#8221; can be identified by a predicate and the arguments which caused it to return false.</p>
<p>I should have known something was wrong as soon as I wrote a <a href="http://github.com/stuartsierra/lazytest/blob/d28c0f96aa07b18cfef6c9cbeb65680bab926d91/src/main/clojure/lazytest/failure.clj#L3">Protocol with no methods</a>. I was doing JavaBean-style programming, using objects to represent structured data. I can represent them more simply as maps.</p>
<p>So that&#8217;s what I&#8217;ve done. The strongly typed failures are <a href="http://github.com/stuartsierra/lazytest/commit/9d47879e749c0036c5c6b1023fbd00c402396cf8">gone</a>. The complex code transformation and replacement in the <code>expect</code> macro are <a href="http://github.com/stuartsierra/lazytest/commit/2224b3c1dc798f8140e4a50bcc2d354793f268c0#diff-1">gone</a>.</p>
<p>What&#8217;s left is a much <a href="http://github.com/stuartsierra/lazytest/blob/2224b3c1dc798f8140e4a50bcc2d354793f268c0/src/main/clojure/lazytest/expect.clj#L33">shorter form</a> of the <code>expect</code> macro that examines the assertion expression and, if it contains a normal function call, evaluates its arguments before calling the function. Effectively, it follows the same evaluation rules as Clojure itself, while holding on to the intermediate values. A failing test throws an exception with an attached map holding the original unevaluated form, the evaluated components, and the return value of the predicate.</p>
	</div><!-- .entry-content -->

	<footer class="entry-footer">
		<span class="byline"><span class="author vcard"><img alt='' src='https://secure.gravatar.com/avatar/55878d0196b91803f9cb2c372b0551d3?s=49&amp;d=blank&amp;r=g' srcset='https://secure.gravatar.com/avatar/55878d0196b91803f9cb2c372b0551d3?s=98&amp;d=blank&amp;r=g 2x' class='avatar avatar-49 photo' height='49' width='49' /><span class="screen-reader-text">Author </span> <a class="url fn n" href="../author/stuart.html">Stuart</a></span></span><span class="posted-on"><span class="screen-reader-text">Posted on </span><a href="../2010/07/31/slightly-less-typed-assertions.html" rel="bookmark"><time class="entry-date published updated" datetime="2010-07-31T16:23:15+00:00">July 31, 2010</time></a></span><span class="cat-links"><span class="screen-reader-text">Categories </span><a href="../category/programming.html" rel="category tag">Programming</a></span><span class="tags-links"><span class="screen-reader-text">Tags </span><a href="clojure.html" rel="tag">Clojure</a>, <a href="lazytest.html" rel="tag">Lazytest</a></span><span class="comments-link"><a href="../2010/07/31/slightly-less-typed-assertions.html#comments">1 Comment<span class="screen-reader-text"> on Slightly Less Typed Assertions</span></a></span>			</footer><!-- .entry-footer -->
</article><!-- #post-## -->

<article id="post-468" class="post-468 post type-post status-publish format-standard hentry category-programming tag-clojure tag-lazytest">
	<header class="entry-header">
		
		<h2 class="entry-title"><a href="../2010/07/30/lazytest-churn.html" rel="bookmark">Lazytest Churn</a></h2>	</header><!-- .entry-header -->

	
	
	<div class="entry-content">
		<p>One of my stated goals with <a href="http://github.com/stuartsierra/lazytest">Lazytest</a> was to enforce a clean separation between test assertions and code that runs before/around the assertions.</p>
<p>The <a href="http://code.google.com/p/spock/">Spock</a> framework for Java/Groovy calls these the <em>stimulus</em> and <em>response</em>, identified by the keywords <code>when</code> and <code>then</code>, respectively. I find this approach attractive, but one look at Spock&#8217;s documentation shows it&#8217;s thoroughly embedded in the imperative mode:</p>
<pre><code>when:
stack.push(elem)

then:
!stack.empty
stack.size() == 1
stack.peek() == elem</code></pre>
<p>In my <a href="../2010/07/24/two-steps-forward.html">last Lazytest update</a>, I added the <code>expect</code> macro, which signals failure by throwing an exception. That was useful for adding typed &#8220;reason for failure&#8221; objects to the test results, but not good in that it led me back in the direction of allowing arbitrary code in test examples.</p>
<p>After todays&#8217; commits, the <code>expect</code> macro is still there, but you don&#8217;t use it explicitly.  I&#8217;ve reverted to allowing only a single test expression inside the <code>it</code> macro. That expression will automatically be wrapped in <code>expect</code>.</p>
<p>If you really need to execute arbitrary code in an example, use the new <code>do-it</code> macro, and call <code>expect</code> explicitly.</p>
<p>Hopefully this is explained clearly enough in the new <a href="http://github.com/stuartsierra/lazytest/blob/1a9dd777f92bd7e9cce0cbd2a5b154e2f4e1e515/README.md">README</a>.</p>
	</div><!-- .entry-content -->

	<footer class="entry-footer">
		<span class="byline"><span class="author vcard"><img alt='' src='https://secure.gravatar.com/avatar/55878d0196b91803f9cb2c372b0551d3?s=49&amp;d=blank&amp;r=g' srcset='https://secure.gravatar.com/avatar/55878d0196b91803f9cb2c372b0551d3?s=98&amp;d=blank&amp;r=g 2x' class='avatar avatar-49 photo' height='49' width='49' /><span class="screen-reader-text">Author </span> <a class="url fn n" href="../author/stuart.html">Stuart</a></span></span><span class="posted-on"><span class="screen-reader-text">Posted on </span><a href="../2010/07/30/lazytest-churn.html" rel="bookmark"><time class="entry-date published updated" datetime="2010-07-30T12:00:27+00:00">July 30, 2010</time></a></span><span class="cat-links"><span class="screen-reader-text">Categories </span><a href="../category/programming.html" rel="category tag">Programming</a></span><span class="tags-links"><span class="screen-reader-text">Tags </span><a href="clojure.html" rel="tag">Clojure</a>, <a href="lazytest.html" rel="tag">Lazytest</a></span><span class="comments-link"><a href="../2010/07/30/lazytest-churn.html#comments">5 Comments<span class="screen-reader-text"> on Lazytest Churn</span></a></span>			</footer><!-- .entry-footer -->
</article><!-- #post-## -->

<article id="post-465" class="post-465 post type-post status-publish format-standard hentry category-programming tag-clojure tag-lazytest">
	<header class="entry-header">
		
		<h2 class="entry-title"><a href="../2010/07/24/two-steps-forward.html" rel="bookmark">Two Steps Forward, One Step Back</a></h2>	</header><!-- .entry-header -->

	
	
	<div class="entry-content">
		<p>Following my <a href="../2010/07/19/typed-assertions.html">last post</a> I integrated typed assertions into the master branch of <a href="http://github.com/stuartsierra/lazytest">Lazytest</a>.</p>
<p>This makes some changes to the API. Test examples in the <code>it</code> macro can no longer simply return true or false. Instead, they must call the <code>expect</code> macro.</p>
<p>The <code>Context</code> type is gone, replaced by the <code>Fixture</code> protocol. More documentation to come. Basically, a Fixture is a pair of methods named <code>setup</code> and <code>teardown</code>. Fixtures are responsible for handling their own state.</p>
<p>The file watcher still works, but the new console reporter kinda sucks. I&#8217;ve got all this great failure information from the typed assertions, now I just need to figure out how to format it.</p>
	</div><!-- .entry-content -->

	<footer class="entry-footer">
		<span class="byline"><span class="author vcard"><img alt='' src='https://secure.gravatar.com/avatar/55878d0196b91803f9cb2c372b0551d3?s=49&amp;d=blank&amp;r=g' srcset='https://secure.gravatar.com/avatar/55878d0196b91803f9cb2c372b0551d3?s=98&amp;d=blank&amp;r=g 2x' class='avatar avatar-49 photo' height='49' width='49' /><span class="screen-reader-text">Author </span> <a class="url fn n" href="../author/stuart.html">Stuart</a></span></span><span class="posted-on"><span class="screen-reader-text">Posted on </span><a href="../2010/07/24/two-steps-forward.html" rel="bookmark"><time class="entry-date published updated" datetime="2010-07-24T18:24:41+00:00">July 24, 2010</time></a></span><span class="cat-links"><span class="screen-reader-text">Categories </span><a href="../category/programming.html" rel="category tag">Programming</a></span><span class="tags-links"><span class="screen-reader-text">Tags </span><a href="clojure.html" rel="tag">Clojure</a>, <a href="lazytest.html" rel="tag">Lazytest</a></span><span class="comments-link"><a href="../2010/07/24/two-steps-forward.html#comments">3 Comments<span class="screen-reader-text"> on Two Steps Forward, One Step Back</span></a></span>			</footer><!-- .entry-footer -->
</article><!-- #post-## -->

<article id="post-463" class="post-463 post type-post status-publish format-standard hentry category-programming tag-clojure tag-lazytest tag-testing">
	<header class="entry-header">
		
		<h2 class="entry-title"><a href="../2010/07/19/typed-assertions.html" rel="bookmark">Typed Assertions Tell You What Hurts</a></h2>	</header><!-- .entry-header -->

	
	
	<div class="entry-content">
		<p>One thing <code>clojure.test</code> did reasonably well was tell you why an assertion failed.  Currently, <a href="http://github.com/stuartsierra/lazytest">Lazytest</a> fails in this regard.</p>
<p>The problem with requiring test functions to return true/false to indicate pass/fail is that they can&#8217;t attach any additional information to a failure to explain <em>why</em> it failed.</p>
<p>I realized that function return values are insufficient for describing failure conditions. Fortunately, we&#8217;ve long had another means for functions to signal failure: typed exceptions.</p>
<p>Typed exceptions seem to be out of favor at the moment. Clojure itself only uses a handful of generic exception types, and defines none of its own.</p>
<p>It&#8217;s slightly awkward to define new exceptions in Clojure because the JVM requires any thrown exception to be derived from the concrete base class <a href="http://download.oracle.com/docs/cd/E17409_01/javase/6/docs/api/java/lang/Throwable.html">java.lang.Throwable</a>.</p>
<p>Sure, you could use <a href="http://clojure.github.com/clojure/clojure.core-api.html#clojure.core/gen-class">gen-class</a>, but generating a stub class that maps to a Clojure namespace seems like overkill for such a simple task.  All I need is something that I can throw with an arbitrary payload attached.</p>
<p>So I did that thing that will make everyone cringe: I wrote it in Java.  All nine lines of it:</p>
<pre>package lazytest;

public class ExpectationFailed extends Error {
    public final Object reason;

    public ExpectationFailed(Object reason) {
	this.reason = reason;
    }
}</pre>
<p>Now I can define any number of <a href="http://github.com/stuartsierra/lazytest/blob/8330dc43558299777fea119533d343296ca81f29/src/main/clojure/lazytest/failure.clj">typed objects representing different failure conditions</a>, and I still only have to worry about catching one exception type.</p>
<p>Next I can write <a href="http://github.com/stuartsierra/lazytest/blob/8330dc43558299777fea119533d343296ca81f29/src/main/clojure/lazytest/expect.clj">functions that test for different conditions</a> and throw <code>ExpectationFailed</code> when they are not met, attaching the appropriate failure object.  I can even write a macro, <a href="http://github.com/stuartsierra/lazytest/blob/8330dc43558299777fea119533d343296ca81f29/src/main/clojure/lazytest/expect.clj#L43">expect</a>, that transforms an ordinary predicate expression into an &#8220;expectation expression&#8221; by reflecting on the code.</p>
<p>The <code>expect</code> macro fills the same role in Lazytest as the <code>is</code> macro in <code>clojure.test</code>.</p>
<p>Now I just need to figure out how to merge all this back in to the master branch.</p>
	</div><!-- .entry-content -->

	<footer class="entry-footer">
		<span class="byline"><span class="author vcard"><img alt='' src='https://secure.gravatar.com/avatar/55878d0196b91803f9cb2c372b0551d3?s=49&amp;d=blank&amp;r=g' srcset='https://secure.gravatar.com/avatar/55878d0196b91803f9cb2c372b0551d3?s=98&amp;d=blank&amp;r=g 2x' class='avatar avatar-49 photo' height='49' width='49' /><span class="screen-reader-text">Author </span> <a class="url fn n" href="../author/stuart.html">Stuart</a></span></span><span class="posted-on"><span class="screen-reader-text">Posted on </span><a href="../2010/07/19/typed-assertions.html" rel="bookmark"><time class="entry-date published updated" datetime="2010-07-19T21:25:05+00:00">July 19, 2010</time></a></span><span class="cat-links"><span class="screen-reader-text">Categories </span><a href="../category/programming.html" rel="category tag">Programming</a></span><span class="tags-links"><span class="screen-reader-text">Tags </span><a href="clojure.html" rel="tag">Clojure</a>, <a href="lazytest.html" rel="tag">Lazytest</a>, <a href="testing.html" rel="tag">testing</a></span><span class="comments-link"><a href="../2010/07/19/typed-assertions.html#comments">7 Comments<span class="screen-reader-text"> on Typed Assertions Tell You What Hurts</span></a></span>			</footer><!-- .entry-footer -->
</article><!-- #post-## -->

		</main><!-- .site-main -->
	</div><!-- .content-area -->


	<aside id="secondary" class="sidebar widget-area" role="complementary">
		<section id="search-3" class="widget widget_search">
<form role="search" method="get" class="search-form" action="https://stuartsierra.com/">
	<label>
		<span class="screen-reader-text">Search for:</span>
		<input type="search" class="search-field" placeholder="Search &hellip;" value="" name="s" />
	</label>
	<button type="submit" class="search-submit"><span class="screen-reader-text">Search</span></button>
</form>
</section><section id="text-4" class="widget widget_text">			<div class="textwidget"><ul>
<li><a href="http://feeds2.feedburner.com/StuartSierra" title="Syndicate this site using RSS 2.0">Entries <abbr title="Really Simple Syndication">RSS</abbr></a></li>
<li><a href="../comments/feed" title="The latest comments to all posts in RSS">Comments <abbr title="Really Simple Syndication">RSS</abbr></a></li>
</ul>
<ul>
<li><a href="https://twitter.com/stuartsierra">Twitter</a></li>
<li><a href="https://github.com/stuartsierra">GitHub</a></li>
</ul></div>
		</section><section id="tag-widget-2" class="widget TagWidget"><h2 class="widget-title">Clojure Do’s and Don’ts</h2><ul class = "posts-by-tag-list"><li class="posts-by-tag-item Clojure do's and don'ts" id="posts-by-tag-item-883"><a class = "posts-by-tag-item-title" href="../2015/08/25/clojure-donts-lazy-effects.html">Clojure Don’ts: Lazy Effects</a></li><li class="posts-by-tag-item Clojure do's and don'ts" id="posts-by-tag-item-877"><a class = "posts-by-tag-item-title" href="../2015/08/10/clojure-donts-redundant-map.html">Clojure Don’ts: Redundant map</a></li><li class="posts-by-tag-item Clojure do's and don'ts" id="posts-by-tag-item-870"><a class = "posts-by-tag-item-title" href="../2015/06/16/clojure-donts-single-branch-if.html">Clojure Don’ts: Single-branch if</a></li><li class="posts-by-tag-item Clojure do's and don'ts" id="posts-by-tag-item-854"><a class = "posts-by-tag-item-title" href="../2015/06/10/clojure-donts-heisenparameter.html">Clojure Don’ts: The Heisenparameter</a></li><li class="posts-by-tag-item Clojure do's and don'ts" id="posts-by-tag-item-849"><a class = "posts-by-tag-item-title" href="../2015/06/01/clojure-donts-optional-arguments-with-varargs.html">Clojure Don’ts: Optional Arguments with Varargs</a></li><li class="posts-by-tag-item Clojure do's and don'ts errors" id="posts-by-tag-item-836"><a class = "posts-by-tag-item-title" href="../2015/05/27/clojure-uncaught-exceptions.html">Clojure Do’s: Uncaught Exceptions</a></li><li class="posts-by-tag-item Clojure do's and don'ts" id="posts-by-tag-item-831"><a class = "posts-by-tag-item-title" href="../2015/05/17/clojure-record-constructors.html">Record Constructors</a></li><li class="posts-by-tag-item Clojure do's and don'ts" id="posts-by-tag-item-826"><a class = "posts-by-tag-item-title" href="../2015/05/10/clojure-namespace-aliases.html">Clojure Do’s: Namespace Aliases</a></li><li class="posts-by-tag-item Clojure do's and don'ts" id="posts-by-tag-item-820"><a class = "posts-by-tag-item-title" href="../2015/05/02/clojure-donts-isa.html">Clojure Don’ts: isa?</a></li><li class="posts-by-tag-item Clojure do's and don'ts" id="posts-by-tag-item-812"><a class = "posts-by-tag-item-title" href="../2015/04/26/clojure-donts-concat.html">Clojure Don’ts: Concat</a></li></ul></section>	</aside><!-- .sidebar .widget-area -->

		</div><!-- .site-content -->

		<footer id="colophon" class="site-footer" role="contentinfo">
							<nav class="main-navigation" role="navigation" aria-label="Footer Primary Menu">
					<div class="menu-main-menu-container"><ul id="menu-main-menu-1" class="primary-menu"><li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-635"><a href="../about-me.html">About Me</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-633"><a href="../writing.html">Writing</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-634"><a href="../presentations.html">Presentations</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-636"><a href="../software.html">Software</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-637"><a href="../contact.html">Contact</a></li>
</ul></div>				</nav><!-- .main-navigation -->
			
			
			<div class="site-info">
								<span class="site-title"><a href="../index.html" rel="home">Digital Digressions by Stuart Sierra</a></span>
				<a href="https://wordpress.org/">Proudly powered by WordPress</a>
			</div><!-- .site-info -->
		</footer><!-- .site-footer -->
	</div><!-- .site-inner -->
</div><!-- .site -->

	<div style="display:none">
	<div class="grofile-hash-map-55878d0196b91803f9cb2c372b0551d3">
	</div>
	</div>
<script type='text/javascript' src='https://s0.wp.com/wp-content/js/devicepx-jetpack.js?ver=201635'></script>
<script type='text/javascript' src='https://secure.gravatar.com/js/gprofiles.js?ver=2016Sepaa'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var WPGroHo = {"my_hash":""};
/* ]]> */
</script>
<script type='text/javascript' src='../wp-content/plugins/jetpack/modules/wpgroho167b.js?ver=4.6'></script>
<script type='text/javascript' src='../wp-content/themes/twentysixteen/js/skip-link-focus-fix8de4.js?ver=20160816'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var screenReaderText = {"expand":"expand child menu","collapse":"collapse child menu"};
/* ]]> */
</script>
<script type='text/javascript' src='../wp-content/themes/twentysixteen/js/functions8de4.js?ver=20160816'></script>
<script type='text/javascript' src='../wp-includes/js/wp-embed.min167b.js?ver=4.6'></script>
<script type='text/javascript' src='https://stats.wp.com/e-201635.js' async defer></script>
<script type='text/javascript'>
	_stq = window._stq || [];
	_stq.push([ 'view', {v:'ext',j:'1:4.2.2',blog:'2702563',post:'0',tz:'-4',srv:'stuartsierra.com'} ]);
	_stq.push([ 'clickTrackerInit', '2702563', '0' ]);
</script>
</body>

<!-- Mirrored from stuartsierra.com/tag/lazytest by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 02 Sep 2016 16:58:27 GMT -->
</html>

<!-- Dynamic page generated in 0.346 seconds. -->
<!-- Cached page generated by WP-Super-Cache on 2016-09-02 12:56:15 -->

<!-- Compression = gzip -->