<!DOCTYPE html>
<html lang="en-US" class="no-js">

<!-- Mirrored from stuartsierra.com/tag/clojure/page/5 by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 02 Sep 2016 17:03:09 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="profile" href="http://gmpg.org/xfn/11">
		<script>(function(html){html.className = html.className.replace(/\bno-js\b/,'js')})(document.documentElement);</script>
<title>Clojure &#8211; Page 5 &#8211; Digital Digressions by Stuart Sierra</title>
<link rel='dns-prefetch' href='http://s0.wp.com/'>
<link rel='dns-prefetch' href='http://secure.gravatar.com/'>
<link rel='dns-prefetch' href='http://fonts.googleapis.com/'>
<link rel='dns-prefetch' href='http://s.w.org/'>
<link rel="alternate" type="application/rss+xml" title="Digital Digressions by Stuart Sierra &raquo; Feed" href="http://feeds2.feedburner.com/StuartSierra" />
<link rel="alternate" type="application/rss+xml" title="Digital Digressions by Stuart Sierra &raquo; Comments Feed" href="../../../comments/feed" />
<link rel="alternate" type="application/rss+xml" title="Digital Digressions by Stuart Sierra &raquo; Clojure Tag Feed" href="http://feeds2.feedburner.com/StuartSierra" />
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/stuartsierra.com\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.6"}};
			!function(a,b,c){function d(a){var c,d,e,f,g,h=b.createElement("canvas"),i=h.getContext&&h.getContext("2d"),j=String.fromCharCode;if(!i||!i.fillText)return!1;switch(i.textBaseline="top",i.font="600 32px Arial",a){case"flag":return i.fillText(j(55356,56806,55356,56826),0,0),!(h.toDataURL().length<3e3)&&(i.clearRect(0,0,h.width,h.height),i.fillText(j(55356,57331,65039,8205,55356,57096),0,0),c=h.toDataURL(),i.clearRect(0,0,h.width,h.height),i.fillText(j(55356,57331,55356,57096),0,0),d=h.toDataURL(),c!==d);case"diversity":return i.fillText(j(55356,57221),0,0),e=i.getImageData(16,16,1,1).data,f=e[0]+","+e[1]+","+e[2]+","+e[3],i.fillText(j(55356,57221,55356,57343),0,0),e=i.getImageData(16,16,1,1).data,g=e[0]+","+e[1]+","+e[2]+","+e[3],f!==g;case"simple":return i.fillText(j(55357,56835),0,0),0!==i.getImageData(16,16,1,1).data[0];case"unicode8":return i.fillText(j(55356,57135),0,0),0!==i.getImageData(16,16,1,1).data[0];case"unicode9":return i.fillText(j(55358,56631),0,0),0!==i.getImageData(16,16,1,1).data[0]}return!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g,h,i;for(i=Array("simple","flag","unicode8","diversity","unicode9"),c.supports={everything:!0,everythingExceptFlag:!0},h=0;h<i.length;h++)c.supports[i[h]]=d(i[h]),c.supports.everything=c.supports.everything&&c.supports[i[h]],"flag"!==i[h]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[i[h]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link rel='stylesheet' id='twentysixteen-jetpack-css'  href='../../../wp-content/plugins/jetpack/modules/theme-tools/compat/twentysixteen3a05.css?ver=4.2.2' type='text/css' media='all' />
<link rel='stylesheet' id='twentysixteen-fonts-css'  href='https://fonts.googleapis.com/css?family=Merriweather%3A400%2C700%2C900%2C400italic%2C700italic%2C900italic%7CMontserrat%3A400%2C700%7CInconsolata%3A400&amp;subset=latin%2Clatin-ext' type='text/css' media='all' />
<link rel='stylesheet' id='genericons-css'  href='../../../wp-content/plugins/jetpack/_inc/genericons/genericons/genericons128b.css?ver=3.1' type='text/css' media='all' />
<link rel='stylesheet' id='twentysixteen-style-css'  href='../../../wp-content/themes/twentysixteen/style167b.css?ver=4.6' type='text/css' media='all' />
<!--[if lt IE 10]>
<link rel='stylesheet' id='twentysixteen-ie-css'  href='https://stuartsierra.com/wp-content/themes/twentysixteen/css/ie.css?ver=20160816' type='text/css' media='all' />
<![endif]-->
<!--[if lt IE 9]>
<link rel='stylesheet' id='twentysixteen-ie8-css'  href='https://stuartsierra.com/wp-content/themes/twentysixteen/css/ie8.css?ver=20160816' type='text/css' media='all' />
<![endif]-->
<!--[if lt IE 8]>
<link rel='stylesheet' id='twentysixteen-ie7-css'  href='https://stuartsierra.com/wp-content/themes/twentysixteen/css/ie7.css?ver=20160816' type='text/css' media='all' />
<![endif]-->
<link rel='stylesheet' id='jetpack_css-css'  href='../../../wp-content/plugins/jetpack/css/jetpack3a05.css?ver=4.2.2' type='text/css' media='all' />
<script type='text/javascript' src='../../../wp-includes/js/jquery/jqueryb8ff.js?ver=1.12.4'></script>
<script type='text/javascript' src='../../../wp-includes/js/jquery/jquery-migrate.min330a.js?ver=1.4.1'></script>
<!--[if lt IE 9]>
<script type='text/javascript' src='https://stuartsierra.com/wp-content/themes/twentysixteen/js/html5.js?ver=3.7.3'></script>
<![endif]-->
<link rel='https://api.w.org/' href='../../../wp-json/index.html' />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="../../../xmlrpc0db0.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="../../../wp-includes/wlwmanifest.xml" /> 
<meta name="generator" content="WordPress 4.6" />

<link rel='dns-prefetch' href='http://v0.wordpress.com/'>
</head>

<body class="archive paged tag tag-clojure tag-47 paged-5 tag-paged-5 hfeed">
<div id="page" class="site">
	<div class="site-inner">
		<a class="skip-link screen-reader-text" href="#content">Skip to content</a>

		<header id="masthead" class="site-header" role="banner">
			<div class="site-header-main">
				<div class="site-branding">
					
											<p class="site-title"><a href="../../../index.html" rel="home">Digital Digressions by Stuart Sierra</a></p>
											<p class="site-description">From programming to everything else</p>
									</div><!-- .site-branding -->

									<button id="menu-toggle" class="menu-toggle">Menu</button>

					<div id="site-header-menu" class="site-header-menu">
													<nav id="site-navigation" class="main-navigation" role="navigation" aria-label="Primary Menu">
								<div class="menu-main-menu-container"><ul id="menu-main-menu" class="primary-menu"><li id="menu-item-635" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-635"><a href="../../../about-me.html">About Me</a></li>
<li id="menu-item-633" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-633"><a href="../../../writing.html">Writing</a></li>
<li id="menu-item-634" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-634"><a href="../../../presentations.html">Presentations</a></li>
<li id="menu-item-636" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-636"><a href="../../../software.html">Software</a></li>
<li id="menu-item-637" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-637"><a href="../../../contact.html">Contact</a></li>
</ul></div>							</nav><!-- .main-navigation -->
						
											</div><!-- .site-header-menu -->
							</div><!-- .site-header-main -->

											<div class="header-image">
					<a href="../../../index.html" rel="home">
						<img src="../../../wp-content/uploads/2015/12/header.jpg" srcset="https://stuartsierra.com/wp-content/uploads/2015/12/header-300x70.jpg 300w, https://stuartsierra.com/wp-content/uploads/2015/12/header-768x179.jpg 768w, https://stuartsierra.com/wp-content/uploads/2015/12/header-1024x239.jpg 1024w, https://stuartsierra.com/wp-content/uploads/2015/12/header.jpg 1200w" sizes="(max-width: 709px) 85vw, (max-width: 909px) 81vw, (max-width: 1362px) 88vw, 1200px" width="1200" height="280" alt="Digital Digressions by Stuart Sierra">
					</a>
				</div><!-- .header-image -->
					</header><!-- .site-header -->

		<div id="content" class="site-content">

	<div id="primary" class="content-area">
		<main id="main" class="site-main" role="main">

		
			<header class="page-header">
				<h1 class="page-title">Tag: Clojure</h1>			</header><!-- .page-header -->

			
<article id="post-472" class="post-472 post type-post status-publish format-standard hentry category-programming tag-clojure tag-lazytest">
	<header class="entry-header">
		
		<h2 class="entry-title"><a href="../../../2010/07/31/slightly-less-typed-assertions.html" rel="bookmark">Slightly Less Typed Assertions</a></h2>	</header><!-- .entry-header -->

	
	
	<div class="entry-content">
		<p>A couple of weeks ago I wrote about <a href="../../../2010/07/19/typed-assertions.html">typed assertions for Lazytest</a>.</p>
<p>Like so many things, it seemed like a good idea at the time. Define typed objects for each kind of assertion (e.g., equality, instanceof). When a test fails, throw an exception with one such object as the payload. The type of the object describes the failure (e.g., not equal, not instance of) and its fields describe the components of the failure (e.g., X was not equal to Y).</p>
<p>It worked, but as Rich Hickey himself pointed out, it was redundant. All these typed objects have no methods, just different kinds of fields. Furthermore, most of the fields aren&#8217;t even that different. Every &#8220;failure&#8221; can be identified by a predicate and the arguments which caused it to return false.</p>
<p>I should have known something was wrong as soon as I wrote a <a href="http://github.com/stuartsierra/lazytest/blob/d28c0f96aa07b18cfef6c9cbeb65680bab926d91/src/main/clojure/lazytest/failure.clj#L3">Protocol with no methods</a>. I was doing JavaBean-style programming, using objects to represent structured data. I can represent them more simply as maps.</p>
<p>So that&#8217;s what I&#8217;ve done. The strongly typed failures are <a href="http://github.com/stuartsierra/lazytest/commit/9d47879e749c0036c5c6b1023fbd00c402396cf8">gone</a>. The complex code transformation and replacement in the <code>expect</code> macro are <a href="http://github.com/stuartsierra/lazytest/commit/2224b3c1dc798f8140e4a50bcc2d354793f268c0#diff-1">gone</a>.</p>
<p>What&#8217;s left is a much <a href="http://github.com/stuartsierra/lazytest/blob/2224b3c1dc798f8140e4a50bcc2d354793f268c0/src/main/clojure/lazytest/expect.clj#L33">shorter form</a> of the <code>expect</code> macro that examines the assertion expression and, if it contains a normal function call, evaluates its arguments before calling the function. Effectively, it follows the same evaluation rules as Clojure itself, while holding on to the intermediate values. A failing test throws an exception with an attached map holding the original unevaluated form, the evaluated components, and the return value of the predicate.</p>
	</div><!-- .entry-content -->

	<footer class="entry-footer">
		<span class="byline"><span class="author vcard"><img alt='' src='https://secure.gravatar.com/avatar/55878d0196b91803f9cb2c372b0551d3?s=49&amp;d=blank&amp;r=g' srcset='https://secure.gravatar.com/avatar/55878d0196b91803f9cb2c372b0551d3?s=98&amp;d=blank&amp;r=g 2x' class='avatar avatar-49 photo' height='49' width='49' /><span class="screen-reader-text">Author </span> <a class="url fn n" href="../../../author/stuart.html">Stuart</a></span></span><span class="posted-on"><span class="screen-reader-text">Posted on </span><a href="../../../2010/07/31/slightly-less-typed-assertions.html" rel="bookmark"><time class="entry-date published updated" datetime="2010-07-31T16:23:15+00:00">July 31, 2010</time></a></span><span class="cat-links"><span class="screen-reader-text">Categories </span><a href="../../../category/programming.html" rel="category tag">Programming</a></span><span class="tags-links"><span class="screen-reader-text">Tags </span><a href="../../clojure.html" rel="tag">Clojure</a>, <a href="../../lazytest.html" rel="tag">Lazytest</a></span><span class="comments-link"><a href="../../../2010/07/31/slightly-less-typed-assertions.html#comments">1 Comment<span class="screen-reader-text"> on Slightly Less Typed Assertions</span></a></span>			</footer><!-- .entry-footer -->
</article><!-- #post-## -->

<article id="post-468" class="post-468 post type-post status-publish format-standard hentry category-programming tag-clojure tag-lazytest">
	<header class="entry-header">
		
		<h2 class="entry-title"><a href="../../../2010/07/30/lazytest-churn.html" rel="bookmark">Lazytest Churn</a></h2>	</header><!-- .entry-header -->

	
	
	<div class="entry-content">
		<p>One of my stated goals with <a href="http://github.com/stuartsierra/lazytest">Lazytest</a> was to enforce a clean separation between test assertions and code that runs before/around the assertions.</p>
<p>The <a href="http://code.google.com/p/spock/">Spock</a> framework for Java/Groovy calls these the <em>stimulus</em> and <em>response</em>, identified by the keywords <code>when</code> and <code>then</code>, respectively. I find this approach attractive, but one look at Spock&#8217;s documentation shows it&#8217;s thoroughly embedded in the imperative mode:</p>
<pre><code>when:
stack.push(elem)

then:
!stack.empty
stack.size() == 1
stack.peek() == elem</code></pre>
<p>In my <a href="../../../2010/07/24/two-steps-forward.html">last Lazytest update</a>, I added the <code>expect</code> macro, which signals failure by throwing an exception. That was useful for adding typed &#8220;reason for failure&#8221; objects to the test results, but not good in that it led me back in the direction of allowing arbitrary code in test examples.</p>
<p>After todays&#8217; commits, the <code>expect</code> macro is still there, but you don&#8217;t use it explicitly. Â I&#8217;ve reverted to allowing only a single test expression inside the <code>it</code> macro. That expression will automatically be wrapped in <code>expect</code>.</p>
<p>If you really need to execute arbitrary code in an example, use the new <code>do-it</code> macro, and call <code>expect</code> explicitly.</p>
<p>Hopefully this is explained clearly enough in the new <a href="http://github.com/stuartsierra/lazytest/blob/1a9dd777f92bd7e9cce0cbd2a5b154e2f4e1e515/README.md">README</a>.</p>
	</div><!-- .entry-content -->

	<footer class="entry-footer">
		<span class="byline"><span class="author vcard"><img alt='' src='https://secure.gravatar.com/avatar/55878d0196b91803f9cb2c372b0551d3?s=49&amp;d=blank&amp;r=g' srcset='https://secure.gravatar.com/avatar/55878d0196b91803f9cb2c372b0551d3?s=98&amp;d=blank&amp;r=g 2x' class='avatar avatar-49 photo' height='49' width='49' /><span class="screen-reader-text">Author </span> <a class="url fn n" href="../../../author/stuart.html">Stuart</a></span></span><span class="posted-on"><span class="screen-reader-text">Posted on </span><a href="../../../2010/07/30/lazytest-churn.html" rel="bookmark"><time class="entry-date published updated" datetime="2010-07-30T12:00:27+00:00">July 30, 2010</time></a></span><span class="cat-links"><span class="screen-reader-text">Categories </span><a href="../../../category/programming.html" rel="category tag">Programming</a></span><span class="tags-links"><span class="screen-reader-text">Tags </span><a href="../../clojure.html" rel="tag">Clojure</a>, <a href="../../lazytest.html" rel="tag">Lazytest</a></span><span class="comments-link"><a href="../../../2010/07/30/lazytest-churn.html#comments">5 Comments<span class="screen-reader-text"> on Lazytest Churn</span></a></span>			</footer><!-- .entry-footer -->
</article><!-- #post-## -->

<article id="post-465" class="post-465 post type-post status-publish format-standard hentry category-programming tag-clojure tag-lazytest">
	<header class="entry-header">
		
		<h2 class="entry-title"><a href="../../../2010/07/24/two-steps-forward.html" rel="bookmark">Two Steps Forward, One Step Back</a></h2>	</header><!-- .entry-header -->

	
	
	<div class="entry-content">
		<p>Following my <a href="../../../2010/07/19/typed-assertions.html">last post</a> I integrated typed assertions into the master branch of <a href="http://github.com/stuartsierra/lazytest">Lazytest</a>.</p>
<p>This makes some changes to the API. Test examples in the <code>it</code> macro can no longer simply return true or false. Instead, they must call the <code>expect</code> macro.</p>
<p>The <code>Context</code> type is gone, replaced by the <code>Fixture</code> protocol. More documentation to come. Basically, a Fixture is a pair of methods named <code>setup</code> and <code>teardown</code>. Fixtures are responsible for handling their own state.</p>
<p>The file watcher still works, but the new console reporter kinda sucks. I&#8217;ve got all this great failure information from the typed assertions, now I just need to figure out how to format it.</p>
	</div><!-- .entry-content -->

	<footer class="entry-footer">
		<span class="byline"><span class="author vcard"><img alt='' src='https://secure.gravatar.com/avatar/55878d0196b91803f9cb2c372b0551d3?s=49&amp;d=blank&amp;r=g' srcset='https://secure.gravatar.com/avatar/55878d0196b91803f9cb2c372b0551d3?s=98&amp;d=blank&amp;r=g 2x' class='avatar avatar-49 photo' height='49' width='49' /><span class="screen-reader-text">Author </span> <a class="url fn n" href="../../../author/stuart.html">Stuart</a></span></span><span class="posted-on"><span class="screen-reader-text">Posted on </span><a href="../../../2010/07/24/two-steps-forward.html" rel="bookmark"><time class="entry-date published updated" datetime="2010-07-24T18:24:41+00:00">July 24, 2010</time></a></span><span class="cat-links"><span class="screen-reader-text">Categories </span><a href="../../../category/programming.html" rel="category tag">Programming</a></span><span class="tags-links"><span class="screen-reader-text">Tags </span><a href="../../clojure.html" rel="tag">Clojure</a>, <a href="../../lazytest.html" rel="tag">Lazytest</a></span><span class="comments-link"><a href="../../../2010/07/24/two-steps-forward.html#comments">3 Comments<span class="screen-reader-text"> on Two Steps Forward, One Step Back</span></a></span>			</footer><!-- .entry-footer -->
</article><!-- #post-## -->

<article id="post-463" class="post-463 post type-post status-publish format-standard hentry category-programming tag-clojure tag-lazytest tag-testing">
	<header class="entry-header">
		
		<h2 class="entry-title"><a href="../../../2010/07/19/typed-assertions.html" rel="bookmark">Typed Assertions Tell You What Hurts</a></h2>	</header><!-- .entry-header -->

	
	
	<div class="entry-content">
		<p>One thing <code>clojure.test</code> did reasonably well was tell you why an assertion failed.  Currently, <a href="http://github.com/stuartsierra/lazytest">Lazytest</a> fails in this regard.</p>
<p>The problem with requiring test functions to return true/false to indicate pass/fail is that they can&#8217;t attach any additional information to a failure to explain <em>why</em> it failed.</p>
<p>I realized that function return values are insufficient for describing failure conditions. Fortunately, we&#8217;ve long had another means for functions to signal failure: typed exceptions.</p>
<p>Typed exceptions seem to be out of favor at the moment. Clojure itself only uses a handful of generic exception types, and defines none of its own.</p>
<p>It&#8217;s slightly awkward to define new exceptions in Clojure because the JVM requires any thrown exception to be derived from the concrete base class <a href="http://download.oracle.com/docs/cd/E17409_01/javase/6/docs/api/java/lang/Throwable.html">java.lang.Throwable</a>.</p>
<p>Sure, you could use <a href="http://clojure.github.com/clojure/clojure.core-api.html#clojure.core/gen-class">gen-class</a>, but generating a stub class that maps to a Clojure namespace seems like overkill for such a simple task.  All I need is something that I can throw with an arbitrary payload attached.</p>
<p>So I did that thing that will make everyone cringe: I wrote it in Java.  All nine lines of it:</p>
<pre>package lazytest;

public class ExpectationFailed extends Error {
    public final Object reason;

    public ExpectationFailed(Object reason) {
	this.reason = reason;
    }
}</pre>
<p>Now I can define any number of <a href="http://github.com/stuartsierra/lazytest/blob/8330dc43558299777fea119533d343296ca81f29/src/main/clojure/lazytest/failure.clj">typed objects representing different failure conditions</a>, and I still only have to worry about catching one exception type.</p>
<p>Next I can write <a href="http://github.com/stuartsierra/lazytest/blob/8330dc43558299777fea119533d343296ca81f29/src/main/clojure/lazytest/expect.clj">functions that test for different conditions</a> and throw <code>ExpectationFailed</code> when they are not met, attaching the appropriate failure object.  I can even write a macro, <a href="http://github.com/stuartsierra/lazytest/blob/8330dc43558299777fea119533d343296ca81f29/src/main/clojure/lazytest/expect.clj#L43">expect</a>, that transforms an ordinary predicate expression into an &#8220;expectation expression&#8221; by reflecting on the code.</p>
<p>The <code>expect</code> macro fills the same role in Lazytest as the <code>is</code> macro in <code>clojure.test</code>.</p>
<p>Now I just need to figure out how to merge all this back in to the master branch.</p>
	</div><!-- .entry-content -->

	<footer class="entry-footer">
		<span class="byline"><span class="author vcard"><img alt='' src='https://secure.gravatar.com/avatar/55878d0196b91803f9cb2c372b0551d3?s=49&amp;d=blank&amp;r=g' srcset='https://secure.gravatar.com/avatar/55878d0196b91803f9cb2c372b0551d3?s=98&amp;d=blank&amp;r=g 2x' class='avatar avatar-49 photo' height='49' width='49' /><span class="screen-reader-text">Author </span> <a class="url fn n" href="../../../author/stuart.html">Stuart</a></span></span><span class="posted-on"><span class="screen-reader-text">Posted on </span><a href="../../../2010/07/19/typed-assertions.html" rel="bookmark"><time class="entry-date published updated" datetime="2010-07-19T21:25:05+00:00">July 19, 2010</time></a></span><span class="cat-links"><span class="screen-reader-text">Categories </span><a href="../../../category/programming.html" rel="category tag">Programming</a></span><span class="tags-links"><span class="screen-reader-text">Tags </span><a href="../../clojure.html" rel="tag">Clojure</a>, <a href="../../lazytest.html" rel="tag">Lazytest</a>, <a href="../../testing.html" rel="tag">testing</a></span><span class="comments-link"><a href="../../../2010/07/19/typed-assertions.html#comments">7 Comments<span class="screen-reader-text"> on Typed Assertions Tell You What Hurts</span></a></span>			</footer><!-- .entry-footer -->
</article><!-- #post-## -->

<article id="post-458" class="post-458 post type-post status-publish format-standard hentry category-programming tag-clojure tag-testing">
	<header class="entry-header">
		
		<h2 class="entry-title"><a href="../../../2010/07/05/lazytest-status-report.html" rel="bookmark">A Journey of a Thousand Lines Begins with a Single Test</a></h2>	</header><!-- .entry-header -->

	
	
	<div class="entry-content">
		<p>I have a curious obsession with testing frameworks.  The first thing I do with any new programming language is try to write a test framework in it. It&#8217;s a useful exercise for exploring the metaprogramming facilities provided by any language. So in C, I use preprocessor macros; in Java, annotations; and in a Lisp, macros.</p>
<p>When I started playing with <a href="http://clojure.org/">Clojure</a>, there was no testing framework. So I wrote one, borrowing ideas from Common Lisp test frameworks such as <a href="http://common-lisp.net/project/lift/">LIFT</a> and <a href="http://www.gigamonkeys.com/book/practical-building-a-unit-test-framework.html">Chapter 9</a> of Peter Seibel&#8217;s <em>Practical Common Lisp</em>.</p>
<p>This was <code>clojure.contrib.test-is</code>. By virtual of being first out of the gate, it became the de facto standard testing framework for Clojure, and release 1.1 gave it an official position as <code>clojure.test</code>.</p>
<p>After seeing <code>clojure.test</code> used in the wild, and using it on my own projects, I found some problems. I set out to fix them in a totally new framework called Lazytest, which I have been working on since February. Lazytest has gone through three major revisions already, and will probably get at least one more before I release it.</p>
<p>Lazytest started with the simple desire to fix all the problems I found with <code>clojure.test</code>, but it evolved into an attempt to make the perfect behavior-driven development framework for Clojure, incorporating all the best ideas from TDD/BDD frameworks in other languages.</p>
<p>This post is an attempt to document where Lazytest is now, the thought processes that got it there, and where it&#8217;s headed.</p>
<p>First, I&#8217;ll cover what <code>clojure.test</code> did wrong (and right).</p>
<h2>Things <code>clojure.test</code> got wrong:</h2>
<p><strong>Test code is tightly coupled to reporting.</strong> Every assertion is responsible for calling <code>clojure.test/report</code>, which immediately prints the result and updates a global counter for tests passed/failed. The only way to change the report output format is to rebind <code>report</code> while tests are running. This makes it awkward to implement alternative result formats such as TAP and JUnit XML.</p>
<p><strong>Tests can only be grouped by dynamic scope.</strong> Following the style of Seibel, the only way <code>clojure.test</code> can combine tests into groups (other than namespaces) is to call one test within the body of another. This conflicts with the default <code>run-tests</code> behavior of running all tests defined in a namespace, leading to the poorly-understood <code>test-ns-hook</code> hack. There is no way to group tests by lexical scope.</p>
<p><strong>Fixtures can only be assigned per-namespace.</strong> Fixtures were a late addition to <code>clojure.test</code> and were not integrated well with the rest of the design. The fact that they are globally applied to an entire namespace makes them useless for all but the simplest cases.</p>
<p><strong>Fixtures rely on dynamic scope.</strong> The only way to pass values from a fixture to a test function is with dynamic binding. Not only is this awkward to use (every value shared between fixtures and tests needs a global Var) it makes test functions dependent on the dynamic context provided by the framework.  Individual tests cannot be run outside of <code>run-tests</code>.</p>
<p><strong>Code templates.</strong> This was a clever idea that didn&#8217;t pan out. <code>clojure.template/do-template</code> is a really complicated way to do <code>map</code> and never should have been promoted from clojure-contrib to Clojure proper.</p>
<p><strong>Tree-walking.</strong> <code>clojure.walk</code> was another clever idea that didn&#8217;t pan out. It is still useful in a handful of situations, such as recursively changing all keywords to strings, but it could probably be replaced with something simpler.</p>
<h2>Things <code>clojure.test</code> got right:</h2>
<p><strong>An explicit assertion form,</strong> a.k.a. the <code>is</code> macro.  In most drafts of Lazytest I omitted this form, instead treating the last expression of any test body as an assertion.  I wanted to discourage the use of multiple assertions in a single test, but such usage is frequently necessary when testing real-world code.</p>
<p><strong>Recognizing assertions by syntactic form.</strong> The <code>is</code> macro uses a multimethod to dispatch on the first symbol in the assertion expression.  The multimethod can generate different code for different kinds of assertions, such as equality, <code>instance?</code> checks, or exceptions thrown.</p>
<p>I had hoped that people would extend the <code>is</code> macro with their own assertion forms, but almost no one did. It was too hard to understand and, like the rest of <code>clojure.test</code>, too tightly coupled to the reporting subsystem.</p>
<h2>Goals for Lazytest</h2>
<p><strong>Separation of concerns.</strong> There should be well-defined interfaces for creating tests, running tests, and reporting test results. It should be trivial to replace any of those components with another that respects the same interface.</p>
<p><strong>Separation of syntax from internal representations.</strong> There should be a simple, functional interface for defining tests without any need for macros. Different text syntaxes, implemented as macros, can be layered on top of this interface.</p>
<p><strong>Support for continuous testing.</strong> It should be possible to start a &#8220;watcher&#8221; process to monitor directories and re-run tests when files change.</p>
<p><strong>Lexical grouping.</strong> It should be possible to combine tests into groups, with unlimited nesting, using lexical scopes.</p>
<p><strong>Composable per-test fixtures.</strong> Fixtures (called &#8220;contexts&#8221; at the moment) may be attached to individual tests or groups of tests, and may be composed.</p>
<p><strong>Support for tagging.</strong> Tests may be tagged with arbitrary metadata, including &#8220;skip&#8221;, &#8220;pending&#8221;, and &#8220;focus&#8221; to control which tests are run.</p>
<p><strong>Useful reporting.</strong> A test failure report should include enough information to diagnose the problem without referring back to the test code. This is probably the hardest goal, partly because it is dependent on having clearly-written tests.</p>
<p>If I can do all this, it will be TDD-nirvana, but that&#8217;s a big <em>if</em>.  Even though I have code for most of the pieces, making them all work together will be a significant challenge.</p>
<p>The basics are already there, on my <a href="http://github.com/stuartsierra/lazytest">Lazytest github page</a>. Please try it out and send me any feedback you have, but be aware that everything in the code, including the test syntax, is still <strong>alpha</strong> and <strong>subject to change</strong>.</p>
<p>I <strong>will</strong> make a proper release at some point, but not until I am satisfied that I have implemented the proper abstractions.</p>
	</div><!-- .entry-content -->

	<footer class="entry-footer">
		<span class="byline"><span class="author vcard"><img alt='' src='https://secure.gravatar.com/avatar/55878d0196b91803f9cb2c372b0551d3?s=49&amp;d=blank&amp;r=g' srcset='https://secure.gravatar.com/avatar/55878d0196b91803f9cb2c372b0551d3?s=98&amp;d=blank&amp;r=g 2x' class='avatar avatar-49 photo' height='49' width='49' /><span class="screen-reader-text">Author </span> <a class="url fn n" href="../../../author/stuart.html">Stuart</a></span></span><span class="posted-on"><span class="screen-reader-text">Posted on </span><a href="../../../2010/07/05/lazytest-status-report.html" rel="bookmark"><time class="entry-date published updated" datetime="2010-07-05T22:12:02+00:00">July 5, 2010</time></a></span><span class="cat-links"><span class="screen-reader-text">Categories </span><a href="../../../category/programming.html" rel="category tag">Programming</a></span><span class="tags-links"><span class="screen-reader-text">Tags </span><a href="../../clojure.html" rel="tag">Clojure</a>, <a href="../../testing.html" rel="tag">testing</a></span><span class="comments-link"><a href="../../../2010/07/05/lazytest-status-report.html#comments">5 Comments<span class="screen-reader-text"> on A Journey of a Thousand Lines Begins with a Single Test</span></a></span>			</footer><!-- .entry-footer -->
</article><!-- #post-## -->

<article id="post-444" class="post-444 post type-post status-publish format-standard hentry category-programming tag-clojure">
	<header class="entry-header">
		
		<h2 class="entry-title"><a href="../../../2010/01/21/spread-thin.html" rel="bookmark">Spread Thin</a></h2>	</header><!-- .entry-header -->

	
	
	<div class="entry-content">
		<p>With the profusion of &#8220;community&#8221; web sites around today, it&#8217;s getting hard to keep track of where your &#8220;community&#8221; is.</p>
<p>For example, the &#8220;Clojure community&#8221; exists in 7 places:</p>
<ol>
<li><a href="http://clojure.org/">clojure.org</a> (main documentation)</li>
<li><a href="http://github.com/richhickey/clojure">Github</a> (source code)</li>
<li><a href="http://www.assembla.com/spaces/clojure">Assembla</a> (bug tracking)</li>
<li><a href="http://en.wikibooks.org/wiki/Clojure">Wikibooks</a> (more documentation)</li>
<li><a href="http://groups.google.com/group/clojure">Google Groups</a> (discussion)</li>
<li><a href="http://code.google.com/p/clojure/">Google Code</a> (downloads)</li>
<li><a href="http://freenode.net/">Freenode</a> (chat)</li>
</ol>
<p>That doesn&#8217;t include the <a href="http://sourceforge.net/projects/clojure/">defunct Sourceforge page</a> or the Hudson build server at <a href="http://build.clojure.org/">build.clojure.org</a>.  Nor does it take into account the groups dedicated to specific Clojure libraries.</p>
<p>If I want to know what&#8217;s going on in Clojure, I have to monitor at least half a dozen channels.  If I want to reach a broad spectrum of Clojure users, I have to post the same content in multiple places.</p>
<p>Weren&#8217;t all-in-one services like Launchpad supposed to save us from this insanity?  Maybe.  But they never can, because everyone has different tastes when it comes to bug tracking, version control, and mailing lists.</p>
<p>I wish that &#8220;community&#8221; sites, rather than trying to provide all-in-one services, would make it easier to connect with other sites.  Assembla, for example, connects to Github.  But relating an Assembla ticket to a Groups discussion to an IRC chat to a wiki page is all but impossible.</p>
<p>Better yet, I wish sites like Github offered subdomain hosting, e.g. github.clojure.org.</p>
	</div><!-- .entry-content -->

	<footer class="entry-footer">
		<span class="byline"><span class="author vcard"><img alt='' src='https://secure.gravatar.com/avatar/55878d0196b91803f9cb2c372b0551d3?s=49&amp;d=blank&amp;r=g' srcset='https://secure.gravatar.com/avatar/55878d0196b91803f9cb2c372b0551d3?s=98&amp;d=blank&amp;r=g 2x' class='avatar avatar-49 photo' height='49' width='49' /><span class="screen-reader-text">Author </span> <a class="url fn n" href="../../../author/stuart.html">Stuart</a></span></span><span class="posted-on"><span class="screen-reader-text">Posted on </span><a href="../../../2010/01/21/spread-thin.html" rel="bookmark"><time class="entry-date published updated" datetime="2010-01-21T12:52:12+00:00">January 21, 2010</time></a></span><span class="cat-links"><span class="screen-reader-text">Categories </span><a href="../../../category/programming.html" rel="category tag">Programming</a></span><span class="tags-links"><span class="screen-reader-text">Tags </span><a href="../../clojure.html" rel="tag">Clojure</a></span><span class="comments-link"><a href="../../../2010/01/21/spread-thin.html#comments">8 Comments<span class="screen-reader-text"> on Spread Thin</span></a></span>			</footer><!-- .entry-footer -->
</article><!-- #post-## -->

<article id="post-432" class="post-432 post type-post status-publish format-standard hentry category-programming tag-clojure">
	<header class="entry-header">
		
		<h2 class="entry-title"><a href="../../../2010/01/15/keyword-arguments-in-clojure.html" rel="bookmark">Keyword Arguments in Clojure, the Right Way</a></h2>	</header><!-- .entry-header -->

	
	
	<div class="entry-content">
		<p><strong>Update Feb. 10, 2010: I was wrong.  Recent discussions indicate that placing optional arguments in-line, as in my first example, is preferred.  In the future, Clojure may have destructuring support for this style.  For now, this post remains a useful guide to map destructuring.</strong></p>
<p>Many languages, such as Python and Ruby, allow functions arguments to be passed as name-value pairs.</p>
<p>People often ask for the same thing in <a href="http://clojure.org/">Clojure</a>, and they end up writing something like this:</p>
<pre>(defn foo [a b & options]
  (let [opts (apply hash-map options)]
    ...))

(foo 1 2 :optionA 3 :optionB 4)</pre>
<p>That works, but it&#8217;s not very efficient.  Every time you call foo, it has to construct a hash-map from its arguments.  That&#8217;s a fair amount of overhead for what is usually a small map of options.</p>
<p>A better way is to use Clojure&#8217;s <em>map binding forms</em>.  The syntax is tricky, but very powerful.</p>
<p>Let&#8217;s look at the general syntax of Clojure&#8217;s local binding form, <strong>let</strong>:</p>
<pre>(let [<em>bindings...</em>] <em>expressions...</em>)</pre>
<p>The <em>bindings</em> are pairs consisting of a <em>binding form</em> and an <em>initialization expression</em>.  The simplest binding pair is just name-value:</p>
<pre>(let [a 1, b 2]
  (list a b))
;;=> (1 2)</pre>
<p>So far, so good.  You probably know that you can use a vector as the binding form to bind sequential things like lists, vectors, and even strings:</p>
<pre>(let [[a b c] "foo"]
  (list a b c))
;;=> (\f \o \o)</pre>
<p>Moving on:  A <em>map binding</em> uses a map as the binding form.  Well, duh.  Let&#8217;s call it the <em>binding map</em>.  (catchy, no?)</p>
<p>The <em>keys</em> of the binding map are the local variables you want to create.  The <em>values</em> of the binding map are <em>keys</em> in the initialization expression.  The locals will be bound to the values of corresponding keys.</p>
<p>How about an example?</p>
<pre>      ; binding form      ; init expression
(let [{a :keyA, b :keyB}  {:keyA 1, :keyB 2}]
  (list a b))
;;=> (1 2)</pre>
<p>You can use the same technique for function arguments:</p>
<pre>(defn foo [{a :keyA, b :keyB}]
  (list a b))

(foo {:keyA 1 :keyB 2})
;;=> (1 2)</pre>
<p>Notice that we&#8217;re calling <strong>foo</strong> with a single argument, a map.  This may be slightly less pretty than having key/value pairs directly in the function arguments, but it is more efficient, since the compiler knows exactly how big the argument map is.  It&#8217;s also more flexible, because we can construct the argument map elsewhere and then pass it to the function:</p>
<pre>(def options {:keyA 3, :keyB 4})

(foo options)
;;=> (3 4)</pre>
<p>You can also mix normal, positional arguments with map arguments:</p>
<pre>(defn foo [a b {c :keyC, d :keyD}]
  (list a b c d))

(foo 1 2 {:keyC 3, :keyD 4})
;;=> (1 2 3 4)</pre>
<p>In the most common case, you probably want your local variables to have the same names as the keywords in the initialization expression.  Clojure has a shortcut for that, a special key in the binding map called, appropriately enough, <strong>:keys</strong>:</p>
<pre>(defn foo [{:keys [a b]}]
  (list a b))

(foo {:a 5, :b 6})
;;=> (5 6)</pre>
<p>You can also supply a map of default values using another special key in the binding map, the <strong>:or</strong> key:</p>
<pre>(defn foo [{:keys [a b c], :or {c 42}}]
  (list a b c))

(foo {:a 7, :b 8, :c 9})
;;=> (7 8 9)

(foo {:a 20, :b 30})
;;=> (20 30 42)</pre>
<p>Finally, what if you want to enforce a requirement that certain keys be present?  Clojure 1.1 introduced a great way to do that with <a href="http://clojure.org/special_forms#toc9">pre- and postconditions</a>.  You can set a pre-condition that will throw an exception if a particular binding is nil:</p>
<pre>(defn foo [{:keys [a b c]}]
  {:pre [(not (nil? c))]}
  (list a b c))

(foo {:a 1, :c 3})
;;=> (1 nil 3)

(foo {:b 2})
;;=> java.lang.AssertionError: Assert failed: (not (nil? c))</pre>
<p>There are even more features of map binding that I haven&#8217;t covered here.  But this should give you enough background to understand the <a href="http://clojure.org/special_forms#toc4">full documentation</a>.</p>
	</div><!-- .entry-content -->

	<footer class="entry-footer">
		<span class="byline"><span class="author vcard"><img alt='' src='https://secure.gravatar.com/avatar/55878d0196b91803f9cb2c372b0551d3?s=49&amp;d=blank&amp;r=g' srcset='https://secure.gravatar.com/avatar/55878d0196b91803f9cb2c372b0551d3?s=98&amp;d=blank&amp;r=g 2x' class='avatar avatar-49 photo' height='49' width='49' /><span class="screen-reader-text">Author </span> <a class="url fn n" href="../../../author/stuart.html">Stuart</a></span></span><span class="posted-on"><span class="screen-reader-text">Posted on </span><a href="../../../2010/01/15/keyword-arguments-in-clojure.html" rel="bookmark"><time class="entry-date published" datetime="2010-01-15T12:42:18+00:00">January 15, 2010</time><time class="updated" datetime="2010-02-10T17:26:19+00:00">February 10, 2010</time></a></span><span class="cat-links"><span class="screen-reader-text">Categories </span><a href="../../../category/programming.html" rel="category tag">Programming</a></span><span class="tags-links"><span class="screen-reader-text">Tags </span><a href="../../clojure.html" rel="tag">Clojure</a></span><span class="comments-link"><a href="../../../2010/01/15/keyword-arguments-in-clojure.html#comments">5 Comments<span class="screen-reader-text"> on Keyword Arguments in Clojure, the Right Way</span></a></span>			</footer><!-- .entry-footer -->
</article><!-- #post-## -->

<article id="post-419" class="post-419 post type-post status-publish format-standard hentry category-programming tag-clojure tag-hadoop">
	<header class="entry-header">
		
		<h2 class="entry-title"><a href="../../../2010/01/11/clojure-hadoop-1-0-0.html" rel="bookmark">Clojure-Hadoop 1.0.0</a></h2>	</header><!-- .entry-header -->

	
	
	<div class="entry-content">
		<p>At long last, I have made a formal release of my <a href="../../../2010/01/11/clojure-hadoop-1-0-0.html">clojure-hadoop</a> library.  Downloads and more information <a href="../../../2010/01/11/clojure-hadoop-1-0-0.html">here</a>.</p>
<p>The 1.0.0 release is documented, but not in exhaustive detail.  Other people have used this successfully, but it may not support all possible Hadoop configurations.</p>
<p>Watch video of <a href="http://vimeo.com/7669741">my presentation at HadoopWorld NYC</a>.</p>
	</div><!-- .entry-content -->

	<footer class="entry-footer">
		<span class="byline"><span class="author vcard"><img alt='' src='https://secure.gravatar.com/avatar/55878d0196b91803f9cb2c372b0551d3?s=49&amp;d=blank&amp;r=g' srcset='https://secure.gravatar.com/avatar/55878d0196b91803f9cb2c372b0551d3?s=98&amp;d=blank&amp;r=g 2x' class='avatar avatar-49 photo' height='49' width='49' /><span class="screen-reader-text">Author </span> <a class="url fn n" href="../../../author/stuart.html">Stuart</a></span></span><span class="posted-on"><span class="screen-reader-text">Posted on </span><a href="../../../2010/01/11/clojure-hadoop-1-0-0.html" rel="bookmark"><time class="entry-date published" datetime="2010-01-11T13:35:43+00:00">January 11, 2010</time><time class="updated" datetime="2010-01-11T13:36:47+00:00">January 11, 2010</time></a></span><span class="cat-links"><span class="screen-reader-text">Categories </span><a href="../../../category/programming.html" rel="category tag">Programming</a></span><span class="tags-links"><span class="screen-reader-text">Tags </span><a href="../../clojure.html" rel="tag">Clojure</a>, <a href="../../hadoop.html" rel="tag">Hadoop</a></span>			</footer><!-- .entry-footer -->
</article><!-- #post-## -->

<article id="post-395" class="post-395 post type-post status-publish format-standard hentry category-programming tag-clojure tag-swing">
	<header class="entry-header">
		
		<h2 class="entry-title"><a href="../../../2010/01/08/agents-of-swing.html" rel="bookmark">Agents of Swing</a></h2>	</header><!-- .entry-header -->

	
	
	<div class="entry-content">
		<p>The title of this post would make a good name for a band.</p>
<p>Anyway, today I&#8217;m going to talk about Swing and concurrency and <a href="http://clojure.org/">Clojure</a>.</p>
<p>The Swing framework is <a href="http://java.sun.com/docs/books/tutorial/uiswing/concurrency/dispatch.html">not thread-safe</a>.  That may sound strange at first, but there&#8217;s actually some <a href="http://weblogs.java.net/blog/kgh/archive/2004/10/multithreaded_t.html">sound technical reasoning</a> behind it.</p>
<p>Basically, the Swing designers realized that, in order to have a multi-threaded GUI, you need locks everywhere, which typically means you have bugs everywhere.</p>
<p>That&#8217;s not to say a Swing application can&#8217;t be multi-threaded.  Swing merely requires that the <em>GUI</em> be single-threaded.  In Swing, all GUI-related code must run on a special thread called the <em>event dispatch thread</em>, which is automatically created by the Swing framework.</p>
<p>By design, event listeners such as <a href="http://java.sun.com/javase/6/docs/api/java/awt/event/ActionListener.html#actionPerformed%28java.awt.event.ActionEvent%29">ActionListener.actionPerformed</a> always run on the event dispatch thread.  To run arbitrary code on the event dispatch thread, you can use the <a href="http://java.sun.com/javase/6/docs/api/javax/swing/SwingUtilities.html#invokeLater%28java.lang.Runnable%29">SwingUtilities.invokeLater</a> method.</p>
<p>As was pointed out in a comment on my <a href="../../../2010/01/06/heating-up-clojure-swing.html">last post</a>, this is how all of my example apps <em>should</em> be started.  The invokeLater method takes a <a title="Runnable API docs" href="http://java.sun.com/javase/6/docs/api/java/lang/Runnable.html">Runnable</a> argument.  In Clojure, this is easy, because all Clojure functions are Runnable.  So, for example, the <strong>temp-app</strong> program should be started like this:</p>
<pre>(SwingUtilities/invokeLater temp-app)</pre>
<p>As a consequence of running all GUI code on a single thread, any GUI code that blocks can &#8220;freeze&#8221; the entire application.  Event listeners, therefore, must execute quickly and delegate long operations like I/O to other threads.</p>
<p>Java 6 provides the <a title="SwingWorker API docs" href="http://java.sun.com/javase/6/docs/api/javax/swing/SwingWorker.html">SwingWorker</a> class to manage long-running background tasks.  Unfortunately, the implementation of SwingWorker is heavily dependent on protected methods and concrete inheritance, features that are awkward to use in Clojure.</p>
<p>But wait, wasn&#8217;t Clojure <em>designed</em> for concurrency?  Yes it was, and we can replace SwingWorker with Clojure&#8217;s more-powerful tools.</p>
<p>In this post, I will recreate the <a href="http://java.sun.com/docs/books/tutorial/uiswing/concurrency/interim.html">Flipper application</a> from the Swing tutorials.</p>
<p>* * *</p>
<p>The point of Flipper is to test the &#8220;fairness&#8221; of Java&#8217;s random number generator.  It uses <a href="http://java.sun.com/javase/6/docs/api/java/util/Random.html">java.util.Random</a> to generate random booleans, simulating a series of coin flips.  The number of &#8220;heads&#8221; (boolean true) should converge to half of the total number of flips.</p>
<p>The Java version of Flipper (<a title="Flipper.java" href="http://java.sun.com/docs/books/tutorial/uiswing/examples/concurrency/FlipperProject/src/concurrency/Flipper.java">source here</a>) does the coin flips in a SwingWorker thread, which sends intermediate results to a GUI.</p>
<p>Our version will use <a href="http://clojure.org/agents">Clojure Agents</a>, a much more flexible and powerful alternative.</p>
<p>Lets dig into some code.  First, we need a function to create a &#8220;Flipper&#8221; agent:</p>
<pre>(defn new-flipper []
  (agent {:total 0, :heads 0,
          :running false,
          :random (java.util.Random.)}))</pre>
<p>This sets up the initial state of the agent, with its own random number generator, two counters, and a boolean flag to designate whether or not the flipper is running.</p>
<p>The flipper agent will have three actions.  An agent <em>action</em> is just a function taking one argument, which is the <em>current</em> state of the agent.  Whatever the function returns becomes the <em>new</em> state of the agent.</p>
<p>Additionally, in the body of the action, the special Var <strong>*agent*</strong> is bound to the agent itself.  The action function can <strong>send</strong> other actions to <strong>*agent*</strong>; those actions will not run until <em>after</em> the current action completes.</p>
<p>Our flipper&#8217;s first action is <strong>calculate</strong>:</p>
<pre>(defn calculate [state]
  (if (:running state)
    (do (send *agent* calculate)
        (assoc state
          :total (inc (:total state))
          :heads (if (.nextBoolean (:random state))
                   (inc (:heads state))
                   (:heads state))))
    state))</pre>
<p>If the flipper is currently &#8220;running,&#8221; <strong>calculate</strong> will call the random number generator and update the counters.  It will also <strong>send</strong> itself to the agent again, creating a loop.</p>
<p>If the flipper is not &#8220;running,&#8221; <strong>calculate</strong> does nothing, but it must still return the original state.</p>
<p>The remaining two actions control the &#8220;running&#8221; state of the agent:</p>
<pre>(defn start [state]
  (send *agent* calculate)
  (assoc state :running true))

(defn stop [state]
  (assoc state :running false))</pre>
<p>These actions just change the value of <strong>:running</strong> in the agent&#8217;s state.  The <strong>start</strong> action also sends the <strong>calculate</strong> action to kickstart the calculation loop.</p>
<p>To watch the agent in action, try this at the REPL:</p>
<pre>(def flipper (new-flipper))
(send flipper start)</pre>
<p>The flipper is now running in the background.  At any time, you can retrieve the current state of the flipper with <strong>(deref&nbsp;flipper)</strong>, or simply <strong>@flipper</strong>.  Try it a few times and see how the counters change, as in this sample REPL session:</p>
<pre><strong>user&gt;</strong> @flipper
{:total 365067, :heads 182253, :running true, ...
<strong>user&gt;</strong> @flipper
{:total 679283, :heads 338549, :running true, ...
<strong>user&gt;</strong> @flipper
{:total 1030204, :heads 513767, :running true, ...</pre>
<p>To stop the calculation, type</p>
<pre>(send flipper stop)</pre>
<p>Subsequent calls to <strong>@flipper</strong> will all show the same value.  You can restart the calculation by typing <strong>(send&nbsp;flipper&nbsp;start)</strong> again.</p>
<p>We need one more function to make our flipper complete.  We want to compute the &#8220;unfairness&#8221; of the random number generator, or how far it is from 0.5.  This is easy:</p>
<pre>(defn error [state]
  (if (zero? (:total state)) 0.0
      (- (/ (double (:heads state))
            (:total state))
         0.5)))</pre>
<p>The <strong>if</strong> expression is just there to avoid divide-by-zero errors in the initial case.  </p>
<p>Note that, although I used the same argument name, <strong>state</strong>, as in the actions, the <strong>error</strong> function is <em>not</em> meant to be called as an action with <strong>send</strong>.  Instead, we will call it on the current state of the agent like this:</p>
<pre>(error @flipper)</pre>
<p>* * *</p>
<p>The nice thing about this flipper is that, unlike the Java version, it is completely decoupled from the GUI.  We can design and test it at the REPL before writing any GUI code at all.</p>
<p>(The Java version <em>could</em> have been decoupled.  But because Swing requires you to create so many classes anyway, the temptation is always there to combine GUI code with &#8220;process&#8221; code.)</p>
<p>So let&#8217;s get this GUI going.  Unlike the Java example, which used callbacks from the flipper to update the GUI, our GUI will update at a fixed rate of 10 times per second.  To do this we will use a <a href="http://java.sun.com/javase/6/docs/api/javax/swing/Timer.html">javax.swing.Timer</a>, which fires an event every <em>n</em> milliseconds.</p>
<p>First, some imports and a helper function to create the text fields with common attributes:</p>
<pre>(import '(javax.swing JPanel JFrame JButton JTextField
                      JLabel Timer SwingUtilities))

(defn text-field [value]
  (doto (JTextField. value 15)
    (.setEnabled false)
    (.setHorizontalAlignment JTextField/RIGHT)))</pre>
<p>Next, we will reuse the <strong>on-action</strong> macro from an earlier post, except I&#8217;ve renamed it <strong>with-action</strong> because my editor&#8217;s automatic indentation looks better that way.</p>
<pre>(defmacro with-action [component event & body]
  `(. ~component addActionListener
      (proxy [java.awt.event.ActionListener] []
        (actionPerformed [~event] ~@body))))</pre>
<p>And now we&#8217;re ready for the app itself:</p>
<pre>(defn flipper-app []
  ;; Construct components:
  (let [flipper (new-flipper)
        b-start (JButton. "Start")
        b-stop (doto (JButton. "Stop")
                 (.setEnabled false))
        total (text-field "0")
        heads (text-field "0")
        t-error (text-field "0.0")
        timer (Timer. 100 nil)]

    ;; Setup actions:
    (with-action timer e
      (let [state @flipper]
        (.setText total (str (:total state)))
        (.setText heads (str (:heads state)))
        (.setText t-error (format "%.10g" (error state)))))
    (with-action b-start e
      (send flipper start)
      (.setEnabled b-stop true)
      (.setEnabled b-start false)
      (.start timer))
    (with-action b-stop e
      (send flipper stop)
      (.setEnabled b-stop false)
      (.setEnabled b-start true)
      (.stop timer))

    ;; Create window and layout:
    (doto (JFrame. "Flipper")
      (.setContentPane
       (doto (JPanel.)
         (.add (JLabel. "Total:"))
         (.add total)
         (.add (JLabel. "Heads:"))
         (.add heads)
         (.add (JLabel. "Error:"))
         (.add t-error)
         (.add b-start)
         (.add b-stop)))
      (.pack)
      (.setVisible true))))</pre>
<p>The GUI has three text fields showing the total number of flips, the number of &#8220;heads,&#8221; and the error rate.  The &#8220;Start&#8221; button starts the flipper; the &#8220;Stop&#8221; button suspends it.  You can start and stop as many times as you like without losing the results of the calculation (another improvement over the Java version, which restarts at zero each time).</p>
<p>The important code is in the <strong>with-action</strong> bodies.  (Don&#8217;t confuse Swing ActionListeners with Agent actions.)  Remember, event listeners must execute quickly, so all they do is update the visible parts of the GUI.</p>
<p>The &#8220;Start&#8221; button kicks off the flipper and activates the Timer.  The Timer fires every 100 milliseconds, updating the text fields from the current state of the flipper.  The &#8220;Stop&#8221; button suspends both the Timer and the flipper.</p>
<p>Run the application like this:</p>
<pre>(SwingUtilities/invokeLater flipper-app)</pre>
<p>We didn&#8217;t do any fancy layout because it wasn&#8217;t necessary for the example.  But if you want something prettier, here&#8217;s another version using the GridBagLayout macros from my last post:</p>
<pre>(import '(java.awt GridBagLayout Insets))

(defmacro set-grid! [constraints field value]
  `(set! (. ~constraints ~(symbol (name field)))
         ~(if (keyword? value)
            `(. java.awt.GridBagConstraints
                ~(symbol (name value)))
            value)))

(defmacro grid-bag-layout [container & body]
  (let [c (gensym "c")
        cntr (gensym "cntr")]
    `(let [~c (new java.awt.GridBagConstraints)
           ~cntr ~container]
       ~@(loop [result '() body body]
           (if (empty? body)
             (reverse result)
             (let [expr (first body)]
               (if (keyword? expr)
                 (recur (cons `(set-grid! ~c ~expr
                                          ~(second body))
                              result)
                        (next (next body)))
                 (recur (cons `(.add ~cntr ~expr ~c)
                              result)
                        (next body)))))))))

(defn flipper-app2 []
  ;; Construct components:
  (let [flipper (new-flipper)
        b-start (JButton. "Start")
        b-stop (doto (JButton. "Stop")
                 (.setEnabled false))
        total (text-field "0")
        heads (text-field "0")
        t-error (text-field "0.0")
        timer (Timer. 100 nil)]

    ;; Setup actions:
    (with-action timer e
      (let [state @flipper]
        (.setText total (str (:total state)))
        (.setText heads (str (:heads state)))
        (.setText t-error (format "%.10g" (error state)))))
    (with-action b-start e
      (send flipper start)
      (.setEnabled b-stop true)
      (.setEnabled b-start false)
      (.start timer))
    (with-action b-stop e
      (send flipper stop)
      (.setEnabled b-stop false)
      (.setEnabled b-start true)
      (.stop timer))

    ;; Create window and layout:
    (doto (JFrame. "Flipper")
      (.setContentPane
       (doto (JPanel. (GridBagLayout.))
         (grid-bag-layout
          :insets (Insets. 5 5 5 5)

          :gridx 0, :anchor :LINE_END
          :gridy 0, (JLabel. "Total:")
          :gridy 1, (JLabel. "Heads:")
          :gridy 2, (JLabel. "Error:")

          :gridx 1, :anchor :LINE_START
          :gridy 0, total
          :gridy 1, heads
          :gridy 2, t-error

          :gridx 0, :gridy 3, :gridwidth 2, :anchor :CENTER
          (doto (JPanel.)
            (.add b-start)
            (.add b-stop)))))
      (.pack)
      (.setVisible true))))</pre>
<p>I centered the buttons below the text fields by embedding them in a nested JPanel that spans the full width of the window.</p>
<p>Run this example as:</p>
<pre>(SwingUtilities/invokeLater flipper-app2)</pre>
<p>Enjoy!</p>
	</div><!-- .entry-content -->

	<footer class="entry-footer">
		<span class="byline"><span class="author vcard"><img alt='' src='https://secure.gravatar.com/avatar/55878d0196b91803f9cb2c372b0551d3?s=49&amp;d=blank&amp;r=g' srcset='https://secure.gravatar.com/avatar/55878d0196b91803f9cb2c372b0551d3?s=98&amp;d=blank&amp;r=g 2x' class='avatar avatar-49 photo' height='49' width='49' /><span class="screen-reader-text">Author </span> <a class="url fn n" href="../../../author/stuart.html">Stuart</a></span></span><span class="posted-on"><span class="screen-reader-text">Posted on </span><a href="../../../2010/01/08/agents-of-swing.html" rel="bookmark"><time class="entry-date published updated" datetime="2010-01-08T13:45:34+00:00">January 8, 2010</time></a></span><span class="cat-links"><span class="screen-reader-text">Categories </span><a href="../../../category/programming.html" rel="category tag">Programming</a></span><span class="tags-links"><span class="screen-reader-text">Tags </span><a href="../../clojure.html" rel="tag">Clojure</a>, <a href="../../swing.html" rel="tag">Swing</a></span><span class="comments-link"><a href="../../../2010/01/08/agents-of-swing.html#comments">9 Comments<span class="screen-reader-text"> on Agents of Swing</span></a></span>			</footer><!-- .entry-footer -->
</article><!-- #post-## -->

<article id="post-388" class="post-388 post type-post status-publish format-standard hentry category-programming tag-clojure tag-swing">
	<header class="entry-header">
		
		<h2 class="entry-title"><a href="../../../2010/01/06/heating-up-clojure-swing.html" rel="bookmark">Heating Up Clojure &#038; Swing</a></h2>	</header><!-- .entry-header -->

	
	
	<div class="entry-content">
		<p>Most Swing examples don&#8217;t translate well into <a href="http://clojure.org/">Clojure</a> because they are so thoroughly embedded in the object-oriented paradigm.</p>
<p>A typical Swing example has a main class that extends a container class and implements some *Listener interface.Â  Clojure beginners who try to port these examples may think they need to mimic that same structure.</p>
<p>In fact, there are few situations where Swing <em>forces</em> you to create a subclass.Â  Most involve event listeners and can be handled adequately with Clojure&#8217;s <strong>proxy</strong>.</p>
<p>In this post, we&#8217;ll develop a complete, albeit small, Swing application: the classic <a title="Java Temperature Converter tutorial" href="http://java.sun.com/docs/books/tutorial/uiswing/learn/">Temperature Converter</a> tutorial.Â  But ours will be better.Â  It can convert both Celsius to Fahrenheit and vice-versa, and it does the conversion immediately without waiting for a button click.</p>
<p>Gentleman, start your REPLs.</p>
<p>Start by importing all the classes we will need for this example:</p>
<pre>(import '(javax.swing JLabel JPanel JFrame JTextField)
        '(javax.swing.event DocumentListener)
        '(java.awt GridBagLayout GridBagConstraints Insets))</pre>
<p>Before we get to any GUI stuff, we need two functions to convert between degrees Celsius and degrees Fahrenheit:</p>
<pre>(defn f-to-c [f]
  (* (- f 32) 5/9))

(defn c-to-f [c]
  (+ (* c 9/5) 32))</pre>
<p>Note the use of Clojure Ratios.</p>
<p>Next, we need a couple of helper functions.  First, the <strong>parse</strong> function will take a String typed by the user and convert it to a number.  If the user types an invalid number, <strong>parse</strong> returns nil, but it can handle extra spaces:</p>
<pre>(defn parse [s]
  (try (Double/parseDouble (.trim s))
       (catch NumberFormatException e nil)))</pre>
<p>The <strong>display</strong> function does the opposite.  It takes a number, rounds it to the nearest Integer (because Integers are prettier), and returns a String.</p>
<pre>(defn display [n]
  (str (Math/round (float n))))</pre>
<p>You can test these functions in the REPL:</p>
<pre>(f-to-c 212) ;; =&gt; 100
(c-to-f 0)   ;; =&gt; 32

(parse "22.5")   ;; =&gt; 22.5
(parse " 22 ")   ;; =&gt; 22.0
(parse "foobar") ;; =&gt; nil

(display 22.5) ;; =&gt; "23"
(display 22/7) ;; =&gt; "3"</pre>
<p>Now, time for some GUI goo!</p>
<p>Our temperature converter will have two text fields, one for Celsius and one for Fahrenheit, like this:</p>
<p><a href="../../../wp-content/uploads/2010/01/tempconvert-demo1.png"><img class="alignnone size-full wp-image-390" title="tempconvert-demo1" src="../../../wp-content/uploads/2010/01/tempconvert-demo1.png" alt="Temperature Converter GUI screenshot" width="181" height="58" /></a></p>
<p>As soon as the user types in either text field, the other text field will immediately change to show the converted value.  So to convert Celsius to Fahrenheit, just type into the &#8220;Celsius&#8221; box.  To go the other way, type into the &#8220;Fahrenheit&#8221; box.</p>
<p>I chose this design because it has two elements that behave very similarly, allowing me to show off some higher-order functions.</p>
<p>Let&#8217;s start with updating.  We have two text fields.  We want to update one, call it the &#8220;target&#8221; field, by converting the value of the other, call it the &#8220;source&#8221; field.  But we never want to update a field while the user is typing in it!  That would then trigger another update, causing an infinite loop.</p>
<p>Here&#8217;s the function:</p>
<pre>(defn update-temp [source target convert]
  (when (.isFocusOwner source)
    (if-let [n (parse (.getText source))]
      (.setText target (display (convert n)))
      (.setText target ""))))</pre>
<p>The <strong>source</strong> and <strong>target</strong> arguments are <a title="JTextField API docs" href="http://java.sun.com/javase/6/docs/api/javax/swing/JTextField.html">JTextField</a>s, which we will create later.  The <strong>update-temp</strong> function will be called every time one of the text fields emits a change event, so first we have to make sure that the <strong>source</strong> field (the one that triggered the event) has the keyboard focus.  If it does, we try to read the source field&#8217;s contents.  If <strong>parse</strong> is successful, we can calculate the value for the <strong>target</strong> field using the supplied <strong>convert</strong> function, otherwise we just set the target to be blank.</p>
<p>To make this work, we need to attach listeners to each of the JTextFields.  We can write a function for that too:</p>
<pre>(defn listen-temp [source target f]
  (.. source getDocument
      (addDocumentListener
       (proxy [DocumentListener] []
         (insertUpdate [e] (update-temp source target f))
         (removeUpdate [e] (update-temp source target f))
         (changedUpdate [e] )))))</pre>
<p>Swing implements a Model-View-Controller paradigm for text fields.  So to listen for changes in a text field, we actually want to listen to the <a title="Document API docs" href="http://java.sun.com/javase/6/docs/api/javax/swing/text/Document.html">Document</a> model associated with that text field.  The <a title="DocumentListener API docs" href="http://java.sun.com/javase/6/docs/api/javax/swing/event/DocumentListener.html">DocumentListener</a> insertUpdate and removeUpdate methods are called whenever the Document changes. The changedUpdate method is not interesting to us, but we still have to provide an empty implementation in the proxy.</p>
<p>So now we&#8217;ve got general-purpose functions for updating one text field whenever another changes.  Suppose we create two text fields named <strong>celsius</strong> and <strong>fahrenheit</strong>.  Wiring them together only takes 2 lines:</p>
<pre>(listen-temp celsius fahrenheit c-to-f)
(listen-temp fahrenheit celsius f-to-c)</pre>
<p>And that&#8217;s exactly what you&#8217;ll see in the final app, below.</p>
<p>All that&#8217;s left is the layout.  I&#8217;ll re-use the GridBagLayout macros from my <a href="../../../2010/01/05/taming-the-gridbaglayout.html">previous post</a>. Here they are again, for those of you following along at home:</p>
<pre>(defmacro set-grid! [constraints field value]
  `(set! (. ~constraints ~(symbol (name field)))
         ~(if (keyword? value)
            `(. GridBagConstraints ~(symbol (name value)))
            value)))

(defmacro grid-bag-layout [container &amp; body]
  (let [c (gensym "c")
        cntr (gensym "cntr")]
    `(let [~c (new java.awt.GridBagConstraints)
           ~cntr ~container]
       ~@(loop [result '() body body]
           (if (empty? body)
             (reverse result)
             (let [expr (first body)]
               (if (keyword? expr)
                 (recur (cons `(set-grid! ~c ~expr
                                          ~(second body))
                              result)
                        (next (next body)))
                 (recur (cons `(.add ~cntr ~expr ~c)
                              result)
                        (next body)))))))))</pre>
<p>And, last but not least, here&#8217;s the app itself:</p>
<pre>(defn temp-app []
  (let [celsius (JTextField. 3)
        fahrenheit (JTextField. 3)
        panel (doto (JPanel. (GridBagLayout.))
                (grid-bag-layout
                 :gridx 0, :gridy 0, :anchor :LINE_END
                 :insets (Insets. 5 5 5 5)
                 (JLabel. "Degrees Celsius:")
                 :gridy 1
                 (JLabel. "Degrees Fahrenheit:")
                 :gridx 1, :gridy 0, :anchor :LINE_START
                 celsius
                 :gridy 1
                 fahrenheit))]
    (listen-temp celsius fahrenheit c-to-f)
    (listen-temp fahrenheit celsius f-to-c)
    (doto (JFrame. "Temperature Converter")
      (.setContentPane panel)
      (.pack)
      (.setVisible true))))</pre>
<p>Run the function <strong>(temp-app)</strong> and you&#8217;ve got yourself a temperature converter.Â  Makes me feel all warm and GUI inside.</p>
	</div><!-- .entry-content -->

	<footer class="entry-footer">
		<span class="byline"><span class="author vcard"><img alt='' src='https://secure.gravatar.com/avatar/55878d0196b91803f9cb2c372b0551d3?s=49&amp;d=blank&amp;r=g' srcset='https://secure.gravatar.com/avatar/55878d0196b91803f9cb2c372b0551d3?s=98&amp;d=blank&amp;r=g 2x' class='avatar avatar-49 photo' height='49' width='49' /><span class="screen-reader-text">Author </span> <a class="url fn n" href="../../../author/stuart.html">Stuart</a></span></span><span class="posted-on"><span class="screen-reader-text">Posted on </span><a href="../../../2010/01/06/heating-up-clojure-swing.html" rel="bookmark"><time class="entry-date published updated" datetime="2010-01-06T17:32:34+00:00">January 6, 2010</time></a></span><span class="cat-links"><span class="screen-reader-text">Categories </span><a href="../../../category/programming.html" rel="category tag">Programming</a></span><span class="tags-links"><span class="screen-reader-text">Tags </span><a href="../../clojure.html" rel="tag">Clojure</a>, <a href="../../swing.html" rel="tag">Swing</a></span><span class="comments-link"><a href="../../../2010/01/06/heating-up-clojure-swing.html#comments">5 Comments<span class="screen-reader-text"> on Heating Up Clojure &#038; Swing</span></a></span>			</footer><!-- .entry-footer -->
</article><!-- #post-## -->

	<nav class="navigation pagination" role="navigation">
		<h2 class="screen-reader-text">Posts navigation</h2>
		<div class="nav-links"><a class="prev page-numbers" href="4.html">Previous page</a>
<a class='page-numbers' href='../index.html'><span class="meta-nav screen-reader-text">Page </span>1</a>
<span class="page-numbers dots">&hellip;</span>
<a class='page-numbers' href='4.html'><span class="meta-nav screen-reader-text">Page </span>4</a>
<span class='page-numbers current'><span class="meta-nav screen-reader-text">Page </span>5</span>
<a class='page-numbers' href='6.html'><span class="meta-nav screen-reader-text">Page </span>6</a>
<a class='page-numbers' href='7.html'><span class="meta-nav screen-reader-text">Page </span>7</a>
<a class="next page-numbers" href="6.html">Next page</a></div>
	</nav>
		</main><!-- .site-main -->
	</div><!-- .content-area -->


	<aside id="secondary" class="sidebar widget-area" role="complementary">
		<section id="search-3" class="widget widget_search">
<form role="search" method="get" class="search-form" action="https://stuartsierra.com/">
	<label>
		<span class="screen-reader-text">Search for:</span>
		<input type="search" class="search-field" placeholder="Search &hellip;" value="" name="s" />
	</label>
	<button type="submit" class="search-submit"><span class="screen-reader-text">Search</span></button>
</form>
</section><section id="text-4" class="widget widget_text">			<div class="textwidget"><ul>
<li><a href="http://feeds2.feedburner.com/StuartSierra" title="Syndicate this site using RSS 2.0">Entries <abbr title="Really Simple Syndication">RSS</abbr></a></li>
<li><a href="../../../comments/feed" title="The latest comments to all posts in RSS">Comments <abbr title="Really Simple Syndication">RSS</abbr></a></li>
</ul>
<ul>
<li><a href="https://twitter.com/stuartsierra">Twitter</a></li>
<li><a href="https://github.com/stuartsierra">GitHub</a></li>
</ul></div>
		</section><section id="tag-widget-2" class="widget TagWidget"><h2 class="widget-title">Clojure Doâs and Donâts</h2><ul class = "posts-by-tag-list"><li class="posts-by-tag-item Clojure do's and don'ts" id="posts-by-tag-item-883"><a class = "posts-by-tag-item-title" href="../../../2015/08/25/clojure-donts-lazy-effects.html">Clojure Donâts: Lazy Effects</a></li><li class="posts-by-tag-item Clojure do's and don'ts" id="posts-by-tag-item-877"><a class = "posts-by-tag-item-title" href="../../../2015/08/10/clojure-donts-redundant-map.html">Clojure Donâts: Redundant map</a></li><li class="posts-by-tag-item Clojure do's and don'ts" id="posts-by-tag-item-870"><a class = "posts-by-tag-item-title" href="../../../2015/06/16/clojure-donts-single-branch-if.html">Clojure Donâts: Single-branch if</a></li><li class="posts-by-tag-item Clojure do's and don'ts" id="posts-by-tag-item-854"><a class = "posts-by-tag-item-title" href="../../../2015/06/10/clojure-donts-heisenparameter.html">Clojure Donâts: The Heisenparameter</a></li><li class="posts-by-tag-item Clojure do's and don'ts" id="posts-by-tag-item-849"><a class = "posts-by-tag-item-title" href="../../../2015/06/01/clojure-donts-optional-arguments-with-varargs.html">Clojure Donâts: Optional Arguments with Varargs</a></li><li class="posts-by-tag-item Clojure do's and don'ts errors" id="posts-by-tag-item-836"><a class = "posts-by-tag-item-title" href="../../../2015/05/27/clojure-uncaught-exceptions.html">Clojure Doâs: Uncaught Exceptions</a></li><li class="posts-by-tag-item Clojure do's and don'ts" id="posts-by-tag-item-831"><a class = "posts-by-tag-item-title" href="../../../2015/05/17/clojure-record-constructors.html">Record Constructors</a></li><li class="posts-by-tag-item Clojure do's and don'ts" id="posts-by-tag-item-826"><a class = "posts-by-tag-item-title" href="../../../2015/05/10/clojure-namespace-aliases.html">Clojure Doâs: Namespace Aliases</a></li><li class="posts-by-tag-item Clojure do's and don'ts" id="posts-by-tag-item-820"><a class = "posts-by-tag-item-title" href="../../../2015/05/02/clojure-donts-isa.html">Clojure Donâts: isa?</a></li><li class="posts-by-tag-item Clojure do's and don'ts" id="posts-by-tag-item-812"><a class = "posts-by-tag-item-title" href="../../../2015/04/26/clojure-donts-concat.html">Clojure Donâts: Concat</a></li></ul></section>	</aside><!-- .sidebar .widget-area -->

		</div><!-- .site-content -->

		<footer id="colophon" class="site-footer" role="contentinfo">
							<nav class="main-navigation" role="navigation" aria-label="Footer Primary Menu">
					<div class="menu-main-menu-container"><ul id="menu-main-menu-1" class="primary-menu"><li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-635"><a href="../../../about-me.html">About Me</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-633"><a href="../../../writing.html">Writing</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-634"><a href="../../../presentations.html">Presentations</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-636"><a href="../../../software.html">Software</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-637"><a href="../../../contact.html">Contact</a></li>
</ul></div>				</nav><!-- .main-navigation -->
			
			
			<div class="site-info">
								<span class="site-title"><a href="../../../index.html" rel="home">Digital Digressions by Stuart Sierra</a></span>
				<a href="https://wordpress.org/">Proudly powered by WordPress</a>
			</div><!-- .site-info -->
		</footer><!-- .site-footer -->
	</div><!-- .site-inner -->
</div><!-- .site -->

	<div style="display:none">
	<div class="grofile-hash-map-55878d0196b91803f9cb2c372b0551d3">
	</div>
	</div>
<script type='text/javascript' src='https://s0.wp.com/wp-content/js/devicepx-jetpack.js?ver=201635'></script>
<script type='text/javascript' src='https://secure.gravatar.com/js/gprofiles.js?ver=2016Sepaa'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var WPGroHo = {"my_hash":""};
/* ]]> */
</script>
<script type='text/javascript' src='../../../wp-content/plugins/jetpack/modules/wpgroho167b.js?ver=4.6'></script>
<script type='text/javascript' src='../../../wp-content/themes/twentysixteen/js/skip-link-focus-fix8de4.js?ver=20160816'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var screenReaderText = {"expand":"expand child menu","collapse":"collapse child menu"};
/* ]]> */
</script>
<script type='text/javascript' src='../../../wp-content/themes/twentysixteen/js/functions8de4.js?ver=20160816'></script>
<script type='text/javascript' src='../../../wp-includes/js/wp-embed.min167b.js?ver=4.6'></script>
<script type='text/javascript' src='https://stats.wp.com/e-201635.js' async defer></script>
<script type='text/javascript'>
	_stq = window._stq || [];
	_stq.push([ 'view', {v:'ext',j:'1:4.2.2',blog:'2702563',post:'0',tz:'-4',srv:'stuartsierra.com'} ]);
	_stq.push([ 'clickTrackerInit', '2702563', '0' ]);
</script>
</body>

<!-- Mirrored from stuartsierra.com/tag/clojure/page/5 by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 02 Sep 2016 17:03:09 GMT -->
</html>

<!-- Dynamic page generated in 0.954 seconds. -->
<!-- Cached page generated by WP-Super-Cache on 2016-09-02 13:00:34 -->

<!-- Compression = gzip -->