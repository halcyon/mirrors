<!DOCTYPE html>
<html lang="en-US" class="no-js">

<!-- Mirrored from stuartsierra.com/tag/patterns by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 02 Sep 2016 17:02:27 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="profile" href="http://gmpg.org/xfn/11">
		<script>(function(html){html.className = html.className.replace(/\bno-js\b/,'js')})(document.documentElement);</script>
<title>patterns &#8211; Digital Digressions by Stuart Sierra</title>
<link rel='dns-prefetch' href='http://s0.wp.com/'>
<link rel='dns-prefetch' href='http://secure.gravatar.com/'>
<link rel='dns-prefetch' href='http://fonts.googleapis.com/'>
<link rel='dns-prefetch' href='http://s.w.org/'>
<link rel="alternate" type="application/rss+xml" title="Digital Digressions by Stuart Sierra &raquo; Feed" href="http://feeds2.feedburner.com/StuartSierra" />
<link rel="alternate" type="application/rss+xml" title="Digital Digressions by Stuart Sierra &raquo; Comments Feed" href="../comments/feed" />
<link rel="alternate" type="application/rss+xml" title="Digital Digressions by Stuart Sierra &raquo; patterns Tag Feed" href="http://feeds2.feedburner.com/StuartSierra" />
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/stuartsierra.com\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.6"}};
			!function(a,b,c){function d(a){var c,d,e,f,g,h=b.createElement("canvas"),i=h.getContext&&h.getContext("2d"),j=String.fromCharCode;if(!i||!i.fillText)return!1;switch(i.textBaseline="top",i.font="600 32px Arial",a){case"flag":return i.fillText(j(55356,56806,55356,56826),0,0),!(h.toDataURL().length<3e3)&&(i.clearRect(0,0,h.width,h.height),i.fillText(j(55356,57331,65039,8205,55356,57096),0,0),c=h.toDataURL(),i.clearRect(0,0,h.width,h.height),i.fillText(j(55356,57331,55356,57096),0,0),d=h.toDataURL(),c!==d);case"diversity":return i.fillText(j(55356,57221),0,0),e=i.getImageData(16,16,1,1).data,f=e[0]+","+e[1]+","+e[2]+","+e[3],i.fillText(j(55356,57221,55356,57343),0,0),e=i.getImageData(16,16,1,1).data,g=e[0]+","+e[1]+","+e[2]+","+e[3],f!==g;case"simple":return i.fillText(j(55357,56835),0,0),0!==i.getImageData(16,16,1,1).data[0];case"unicode8":return i.fillText(j(55356,57135),0,0),0!==i.getImageData(16,16,1,1).data[0];case"unicode9":return i.fillText(j(55358,56631),0,0),0!==i.getImageData(16,16,1,1).data[0]}return!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g,h,i;for(i=Array("simple","flag","unicode8","diversity","unicode9"),c.supports={everything:!0,everythingExceptFlag:!0},h=0;h<i.length;h++)c.supports[i[h]]=d(i[h]),c.supports.everything=c.supports.everything&&c.supports[i[h]],"flag"!==i[h]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[i[h]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link rel='stylesheet' id='twentysixteen-jetpack-css'  href='../wp-content/plugins/jetpack/modules/theme-tools/compat/twentysixteen3a05.css?ver=4.2.2' type='text/css' media='all' />
<link rel='stylesheet' id='twentysixteen-fonts-css'  href='https://fonts.googleapis.com/css?family=Merriweather%3A400%2C700%2C900%2C400italic%2C700italic%2C900italic%7CMontserrat%3A400%2C700%7CInconsolata%3A400&amp;subset=latin%2Clatin-ext' type='text/css' media='all' />
<link rel='stylesheet' id='genericons-css'  href='../wp-content/plugins/jetpack/_inc/genericons/genericons/genericons128b.css?ver=3.1' type='text/css' media='all' />
<link rel='stylesheet' id='twentysixteen-style-css'  href='../wp-content/themes/twentysixteen/style167b.css?ver=4.6' type='text/css' media='all' />
<!--[if lt IE 10]>
<link rel='stylesheet' id='twentysixteen-ie-css'  href='https://stuartsierra.com/wp-content/themes/twentysixteen/css/ie.css?ver=20160816' type='text/css' media='all' />
<![endif]-->
<!--[if lt IE 9]>
<link rel='stylesheet' id='twentysixteen-ie8-css'  href='https://stuartsierra.com/wp-content/themes/twentysixteen/css/ie8.css?ver=20160816' type='text/css' media='all' />
<![endif]-->
<!--[if lt IE 8]>
<link rel='stylesheet' id='twentysixteen-ie7-css'  href='https://stuartsierra.com/wp-content/themes/twentysixteen/css/ie7.css?ver=20160816' type='text/css' media='all' />
<![endif]-->
<link rel='stylesheet' id='jetpack_css-css'  href='../wp-content/plugins/jetpack/css/jetpack3a05.css?ver=4.2.2' type='text/css' media='all' />
<script type='text/javascript' src='../wp-includes/js/jquery/jqueryb8ff.js?ver=1.12.4'></script>
<script type='text/javascript' src='../wp-includes/js/jquery/jquery-migrate.min330a.js?ver=1.4.1'></script>
<!--[if lt IE 9]>
<script type='text/javascript' src='https://stuartsierra.com/wp-content/themes/twentysixteen/js/html5.js?ver=3.7.3'></script>
<![endif]-->
<link rel='https://api.w.org/' href='../wp-json/index.html' />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="../xmlrpc0db0.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="../wp-includes/wlwmanifest.xml" /> 
<meta name="generator" content="WordPress 4.6" />

<link rel='dns-prefetch' href='http://v0.wordpress.com/'>
</head>

<body class="archive tag tag-patterns tag-115 hfeed">
<div id="page" class="site">
	<div class="site-inner">
		<a class="skip-link screen-reader-text" href="#content">Skip to content</a>

		<header id="masthead" class="site-header" role="banner">
			<div class="site-header-main">
				<div class="site-branding">
					
											<p class="site-title"><a href="../index.html" rel="home">Digital Digressions by Stuart Sierra</a></p>
											<p class="site-description">From programming to everything else</p>
									</div><!-- .site-branding -->

									<button id="menu-toggle" class="menu-toggle">Menu</button>

					<div id="site-header-menu" class="site-header-menu">
													<nav id="site-navigation" class="main-navigation" role="navigation" aria-label="Primary Menu">
								<div class="menu-main-menu-container"><ul id="menu-main-menu" class="primary-menu"><li id="menu-item-635" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-635"><a href="../about-me.html">About Me</a></li>
<li id="menu-item-633" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-633"><a href="../writing.html">Writing</a></li>
<li id="menu-item-634" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-634"><a href="../presentations.html">Presentations</a></li>
<li id="menu-item-636" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-636"><a href="../software.html">Software</a></li>
<li id="menu-item-637" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-637"><a href="../contact.html">Contact</a></li>
</ul></div>							</nav><!-- .main-navigation -->
						
											</div><!-- .site-header-menu -->
							</div><!-- .site-header-main -->

											<div class="header-image">
					<a href="../index.html" rel="home">
						<img src="../wp-content/uploads/2015/12/header.jpg" srcset="https://stuartsierra.com/wp-content/uploads/2015/12/header-300x70.jpg 300w, https://stuartsierra.com/wp-content/uploads/2015/12/header-768x179.jpg 768w, https://stuartsierra.com/wp-content/uploads/2015/12/header-1024x239.jpg 1024w, https://stuartsierra.com/wp-content/uploads/2015/12/header.jpg 1200w" sizes="(max-width: 709px) 85vw, (max-width: 909px) 81vw, (max-width: 1362px) 88vw, 1200px" width="1200" height="280" alt="Digital Digressions by Stuart Sierra">
					</a>
				</div><!-- .header-image -->
					</header><!-- .site-header -->

		<div id="content" class="site-content">

	<div id="primary" class="content-area">
		<main id="main" class="site-main" role="main">

		
			<header class="page-header">
				<h1 class="page-title">Tag: patterns</h1>			</header><!-- .page-header -->

			
<article id="post-710" class="post-710 post type-post status-publish format-standard hentry category-programming tag-clojure tag-patterns tag-scope">
	<header class="entry-header">
		
		<h2 class="entry-title"><a href="../2013/03/29/perils-of-dynamic-scope.html" rel="bookmark">On the Perils of Dynamic Scope</a></h2>	</header><!-- .entry-header -->

	
	
	<div class="entry-content">
		<p><i>Common Lisp the Language</i> (CLtL) devotes an entire chapter to the subject of <a href="http://www.cs.cmu.edu/Groups/AI/html/cltl/clm/node43.html">Scope and Extent</a>. It defines <b>scope</b> as the textual region of a program in which an entity may be used, where &#8220;entity&#8221; could be a symbol, a value, or something more abstract like a variable binding.
</p>
<p>
So scope is about <i>where</i> you can use something. CLtL defines two different kinds of scope:
</p>
<p>
<b>Lexical scope</b> is usually the body of a single expression like <code>let</code> or <code>defun</code>.
</p>
<p>
<b>Indefinite scope</b> is everything else, effectively the global set of symbols that exist in a program.
</p>
<p>
In contrast, <b>extent</b> is about <i>when</i>: it&#8217;s the interval of time during which something may be used. CLtL defines two different kinds of extent:
</p>
<p>
<b>Dynamic extent</b> refers to things that exist for a fixed period of time and are explicitly &#8220;destroyed&#8221; at the end of that period, usually when control returns to the code that created the thing.
</p>
<p>
<b>Indefinite extent</b> is everything else: things that get created, passed around, and eventually garbage-collected.
</p>
<p>
In any language with a garbage collector, most things have indefinite extent. You can create strings, lists, or hash tables and pass them around with impunity. When the garbage collector determines that you are done using something, it reclaims the memory. The process is, in most cases, completely transparent to you.
</p>
<p>
But what about the so-called <b>dynamic scope</b>? The authors of CLtL have this to say:
</p>
<blockquote>
<p>The term &#8220;dynamic scope&#8221; is a misnomer. Nevertheless it is both traditional and useful.
</p>
</blockquote>
<p>
They also define &#8220;dynamic scope&#8221; to be the combination of <i>indefinite scope</i> and <i>dynamic extent</i>. That is, things with dynamic scope are valid in any <i>place</i> in a program, but only for a limited <i>time</i>. In Common Lisp, these are called &#8220;special variables,&#8221; and are created with the macros <a href="http://www.lispworks.com/documentation/HyperSpec/Body/m_defpar.htm"><code>defparameter</code> and <code>defvar</code></a>.
</p>
<div id="outline-container-1" class="outline-2">
<h2 id="sec-1">Vars</h2>
<div class="outline-text-2" id="text-1">
<p>
So what does this have to do with Clojure? Clojure has these things called Vars. Every time you write <code>def</code> or <code>defn</code> or one of its variants in Clojure, you&#8217;re creating a Var.
</p>
<p>
Vars have <i>indefinite scope</i>: no matter where you <code>def</code> a Var, it&#8217;s visible everywhere in the program.<sup><a class="footref" name="fnr.1" href="#fn.1">1</a></sup>
</p>
<p>
Vars usually have <i>indefinite extent</i> as well. Usually. This is where things get tricky. Clojure, unlike Common Lisp, was designed for multi-threaded programs.<sup><a class="footref" name="fnr.2" href="#fn.2">2</a></sup> The meaning of <i>extent</i> gets a lot muddier in the face of multiple threads. Each thread has its own timeline, its own view of &#8220;now&#8221; which may or may not conform to any other thread&#8217;s view.
</p>
<p>
In Clojure versions 1.2 and earlier, <b>all</b> Vars had dynamic scope by default, but this meant that there was a performance cost to look up the current dynamic binding of a Var on every function call. Leading up to 1.3, Rich Hickey experimented with allowing Vars to be declared <code>^:static</code>, before settling on static by default with <code>^:dynamic</code> as an option. You can still find <code>^:static</code> declarations littered through the Clojure source code. Maybe someday they&#8217;ll be useful again.
</p>
<p>
The definition of &#8220;dynamic scope&#8221; in Clojure is even fuzzier than it is in Common Lisp. How do we define &#8220;extent&#8221; in the face of multiple threads, each potentially with its own thread-local binding? If a resource can be shared across multiple threads, we have to coordinate the cleanup of that resource. For example, if I open a socket and then hand it off to another piece of code, who is responsible for closing the socket?
</p>
<p>
Resource management is one concurrency bugaboo that Clojure developers have not managed to crack. Various attempts have been made: you can see the artifacts in wiki and mailing list discussions of <a href="http://dev.clojure.org/display/design/Resource+Scopes">Resource Scopes</a>. So far, no solution has been found that doesn&#8217;t just shift the problem somewhere else.
</p>
<p>
It ends up looking a bit like garbage collection: how do I track the path of every resource used by my program and ensure that it gets cleaned up at the appropriate time? But it&#8217;s even harder than that, because resources like file handles and sockets are much scarcer than memory: they need to be reclaimed as soon as possible. In a modern runtime like the JVM, garbage collection is stochastic: there&#8217;s no guarantee that it will happen at any particular time, or even that it will happen at all.
</p>
<p>
To make matters worse, Clojure has laziness to contend with. It&#8217;s entirely possible to obtain a resource, start consuming it via a lazy sequence, and <i>never finish</i> consuming it.
</p>
</div>
</div>
<div id="outline-container-2" class="outline-2">
<h2 id="sec-2">The Wrong Solution</h2>
<div class="outline-text-2" id="text-2">
<p>
This brings me to one of my top <a href="http://c2.com/cgi/wiki?AntiPattern">anti-patterns</a> in Clojure: the Dynamically-Scoped Singleton Resource (DSSR).
</p>
<p>
The DSSR is popular in libraries that depend on some external resource such as a socket, file, or database connection. It typically looks like this:
</p>
<pre class="src src-clojure">(<span class="org-keyword">ns</span> com.example.library)

(<span class="org-keyword">def</span> <span class="org-constant">^:dynamic</span> <span class="org-function-name">*resource*</span>)

(<span class="org-keyword">defn-</span> <span class="org-function-name">internal-procedure</span> []
  <span class="org-comment-delimiter">;; </span><span class="org-comment">... uses *resource* ...</span>
  )

(<span class="org-keyword">defn</span> <span class="org-function-name">public-api-function</span> [arg]
  <span class="org-comment-delimiter">;; </span><span class="org-comment">... calls internal-procedure ...</span>
  )
</pre>
<p>
That is, there is a single dynamic Var holding the &#8220;resource&#8221; on which the rest of the API operates. The DSSR is often accompanied by a <code>with-*</code> macro:
</p>
<pre class="src src-clojure">(<span class="org-keyword">defmacro</span> <span class="org-function-name">with-resource</span> [src &amp; body]
  `(<span class="org-keyword">binding</span> [*resource* (acquire src)]
     (<span class="org-keyword">try</span> ~@body
       (<span class="org-keyword">finally</span>
         (dispose *resource*)))))
</pre>
<p>
This looks harmless enough. It&#8217;s practically a carbon copy of Clojure&#8217;s <code>with-open</code> macro, and it ensures that the resource will get cleaned up even if <code>body</code> throws an exception.
</p>
<p>
The problem with this pattern, especially in libraries, is the constraints it imposes on any code that wants to use the library. The <code>with-resource</code> macro severely constrains what you can do in the <code>body</code>:
</p>
<p>
<b>You can&#8217;t dispatch to another thread.</b> Say goodbye to Agents, Futures, thread pools, non-blocking I/O, or any other kind of asynchrony. The resource is only valid on the current thread.<sup><a class="footref" name="fnr.3" href="#fn.3">3</a></sup>
</p>
<p>
<b>You can&#8217;t return a lazy sequence</b> backed by the resource because the resource will be destroyed as soon as <code>body</code> returns.
</p>
<p>
<b>You can&#8217;t have more than one resource at a time.</b> Hence the &#8220;singleton&#8221; in the name of this pattern. Using a thread-bound Var throughout the API means that you can never operate on more than one instance of the resource in a single thread. Lots of apps need to work with multiple databases, which really sucks using this kind of library.
</p>
<p>
The last problem with this pattern is a more subtle one: <b>hidden dependencies</b>. The public API functions, which have global scope, depend on the state (thread-local binding) of another Var with global scope. This dependency isn&#8217;t explicitly stated anywhere in the definition of those functions. That might not seem like such a big deal in small examples, and it isn&#8217;t. But as programs (and development teams) grow larger, it&#8217;s one additional piece of implicit knowledge that you have to keep in your head. If there are seventeen layers of function calls between the resource binding and its usage, how certain are you going to be that the resource has the right extent?
</p>
</div>
</div>
<div id="outline-container-3" class="outline-2">
<h2 id="sec-3">Friends Don&#8217;t Let Friends Use Dynamic Scope</h2>
<div class="outline-text-2" id="text-3">
<p>
The alternative is easy: don&#8217;t do it. Don&#8217;t try to &#8220;solve&#8221; resource management in every library.
</p>
<p>
By all means, provide the functions to acquire and dispose of resources, but then let the application programmer decide what to do with them. Define API functions to take the resource as an argument.
</p>
<p>
Applications can manage their own resources, and only the application programmer knows what the extent of those resources should be. Maybe you can pass it around as a value. Maybe you want to use dynamic binding after all. Maybe you want to stash it in a global state Var.<sup><a class="footref" name="fnr.4" href="#fn.4">4</a></sup> That&#8217;s for you to decide.
</p>
<p>
<a href="http://datomic.com/">Datomic</a> is a good example to follow: it creates connection objects that have a lot of state attached to them &mdash; sockets, queues, and threads. But it says nothing about how you should manage the extent of those connections.<sup><a class="footref" name="fnr.5" href="#fn.5">5</a></sup> Most functions in the <a href="http://docs.datomic.com/clojure/index.html">Datomic API</a> take either a connection or a database (a value obtained from the connection) as an argument.
</p>
</div>
</div>
<div id="outline-container-4" class="outline-2">
<h2 id="sec-4">Safe Dynamic Scope</h2>
<div class="outline-text-2" id="text-4">
<p>
So dynamic scope is totally evil, right? Not totally. There are situations where dynamic scope can be helpful without causing the cascade of problems I described above.
</p>
<p>
Remember that dynamic scope in Clojure is really <i>thread-local binding</i>. Therefore, it&#8217;s best suited to operations that are <i>confined to a single thread</i>. There are plenty of examples of this: most popular algorithms are single-threaded, after all. Consider the classic <a href="http://www.cs.engr.uky.edu/~lewis/essays/compilers/rec-des.html">recursive-descent parser</a>: you start with one function call at the top and you&#8217;re not done until that function returns. The entire operation happens on a single thread, in a single call stack. It has <b>dynamic extent</b>.
</p>
<p>
I took advantage of this fact in a <a href="https://github.com/clojure/data.json">Clojure JSON parser</a>. There were a number of control flags that I needed to make available to all the functions. Rather than pass around extra arguments all over the place, I created <a href="https://github.com/clojure/data.json/blob/data.json-0.2.1/src/main/clojure/clojure/data/json.clj#L20-L22">private dynamic Vars</a> to hold them. Those Vars get <a href="https://github.com/clojure/data.json/blob/data.json-0.2.1/src/main/clojure/clojure/data/json.clj#L263-L265">bound in the entry-point</a> to the parser, based on options passed in as arguments to the public API function. The thread-local state never leaks out of the initial function call.
</p>
<p>
As another example, the Clojure compiler, although written in Java, <a href="https://github.com/clojure/clojure/blob/clojure-1.5.1/src/jvm/clojure/lang/Compiler.java#L181-L203">uses dynamic Vars</a> to keep track of internal state.
</p>
<p>
And what about our friend <code>with-open</code>? I said that the example <code>with-resource</code> macro was nearly a copy of it, but only nearly. <code>clojure.core/with-open</code> creates <b>lexical</b> (i.e. local) bindings. It still suffers from some limitations around what you can do in the body, but at least it doesn&#8217;t limit you to one resource at a time.
</p>
<p>
Global state is the zombie in the closet of every Clojure program, about which I&#8217;ll have more to say in future posts. For now, I hope I&#8217;ve convinced you that dynamic scope is easily abused and has a lot of unintended consequences.
</p>
<div id="footnotes">
<h2 class="footnotes">Footnotes: </h2>
<div id="text-footnotes">
<p class="footnote"><sup><a class="footnum" name="fn.1" href="#fnr.1">1</a></sup> Technically, a Var is visible only <b>after</b> the point at which it was defined. This is significant with regard to the order of definitions, but Vars are still globally visible once they have been defined.
</p>
<p class="footnote"><sup><a class="footnum" name="fn.2" href="#fnr.2">2</a></sup> CLtL has this note embedded in the chapter on scope and extent: &#8220;Behind the assertion that dynamic extents nest properly is the assumption that there is only a single program or process. Common Lisp does not address the problems of multiprogramming (timesharing) or multiprocessing (more than one active processor) within a single Lisp environment.&#8221; Modern Common Lisp implementations have added multi-threading, but it remains absent from the language specification.
</p>
<p class="footnote"><sup><a class="footnum" name="fn.3" href="#fnr.3">3</a></sup> You can use <a href="http://clojure.github.com/clojure/clojure.core-api.html#clojure.core/bound-fn">bound-fn</a> to capture the bindings and pass them to another thread, but you still have the problem that the resource may be destroyed before the other thread is finished with it.
</p>
<p class="footnote"><sup><a class="footnum" name="fn.4" href="#fnr.4">4</a></sup> Not recommended, to be discussed in a future post.
</p>
<p class="footnote"><sup><a class="footnum" name="fn.5" href="#fnr.5">5</a></sup> There&#8217;s some caching of connection objects under the hood, but this is not relevant to the consumer.
</p>
</div>
</div>
</div>
</div>
	</div><!-- .entry-content -->

	<footer class="entry-footer">
		<span class="byline"><span class="author vcard"><img alt='' src='https://secure.gravatar.com/avatar/55878d0196b91803f9cb2c372b0551d3?s=49&amp;d=blank&amp;r=g' srcset='https://secure.gravatar.com/avatar/55878d0196b91803f9cb2c372b0551d3?s=98&amp;d=blank&amp;r=g 2x' class='avatar avatar-49 photo' height='49' width='49' /><span class="screen-reader-text">Author </span> <a class="url fn n" href="../author/stuart.html">Stuart</a></span></span><span class="posted-on"><span class="screen-reader-text">Posted on </span><a href="../2013/03/29/perils-of-dynamic-scope.html" rel="bookmark"><time class="entry-date published" datetime="2013-03-29T08:00:52+00:00">March 29, 2013</time><time class="updated" datetime="2013-03-28T20:10:34+00:00">March 28, 2013</time></a></span><span class="cat-links"><span class="screen-reader-text">Categories </span><a href="../category/programming.html" rel="category tag">Programming</a></span><span class="tags-links"><span class="screen-reader-text">Tags </span><a href="clojure.html" rel="tag">Clojure</a>, <a href="patterns.html" rel="tag">patterns</a>, <a href="scope.html" rel="tag">scope</a></span><span class="comments-link"><a href="../2013/03/29/perils-of-dynamic-scope.html#comments">11 Comments<span class="screen-reader-text"> on On the Perils of Dynamic Scope</span></a></span>			</footer><!-- .entry-footer -->
</article><!-- #post-## -->

		</main><!-- .site-main -->
	</div><!-- .content-area -->


	<aside id="secondary" class="sidebar widget-area" role="complementary">
		<section id="search-3" class="widget widget_search">
<form role="search" method="get" class="search-form" action="https://stuartsierra.com/">
	<label>
		<span class="screen-reader-text">Search for:</span>
		<input type="search" class="search-field" placeholder="Search &hellip;" value="" name="s" />
	</label>
	<button type="submit" class="search-submit"><span class="screen-reader-text">Search</span></button>
</form>
</section><section id="text-4" class="widget widget_text">			<div class="textwidget"><ul>
<li><a href="http://feeds2.feedburner.com/StuartSierra" title="Syndicate this site using RSS 2.0">Entries <abbr title="Really Simple Syndication">RSS</abbr></a></li>
<li><a href="../comments/feed" title="The latest comments to all posts in RSS">Comments <abbr title="Really Simple Syndication">RSS</abbr></a></li>
</ul>
<ul>
<li><a href="https://twitter.com/stuartsierra">Twitter</a></li>
<li><a href="https://github.com/stuartsierra">GitHub</a></li>
</ul></div>
		</section><section id="tag-widget-2" class="widget TagWidget"><h2 class="widget-title">Clojure Do’s and Don’ts</h2><ul class = "posts-by-tag-list"><li class="posts-by-tag-item Clojure do's and don'ts" id="posts-by-tag-item-883"><a class = "posts-by-tag-item-title" href="../2015/08/25/clojure-donts-lazy-effects.html">Clojure Don’ts: Lazy Effects</a></li><li class="posts-by-tag-item Clojure do's and don'ts" id="posts-by-tag-item-877"><a class = "posts-by-tag-item-title" href="../2015/08/10/clojure-donts-redundant-map.html">Clojure Don’ts: Redundant map</a></li><li class="posts-by-tag-item Clojure do's and don'ts" id="posts-by-tag-item-870"><a class = "posts-by-tag-item-title" href="../2015/06/16/clojure-donts-single-branch-if.html">Clojure Don’ts: Single-branch if</a></li><li class="posts-by-tag-item Clojure do's and don'ts" id="posts-by-tag-item-854"><a class = "posts-by-tag-item-title" href="../2015/06/10/clojure-donts-heisenparameter.html">Clojure Don’ts: The Heisenparameter</a></li><li class="posts-by-tag-item Clojure do's and don'ts" id="posts-by-tag-item-849"><a class = "posts-by-tag-item-title" href="../2015/06/01/clojure-donts-optional-arguments-with-varargs.html">Clojure Don’ts: Optional Arguments with Varargs</a></li><li class="posts-by-tag-item Clojure do's and don'ts errors" id="posts-by-tag-item-836"><a class = "posts-by-tag-item-title" href="../2015/05/27/clojure-uncaught-exceptions.html">Clojure Do’s: Uncaught Exceptions</a></li><li class="posts-by-tag-item Clojure do's and don'ts" id="posts-by-tag-item-831"><a class = "posts-by-tag-item-title" href="../2015/05/17/clojure-record-constructors.html">Record Constructors</a></li><li class="posts-by-tag-item Clojure do's and don'ts" id="posts-by-tag-item-826"><a class = "posts-by-tag-item-title" href="../2015/05/10/clojure-namespace-aliases.html">Clojure Do’s: Namespace Aliases</a></li><li class="posts-by-tag-item Clojure do's and don'ts" id="posts-by-tag-item-820"><a class = "posts-by-tag-item-title" href="../2015/05/02/clojure-donts-isa.html">Clojure Don’ts: isa?</a></li><li class="posts-by-tag-item Clojure do's and don'ts" id="posts-by-tag-item-812"><a class = "posts-by-tag-item-title" href="../2015/04/26/clojure-donts-concat.html">Clojure Don’ts: Concat</a></li></ul></section>	</aside><!-- .sidebar .widget-area -->

		</div><!-- .site-content -->

		<footer id="colophon" class="site-footer" role="contentinfo">
							<nav class="main-navigation" role="navigation" aria-label="Footer Primary Menu">
					<div class="menu-main-menu-container"><ul id="menu-main-menu-1" class="primary-menu"><li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-635"><a href="../about-me.html">About Me</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-633"><a href="../writing.html">Writing</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-634"><a href="../presentations.html">Presentations</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-636"><a href="../software.html">Software</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-637"><a href="../contact.html">Contact</a></li>
</ul></div>				</nav><!-- .main-navigation -->
			
			
			<div class="site-info">
								<span class="site-title"><a href="../index.html" rel="home">Digital Digressions by Stuart Sierra</a></span>
				<a href="https://wordpress.org/">Proudly powered by WordPress</a>
			</div><!-- .site-info -->
		</footer><!-- .site-footer -->
	</div><!-- .site-inner -->
</div><!-- .site -->

	<div style="display:none">
	<div class="grofile-hash-map-55878d0196b91803f9cb2c372b0551d3">
	</div>
	</div>
<script type='text/javascript' src='https://s0.wp.com/wp-content/js/devicepx-jetpack.js?ver=201635'></script>
<script type='text/javascript' src='https://secure.gravatar.com/js/gprofiles.js?ver=2016Sepaa'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var WPGroHo = {"my_hash":""};
/* ]]> */
</script>
<script type='text/javascript' src='../wp-content/plugins/jetpack/modules/wpgroho167b.js?ver=4.6'></script>
<script type='text/javascript' src='../wp-content/themes/twentysixteen/js/skip-link-focus-fix8de4.js?ver=20160816'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var screenReaderText = {"expand":"expand child menu","collapse":"collapse child menu"};
/* ]]> */
</script>
<script type='text/javascript' src='../wp-content/themes/twentysixteen/js/functions8de4.js?ver=20160816'></script>
<script type='text/javascript' src='../wp-includes/js/wp-embed.min167b.js?ver=4.6'></script>
<script type='text/javascript' src='https://stats.wp.com/e-201635.js' async defer></script>
<script type='text/javascript'>
	_stq = window._stq || [];
	_stq.push([ 'view', {v:'ext',j:'1:4.2.2',blog:'2702563',post:'0',tz:'-4',srv:'stuartsierra.com'} ]);
	_stq.push([ 'clickTrackerInit', '2702563', '0' ]);
</script>
</body>

<!-- Mirrored from stuartsierra.com/tag/patterns by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 02 Sep 2016 17:02:27 GMT -->
</html>

<!-- Dynamic page generated in 0.334 seconds. -->
<!-- Cached page generated by WP-Super-Cache on 2016-09-02 12:59:33 -->

<!-- Compression = gzip -->