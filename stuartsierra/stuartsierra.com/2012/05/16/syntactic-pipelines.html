<!DOCTYPE html>
<html lang="en-US" class="no-js">

<!-- Mirrored from stuartsierra.com/2012/05/16/syntactic-pipelines by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 02 Sep 2016 17:02:24 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="profile" href="http://gmpg.org/xfn/11">
		<script>(function(html){html.className = html.className.replace(/\bno-js\b/,'js')})(document.documentElement);</script>
<title>Syntactic Pipelines &#8211; Digital Digressions by Stuart Sierra</title>
<link rel='dns-prefetch' href='http://s0.wp.com/'>
<link rel='dns-prefetch' href='http://secure.gravatar.com/'>
<link rel='dns-prefetch' href='http://fonts.googleapis.com/'>
<link rel='dns-prefetch' href='http://s.w.org/'>
<link rel="alternate" type="application/rss+xml" title="Digital Digressions by Stuart Sierra &raquo; Feed" href="http://feeds2.feedburner.com/StuartSierra" />
<link rel="alternate" type="application/rss+xml" title="Digital Digressions by Stuart Sierra &raquo; Comments Feed" href="../../../comments/feed" />
<link rel="alternate" type="application/rss+xml" title="Digital Digressions by Stuart Sierra &raquo; Syntactic Pipelines Comments Feed" href="syntactic-pipelines/feed" />
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/stuartsierra.com\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.6"}};
			!function(a,b,c){function d(a){var c,d,e,f,g,h=b.createElement("canvas"),i=h.getContext&&h.getContext("2d"),j=String.fromCharCode;if(!i||!i.fillText)return!1;switch(i.textBaseline="top",i.font="600 32px Arial",a){case"flag":return i.fillText(j(55356,56806,55356,56826),0,0),!(h.toDataURL().length<3e3)&&(i.clearRect(0,0,h.width,h.height),i.fillText(j(55356,57331,65039,8205,55356,57096),0,0),c=h.toDataURL(),i.clearRect(0,0,h.width,h.height),i.fillText(j(55356,57331,55356,57096),0,0),d=h.toDataURL(),c!==d);case"diversity":return i.fillText(j(55356,57221),0,0),e=i.getImageData(16,16,1,1).data,f=e[0]+","+e[1]+","+e[2]+","+e[3],i.fillText(j(55356,57221,55356,57343),0,0),e=i.getImageData(16,16,1,1).data,g=e[0]+","+e[1]+","+e[2]+","+e[3],f!==g;case"simple":return i.fillText(j(55357,56835),0,0),0!==i.getImageData(16,16,1,1).data[0];case"unicode8":return i.fillText(j(55356,57135),0,0),0!==i.getImageData(16,16,1,1).data[0];case"unicode9":return i.fillText(j(55358,56631),0,0),0!==i.getImageData(16,16,1,1).data[0]}return!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g,h,i;for(i=Array("simple","flag","unicode8","diversity","unicode9"),c.supports={everything:!0,everythingExceptFlag:!0},h=0;h<i.length;h++)c.supports[i[h]]=d(i[h]),c.supports.everything=c.supports.everything&&c.supports[i[h]],"flag"!==i[h]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[i[h]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link rel='stylesheet' id='twentysixteen-jetpack-css'  href='../../../wp-content/plugins/jetpack/modules/theme-tools/compat/twentysixteen3a05.css?ver=4.2.2' type='text/css' media='all' />
<link rel='stylesheet' id='twentysixteen-fonts-css'  href='https://fonts.googleapis.com/css?family=Merriweather%3A400%2C700%2C900%2C400italic%2C700italic%2C900italic%7CMontserrat%3A400%2C700%7CInconsolata%3A400&amp;subset=latin%2Clatin-ext' type='text/css' media='all' />
<link rel='stylesheet' id='genericons-css'  href='../../../wp-content/plugins/jetpack/_inc/genericons/genericons/genericons128b.css?ver=3.1' type='text/css' media='all' />
<link rel='stylesheet' id='twentysixteen-style-css'  href='../../../wp-content/themes/twentysixteen/style167b.css?ver=4.6' type='text/css' media='all' />
<!--[if lt IE 10]>
<link rel='stylesheet' id='twentysixteen-ie-css'  href='https://stuartsierra.com/wp-content/themes/twentysixteen/css/ie.css?ver=20160816' type='text/css' media='all' />
<![endif]-->
<!--[if lt IE 9]>
<link rel='stylesheet' id='twentysixteen-ie8-css'  href='https://stuartsierra.com/wp-content/themes/twentysixteen/css/ie8.css?ver=20160816' type='text/css' media='all' />
<![endif]-->
<!--[if lt IE 8]>
<link rel='stylesheet' id='twentysixteen-ie7-css'  href='https://stuartsierra.com/wp-content/themes/twentysixteen/css/ie7.css?ver=20160816' type='text/css' media='all' />
<![endif]-->
<link rel='stylesheet' id='jetpack_css-css'  href='../../../wp-content/plugins/jetpack/css/jetpack3a05.css?ver=4.2.2' type='text/css' media='all' />
<script type='text/javascript' src='../../../wp-includes/js/jquery/jqueryb8ff.js?ver=1.12.4'></script>
<script type='text/javascript' src='../../../wp-includes/js/jquery/jquery-migrate.min330a.js?ver=1.4.1'></script>
<!--[if lt IE 9]>
<script type='text/javascript' src='https://stuartsierra.com/wp-content/themes/twentysixteen/js/html5.js?ver=3.7.3'></script>
<![endif]-->
<link rel='https://api.w.org/' href='../../../wp-json/index.html' />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="../../../xmlrpc0db0.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="../../../wp-includes/wlwmanifest.xml" /> 
<link rel='prev' title='Three Kinds of Error' href='../../04/03/three-kinds-of-error.html' />
<link rel='next' title='Why I&#8217;m Using ClojureScript' href='../../06/16/why-im-using-clojurescript.html' />
<meta name="generator" content="WordPress 4.6" />
<link rel="canonical" href="syntactic-pipelines.html" />
<link rel='shortlink' href='https://wp.me/pbl3J-a4' />
<link rel="alternate" type="application/json+oembed" href="../../../wp-json/oembed/1.0/embedf640.json?url=https%3A%2F%2Fstuartsierra.com%2F2012%2F05%2F16%2Fsyntactic-pipelines" />
<link rel="alternate" type="text/xml+oembed" href="../../../wp-json/oembed/1.0/embed532d?url=https%3A%2F%2Fstuartsierra.com%2F2012%2F05%2F16%2Fsyntactic-pipelines&amp;format=xml" />

<link rel='dns-prefetch' href='http://v0.wordpress.com/'>

<!-- Jetpack Open Graph Tags -->
<meta property="og:type" content="article" />
<meta property="og:title" content="Syntactic Pipelines" />
<meta property="og:url" content="https://stuartsierra.com/2012/05/16/syntactic-pipelines" />
<meta property="og:description" content=".org-constant { color: purple; } .org-string { color: green; } .org-comment { color: darkred; } .org-comment-delimiter { color: darkred; } .org-keyword, .org-builtin, .org-variable-name { color: blâ€¦" />
<meta property="article:published_time" content="2012-05-16T22:42:41+00:00" />
<meta property="article:modified_time" content="2012-05-17T14:46:27+00:00" />
<meta property="og:site_name" content="Digital Digressions by Stuart Sierra" />
<meta property="og:image" content="https://s0.wp.com/i/blank.jpg" />
<meta property="og:locale" content="en_US" />
<meta name="twitter:card" content="summary" />
</head>

<body class="single single-post postid-624 single-format-standard">
<div id="page" class="site">
	<div class="site-inner">
		<a class="skip-link screen-reader-text" href="#content">Skip to content</a>

		<header id="masthead" class="site-header" role="banner">
			<div class="site-header-main">
				<div class="site-branding">
					
											<p class="site-title"><a href="../../../index.html" rel="home">Digital Digressions by Stuart Sierra</a></p>
											<p class="site-description">From programming to everything else</p>
									</div><!-- .site-branding -->

									<button id="menu-toggle" class="menu-toggle">Menu</button>

					<div id="site-header-menu" class="site-header-menu">
													<nav id="site-navigation" class="main-navigation" role="navigation" aria-label="Primary Menu">
								<div class="menu-main-menu-container"><ul id="menu-main-menu" class="primary-menu"><li id="menu-item-635" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-635"><a href="../../../about-me.html">About Me</a></li>
<li id="menu-item-633" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-633"><a href="../../../writing.html">Writing</a></li>
<li id="menu-item-634" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-634"><a href="../../../presentations.html">Presentations</a></li>
<li id="menu-item-636" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-636"><a href="../../../software.html">Software</a></li>
<li id="menu-item-637" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-637"><a href="../../../contact.html">Contact</a></li>
</ul></div>							</nav><!-- .main-navigation -->
						
											</div><!-- .site-header-menu -->
							</div><!-- .site-header-main -->

											<div class="header-image">
					<a href="../../../index.html" rel="home">
						<img src="../../../wp-content/uploads/2015/12/header.jpg" srcset="https://stuartsierra.com/wp-content/uploads/2015/12/header-300x70.jpg 300w, https://stuartsierra.com/wp-content/uploads/2015/12/header-768x179.jpg 768w, https://stuartsierra.com/wp-content/uploads/2015/12/header-1024x239.jpg 1024w, https://stuartsierra.com/wp-content/uploads/2015/12/header.jpg 1200w" sizes="(max-width: 709px) 85vw, (max-width: 909px) 81vw, (max-width: 1362px) 88vw, 1200px" width="1200" height="280" alt="Digital Digressions by Stuart Sierra">
					</a>
				</div><!-- .header-image -->
					</header><!-- .site-header -->

		<div id="content" class="site-content">

<div id="primary" class="content-area">
	<main id="main" class="site-main" role="main">
		
<article id="post-624" class="post-624 post type-post status-publish format-standard hentry category-programming tag-clojure tag-macros">
	<header class="entry-header">
		<h1 class="entry-title">Syntactic Pipelines</h1>	</header><!-- .entry-header -->

	
	
	<div class="entry-content">
		<style type="text/css">
  .org-constant {
     color: purple;
  }</p>
<p>  .org-string {
     color: green;
  }</p>
<p>  .org-comment {
     color: darkred;
  }</p>
<p>  .org-comment-delimiter {
     color: darkred;
  }</p>
<p>  .org-keyword, .org-builtin, .org-variable-name {
     color: blue;
  }
  </style>
<p>
Lately I&#8217;ve been thinking about Clojure programs written in this &#8220;threaded&#8221; or &#8220;pipelined&#8221; style:
</p>
<pre class="src src-clojure">(<span class="org-keyword">defn</span> <span class="org-function-name">large-process</span> [input]
  (<span class="org-builtin">-&gt;</span> input
      subprocess-one
      subprocess-two
      subprocess-three))
</pre>
<p>
If you saw my talk at Clojure/West (<a href="http://clojurewest.org/news/2012/5/11/clojurewest-video-schedule.html">video forthcoming</a>) this should look familiar. The value being &#8220;threaded&#8221; by the <code>-&gt;</code> macro from one <i>subprocess-</i> function to the next is usually a map, and each subprocess can add, remove, or update keys in the map. A typical subprocess function might look something like this:
</p>
<pre class="src src-clojure">(<span class="org-keyword">defn</span> <span class="org-function-name">subprocess-two</span> [data]
  (<span class="org-builtin">let</span> [{<span class="org-constant">:keys</span> [alpha beta]} data]
    (<span class="org-builtin">-&gt;</span> data
        (<span class="org-variable-name">assoc</span> <span class="org-constant">:epsilon</span> (compute-epsilon alpha))
        (<span class="org-variable-name">update-in</span> [<span class="org-constant">:gamma</span>] merge (compute-gamma beta)))))
</pre>
<p>
Most subprocess functions, therefore, have a similar structure: they begin by destructuring the input map and end by performing updates to that same map.
</p>
<p>
This style of programming tends to produce slightly longer code than would be obtained by writing larger functions with <code>let</code> bindings for intermediate values, but it has some advantages. The structure is immediately apparent: someone reading the code can get a high-level overview of what the code does simply by looking at the outer-most function, which, due to the single-pass design of Clojure&#8217;s compiler, will always be at the bottom of a file. It&#8217;s also easy to insert new functions into the process: as long as they accept and return a map with the same structure, they will not interfere with the existing functions.
</p>
<p>
The only problem with this code from a readability standpoint is the visual clutter of repeatedly destructuring and updating the same map. (It&#8217;s possible to move the destructuring into the function argument vector, but it&#8217;s still messy.)
</p>
<div id="outline-container-1" class="outline-2">
<h2 id="sec-1">defpipe</h2>
<div class="outline-text-2" id="text-1">
<p>
What if we could clean up the syntax without changing the behavior? That&#8217;s exactly what macros are good for. Here&#8217;s a first attempt:
</p>
<pre class="src src-clojure">(<span class="org-keyword">defmacro</span> <span class="org-function-name">defpipe</span> [name argv &amp; body]
  `(<span class="org-keyword">defn</span> <span class="org-function-name">~name</span> [arg#]
     (<span class="org-builtin">let</span> [{<span class="org-constant">:keys</span> ~argv} arg#]
       ~@body)))
</pre>
<pre class="src src-clojure">(<span class="org-variable-name">macroexpand-1</span> '(<span class="org-keyword">defpipe</span> <span class="org-function-name">foo</span> [a b c] ...))
<span class="org-comment-delimiter">;;</span><span class="org-comment">=&gt; (clojure.core/defn foo [arg_47_auto]</span>
<span class="org-comment-delimiter">;;     </span><span class="org-comment">(clojure.core/let [{:keys [a b c]} arg_47_auto] ...))</span>
</pre>
<p>
That doesn&#8217;t quite work: we&#8217;ve eliminated the <code>:keys</code> destructuring, but lost the original input map.
</p>
</div>
</div>
<div id="outline-container-2" class="outline-2">
<h2 id="sec-2">return</h2>
<div class="outline-text-2" id="text-2">
<p>
What if we make a second macro specifically for updating the input map?
</p>
<pre class="src src-clojure">(<span class="org-keyword">def</span> <span class="org-constant">^:private</span> <span class="org-function-name">pipe-arg</span> (<span class="org-variable-name">gensym</span> <span class="org-string">"pipeline-argument"</span>))

(<span class="org-keyword">defmacro</span> <span class="org-function-name">defpipe</span> [name argv &amp; body]
  `(<span class="org-keyword">defn</span> <span class="org-function-name">~name</span> [~pipe-arg]
     (<span class="org-builtin">let</span> [{<span class="org-constant">:keys</span> ~argv} ~pipe-arg]
       ~@body)))

(<span class="org-keyword">defn-</span> <span class="org-function-name">return-clause</span> [spec]
  (<span class="org-builtin">let</span> [[command sym &amp; body] spec]
    (<span class="org-builtin">case</span> command
      <span class="org-constant">:update</span> `(<span class="org-variable-name">update-in</span> [~(<span class="org-variable-name">keyword</span> (<span class="org-variable-name">name</span> sym))] ~@body)
      <span class="org-constant">:set</span>    `(<span class="org-variable-name">assoc</span> ~(<span class="org-variable-name">keyword</span> (<span class="org-variable-name">name</span> sym)) ~@body)
      <span class="org-constant">:remove</span> `(<span class="org-variable-name">dissoc</span> ~(<span class="org-variable-name">keyword</span> (<span class="org-variable-name">name</span> sym)) ~@body)
      body)))

(<span class="org-keyword">defmacro</span> <span class="org-function-name">return</span> [&amp; specs]
  `(<span class="org-builtin">-&gt;</span> ~pipe-arg
       ~@(<span class="org-variable-name">map</span> return-clause specs)))
</pre>
<p>
This requires some more explanation. The <code>return</code> macro works in tandem with <code>defpipe</code>, and provides a mini-language for threading the input map through a series of transformations. So it can be used like this:
</p>
<pre class="src src-clojure">(<span class="org-keyword">defpipe</span> <span class="org-function-name">foo</span> [a b]
  (return (<span class="org-constant">:update</span> a + 10)
          (<span class="org-constant">:remove</span> b)
          (<span class="org-constant">:set</span> c a)))

<span class="org-comment-delimiter">;; </span><span class="org-comment">which expands to:</span>
(<span class="org-keyword">defn</span> <span class="org-function-name">foo</span> [input]
  (<span class="org-builtin">let</span> [{<span class="org-constant">:keys</span> [a b]} input]
    (<span class="org-builtin">-&gt;</span> input
        (<span class="org-variable-name">update-in</span> [<span class="org-constant">:a</span>] + 10)
        (<span class="org-variable-name">dissoc</span> <span class="org-constant">:b</span>)
        (<span class="org-variable-name">assoc</span> <span class="org-constant">:c</span> a))))
</pre>
<p>
As a fallback, we can put any old expression inside the <code>return</code>, and it will be just as if we had used it in the <code>-&gt;</code> macro. The rest of the code inside <code>defpipe</code>, before <code>return</code>, is a normal function body. The <code>return</code> can appear anywhere inside <code>defpipe</code>, as long as it is in tail position.
</p>
<p>
The symbol used for the input argument has to be the same in both <code>defpipe</code> and <code>return</code>, so we define it once and use it again. This is safe because that symbol is not exposed anywhere else, and the <code>gensym</code> ensures that it is unique.
</p>
</div>
</div>
<div id="outline-container-3" class="outline-2">
<h2 id="sec-3">defpipeline</h2>
<div class="outline-text-2" id="text-3">
<p>
Now that we have the <code>defpipe</code> macro, it&#8217;s trivial to add another macro for defining the composition of functions created with <code>defpipe</code>:
</p>
<pre class="src src-clojure">(<span class="org-keyword">defmacro</span> <span class="org-function-name">defpipeline</span> [name &amp; body]
  `(<span class="org-keyword">defn</span> <span class="org-function-name">~name</span> [arg#]
     (<span class="org-builtin">-&gt;</span> arg# ~@body)))
</pre>
<p>
This macro does so little that I debated whether or not to include it. The only thing it eliminates is the argument name. But I like the way it expresses intent: a pipeline is purely the composition of <code>defpipe</code> functions.
</p>
</div>
</div>
<div id="outline-container-4" class="outline-2">
<h2 id="sec-4">Further Possibilities</h2>
<div class="outline-text-2" id="text-4">
<p>
One flaw in the &#8220;pipeline&#8221; style is that it cannot express conditional logic in the middle of a pipeline. Some might say this is a feature: the whole point of the pipeline is that it defines a single thread of execution. But I&#8217;m toying with the idea of adding syntax for predicate dispatch within a pipeline, something like this:
</p>
<pre class="src src-clojure">(<span class="org-keyword">defpipeline</span> <span class="org-function-name">name</span>
  pipe1
  <span class="org-comment-delimiter">;; </span><span class="org-comment">Map signifies a conditional branch:</span>
  {predicate-a pipe-a
   predicate-b pipe-b
   <span class="org-constant">:else</span>       pipe-c}
  <span class="org-comment-delimiter">;; </span><span class="org-comment">Regular pipeline execution follows:</span>
  pipe2
  pipe3)
</pre>
</div>
</div>
<div id="outline-container-5" class="outline-2">
<h2 id="sec-5">The Whole Shebang</h2>
<div class="outline-text-2" id="text-5">
<p>
The complete implementation follows. I&#8217;ve added doc strings, metadata, and some helper functions to parse the arguments to <code>defpipe</code> and <code>defpipeline</code> in the same style as <code>defn</code>.
</p>
<pre class="src src-clojure">(<span class="org-keyword">def</span> <span class="org-constant">^:private</span> <span class="org-function-name">pipe-arg</span> (<span class="org-variable-name">gensym</span> <span class="org-string">"pipeline-argument"</span>))

(<span class="org-keyword">defn-</span> <span class="org-function-name">req</span>
  <span class="org-doc">"Required argument"</span>
  [pred spec message]
  (<span class="org-variable-name">assert</span> (pred (<span class="org-variable-name">first</span> spec))
          (<span class="org-variable-name">str</span> message <span class="org-string">" : "</span> (<span class="org-variable-name">pr-str</span> (<span class="org-variable-name">first</span> spec))))
  [(<span class="org-variable-name">first</span> spec) (<span class="org-variable-name">rest</span> spec)])

(<span class="org-keyword">defn-</span> <span class="org-function-name">opt</span>
  <span class="org-doc">"Optional argument"</span>
  [pred spec]
  (<span class="org-builtin">if</span> (pred (<span class="org-variable-name">first</span> spec))
    [(<span class="org-variable-name">list</span> (<span class="org-variable-name">first</span> spec)) (<span class="org-variable-name">rest</span> spec)]
    [nil spec]))

(<span class="org-keyword">defmacro</span> <span class="org-function-name">defpipeline</span> [name &amp; spec]
  (<span class="org-builtin">let</span> [[docstring spec] (opt string? spec)
        [attr-map spec] (opt map? spec)]
    `(<span class="org-keyword">defn</span> <span class="org-function-name">~name</span> 
       ~@docstring
       ~@attr-map
       [arg#]
       (<span class="org-builtin">-&gt;</span> arg# ~@spec))))

(<span class="org-keyword">defmacro</span> <span class="org-function-name">defpipe</span>
  <span class="org-doc">"Defines a function which takes one argument, a map. The params are</span>
<span class="org-doc">  symbols, which will be bound to values from the map as by :keys</span>
<span class="org-doc">  destructuring. In any tail position of the body, use the 'return'</span>
<span class="org-doc">  macro to update and return the input map."</span>
  [name &amp; spec]
  {<span class="org-constant">:arglists</span> '([name doc-string? attr-map? [params*] &amp; body])}
  (<span class="org-builtin">let</span> [[docstring spec] (opt string? spec)
        [attr-map spec] (opt map? spec)
        [argv spec] (req vector? spec <span class="org-string">"Should be a vector"</span>)]
    (<span class="org-variable-name">assert</span> (<span class="org-variable-name">every?</span> symbol? argv)
            (<span class="org-variable-name">str</span> <span class="org-string">"Should be a vector of symbols : "</span>
                 (<span class="org-variable-name">pr-str</span> argv)))
    `(<span class="org-keyword">defn</span> <span class="org-function-name">~name</span>
       ~@docstring
       ~@attr-map
       [~pipe-arg]
       (<span class="org-builtin">let</span> [{<span class="org-constant">:keys</span> ~argv} ~pipe-arg]
         ~@spec))))

(<span class="org-keyword">defn-</span> <span class="org-function-name">return-clause</span> [spec]
  (<span class="org-builtin">let</span> [[command sym &amp; body] spec]
    (<span class="org-builtin">case</span> command
      <span class="org-constant">:update</span> `(<span class="org-variable-name">update-in</span> [~(<span class="org-variable-name">keyword</span> (<span class="org-variable-name">name</span> sym))] ~@body)
      <span class="org-constant">:set</span>    `(<span class="org-variable-name">assoc</span> ~(<span class="org-variable-name">keyword</span> (<span class="org-variable-name">name</span> sym)) ~@body)
      <span class="org-constant">:remove</span> `(<span class="org-variable-name">dissoc</span> ~(<span class="org-variable-name">keyword</span> (<span class="org-variable-name">name</span> sym)) ~@body)
      body)))

(<span class="org-keyword">defmacro</span> <span class="org-function-name">return</span>
  <span class="org-doc">"Within the body of the defpipe macro, returns the input argument of</span>
<span class="org-doc">  the defpipe function. Must be in tail position. The input argument,</span>
<span class="org-doc">  a map, is threaded through exprs as by the -&gt; macro.</span>

<span class="org-doc">  Expressions within the 'return' macro may take one of the following</span>
<span class="org-doc">  forms:</span>

<span class="org-doc">      (:set key value)      ; like (assoc :key value)</span>
<span class="org-doc">      (:remove key)         ; like (dissoc :key)</span>
<span class="org-doc">      (:update key f args*) ; like (update-in [:key] f args*)</span>

<span class="org-doc">  Optionally, any other expression may be used: the input map will be</span>
<span class="org-doc">  inserted as its first argument."</span>
  [&amp; exprs]
  `(<span class="org-builtin">-&gt;</span> ~pipe-arg
       ~@(<span class="org-variable-name">map</span> return-clause exprs)))
</pre>
</div>
</div>
<div id="outline-container-6" class="outline-2">
<h2 id="sec-6">And a Made-Up Example</h2>
<div class="outline-text-2" id="text-6">
<pre class="src src-clojure">(<span class="org-keyword">defpipe</span> <span class="org-function-name">setup</span> []
  (return  <span class="org-comment-delimiter">; </span><span class="org-comment">imagine these come from a database</span>
   (<span class="org-constant">:set</span> alpha 4)
   (<span class="org-constant">:set</span> beta 3)))

(<span class="org-keyword">defpipe</span> <span class="org-function-name">compute-step1</span> [alpha beta]
  (return (<span class="org-variable-name">:set</span> delta (<span class="org-variable-name">+</span> alpha beta))))

(<span class="org-keyword">defpipe</span> <span class="org-function-name">compute-step2</span> [delta]
  (return
   (<span class="org-variable-name">assoc-in</span> [<span class="org-constant">:x</span> <span class="org-constant">:y</span>] 42)  <span class="org-comment-delimiter">; </span><span class="org-comment">ordinary function expression</span>
   (<span class="org-constant">:update</span> delta * 2)
   (<span class="org-constant">:set</span> gamma (<span class="org-variable-name">+</span> delta 100))))  <span class="org-comment-delimiter">; </span><span class="org-comment">uses old value of delta</span>

(<span class="org-keyword">defpipe</span> <span class="org-function-name">respond</span> [alpha beta gamma delta]
  (<span class="org-variable-name">println</span> <span class="org-string">" Alpha is"</span> alpha <span class="org-string">"\n"</span>
           <span class="org-string">"Beta is"</span> beta <span class="org-string">"\n"</span>
           <span class="org-string">"Delta is"</span> delta <span class="org-string">"\n"</span>
           <span class="org-string">"Gamma is"</span> gamma)
  (return)) <span class="org-comment-delimiter">; </span><span class="org-comment">not strictly necessary, but a good idea</span>

(<span class="org-keyword">defpipeline</span> <span class="org-function-name">compute</span>
  compute-step1
  compute-step2)

(<span class="org-keyword">defpipeline</span> <span class="org-function-name">process-request</span>
  setup
  compute
  respond)
</pre>
<pre class="src src-clojure">(process-request {})

<span class="org-comment-delimiter">;; </span><span class="org-comment">Alpha is 4 </span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">Beta is 3 </span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">Delta is 14 </span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">Gamma is 107</span>

<span class="org-comment-delimiter">;;</span><span class="org-comment">=&gt; {:gamma 107, :delta 14, :beta 3, :alpha 4}</span>
</pre>
</div>
</div>
	</div><!-- .entry-content -->

	<footer class="entry-footer">
		<span class="byline"><span class="author vcard"><img alt='' src='https://secure.gravatar.com/avatar/55878d0196b91803f9cb2c372b0551d3?s=49&amp;d=blank&amp;r=g' srcset='https://secure.gravatar.com/avatar/55878d0196b91803f9cb2c372b0551d3?s=98&amp;d=blank&amp;r=g 2x' class='avatar avatar-49 photo' height='49' width='49' /><span class="screen-reader-text">Author </span> <a class="url fn n" href="../../../author/stuart.html">Stuart</a></span></span><span class="posted-on"><span class="screen-reader-text">Posted on </span><a href="syntactic-pipelines.html" rel="bookmark"><time class="entry-date published" datetime="2012-05-16T17:42:41+00:00">May 16, 2012</time><time class="updated" datetime="2012-05-17T09:46:27+00:00">May 17, 2012</time></a></span><span class="cat-links"><span class="screen-reader-text">Categories </span><a href="../../../category/programming.html" rel="category tag">Programming</a></span><span class="tags-links"><span class="screen-reader-text">Tags </span><a href="../../../tag/clojure.html" rel="tag">Clojure</a>, <a href="../../../tag/macros.html" rel="tag">macros</a></span>			</footer><!-- .entry-footer -->
</article><!-- #post-## -->

<div id="comments" class="comments-area">

			<h2 class="comments-title">
			14 thoughts on &ldquo;Syntactic Pipelines&rdquo;		</h2>

		
		<ol class="comment-list">
					<li id="comment-44479" class="comment even thread-even depth-1">
			<article id="div-comment-44479" class="comment-body">
				<footer class="comment-meta">
					<div class="comment-author vcard">
						<img alt='' src='https://secure.gravatar.com/avatar/afe8dee86e7c664a293377e6aa199eae?s=42&amp;d=blank&amp;r=g' srcset='https://secure.gravatar.com/avatar/afe8dee86e7c664a293377e6aa199eae?s=84&amp;d=blank&amp;r=g 2x' class='avatar avatar-42 photo' height='42' width='42' />						<b class="fn">Mike</b> <span class="says">says:</span>					</div><!-- .comment-author -->

					<div class="comment-metadata">
						<a href="syntactic-pipelines.html#comment-44479">
							<time datetime="2012-05-16T20:20:38+00:00">
								May 16, 2012 at 8:20 pm							</time>
						</a>
											</div><!-- .comment-metadata -->

									</footer><!-- .comment-meta -->

				<div class="comment-content">
					<p>Great stuff Stuart. This actually reminds me a lot of the old webMethods EAI toolset which featured similar kinds of operations on pipelines that were effectively hashmaps. And it cost half a million pounds&#8230;..</p>
<p>It strikes me that what you are doing is actually very similar to a monadic style of programming (in the sense of binding and return values). If you formalised these pipelines into monads, it might open up some further possibilities (e.g. using monad transformers to add logging, retry capabilities etc.?)</p>
				</div><!-- .comment-content -->

							</article><!-- .comment-body -->
</li><!-- #comment-## -->
		<li id="comment-44480" class="comment odd alt thread-odd thread-alt depth-1">
			<article id="div-comment-44480" class="comment-body">
				<footer class="comment-meta">
					<div class="comment-author vcard">
						<img alt='' src='https://secure.gravatar.com/avatar/fb5ab7102f9d722394bd2d9bfbcbadca?s=42&amp;d=blank&amp;r=g' srcset='https://secure.gravatar.com/avatar/fb5ab7102f9d722394bd2d9bfbcbadca?s=84&amp;d=blank&amp;r=g 2x' class='avatar avatar-42 photo' height='42' width='42' />						<b class="fn"><a href='http://sunng.info/' rel='external nofollow' class='url'>Sunng</a></b> <span class="says">says:</span>					</div><!-- .comment-author -->

					<div class="comment-metadata">
						<a href="syntactic-pipelines.html#comment-44480">
							<time datetime="2012-05-17T06:45:54+00:00">
								May 17, 2012 at 6:45 am							</time>
						</a>
											</div><!-- .comment-metadata -->

									</footer><!-- .comment-meta -->

				<div class="comment-content">
					<p>Hi, Stuart,</p>
<p>Will you package these  code as a library?<br />
It does great help to me. I am looking for way that I can use it in my application.</p>
				</div><!-- .comment-content -->

							</article><!-- .comment-body -->
</li><!-- #comment-## -->
		<li id="comment-44481" class="comment even thread-even depth-1">
			<article id="div-comment-44481" class="comment-body">
				<footer class="comment-meta">
					<div class="comment-author vcard">
						<img alt='' src='https://secure.gravatar.com/avatar/a523012f661f603806ab1c22d855216f?s=42&amp;d=blank&amp;r=g' srcset='https://secure.gravatar.com/avatar/a523012f661f603806ab1c22d855216f?s=84&amp;d=blank&amp;r=g 2x' class='avatar avatar-42 photo' height='42' width='42' />						<b class="fn"><a href='http://www.exampler.com/blog' rel='external nofollow' class='url'>Brian Marick</a></b> <span class="says">says:</span>					</div><!-- .comment-author -->

					<div class="comment-metadata">
						<a href="syntactic-pipelines.html#comment-44481">
							<time datetime="2012-05-17T09:22:37+00:00">
								May 17, 2012 at 9:22 am							</time>
						</a>
											</div><!-- .comment-metadata -->

									</footer><!-- .comment-meta -->

				<div class="comment-content">
					<p>Nifty. Slight preference for having the default be that `defpipe` wraps the pipeline in `return` for you. (I&#8217;d have to write `respond` without using `defpipe`, I suppose, but that&#8217;s OK, since it&#8217;s not really a pipe in the same sense that `compute-step1` and `compute-step2` are.)</p>
<p>Also, a typo, I think: in `compute-step1`, shouldn&#8217;t the `set` be a `:set`?</p>
				</div><!-- .comment-content -->

							</article><!-- .comment-body -->
</li><!-- #comment-## -->
		<li id="comment-44482" class="comment byuser comment-author-stuart bypostauthor odd alt thread-odd thread-alt depth-1">
			<article id="div-comment-44482" class="comment-body">
				<footer class="comment-meta">
					<div class="comment-author vcard">
						<img alt='' src='https://secure.gravatar.com/avatar/55878d0196b91803f9cb2c372b0551d3?s=42&amp;d=blank&amp;r=g' srcset='https://secure.gravatar.com/avatar/55878d0196b91803f9cb2c372b0551d3?s=84&amp;d=blank&amp;r=g 2x' class='avatar avatar-42 photo' height='42' width='42' />						<b class="fn"><a href='../../../index.html' rel='external nofollow' class='url'>Stuart</a></b> <span class="says">says:</span>					</div><!-- .comment-author -->

					<div class="comment-metadata">
						<a href="syntactic-pipelines.html#comment-44482">
							<time datetime="2012-05-17T09:47:01+00:00">
								May 17, 2012 at 9:47 am							</time>
						</a>
											</div><!-- .comment-metadata -->

									</footer><!-- .comment-meta -->

				<div class="comment-content">
					<p>Brian: typo fixed, thanks!</p>
				</div><!-- .comment-content -->

							</article><!-- .comment-body -->
</li><!-- #comment-## -->
		<li id="comment-44483" class="comment byuser comment-author-stuart bypostauthor even thread-even depth-1">
			<article id="div-comment-44483" class="comment-body">
				<footer class="comment-meta">
					<div class="comment-author vcard">
						<img alt='' src='https://secure.gravatar.com/avatar/55878d0196b91803f9cb2c372b0551d3?s=42&amp;d=blank&amp;r=g' srcset='https://secure.gravatar.com/avatar/55878d0196b91803f9cb2c372b0551d3?s=84&amp;d=blank&amp;r=g 2x' class='avatar avatar-42 photo' height='42' width='42' />						<b class="fn"><a href='../../../index.html' rel='external nofollow' class='url'>Stuart</a></b> <span class="says">says:</span>					</div><!-- .comment-author -->

					<div class="comment-metadata">
						<a href="syntactic-pipelines.html#comment-44483">
							<time datetime="2012-05-17T10:12:03+00:00">
								May 17, 2012 at 10:12 am							</time>
						</a>
											</div><!-- .comment-metadata -->

									</footer><!-- .comment-meta -->

				<div class="comment-content">
					<p>Mike: Yes, it is slightly monadic in character. I&#8217;ve never been convinced of the utility of monads outside of strictly pure functional languages like Haskell, but that may be simply because I&#8217;ve never understood them.</p>
				</div><!-- .comment-content -->

							</article><!-- .comment-body -->
</li><!-- #comment-## -->
		<li id="comment-44484" class="comment byuser comment-author-stuart bypostauthor odd alt thread-odd thread-alt depth-1">
			<article id="div-comment-44484" class="comment-body">
				<footer class="comment-meta">
					<div class="comment-author vcard">
						<img alt='' src='https://secure.gravatar.com/avatar/55878d0196b91803f9cb2c372b0551d3?s=42&amp;d=blank&amp;r=g' srcset='https://secure.gravatar.com/avatar/55878d0196b91803f9cb2c372b0551d3?s=84&amp;d=blank&amp;r=g 2x' class='avatar avatar-42 photo' height='42' width='42' />						<b class="fn"><a href='../../../index.html' rel='external nofollow' class='url'>Stuart</a></b> <span class="says">says:</span>					</div><!-- .comment-author -->

					<div class="comment-metadata">
						<a href="syntactic-pipelines.html#comment-44484">
							<time datetime="2012-05-17T10:24:23+00:00">
								May 17, 2012 at 10:24 am							</time>
						</a>
											</div><!-- .comment-metadata -->

									</footer><!-- .comment-meta -->

				<div class="comment-content">
					<p>Brian: re. having `return` automatically included in `defpipe`: that would make the macro implementation simpler, but would prevent you from putting anything else in the function body. I wanted `defpipe` functions to be able to do all the things real functions can do, including conditional branching and side effects. For example:</p>
<pre>(defpipe foo [a b]
  (log "This is foo")
  (if (< a 100)
    (return (:update b + 100))
    (return)))</pre>
				</div><!-- .comment-content -->

							</article><!-- .comment-body -->
</li><!-- #comment-## -->
		<li id="comment-44492" class="comment even thread-even depth-1">
			<article id="div-comment-44492" class="comment-body">
				<footer class="comment-meta">
					<div class="comment-author vcard">
						<img alt='' src='https://secure.gravatar.com/avatar/361cb3cfa29928ddff4c49cbb5ad0cbd?s=42&amp;d=blank&amp;r=g' srcset='https://secure.gravatar.com/avatar/361cb3cfa29928ddff4c49cbb5ad0cbd?s=84&amp;d=blank&amp;r=g 2x' class='avatar avatar-42 photo' height='42' width='42' />						<b class="fn">Dmitri</b> <span class="says">says:</span>					</div><!-- .comment-author -->

					<div class="comment-metadata">
						<a href="syntactic-pipelines.html#comment-44492">
							<time datetime="2012-05-19T12:45:34+00:00">
								May 19, 2012 at 12:45 pm							</time>
						</a>
											</div><!-- .comment-metadata -->

									</footer><!-- .comment-meta -->

				<div class="comment-content">
					<p>[edited for code formatting -S]</p>
<p>Shouldn&#8217;t side-effecty stuff like logging be isolated from functions containing transformation logic? Are explicit return calls idiomatic in clojure? How does [1] really differs from [1&#8242;], and [2] from [2&#8242;]? I&#8217;m not sure which is shorter.</p>
<pre>[1]
(defpipe compute-step2 [delta]
  (return
   (assoc-in [:x :y] 42)
   (:update delta * 2)
   (:set gamma (+ delta 100))))

[1']
(defn compute-step2 [{:keys [delta] :as m}]
  (-&gt; m
      (assoc-in [:x :y] 42)
      (update-in [:delta] * 2)
      (assoc :gamma (+ delta 100))))

[2]
(defpipeline compute
  compute-step1
  compute-step2)

[2']
(def compute (comp compute-step2 compute-step1))</pre>
				</div><!-- .comment-content -->

							</article><!-- .comment-body -->
</li><!-- #comment-## -->
		<li id="comment-44493" class="comment byuser comment-author-stuart bypostauthor odd alt thread-odd thread-alt depth-1">
			<article id="div-comment-44493" class="comment-body">
				<footer class="comment-meta">
					<div class="comment-author vcard">
						<img alt='' src='https://secure.gravatar.com/avatar/55878d0196b91803f9cb2c372b0551d3?s=42&amp;d=blank&amp;r=g' srcset='https://secure.gravatar.com/avatar/55878d0196b91803f9cb2c372b0551d3?s=84&amp;d=blank&amp;r=g 2x' class='avatar avatar-42 photo' height='42' width='42' />						<b class="fn"><a href='../../../index.html' rel='external nofollow' class='url'>Stuart</a></b> <span class="says">says:</span>					</div><!-- .comment-author -->

					<div class="comment-metadata">
						<a href="syntactic-pipelines.html#comment-44493">
							<time datetime="2012-05-19T13:16:06+00:00">
								May 19, 2012 at 1:16 pm							</time>
						</a>
											</div><!-- .comment-metadata -->

									</footer><!-- .comment-meta -->

				<div class="comment-content">
					<p>Dmitri: It&#8217;s not an explicit return call (which Clojure does not support) I just chose the name <code>return</code> because that&#8217;s where you put the code that manipulates the return value of the function. As I said, the <code>return</code> macro always has to be in tail position anyway.</p>
<p>There is no actual difference between [1] and [1&#8242;] or between [2] and [2&#8242;]. Which you prefer is a matter of taste. My purpose in writing the macros was simply to demonstrate that macros can be used to formalize a repeated syntactic pattern. I&#8217;m not sure I&#8217;d even use these macros myself, unless I felt like they really added to the clarity of the code.</p>
<p>One other possibility, which I failed to mention in the article, is that abstracting this pattern into macros could allow alternate implementations. For example, perhaps the macros could be made clever enough to use only local variables and omit the map parameter altogether for better performance. I don&#8217;t actually know if this is possible in this case, but it&#8217;s interesting to think about.</p>
				</div><!-- .comment-content -->

							</article><!-- .comment-body -->
</li><!-- #comment-## -->
		<li id="comment-44494" class="comment even thread-even depth-1">
			<article id="div-comment-44494" class="comment-body">
				<footer class="comment-meta">
					<div class="comment-author vcard">
						<img alt='' src='https://secure.gravatar.com/avatar/ed9fe597636ab8151391831b32ad6db9?s=42&amp;d=blank&amp;r=g' srcset='https://secure.gravatar.com/avatar/ed9fe597636ab8151391831b32ad6db9?s=84&amp;d=blank&amp;r=g 2x' class='avatar avatar-42 photo' height='42' width='42' />						<b class="fn"><a href='https://twitter.com/sbtourist' rel='external nofollow' class='url'>Sergio Bossa</a></b> <span class="says">says:</span>					</div><!-- .comment-author -->

					<div class="comment-metadata">
						<a href="syntactic-pipelines.html#comment-44494">
							<time datetime="2012-05-19T14:19:44+00:00">
								May 19, 2012 at 2:19 pm							</time>
						</a>
											</div><!-- .comment-metadata -->

									</footer><!-- .comment-meta -->

				<div class="comment-content">
					<p>Very nice piece of work, look forward to see it on GitHub ;)</p>
<p>Just one improvement imho: I&#8217;d personally prefer if users could provide their own map manipulation functions rather than just relying on predefined ones; what do you think?</p>
				</div><!-- .comment-content -->

							</article><!-- .comment-body -->
</li><!-- #comment-## -->
		<li id="comment-44495" class="comment byuser comment-author-stuart bypostauthor odd alt thread-odd thread-alt depth-1">
			<article id="div-comment-44495" class="comment-body">
				<footer class="comment-meta">
					<div class="comment-author vcard">
						<img alt='' src='https://secure.gravatar.com/avatar/55878d0196b91803f9cb2c372b0551d3?s=42&amp;d=blank&amp;r=g' srcset='https://secure.gravatar.com/avatar/55878d0196b91803f9cb2c372b0551d3?s=84&amp;d=blank&amp;r=g 2x' class='avatar avatar-42 photo' height='42' width='42' />						<b class="fn"><a href='../../../index.html' rel='external nofollow' class='url'>Stuart</a></b> <span class="says">says:</span>					</div><!-- .comment-author -->

					<div class="comment-metadata">
						<a href="syntactic-pipelines.html#comment-44495">
							<time datetime="2012-05-19T14:29:15+00:00">
								May 19, 2012 at 2:29 pm							</time>
						</a>
											</div><!-- .comment-metadata -->

									</footer><!-- .comment-meta -->

				<div class="comment-content">
					<p>Sergio: You can already supply your own map-manipulation functions: that&#8217;s why the <code>return</code> macro has the original <code>body</code> as the &#8220;else&#8221; clause in the <code>case</code> expression: if the expression given to <code>return</code> isn&#8217;t one of the predefined keywords, it&#8217;s just included verbatim.</p>
				</div><!-- .comment-content -->

							</article><!-- .comment-body -->
</li><!-- #comment-## -->
		<li id="comment-44500" class="comment even thread-even depth-1">
			<article id="div-comment-44500" class="comment-body">
				<footer class="comment-meta">
					<div class="comment-author vcard">
						<img alt='' src='https://secure.gravatar.com/avatar/ed9fe597636ab8151391831b32ad6db9?s=42&amp;d=blank&amp;r=g' srcset='https://secure.gravatar.com/avatar/ed9fe597636ab8151391831b32ad6db9?s=84&amp;d=blank&amp;r=g 2x' class='avatar avatar-42 photo' height='42' width='42' />						<b class="fn"><a href='https://twitter.com/sbtourist' rel='external nofollow' class='url'>Sergio Bossa</a></b> <span class="says">says:</span>					</div><!-- .comment-author -->

					<div class="comment-metadata">
						<a href="syntactic-pipelines.html#comment-44500">
							<time datetime="2012-05-20T05:06:53+00:00">
								May 20, 2012 at 5:06 am							</time>
						</a>
											</div><!-- .comment-metadata -->

									</footer><!-- .comment-meta -->

				<div class="comment-content">
					<p>Right, missed that: thanks for clarifying!</p>
				</div><!-- .comment-content -->

							</article><!-- .comment-body -->
</li><!-- #comment-## -->
		<li id="comment-44614" class="pingback odd alt thread-odd thread-alt depth-1">
			<div class="comment-body">
				Pingback: <a href='http://blog.fogus.me/2012/07/09/clojure-obscura/' rel='external nofollow' class='url'>fogus: Clojure Obscura</a> 			</div>
</li><!-- #comment-## -->
		<li id="comment-44630" class="comment even thread-even depth-1">
			<article id="div-comment-44630" class="comment-body">
				<footer class="comment-meta">
					<div class="comment-author vcard">
						<img alt='' src='https://secure.gravatar.com/avatar/d0a22997aba0f1b17403d9ee0aee7b3c?s=42&amp;d=blank&amp;r=g' srcset='https://secure.gravatar.com/avatar/d0a22997aba0f1b17403d9ee0aee7b3c?s=84&amp;d=blank&amp;r=g 2x' class='avatar avatar-42 photo' height='42' width='42' />						<b class="fn">lsh</b> <span class="says">says:</span>					</div><!-- .comment-author -->

					<div class="comment-metadata">
						<a href="syntactic-pipelines.html#comment-44630">
							<time datetime="2012-08-14T11:44:25+00:00">
								August 14, 2012 at 11:44 am							</time>
						</a>
											</div><!-- .comment-metadata -->

									</footer><!-- .comment-meta -->

				<div class="comment-content">
					<p>I came across this post by accident. I&#8217;m coming from the Python world and in Django the http middleware behaves just like these pipes, which was something I was trying to implement in Clojure &#8211; however you pull it off much more cleverly. I&#8217;m just learning macros (from Practical Clojure, your book no less) but for your case where you want conditional pipelines evaluated I wrangled this:</p>
<p><code><br />
(defmacro branch [pred &amp; body]<br />
    `(fn [x#]<br />
        (if (~pred x#) (-&gt; x# ~@body) x#)))<br />
</code></p>
<p>I&#8217;m still playing with it, and at first blush it seems to be working:</p>
<p><code><br />
(defpipeline compute<br />
    step1<br />
    ((branch some-check<br />
        substep1 substep2 substep3))<br />
    step2)<br />
</code></p>
<p>There is that *ugly* double parenthesis though. It&#8217;s pretty simplistic, but hopefully a shortcut for another, future, reader.</p>
<p>Thanks for the post and thank you very much for your work on Practical Clojure.</p>
				</div><!-- .comment-content -->

							</article><!-- .comment-body -->
</li><!-- #comment-## -->
		<li id="comment-44632" class="pingback odd alt thread-odd thread-alt depth-1">
			<div class="comment-body">
				Pingback: <a href='../../09/12/when-to-write-a-macro.html' rel='external nofollow' class='url'>When (Not) to Write a Macro | Digital Digressions by Stuart Sierra</a> 			</div>
</li><!-- #comment-## -->
		</ol><!-- .comment-list -->

		
	
			<p class="no-comments">Comments are closed.</p>
	
	
</div><!-- .comments-area -->

	<nav class="navigation post-navigation" role="navigation">
		<h2 class="screen-reader-text">Post navigation</h2>
		<div class="nav-links"><div class="nav-previous"><a href="../../04/03/three-kinds-of-error.html" rel="prev"><span class="meta-nav" aria-hidden="true">Previous</span> <span class="screen-reader-text">Previous post:</span> <span class="post-title">Three Kinds of Error</span></a></div><div class="nav-next"><a href="../../06/16/why-im-using-clojurescript.html" rel="next"><span class="meta-nav" aria-hidden="true">Next</span> <span class="screen-reader-text">Next post:</span> <span class="post-title">Why I&#8217;m Using ClojureScript</span></a></div></div>
	</nav>
	</main><!-- .site-main -->

	
</div><!-- .content-area -->


	<aside id="secondary" class="sidebar widget-area" role="complementary">
		<section id="search-3" class="widget widget_search">
<form role="search" method="get" class="search-form" action="https://stuartsierra.com/">
	<label>
		<span class="screen-reader-text">Search for:</span>
		<input type="search" class="search-field" placeholder="Search &hellip;" value="" name="s" />
	</label>
	<button type="submit" class="search-submit"><span class="screen-reader-text">Search</span></button>
</form>
</section><section id="text-4" class="widget widget_text">			<div class="textwidget"><ul>
<li><a href="http://feeds2.feedburner.com/StuartSierra" title="Syndicate this site using RSS 2.0">Entries <abbr title="Really Simple Syndication">RSS</abbr></a></li>
<li><a href="../../../comments/feed" title="The latest comments to all posts in RSS">Comments <abbr title="Really Simple Syndication">RSS</abbr></a></li>
</ul>
<ul>
<li><a href="https://twitter.com/stuartsierra">Twitter</a></li>
<li><a href="https://github.com/stuartsierra">GitHub</a></li>
</ul></div>
		</section><section id="tag-widget-2" class="widget TagWidget"><h2 class="widget-title">Clojure Doâ€™s and Donâ€™ts</h2><ul class = "posts-by-tag-list"><li class="posts-by-tag-item Clojure do's and don'ts" id="posts-by-tag-item-883"><a class = "posts-by-tag-item-title" href="../../../2015/08/25/clojure-donts-lazy-effects.html">Clojure Donâ€™ts: Lazy Effects</a></li><li class="posts-by-tag-item Clojure do's and don'ts" id="posts-by-tag-item-877"><a class = "posts-by-tag-item-title" href="../../../2015/08/10/clojure-donts-redundant-map.html">Clojure Donâ€™ts: Redundant map</a></li><li class="posts-by-tag-item Clojure do's and don'ts" id="posts-by-tag-item-870"><a class = "posts-by-tag-item-title" href="../../../2015/06/16/clojure-donts-single-branch-if.html">Clojure Donâ€™ts: Single-branch if</a></li><li class="posts-by-tag-item Clojure do's and don'ts" id="posts-by-tag-item-854"><a class = "posts-by-tag-item-title" href="../../../2015/06/10/clojure-donts-heisenparameter.html">Clojure Donâ€™ts: The Heisenparameter</a></li><li class="posts-by-tag-item Clojure do's and don'ts" id="posts-by-tag-item-849"><a class = "posts-by-tag-item-title" href="../../../2015/06/01/clojure-donts-optional-arguments-with-varargs.html">Clojure Donâ€™ts: Optional Arguments with Varargs</a></li><li class="posts-by-tag-item Clojure do's and don'ts errors" id="posts-by-tag-item-836"><a class = "posts-by-tag-item-title" href="../../../2015/05/27/clojure-uncaught-exceptions.html">Clojure Doâ€™s: Uncaught Exceptions</a></li><li class="posts-by-tag-item Clojure do's and don'ts" id="posts-by-tag-item-831"><a class = "posts-by-tag-item-title" href="../../../2015/05/17/clojure-record-constructors.html">Record Constructors</a></li><li class="posts-by-tag-item Clojure do's and don'ts" id="posts-by-tag-item-826"><a class = "posts-by-tag-item-title" href="../../../2015/05/10/clojure-namespace-aliases.html">Clojure Doâ€™s: Namespace Aliases</a></li><li class="posts-by-tag-item Clojure do's and don'ts" id="posts-by-tag-item-820"><a class = "posts-by-tag-item-title" href="../../../2015/05/02/clojure-donts-isa.html">Clojure Donâ€™ts: isa?</a></li><li class="posts-by-tag-item Clojure do's and don'ts" id="posts-by-tag-item-812"><a class = "posts-by-tag-item-title" href="../../../2015/04/26/clojure-donts-concat.html">Clojure Donâ€™ts: Concat</a></li></ul></section>	</aside><!-- .sidebar .widget-area -->

		</div><!-- .site-content -->

		<footer id="colophon" class="site-footer" role="contentinfo">
							<nav class="main-navigation" role="navigation" aria-label="Footer Primary Menu">
					<div class="menu-main-menu-container"><ul id="menu-main-menu-1" class="primary-menu"><li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-635"><a href="../../../about-me.html">About Me</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-633"><a href="../../../writing.html">Writing</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-634"><a href="../../../presentations.html">Presentations</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-636"><a href="../../../software.html">Software</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-637"><a href="../../../contact.html">Contact</a></li>
</ul></div>				</nav><!-- .main-navigation -->
			
			
			<div class="site-info">
								<span class="site-title"><a href="../../../index.html" rel="home">Digital Digressions by Stuart Sierra</a></span>
				<a href="https://wordpress.org/">Proudly powered by WordPress</a>
			</div><!-- .site-info -->
		</footer><!-- .site-footer -->
	</div><!-- .site-inner -->
</div><!-- .site -->

	<div style="display:none">
	<div class="grofile-hash-map-55878d0196b91803f9cb2c372b0551d3">
	</div>
	<div class="grofile-hash-map-afe8dee86e7c664a293377e6aa199eae">
	</div>
	<div class="grofile-hash-map-fb5ab7102f9d722394bd2d9bfbcbadca">
	</div>
	<div class="grofile-hash-map-a523012f661f603806ab1c22d855216f">
	</div>
	<div class="grofile-hash-map-55878d0196b91803f9cb2c372b0551d3">
	</div>
	<div class="grofile-hash-map-361cb3cfa29928ddff4c49cbb5ad0cbd">
	</div>
	<div class="grofile-hash-map-ed9fe597636ab8151391831b32ad6db9">
	</div>
	<div class="grofile-hash-map-d0a22997aba0f1b17403d9ee0aee7b3c">
	</div>
	</div>
<script type='text/javascript' src='https://s0.wp.com/wp-content/js/devicepx-jetpack.js?ver=201635'></script>
<script type='text/javascript' src='https://secure.gravatar.com/js/gprofiles.js?ver=2016Sepaa'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var WPGroHo = {"my_hash":""};
/* ]]> */
</script>
<script type='text/javascript' src='../../../wp-content/plugins/jetpack/modules/wpgroho167b.js?ver=4.6'></script>
<script type='text/javascript' src='../../../wp-content/themes/twentysixteen/js/skip-link-focus-fix8de4.js?ver=20160816'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var screenReaderText = {"expand":"expand child menu","collapse":"collapse child menu"};
/* ]]> */
</script>
<script type='text/javascript' src='../../../wp-content/themes/twentysixteen/js/functions8de4.js?ver=20160816'></script>
<script type='text/javascript' src='../../../wp-includes/js/wp-embed.min167b.js?ver=4.6'></script>
<script type='text/javascript' src='https://stats.wp.com/e-201635.js' async defer></script>
<script type='text/javascript'>
	_stq = window._stq || [];
	_stq.push([ 'view', {v:'ext',j:'1:4.2.2',blog:'2702563',post:'624',tz:'-4',srv:'stuartsierra.com'} ]);
	_stq.push([ 'clickTrackerInit', '2702563', '624' ]);
</script>
</body>

<!-- Mirrored from stuartsierra.com/2012/05/16/syntactic-pipelines by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 02 Sep 2016 17:02:25 GMT -->
</html>

<!-- Dynamic page generated in 0.422 seconds. -->
<!-- Cached page generated by WP-Super-Cache on 2016-09-02 12:59:27 -->

<!-- Compression = gzip -->