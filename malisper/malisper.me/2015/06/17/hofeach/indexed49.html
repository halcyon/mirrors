<!DOCTYPE html>
<html lang="en-US" prefix="og: http://ogp.me/ns#">

<!-- Mirrored from malisper.me/2015/06/17/hofeach/?replytocom=50 by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 01 Sep 2016 17:47:30 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Hofeach - Macrology</title>
<link rel="profile" href="http://gmpg.org/xfn/11">
<link rel="pingback" href="../../../../xmlrpc.php">


<!-- This site is optimized with the Yoast SEO plugin v3.4.2 - https://yoast.com/wordpress/plugins/seo/ -->
<meta name="robots" content="noindex,follow"/>
<link rel="canonical" href="index.html" />
<meta property="og:locale" content="en_US" />
<meta property="og:type" content="article" />
<meta property="og:title" content="Hofeach - Macrology" />
<meta property="og:description" content="Last time I talked about mapeach, a macro which is a simple wrapper around mapcar. After using mapeach a couple times, I found that I wanted &#8216;each&#8217; version of many other other functions, remove, find, and count to name a few. One option I had was to write a macro for every single one of these functions. If I were &hellip;" />
<meta property="og:url" content="index.html" />
<meta property="og:site_name" content="Macrology" />
<meta property="article:section" content="Basic Macros" />
<meta property="article:published_time" content="2015-06-17T10:46:50-05:00" />
<meta property="article:modified_time" content="2015-07-04T15:57:48-05:00" />
<meta property="og:updated_time" content="2015-07-04T15:57:48-05:00" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:description" content="Last time I talked about mapeach, a macro which is a simple wrapper around mapcar. After using mapeach a couple times, I found that I wanted &#8216;each&#8217; version of many other other functions, remove, find, and count to name a few. One option I had was to write a macro for every single one of these functions. If I were [&hellip;]" />
<meta name="twitter:title" content="Hofeach - Macrology" />
<!-- / Yoast SEO plugin. -->

<link rel='dns-prefetch' href='http://fonts.googleapis.com/'>
<link rel="alternate" type="application/rss+xml" title="Macrology &raquo; Feed" href="../../../../feed/index.html" />
<link rel="alternate" type="application/rss+xml" title="Macrology &raquo; Comments Feed" href="../../../../comments/feed/index.html" />
<link rel="alternate" type="application/rss+xml" title="Macrology &raquo; Hofeach Comments Feed" href="feed/index.html" />
<link rel='stylesheet' id='scrawl-style-css'  href='../../../../wp-content/themes/scrawl-wpcom/style167b.css?ver=4.6' type='text/css' media='all' />
<link rel='stylesheet' id='scrawl-fonts-css'  href='https://fonts.googleapis.com/css?family=Lora:400,700|Merriweather:400italic,400,700,700italic&amp;subset=latin%2Clatin-ext' type='text/css' media='all' />
<link rel='stylesheet' id='genericons-css'  href='../../../../wp-content/themes/scrawl-wpcom/fonts/genericons6de8.css?ver=3.3' type='text/css' media='all' />
<script type='text/javascript' src='../../../../wp-includes/js/jquery/jqueryb8ff.js?ver=1.12.4'></script>
<script type='text/javascript' src='../../../../wp-includes/js/jquery/jquery-migrate.min330a.js?ver=1.4.1'></script>
<link rel='https://api.w.org/' href='../../../../wp-json/index.html' />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="../../../../xmlrpc0db0.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="../../../../wp-includes/wlwmanifest.xml" /> 
<meta name="generator" content="WordPress 4.6" />
<link rel='shortlink' href='../../../../index03e1.html?p=241' />
<meta name='robots' content='noindex,follow' />
<link rel="alternate" type="application/json+oembed" href="../../../../wp-json/oembed/1.0/embed311b.json?url=http%3A%2F%2Fmalisper.me%2F2015%2F06%2F17%2Fhofeach%2F" />
<link rel="alternate" type="text/xml+oembed" href="../../../../wp-json/oembed/1.0/embed9f85?url=http%3A%2F%2Fmalisper.me%2F2015%2F06%2F17%2Fhofeach%2F&amp;format=xml" />
<script type="text/javascript">
var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-63547056-1']);
_gaq.push(['_trackPageview']);
(function() {
var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();
</script>
<style type="text/css" id="syntaxhighlighteranchor"></style>

<script type="text/javascript">
  window.heap=window.heap||[],heap.load=function(e,t){window.heap.appid=e,window.heap.config=t=t||{};var n=t.forceSSL||"https:"===document.location.protocol,a=document.createElement("script");a.type="text/javascript",a.async=!0,a.src=(n?"https:":"http:")+"//cdn.heapanalytics.com/js/heap-"+e+".js";var o=document.getElementsByTagName("script")[0];o.parentNode.insertBefore(a,o);for(var r=function(e){return function(){heap.push([e].concat(Array.prototype.slice.call(arguments,0)))}},p=["clearEventProperties","identify","setEventProperties","track","unsetEventProperty"],c=0;c<p.length;c++)heap[p[c]]=r(p[c])};
    heap.load("931515525");
</script>
</head>

<body class="single single-post postid-241 single-format-standard">
	<button class="menu-toggle x">
		<span class="lines"></span>
		<span class="screen-reader-text">Primary Menu</span>
	</button>
	<div class="slide-menu">
				
		<h1 class="site-title"><a href="../../../../index.html" rel="home">Macrology</a></h1>
		<h2 class="site-description">Case Studies in Lisp Macros</h2>
		
				
				
			<div id="secondary" class="widget-area" role="complementary">
		<aside id="search-2" class="widget widget_search"><form role="search" method="get" class="search-form" action="http://malisper.me/">
				<label>
					<span class="screen-reader-text">Search for:</span>
					<input type="search" class="search-field" placeholder="Search &hellip;" value="" name="s" />
				</label>
				<input type="submit" class="search-submit" value="Search" />
			</form></aside><aside id="pages-3" class="widget widget_pages"><h1 class="widget-title">Pages</h1>		<ul>
			<li class="page_item page-item-55"><a href="../../../../about-me/index.html">About Michael Malis</a></li>
<li class="page_item page-item-44"><a href="../../../../about-this-site-2/index.html">About This Site</a></li>
		</ul>
		</aside><aside id="nav_menu-3" class="widget widget_nav_menu"><h1 class="widget-title">Contact Me</h1><div class="menu-contact-me-container"><ul id="menu-contact-me" class="menu"><li id="menu-item-60" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-60"><a href="mailto:michaelmalis2@gmail.com">Email</a></li>
<li id="menu-item-58" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-58"><a href="https://github.com/malisper">Github</a></li>
<li id="menu-item-59" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-59"><a href="https://news.ycombinator.com/user?id=malisper">Hacker News</a></li>
</ul></div></aside><aside id="archives-2" class="widget widget_archive"><h1 class="widget-title">Archives</h1>		<ul>
			<li><a href='../../../../2016/06/index.html'>June 2016</a></li>
	<li><a href='../../../../2016/04/index.html'>April 2016</a></li>
	<li><a href='../../../../2016/01/index.html'>January 2016</a></li>
	<li><a href='../../../12/index.html'>December 2015</a></li>
	<li><a href='../../../11/index.html'>November 2015</a></li>
	<li><a href='../../../10/index.html'>October 2015</a></li>
	<li><a href='../../../09/index.html'>September 2015</a></li>
	<li><a href='../../../08/index.html'>August 2015</a></li>
	<li><a href='../../../07/index.html'>July 2015</a></li>
	<li><a href='../../index.html'>June 2015</a></li>
	<li><a href='../../../05/index.html'>May 2015</a></li>
		</ul>
		</aside><aside id="categories-2" class="widget widget_categories"><h1 class="widget-title">Categories</h1>		<ul>
	<li class="cat-item cat-item-2"><a href="../../../../category/basics/index.html" title="These are basic Lisp macros that should be trivial to understand.">Basic Macros</a>
</li>
	<li class="cat-item cat-item-5"><a href="../../../../category/intermediate-macros/index.html" >Intermediate Macros</a>
</li>
	<li class="cat-item cat-item-6"><a href="../../../../category/advanced-macros/index.html" >Advanced Macros</a>
</li>
	<li class="cat-item cat-item-7"><a href="../../../../category/debugging-common-lisp/index.html" >Debugging Lisp</a>
</li>
	<li class="cat-item cat-item-8"><a href="../../../../category/loops-in-lisp/index.html" >Loops in Lisp</a>
</li>
		</ul>
</aside>	</div><!-- #secondary -->
	</div><!-- .slide-menu -->
<div id="page" class="hfeed site">
	<a class="skip-link screen-reader-text" href="#content">Skip to content</a>

	<header id="masthead" class="site-header" role="banner">

		<div class="site-branding">
						<h1 class="site-title"><a href="../../../../index.html" rel="home">Macrology</a></h1>
		</div>

	</header><!-- #masthead -->

	
	
	<div id="content" class="site-content">


	<div id="primary" class="content-area">
		<main id="main" class="site-main" role="main">

		
			<article id="post-241" class="post-241 post type-post status-publish format-standard hentry category-basics">
			<header class="entry-header">
			<h1 class="entry-title">Hofeach</h1>		</header><!-- .entry-header -->
		<div class="entry-content">
		<p>Last time I talked about <a href="../../14/mapeach/index.html">mapeach</a>, a macro which is a simple wrapper around <strong>mapcar</strong>. After using <strong>mapeach</strong> a couple times, I found that I wanted &#8216;each&#8217; version of many other other functions, <strong>remove</strong>, <strong>find</strong>, and <strong>count</strong> to name a few. One option I had was to write a macro for every single one of these functions. If I were to have done this, I would have wound up with &#8216;remove-each&#8217;, &#8216;find-each&#8217;, and so on. Instead I took door number two, creating a general macro which I call &#8216;<strong>hofeach&#8217;</strong>. <strong>Hofeach</strong>, is just like <strong>mapeach</strong>, except it takes an extra argument for the HOF (higher order function), that you want to use. Below is one possible implementation of <strong>hofeach</strong>.</p>
<pre class="brush: plain; title: ; notranslate" title="">
(defmacro hofeach (hof var list &amp;body body)
  `(funcall ,hof (lambda (,var) ,@body) ,list))
</pre>
<p>Here is what code that uses <strong>hofeach</strong> as a fill in for <strong>mapeach</strong> looks like:</p>
<pre class="brush: plain; title: ; notranslate" title="">
(hofeach #'mapcar x '(1 2 3)
  (* x x))

=&gt; (1 4 9)
</pre>
<p>Now we get to specify which HOF we want to use! If we want to keep all of the numbers in a list that are even, here is how we could do that:<span id='easy-footnote-1' class='easy-footnote-margin-adjust'></span><span class='easy-footnote'><a href='#easy-footnote-bottom-1' title='Remove-if-not is a pretty bad name. Removing all of the elements that do not satisfy some property can be thought of as keeping all of the ones that do. So instead of being called &#8216;remove-if-not&#8217;, it should be called &#8216;keep-if&#8217;.'><sup>1</sup></a></span> <span id='easy-footnote-2' class='easy-footnote-margin-adjust'></span><span class='easy-footnote'><a href='#easy-footnote-bottom-2' title='We need to use integerp since evenp signals an error when called with a non-integer value.'><sup>2</sup></a></span></p>
<pre class="brush: plain; title: ; notranslate" title="">
(hofeach #'remove-if-not x '(1.2 5 7 2 3.5 6 9)
  (and (integerp x) (evenp x)))

=&gt; (2 6)
</pre>
<p>So now that I have <strong>hofeach</strong>, I generally will use it instead of passing a complex lambda expression to a HOF. Most of the time I use <strong>hofeach</strong> with <strong>remove-if-not</strong>, but I have also used it with <b>count-if</b> as well. It gives code a nice down and to the right look, which I find pretty easy to read. You get to read the forms in the order that they appear. If you were to use a lambda expression instead, it becomes much more difficult to read since you have to jump around in order to read the code.</p>
<ol class="easy-footnotes-wrapper"><li class="easy-footnote-single"><span id="easy-footnote-bottom-1" class="easy-footnote-margin-adjust"></span>Remove-if-not is a pretty bad name. Removing all of the elements that do not satisfy some property can be thought of as keeping all of the ones that do. So instead of being called &#8216;remove-if-not&#8217;, it should be called &#8216;keep-if&#8217;.<a class="easy-footnote-to-top" href="#easy-footnote-1"></a></li><li class="easy-footnote-single"><span id="easy-footnote-bottom-2" class="easy-footnote-margin-adjust"></span>We need to use integerp since evenp signals an error when called with a non-integer value.<a class="easy-footnote-to-top" href="#easy-footnote-2"></a></li></ol>			</div><!-- .entry-content -->

	<footer class="entry-footer">
				<div class="entry-meta clear">
			<span class="posted-on">Posted on <a href="index.html" rel="bookmark"><time class="entry-date published" datetime="2015-06-17T10:46:50+00:00">June 17, 2015</time><time class="updated" datetime="2015-07-04T15:57:48+00:00">July 4, 2015</time></a></span><span class="byline"> by <span class="author vcard"><a class="url fn n" href="../../../../author/malisper/index.html">malisper</a></span></span><span class="category-links"> in <a href="../../../../category/basics/index.html" rel="category tag">Basic Macros</a></span>			<span class="secondary-entry-meta">
								<span class="comments-link"><a href="index.html#comments">10</a></span>							</span>
		</div><!-- .entry-meta -->
	</footer><!-- .entry-footer -->
</article><!-- #post-## -->

			
	<nav class="navigation post-navigation" role="navigation">
		<h2 class="screen-reader-text">Post navigation</h2>
		<div class="nav-links"><div class="nav-previous"><a href="../../14/mapeach/index.html" rel="prev"><span class="title">Previous post</span>Mapeach</a></div><div class="nav-next"><a href="../../30/multiple-value-bind/index.html" rel="next"><span class="title">Next post</span>Multiple-value-bind</a></div></div>
	</nav>
			
<div id="comments" class="comments-area">

	
			<h2 class="comments-title">
			10 thoughts on &ldquo;<span>Hofeach</span>&rdquo;		</h2>

		<ol class="comment-list">
					<li id="comment-41" class="comment even thread-even depth-1">
			<article id="div-comment-41" class="comment-body">
				<footer class="comment-meta">
					<div class="comment-author vcard">
						<img alt='' src='http://2.gravatar.com/avatar/2c8b478e285045e2d5a7cd1119628f80?s=64&amp;d=mm&amp;r=g' srcset='http://2.gravatar.com/avatar/2c8b478e285045e2d5a7cd1119628f80?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />						<b class="fn">Marco</b> <span class="says">says:</span>					</div><!-- .comment-author -->

					<div class="comment-metadata">
						<a href="index.html#comment-41">
							<time datetime="2015-06-30T00:06:55+00:00">
								June 30, 2015 at 12:06 am							</time>
						</a>
											</div><!-- .comment-metadata -->

									</footer><!-- .comment-meta -->

				<div class="comment-content">
					<p>Thank you, very instructive as always.</p>
<p>A note on &#8220;remove-if-not&#8221;, and similar functions, can be found on &#8220;On Lisp&#8221; as well:</p>
<p><a href="http://www.bookshelf.jp/texi/onlisp/onlisp_6.html#Common%20Lisp%20Evolves" rel="nofollow">http://www.bookshelf.jp/texi/onlisp/onlisp_6.html#Common%20Lisp%20Evolves</a></p>
<p>Personally, I do like the &#8220;if-not&#8221; functions. They may be from more &#8220;baroque&#8221; times, but they add a semantic richness that the &#8220;complement&#8221; predicate does not offer.</p>
<p>Thanks again for Macrology!</p>
				</div><!-- .comment-content -->

				<div class="reply"><a rel='nofollow' class='comment-reply-link' href='index5785.html?replytocom=41#respond' onclick='return addComment.moveForm( "div-comment-41", "41", "respond", "241" )' aria-label='Reply to Marco'>Reply</a></div>			</article><!-- .comment-body -->
</li><!-- #comment-## -->
		<li id="comment-48" class="comment odd alt thread-odd thread-alt depth-1 parent">
			<article id="div-comment-48" class="comment-body">
				<footer class="comment-meta">
					<div class="comment-author vcard">
						<img alt='' src='http://1.gravatar.com/avatar/a66b0fe70080e92224030cde6a828a81?s=64&amp;d=mm&amp;r=g' srcset='http://1.gravatar.com/avatar/a66b0fe70080e92224030cde6a828a81?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />						<b class="fn">Ruku</b> <span class="says">says:</span>					</div><!-- .comment-author -->

					<div class="comment-metadata">
						<a href="index.html#comment-48">
							<time datetime="2015-07-04T16:50:36+00:00">
								July 4, 2015 at 4:50 pm							</time>
						</a>
											</div><!-- .comment-metadata -->

									</footer><!-- .comment-meta -->

				<div class="comment-content">
					<p>I used to love writing macros like this. It does clarify some code snippets, but it comes at the cost of being harder to read for other programmers. This hurts when others have to read your code and look up your macro to understand exactly what you are doing. You are creating a personal dialect, which has disadvantages as well as advantages.</p>
<p>My personal way of dealing with this issue is to create a local function immediately around the mapping function with flet. It allows me to use a self-documenting name instead of lambda, and is completely standard lisp.</p>
<p>e.g.</p>
<pre class="brush: plain; title: ; notranslate" title="">
(flet ((meaningful-name (ele) big-complicated-form))
   (mapcar #'meaningful-name list))
</pre>
				</div><!-- .comment-content -->

				<div class="reply"><a rel='nofollow' class='comment-reply-link' href='indexa3a3.html?replytocom=48#respond' onclick='return addComment.moveForm( "div-comment-48", "48", "respond", "241" )' aria-label='Reply to Ruku'>Reply</a></div>			</article><!-- .comment-body -->
<ol class="children">
		<li id="comment-49" class="comment byuser comment-author-malisper bypostauthor even depth-2">
			<article id="div-comment-49" class="comment-body">
				<footer class="comment-meta">
					<div class="comment-author vcard">
						<img alt='' src='http://2.gravatar.com/avatar/2587b67431f9cc2a998a25e42e2d172d?s=64&amp;d=mm&amp;r=g' srcset='http://2.gravatar.com/avatar/2587b67431f9cc2a998a25e42e2d172d?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />						<b class="fn">malisper</b> <span class="says">says:</span>					</div><!-- .comment-author -->

					<div class="comment-metadata">
						<a href="index.html#comment-49">
							<time datetime="2015-07-04T20:04:27+00:00">
								July 4, 2015 at 8:04 pm							</time>
						</a>
											</div><!-- .comment-metadata -->

									</footer><!-- .comment-meta -->

				<div class="comment-content">
					<p>I think this is mostly a stylistic issue. If you are working with a team where everyone is familiar with them, I believe utility macros such as hofeach become a win all around. If you are working with programmers who are unfamiliar with the macros you are using (i.e. open source software) they can wind up being a net negative. Of course, with macros as simple as hofeach, it only takes several seconds to macroexpand it or read the source code to figure out what they are doing.</p>
				</div><!-- .comment-content -->

				<div class="reply"><a rel='nofollow' class='comment-reply-link' href='index21e4.html?replytocom=49#respond' onclick='return addComment.moveForm( "div-comment-49", "49", "respond", "241" )' aria-label='Reply to malisper'>Reply</a></div>			</article><!-- .comment-body -->
</li><!-- #comment-## -->
</ol><!-- .children -->
</li><!-- #comment-## -->
		<li id="comment-50" class="comment odd alt thread-even depth-1">
			<article id="div-comment-50" class="comment-body">
				<footer class="comment-meta">
					<div class="comment-author vcard">
						<img alt='' src='http://1.gravatar.com/avatar/a447cdf7e8485010f061613330e56f7a?s=64&amp;d=mm&amp;r=g' srcset='http://1.gravatar.com/avatar/a447cdf7e8485010f061613330e56f7a?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />						<b class="fn">Chris Dean</b> <span class="says">says:</span>					</div><!-- .comment-author -->

					<div class="comment-metadata">
						<a href="index.html#comment-50">
							<time datetime="2015-07-04T21:44:34+00:00">
								July 4, 2015 at 9:44 pm							</time>
						</a>
											</div><!-- .comment-metadata -->

									</footer><!-- .comment-meta -->

				<div class="comment-content">
					<p>This is great.  You should take a look at iter  <a href="https://common-lisp.net/project/iterate/" rel="nofollow">https://common-lisp.net/project/iterate/</a></p>
<p>It has a similar syntax:</p>
<pre class="brush: plain; title: ; notranslate" title="">
(iter (for x :in '(1 2 3))
         (collect (* x x))
</pre>
				</div><!-- .comment-content -->

				<div class="reply"><a rel='nofollow' class='comment-reply-link' href='indexed49.html?replytocom=50#respond' onclick='return addComment.moveForm( "div-comment-50", "50", "respond", "241" )' aria-label='Reply to Chris Dean'>Reply</a></div>			</article><!-- .comment-body -->
</li><!-- #comment-## -->
		<li id="comment-52" class="comment even thread-odd thread-alt depth-1">
			<article id="div-comment-52" class="comment-body">
				<footer class="comment-meta">
					<div class="comment-author vcard">
						<img alt='' src='http://2.gravatar.com/avatar/5583ee5cd9fc9109043328f4e0fdf7ae?s=64&amp;d=mm&amp;r=g' srcset='http://2.gravatar.com/avatar/5583ee5cd9fc9109043328f4e0fdf7ae?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />						<b class="fn"><a href='http://www.ccil.org/~cowan' rel='external nofollow' class='url'>John Cowan</a></b> <span class="says">says:</span>					</div><!-- .comment-author -->

					<div class="comment-metadata">
						<a href="index.html#comment-52">
							<time datetime="2015-07-05T11:24:48+00:00">
								July 5, 2015 at 11:24 am							</time>
						</a>
											</div><!-- .comment-metadata -->

									</footer><!-- .comment-meta -->

				<div class="comment-content">
					<p>An alternative approach would be to write a macro that expands to an -each macro, rather than being a general macro for any high-order function.  That way, you can give the -each macro any name you want.</p>
<p>In my view, syntax extension like this is a powerful tool that can easily be abused, but Ruku&#8217;s  general argument against them would also be an argument against creating named functions: you don&#8217;t know what they do until you look (at least at the documentation if not the code).</p>
<p>As for <code>remove-if-not</code>, it&#8217;s a good function with a bad name: a double negative, really.  In Scheme and Haskell it&#8217;s called <code>filter</code>:  <code>(filter evenp? '(1 2 3 4 5))</code> evaluates to <code>(2 4).</code>, which  is clear and clean.</p>
				</div><!-- .comment-content -->

				<div class="reply"><a rel='nofollow' class='comment-reply-link' href='indexcff9.html?replytocom=52#respond' onclick='return addComment.moveForm( "div-comment-52", "52", "respond", "241" )' aria-label='Reply to John Cowan'>Reply</a></div>			</article><!-- .comment-body -->
</li><!-- #comment-## -->
		<li id="comment-118" class="comment odd alt thread-even depth-1">
			<article id="div-comment-118" class="comment-body">
				<footer class="comment-meta">
					<div class="comment-author vcard">
						<img alt='' src='http://0.gravatar.com/avatar/3d5bd47f9edb40c4eee3e9bae3aa5f27?s=64&amp;d=mm&amp;r=g' srcset='http://0.gravatar.com/avatar/3d5bd47f9edb40c4eee3e9bae3aa5f27?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />						<b class="fn">Andrew Kirkpatrick</b> <span class="says">says:</span>					</div><!-- .comment-author -->

					<div class="comment-metadata">
						<a href="index.html#comment-118">
							<time datetime="2015-07-10T04:10:29+00:00">
								July 10, 2015 at 4:10 am							</time>
						</a>
											</div><!-- .comment-metadata -->

									</footer><!-- .comment-meta -->

				<div class="comment-content">
					<p>Improving on the macro I posted for mapeach, but of course, yet more complex. Nice posts, good discussion.</p>
<pre class="brush: plain; title: ; notranslate" title="">
(defmacro ahofeach (hof body &amp;rest lists)
  &quot;Succinct anaphoric HOF iteration.&quot;
  (flet ((wrap-functor-body (it-sym parameters body)
           `(lambda (,@parameters)
              (declare (ignorable ,@parameters))
              (symbol-macrolet ((,it-sym ,(first parameters)))
                ,@body))))
    (let* ((parameters (loop for i from 1 to (length lists)
                             collect (intern (format nil &quot;IT~A&quot; i))))
           (it-sym (intern &quot;IT&quot;))
           (functor (cond
                      ((and (listp body)
                            (or (and (= (length body) 2) ;; #'func, 'func
                                     (member (first body) '(function quote)))
                                (and (&gt;= (length body) 2) ;; (lambda nil …)
                                     (eq (first body) 'lambda))))
                       body)
                      ((and (listp body) (listp (first body))) ;; multiple forms
                       (wrap-functor-body it-sym parameters body))
                      (t ;; assume single form
                       (wrap-functor-body it-sym parameters (list body))))))
      `(funcall ,hof ,functor ,@lists))))

;; (let ((list '(1 2 3 4)))
;;   (list (ahofeach #'remove-if-not #'evenp list)
;;         (ahofeach 'remove-if-not 'evenp list)
;;         (ahofeach #'remove-if-not (evenp it) list)
;;         (ahofeach #'remove-if-not ((format t &quot;…~A&quot; it)
;;                                    (let ((x (multiple-value-list (floor it 2))))
;;                                      (zerop (second x))))
;;                   list)))
;; output =&gt; …1…2…3…4
;; value  =&gt; ((2 4) (2 4) (2 4) (2 4))
</pre>
				</div><!-- .comment-content -->

				<div class="reply"><a rel='nofollow' class='comment-reply-link' href='index4e2e.html?replytocom=118#respond' onclick='return addComment.moveForm( "div-comment-118", "118", "respond", "241" )' aria-label='Reply to Andrew Kirkpatrick'>Reply</a></div>			</article><!-- .comment-body -->
</li><!-- #comment-## -->
		<li id="comment-353" class="comment even thread-odd thread-alt depth-1 parent">
			<article id="div-comment-353" class="comment-body">
				<footer class="comment-meta">
					<div class="comment-author vcard">
						<img alt='' src='http://0.gravatar.com/avatar/3476d76a6b7589afaf013736c9652763?s=64&amp;d=mm&amp;r=g' srcset='http://0.gravatar.com/avatar/3476d76a6b7589afaf013736c9652763?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />						<b class="fn"><a href='http://www.weltraumschlangen.de/' rel='external nofollow' class='url'>Thomas Bartscher</a></b> <span class="says">says:</span>					</div><!-- .comment-author -->

					<div class="comment-metadata">
						<a href="index.html#comment-353">
							<time datetime="2015-08-21T15:09:06+00:00">
								August 21, 2015 at 3:09 pm							</time>
						</a>
											</div><!-- .comment-metadata -->

									</footer><!-- .comment-meta -->

				<div class="comment-content">
					<p>Why the funcall?</p>
<pre class="brush: plain; title: ; notranslate" title="">
(defmacro hofeach (hof var list &amp;body body)
  `(,hof (lambda (,var) ,@body) ,list))
</pre>
<p>This allows to skip the #&#8217; before the function name and lambda expressions can be used, too, as long as they&#8217;re not prefixed with #&#8217;.</p>
				</div><!-- .comment-content -->

				<div class="reply"><a rel='nofollow' class='comment-reply-link' href='index8190.html?replytocom=353#respond' onclick='return addComment.moveForm( "div-comment-353", "353", "respond", "241" )' aria-label='Reply to Thomas Bartscher'>Reply</a></div>			</article><!-- .comment-body -->
<ol class="children">
		<li id="comment-355" class="comment byuser comment-author-malisper bypostauthor odd alt depth-2 parent">
			<article id="div-comment-355" class="comment-body">
				<footer class="comment-meta">
					<div class="comment-author vcard">
						<img alt='' src='http://2.gravatar.com/avatar/2587b67431f9cc2a998a25e42e2d172d?s=64&amp;d=mm&amp;r=g' srcset='http://2.gravatar.com/avatar/2587b67431f9cc2a998a25e42e2d172d?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />						<b class="fn">malisper</b> <span class="says">says:</span>					</div><!-- .comment-author -->

					<div class="comment-metadata">
						<a href="index.html#comment-355">
							<time datetime="2015-08-21T20:38:53+00:00">
								August 21, 2015 at 8:38 pm							</time>
						</a>
											</div><!-- .comment-metadata -->

									</footer><!-- .comment-meta -->

				<div class="comment-content">
					<p>With macros that wind up calling a function, it is a style issue as whether to call it directly or to use <strong>funcall</strong>. I personally always use <strong>funcall</strong> because it allows for the possibility of an expression to determine which function to use. For example:</p>
<pre class="brush: plain; title: ; notranslate" title="">
(hofeach (if (...) 
             #'remove-if-not 
             #'remove-if)
  ...)
</pre>
				</div><!-- .comment-content -->

				<div class="reply"><a rel='nofollow' class='comment-reply-link' href='indexa141.html?replytocom=355#respond' onclick='return addComment.moveForm( "div-comment-355", "355", "respond", "241" )' aria-label='Reply to malisper'>Reply</a></div>			</article><!-- .comment-body -->
<ol class="children">
		<li id="comment-687" class="comment even depth-3 parent">
			<article id="div-comment-687" class="comment-body">
				<footer class="comment-meta">
					<div class="comment-author vcard">
						<img alt='' src='http://0.gravatar.com/avatar/3476d76a6b7589afaf013736c9652763?s=64&amp;d=mm&amp;r=g' srcset='http://0.gravatar.com/avatar/3476d76a6b7589afaf013736c9652763?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />						<b class="fn"><a href='http://www.weltraumschlangen.de/' rel='external nofollow' class='url'>Thomas Bartscher</a></b> <span class="says">says:</span>					</div><!-- .comment-author -->

					<div class="comment-metadata">
						<a href="index.html#comment-687">
							<time datetime="2015-09-24T19:16:03+00:00">
								September 24, 2015 at 7:16 pm							</time>
						</a>
											</div><!-- .comment-metadata -->

									</footer><!-- .comment-meta -->

				<div class="comment-content">
					<p>Ah, that makes sense.</p>
<p>In that case:</p>
<pre class="brush: plain; title: ; notranslate" title="">
(defmacro hofeach (hof var list &amp;body body)
  (if (symbolp hof)
      `(,hof (lambda (,var) ,@body) ,list)
      `(funcall ,hof (lambda (,var) ,@body) ,list)))
</pre>
<p>for convenience.</p>
				</div><!-- .comment-content -->

				<div class="reply"><a rel='nofollow' class='comment-reply-link' href='index4a9e.html?replytocom=687#respond' onclick='return addComment.moveForm( "div-comment-687", "687", "respond", "241" )' aria-label='Reply to Thomas Bartscher'>Reply</a></div>			</article><!-- .comment-body -->
<ol class="children">
		<li id="comment-740" class="comment byuser comment-author-malisper bypostauthor odd alt depth-4">
			<article id="div-comment-740" class="comment-body">
				<footer class="comment-meta">
					<div class="comment-author vcard">
						<img alt='' src='http://2.gravatar.com/avatar/2587b67431f9cc2a998a25e42e2d172d?s=64&amp;d=mm&amp;r=g' srcset='http://2.gravatar.com/avatar/2587b67431f9cc2a998a25e42e2d172d?s=128&amp;d=mm&amp;r=g 2x' class='avatar avatar-64 photo' height='64' width='64' />						<b class="fn">malisper</b> <span class="says">says:</span>					</div><!-- .comment-author -->

					<div class="comment-metadata">
						<a href="index.html#comment-740">
							<time datetime="2015-09-27T09:52:29+00:00">
								September 27, 2015 at 9:52 am							</time>
						</a>
											</div><!-- .comment-metadata -->

									</footer><!-- .comment-meta -->

				<div class="comment-content">
					<p>That works except in cases where you want to pass in the value of a variable. It implicitly assumes that a symbol corresponds to the function of the same name and not to the variable.</p>
				</div><!-- .comment-content -->

				<div class="reply"><a rel='nofollow' class='comment-reply-link' href='indexac84.html?replytocom=740#respond' onclick='return addComment.moveForm( "div-comment-740", "740", "respond", "241" )' aria-label='Reply to malisper'>Reply</a></div>			</article><!-- .comment-body -->
</li><!-- #comment-## -->
</ol><!-- .children -->
</li><!-- #comment-## -->
</ol><!-- .children -->
</li><!-- #comment-## -->
</ol><!-- .children -->
</li><!-- #comment-## -->
		</ol><!-- .comment-list -->

		
	
	
					<div id="respond" class="comment-respond">
			<h3 id="reply-title" class="comment-reply-title">Leave a Reply to <a href="#comment-50">Chris Dean</a> <small><a rel="nofollow" id="cancel-comment-reply-link" title="Cancel reply" href="index.html#respond"><span class="screen-reader-text">Cancel reply</span></a></small></h3>				<form action="http://malisper.me/wp-comments-post.php" method="post" id="commentform" class="comment-form" novalidate>
					<p class="comment-notes"><span id="email-notes">Your email address will not be published.</span> Required fields are marked <span class="required">*</span></p><p class="comment-form-comment"><label for="comment">Comment</label> <textarea id="comment" name="comment" cols="45" rows="8" maxlength="65525" aria-required="true" required="required"></textarea></p><p class="comment-form-author"><label for="author">Name <span class="required">*</span></label> <input id="author" name="author" type="text" value="" size="30" maxlength="245" aria-required='true' required='required' /></p>
<p class="comment-form-email"><label for="email">Email <span class="required">*</span></label> <input id="email" name="email" type="email" value="" size="30" maxlength="100" aria-describedby="email-notes" aria-required='true' required='required' /></p>
<p class="comment-form-url"><label for="url">Website</label> <input id="url" name="url" type="url" value="" size="30" maxlength="200" /></p>
<p class="form-submit"><input name="submit" type="submit" id="submit" class="submit" value="Post Comment" /> <input type='hidden' name='comment_post_ID' value='241' id='comment_post_ID' />
<input type='hidden' name='comment_parent' id='comment_parent' value='50' />
</p><p style="display: none;"><input type="hidden" id="akismet_comment_nonce" name="akismet_comment_nonce" value="518d59227c" /></p><p style="display: none;"><input type="hidden" id="ak_js" name="ak_js" value="145"/></p>				</form>
					</div><!-- #respond -->
		
</div><!-- #comments -->
		
		</main><!-- #main -->
	</div><!-- #primary -->

	</div><!-- #content -->

	<footer id="colophon" class="site-footer" role="contentinfo">
		<div class="site-info">
			<a href="http://wordpress.org/">Proudly powered by WordPress</a>
			<span class="sep"> ~ </span>
			Theme: Scrawl by <a href="https://wordpress.com/themes/" rel="designer">WordPress.com</a>.		</div><!-- .site-info -->
	</footer><!-- #colophon -->
</div><!-- #page -->

<script type='text/javascript' src='../../../../wp-content/plugins/akismet/_inc/form2d73.html?ver=3.1.11'></script>
<script type='text/javascript' src='../../../../wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shCore09b1.js?ver=3.0.9b'></script>
<script type='text/javascript' src='../../../../wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushPlain09b1.js?ver=3.0.9b'></script>
<script type='text/javascript'>
	(function(){
		var corecss = document.createElement('link');
		var themecss = document.createElement('link');
		var corecssurl = "../../../../wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shCore09b1.css?ver=3.0.9b";
		if ( corecss.setAttribute ) {
				corecss.setAttribute( "rel", "stylesheet" );
				corecss.setAttribute( "type", "text/css" );
				corecss.setAttribute( "href", corecssurl );
		} else {
				corecss.rel = "stylesheet";
				corecss.href = corecssurl;
		}
		document.getElementsByTagName("head")[0].insertBefore( corecss, document.getElementById("syntaxhighlighteranchor") );
		var themecssurl = "../../../../wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shThemeEclipse09b1.css?ver=3.0.9b";
		if ( themecss.setAttribute ) {
				themecss.setAttribute( "rel", "stylesheet" );
				themecss.setAttribute( "type", "text/css" );
				themecss.setAttribute( "href", themecssurl );
		} else {
				themecss.rel = "stylesheet";
				themecss.href = themecssurl;
		}
		//document.getElementById("syntaxhighlighteranchor").appendChild(themecss);
		document.getElementsByTagName("head")[0].insertBefore( themecss, document.getElementById("syntaxhighlighteranchor") );
	})();
	SyntaxHighlighter.config.strings.expandSource = '+ expand source';
	SyntaxHighlighter.config.strings.help = '?';
	SyntaxHighlighter.config.strings.alert = 'SyntaxHighlighter\n\n';
	SyntaxHighlighter.config.strings.noBrush = 'Can\'t find brush for: ';
	SyntaxHighlighter.config.strings.brushNotHtmlScript = 'Brush wasn\'t configured for html-script option: ';
	SyntaxHighlighter.defaults['pad-line-numbers'] = false;
	SyntaxHighlighter.defaults['toolbar'] = false;
	SyntaxHighlighter.all();
</script>
<link rel='stylesheet' id='qtipstyles-css'  href='../../../../wp-content/plugins/easy-footnotes/assets/qtip/jquery.qtip.min167b.css?ver=4.6' type='text/css' media='' />
<link rel='stylesheet' id='easyfootnotescss-css'  href='../../../../wp-content/plugins/easy-footnotes/assets/easy-footnotes167b.css?ver=4.6' type='text/css' media='' />
<link rel='stylesheet' id='dashicons-css'  href='../../../../wp-includes/css/dashicons.min167b.css?ver=4.6' type='text/css' media='all' />
<script type='text/javascript' src='../../../../wp-content/themes/scrawl-wpcom/js/scrawld56c.js?ver=20150309'></script>
<script type='text/javascript' src='../../../../wp-content/themes/scrawl-wpcom/js/skip-link-focus-fix08e0.js?ver=20130115'></script>
<script type='text/javascript' src='../../../../wp-includes/js/comment-reply.min167b.js?ver=4.6'></script>
<script type='text/javascript' src='../../../../wp-includes/js/wp-embed.min167b.js?ver=4.6'></script>
<script type='text/javascript' src='../../../../wp-includes/js/imagesloaded.min55a0.js?ver=3.2.0'></script>
<script type='text/javascript' src='../../../../wp-content/plugins/easy-footnotes/assets/qtip/jquery.qtip.min167b.js?ver=4.6'></script>
<script type='text/javascript' src='../../../../wp-content/plugins/easy-footnotes/assets/qtip/jquery.qtipcall167b.js?ver=4.6'></script>

</body>

<!-- Mirrored from malisper.me/2015/06/17/hofeach/?replytocom=50 by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 01 Sep 2016 17:47:30 GMT -->
</html>
<!-- Dynamic page generated in 0.109 seconds. -->
<!-- Cached page generated by WP-Super-Cache on 2016-09-01 12:24:10 -->
