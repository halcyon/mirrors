<!DOCTYPE html>
<html>
  
<!-- Mirrored from beautifulracket.com/jsonic-2/toolbar-buttons.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 16 Mar 2017 05:47:20 GMT -->
<head>
    <meta charset="UTF-8">
    <title>Beautiful Racket: Level up: jsonic revisited</title>
    <link rel="stylesheet" type="text/css" media="all" href="../styles.css"/>
    <script type="text/javascript" src="../functions.js"></script>
    <script type="text/javascript" src="../clipboard.min.js"></script>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-74684045-1', 'auto');
      ga('send', 'pageview');
    </script>
  </head>
<body>
<div id="alert">Thank you for your comment</div>
    <div id="doc"><h3 class="dept" anchorize="false"><a href="../index.html">Beau­ti­ful Racket</a> / <a href="../index.html#tutorials">tuto­ri­als</a></h3><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;level-up-jsonic-revisited&quot;)"></div><h1 anchor="level-up-jsonic-revisited" id="level-up-jsonic-revisited" hyphens="none">Level up: <span class="my-code" decode="exclude">jsonic</span> revisited</h1></div><ul class="siblinks"><li><a href="intro.html">1&emsp;intro</a></li><li><a href="setup.html">2&emsp;setup</a></li><li><a href="contracts.html">3&emsp;con­tracts</a></li><li><a href="unit-tests.html">4&emsp;unit tests</a></li><li><a href="source-locations.html">5&emsp;source loca­tions</a></li><li><a href="drracket-integration.html">6&emsp;drracket inte­gra­tion</a></li><li><a href="syntax-coloring.html">7&emsp;syn­tax col­or­ing</a></li><li><a href="indenting.html">8&emsp;indent­ing</a></li><li><a class="here" href="toolbar-buttons.html">9&emsp;tool­bar but­tons</a></li><li><a href="recap.html">10&emsp;recap</a></li><li><a href="source-listing.html">11&emsp;source list­ing</a></li></ul><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_pyosY&quot;)"></div><p id="a_pyosY">At the top of every DrRacket edi­tor win­dow is a tool­bar with but­tons:</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_Vldpk&quot;)"></div><div id="a_Vldpk" style="text-align:center;padding:0.5rem;"><img src="drracket-buttons-before.gif" style="width:80%;border:1px solid #ccc"/></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_UUhrX&quot;)"></div><p id="a_UUhrX">As with <a href="syntax-coloring.html">syn­tax col­or­ing</a> and <a href="indenting.html">indent­ing</a>, these but­tons can be cus­tomized for any Racket-imple­mented lan­guage.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_jVUBW&quot;)"></div><p id="a_jVUBW">For <span class="my-code" decode="exclude">jsonic</span>, a use­ful but­ton might be one that inserts our expres­sion delim­iters <span class="my-code" decode="exclude">@$ ··· $@</span> and auto­mat­i­cally moves the cur­sor between them.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_QBYHy&quot;)"></div><p id="a_QBYHy">So let’s add that.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;button-prep&quot;)"></div><h3 anchor="button-prep" class="subhead" id="button-prep"><a href="#button-prep">But­ton prep</a></h3></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_4cH5W&quot;)"></div><p id="a_4cH5W">We already set up our <span class="my-code" decode="exclude">"jsonic/main.rkt"</span> file to work with tool­bar but­tons. Let’s remind our­selves where we left it:</p></div><div class="filebox" anchorize="false"><div class="filename" anchorize="false" decode="exclude">jsonic/main.rkt</div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_9bLf4&quot;)"></div><div class="highlight-container" id="a_9bLf4"><div id="code_43" form="false" decode="exclude" style="font-size:0;width:0;height:0">#lang br/quicklang<br/>(module reader br<br/>  (require "reader.rkt")<br/>  (provide read-syntax get-info)<br/>  (define (get-info port mod line col pos)<br/>    (define (handle-query key default)<br/>      (case key<br/>        [(color-lexer)<br/>         (dynamic-require 'jsonic/colorer 'color-jsonic)]<br/>        [(drracket:indentation)<br/>         (dynamic-require 'jsonic/indenter 'indent-jsonic)]<br/>        [(drracket:toolbar-buttons)<br/>         (dynamic-require 'jsonic/buttons 'button-list)]<br/>        [else default]))<br/>    handle-query))</div><div class="highlight" form="false" id="a_P09J4"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class="code"><div class="source"><pre><span class="kn">#lang </span><span class="nn">br/quicklang</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/module.html#(form._((quote._~23~25kernel)._module))" class="docs" hyphens="none">module</a></span> <span class="n">reader</span> <span class="n">br</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._require))" class="docs" hyphens="none">require</a></span> <span class="s2">"reader.rkt"</span><span class="p">)</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._provide))" class="docs" hyphens="none">provide</a></span> <span class="nb"><a href="http://docs.racket-lang.org/reference/Reading.html#(def._((quote._~23~25kernel)._read-syntax))" class="docs" hyphens="none">read-syntax</a></span> <span class="n">get-info</span><span class="p">)</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="p">(</span><span class="n">get-info</span> <span class="n">port</span> <span class="n">mod</span> <span class="nb"><a href="http://docs.racket-lang.org/br/index.html#(def._((lib._br/indent..rkt)._line))" class="docs" hyphens="none">line</a></span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(def._((lib._br-parser-tools/lex..rkt)._position-col))" class="docs" hyphens="none">col</a></span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(def._((lib._br-parser-tools/lex..rkt)._position-offset))" class="docs" hyphens="none">pos</a></span><span class="p">)</span>
    <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="p">(</span><span class="n">handle-query</span> <span class="n">key</span> <span class="n">default</span><span class="p">)</span>
      <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/case.html#(form._((lib._racket/private/more-scheme..rkt)._case))" class="docs" hyphens="none">case</a></span> <span class="n">key</span>
        <span class="p">[(</span><span class="n">color-lexer</span><span class="p">)</span>
         <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/Module_Names_and_Loading.html#(def._((quote._~23~25kernel)._dynamic-require))" class="docs" hyphens="none">dynamic-require</a></span> <span class="o">&#39;</span><span class="ss">jsonic/colorer</span> <span class="o">&#39;</span><span class="ss">color-jsonic</span><span class="p">)]</span>
        <span class="p">[(</span><span class="n">drracket:indentation</span><span class="p">)</span>
         <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/Module_Names_and_Loading.html#(def._((quote._~23~25kernel)._dynamic-require))" class="docs" hyphens="none">dynamic-require</a></span> <span class="o">&#39;</span><span class="ss">jsonic/indenter</span> <span class="o">&#39;</span><span class="ss">indent-jsonic</span><span class="p">)]</span>
        <span class="p">[(</span><span class="n">drracket:toolbar-buttons</span><span class="p">)</span>
         <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/Module_Names_and_Loading.html#(def._((quote._~23~25kernel)._dynamic-require))" class="docs" hyphens="none">dynamic-require</a></span> <span class="o">&#39;</span><span class="ss">jsonic/buttons</span> <span class="o">&#39;</span><span class="ss">button-list</span><span class="p">)]</span>
        <span class="p">[</span><span class="nb"><a href="http://docs.racket-lang.org/reference/if.html#(form._((lib._racket/private/letstx-scheme..rkt)._else))" class="docs" hyphens="none">else</a></span> <span class="n">default</span><span class="p">]))</span>
    <span class="n">handle-query</span><span class="p">))</span>
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpk1" data-clipboard-target="#code_43" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_ttay6&quot;)"></div><p id="a_ttay6">When DrRacket notices that <span class="my-code" decode="exclude">jsonic</span> is being used in a code edi­tor, it will call our <span class="my-code" decode="exclude">get-info</span> func­tion with a <span class="my-code" decode="exclude">drracket:toolbar-buttons</span> query. We’ll return a list of but­tons that DrRacket will install in the tool­bar. Sim­ple.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;making-a-button&quot;)"></div><h3 anchor="making-a-button" class="subhead" id="making-a-button"><a href="#making-a-button">Mak­ing a but­ton</a></h3></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_phwur&quot;)"></div><p id="a_phwur">As <span class="my-code" decode="exclude">"jsonic/main.rkt"</span> indi­cates, our list of but­tons will be called <span class="my-code" decode="exclude">button-list</span> and live in a mod­ule called <span class="my-code" decode="exclude">"jsonic/buttons.rkt"</span>. So let’s start that file now:</p></div><div class="filebox" anchorize="false"><div class="filename" anchorize="false" decode="exclude">jsonic/buttons.rkt</div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_Vgnvd&quot;)"></div><div class="highlight-container" id="a_Vgnvd"><div id="code_44" form="false" decode="exclude" style="font-size:0;width:0;height:0">#lang br<br/><br/>(define our-jsonic-button<br/>  (list ···))<br/><br/>(provide button-list)<br/>(define button-list (list our-jsonic-button))</div><div class="highlight" form="false" id="a_NgOqH"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="source"><pre><span class="kn">#lang </span><span class="nn">br</span>

<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="n">our-jsonic-button</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._list))" class="docs" hyphens="none">list</a></span> <span class="n">···</span><span class="p">))</span>

<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._provide))" class="docs" hyphens="none">provide</a></span> <span class="n">button-list</span><span class="p">)</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="n">button-list</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._list))" class="docs" hyphens="none">list</a></span> <span class="n">our-jsonic-button</span><span class="p">))</span>
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpk2" data-clipboard-target="#code_44" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_HbEf7&quot;)"></div><p id="a_HbEf7">Our <span class="my-code" decode="exclude">button-list</span> is, of course, a list. Each but­ton within this list is itself a list of four val­ues:</p></div><ol><li><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_jzj3s&quot;)"></div><p id="a_jzj3s">A string rep­re­sent­ing the but­ton label shown in the tool­bar.</p></div></li><li><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_jcNmA&quot;)"></div><p id="a_jcNmA">A 16-pixel-high bitmap rep­re­sent­ing the icon that goes next to the label.</p></div></li><li><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_GXkoW&quot;)"></div><p id="a_GXkoW">A func­tion that’s called when the but­ton is pressed. This func­tion receives a sin­gle argu­ment: a ref­er­ence to the edi­tor win­dow where the but­ton was pressed.</p></div></li><li><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_v4aC5&quot;)"></div><p id="a_v4aC5">A num­ber that deter­mines the order­ing of the but­ton on the tool­bar. If we don’t care about this, we can set it to <span class="my-code" decode="exclude">#f</span>.</p></div></li></ol><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_cfFRv&quot;)"></div><p id="a_cfFRv">We’re only going to have one but­ton called <span class="my-code" decode="exclude">our-jsonic-button</span>, but we could have more.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_j5Jmc&quot;)"></div><p id="a_j5Jmc">Let’s use <em>Insert expres­sion</em> as the but­ton label, and <span class="my-code" decode="exclude">#f</span> as our order­ing num­ber. That takes care of two out of four fields:</p></div><div class="filebox" anchorize="false"><div class="filename" anchorize="false" decode="exclude">jsonic/buttons.rkt</div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_2uhlv&quot;)"></div><div class="highlight-container" id="a_2uhlv"><div id="code_45" form="false" decode="exclude" style="font-size:0;width:0;height:0">#lang br<br/><br/>(define our-jsonic-button<br/>  (list<br/>   "Insert expression"<br/>   ···<br/>   #f))<br/><br/>(provide button-list)<br/>(define button-list (list our-jsonic-button))</div><div class="highlight" form="false" id="a_Aao3k"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="source"><pre><span class="kn">#lang </span><span class="nn">br</span>

<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="n">our-jsonic-button</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._list))" class="docs" hyphens="none">list</a></span>
<span class="hll">   <span class="s2">"Insert expression"</span>
</span>   <span class="n">···</span>
<span class="hll">   <span class="no">#f</span><span class="p">))</span>
</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._provide))" class="docs" hyphens="none">provide</a></span> <span class="n">button-list</span><span class="p">)</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="n">button-list</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._list))" class="docs" hyphens="none">list</a></span> <span class="n">our-jsonic-button</span><span class="p">))</span>
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpk3" data-clipboard-target="#code_45" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_QLjjW&quot;)"></div><p id="a_QLjjW">For our bitmap, in honor of the iconic <a class=" ext" href="https://www.wikiart.org/en/kazimir-malevich/white-square-1917">Kaz­imir Male­vich</a>, we’ll use a white square. We can quickly draw this square by import­ing <a href="http://docs.racket-lang.org/draw/"><span class="my-code" decode="exclude">racket/draw</span></a> and call­ing <a href="http://docs.racket-lang.org/reference/objcreation.html#(def._((lib._racket/private/class-internal..rkt)._make-object))" class="docs" hyphens="none">make-object</a> <a href="http://docs.racket-lang.org/draw/bitmap_.html##f" class="docs" hyphens="none">bitmap%</a>:</p></div><div class="filebox" anchorize="false"><div class="filename" anchorize="false" decode="exclude">jsonic/buttons.rkt</div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_eTPww&quot;)"></div><div class="highlight-container" id="a_eTPww"><div id="code_46" form="false" decode="exclude" style="font-size:0;width:0;height:0">#lang br<br/>(require racket/draw)<br/><br/>(define our-jsonic-button<br/>  (list<br/>   "Insert expression"<br/>   (make-object bitmap% 16 16) ; a 16 x 16 white square<br/>   ···<br/>   #f))<br/><br/>(provide button-list)<br/>(define button-list (list our-jsonic-button))</div><div class="highlight" form="false" id="a_REIIh"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="source"><pre><span class="kn">#lang </span><span class="nn">br</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._require))" class="docs" hyphens="none">require</a></span> <span class="n">racket/draw</span><span class="p">)</span>

<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="n">our-jsonic-button</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._list))" class="docs" hyphens="none">list</a></span>
   <span class="s2">"Insert expression"</span>
<span class="hll">   <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/objcreation.html#(def._((lib._racket/private/class-internal..rkt)._make-object))" class="docs" hyphens="none">make-object</a></span> <span class="nb"><a href="http://docs.racket-lang.org/draw/bitmap_.html##f" class="docs" hyphens="none">bitmap%</a></span> <span class="mi">16</span> <span class="mi">16</span><span class="p">)</span> <span class="c1">; a 16 x 16 white square</span>
</span>   <span class="n">···</span>
   <span class="no">#f</span><span class="p">))</span>

<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._provide))" class="docs" hyphens="none">provide</a></span> <span class="n">button-list</span><span class="p">)</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="n">button-list</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._list))" class="docs" hyphens="none">list</a></span> <span class="n">our-jsonic-button</span><span class="p">))</span>
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpk4" data-clipboard-target="#code_46" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_2uLf7&quot;)"></div><p id="a_2uLf7">But the most impor­tant part of the but­ton is the but­ton-press func­tion. We’ll <a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a> a new func­tion called <span class="my-code" decode="exclude">button-func</span> and add it as the third value in our but­ton:</p></div><div class="filebox" anchorize="false"><div class="filename" anchorize="false" decode="exclude">jsonic/buttons.rkt</div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_t5WrW&quot;)"></div><div class="highlight-container" id="a_t5WrW"><div id="code_47" form="false" decode="exclude" style="font-size:0;width:0;height:0">#lang br<br/>(require racket/draw)<br/><br/>(define (button-func drr-window)<br/>  (define expr-string "@$  $@")<br/>  (define editor (send drr-window get-definitions-text))<br/>  (send editor insert expr-string)<br/>  (define pos (send editor get-start-position))<br/>  (send editor set-position (- pos 3)))<br/><br/>(define our-jsonic-button<br/>  (list<br/>   "Insert expression"<br/>   (make-object bitmap% 16 16)<br/>   button-func<br/>   #f))<br/><br/>(provide button-list)<br/>(define button-list (list our-jsonic-button))         <br/><br/>
</div><div class="highlight" form="false" id="a_lDvxZ"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</pre></div></td><td class="code"><div class="source"><pre><span class="kn">#lang </span><span class="nn">br</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._require))" class="docs" hyphens="none">require</a></span> <span class="n">racket/draw</span><span class="p">)</span>

<span class="hll"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="p">(</span><span class="n">button-func</span> <span class="n">drr-window</span><span class="p">)</span>
</span><span class="hll">  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="n">expr-string</span> <span class="s2">"@$  $@"</span><span class="p">)</span>
</span><span class="hll">  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="n">editor</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/ivaraccess.html#(form._((lib._racket/private/class-internal..rkt)._send))" class="docs" hyphens="none">send</a></span> <span class="n">drr-window</span> <span class="n">get-definitions-text</span><span class="p">))</span>
</span><span class="hll">  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/ivaraccess.html#(form._((lib._racket/private/class-internal..rkt)._send))" class="docs" hyphens="none">send</a></span> <span class="n">editor</span> <span class="n">insert</span> <span class="n">expr-string</span><span class="p">)</span>
</span><span class="hll">  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(def._((lib._br-parser-tools/lex..rkt)._position-offset))" class="docs" hyphens="none">pos</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/ivaraccess.html#(form._((lib._racket/private/class-internal..rkt)._send))" class="docs" hyphens="none">send</a></span> <span class="n">editor</span> <span class="n">get-start-position</span><span class="p">))</span>
</span><span class="hll">  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/ivaraccess.html#(form._((lib._racket/private/class-internal..rkt)._send))" class="docs" hyphens="none">send</a></span> <span class="n">editor</span> <span class="n">set-position</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._-))" class="docs" hyphens="none">-</a></span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(def._((lib._br-parser-tools/lex..rkt)._position-offset))" class="docs" hyphens="none">pos</a></span> <span class="mi">3</span><span class="p">)))</span>
</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="n">our-jsonic-button</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._list))" class="docs" hyphens="none">list</a></span>
   <span class="s2">"Insert expression"</span>
   <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/objcreation.html#(def._((lib._racket/private/class-internal..rkt)._make-object))" class="docs" hyphens="none">make-object</a></span> <span class="nb"><a href="http://docs.racket-lang.org/draw/bitmap_.html##f" class="docs" hyphens="none">bitmap%</a></span> <span class="mi">16</span> <span class="mi">16</span><span class="p">)</span>
<span class="hll">   <span class="n">button-func</span>
</span>   <span class="no">#f</span><span class="p">))</span>

<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._provide))" class="docs" hyphens="none">provide</a></span> <span class="n">button-list</span><span class="p">)</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="n">button-list</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._list))" class="docs" hyphens="none">list</a></span> <span class="n">our-jsonic-button</span><span class="p">))</span>         
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpk5" data-clipboard-target="#code_47" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_fqRpS&quot;)"></div><p id="a_fqRpS">Let’s walk through the lines of this func­tion.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_xZzDe&quot;)"></div><p id="a_xZzDe">Our sin­gle argu­ment <span class="my-code" decode="exclude">drr-window</span> is a ref­er­ence to the cur­rent DrRacket win­dow. (We can skip writ­ing a con­tract for this func­tion because it’ll only be used by DrRacket, which can be trusted to pass the cor­rect kind of argu­ment.)</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_kqLXu&quot;)"></div><p id="a_kqLXu">The <span class="my-code" decode="exclude">drr-window</span> object is an instance of the <a href="http://docs.racket-lang.org/gui/frame_.html##f" class="docs" hyphens="none">frame%</a> class in Racket’s GUI library (sim­i­lar to how the text box <a href="indenting.html">in the inden­ter</a> was an instance of the <a href="http://docs.racket-lang.org/gui/text_.html##f" class="docs" hyphens="none">text%</a> class). Because DrRacket passes every but­ton a ref­er­ence to the whole win­dow, a but­ton can do pretty much any­thing to the win­dow: change the text, draw on the screen, and so on. But that also means that writ­ing but­ton func­tions requires some famil­iar­ity with the GUI library.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_AKLT7&quot;)"></div><p id="a_AKLT7">To avoid that detour, we’ll use a lit­tle extra hand­wav­ing as we walk through the code above, which inserts our expres­sion delim­iters sep­a­rated by two spaces <span class="my-code" decode="exclude">@$  $@</span>, and then moves the inser­tion point into the mid­dle.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_MSLZc&quot;)"></div><p id="a_MSLZc">To use meth­ods stored in Racket objects, we <a href="http://docs.racket-lang.org/reference/ivaraccess.html#(form._((lib._racket/private/class-internal..rkt)._send))" class="docs" hyphens="none">send</a> an object a method name and any nec­es­sary argu­ments. To start, we grab a ref­er­ence to the upper pane of the win­dow con­tain­ing the source with <span class="my-code" decode="exclude">get-definitions-text</span>, and store it in <span class="my-code" decode="exclude">editor</span>. We then <span class="my-code" decode="exclude">insert</span> our <span class="my-code" decode="exclude">expr-string</span> in the <span class="my-code" decode="exclude">editor</span>. By default, it will go wher­ever the inser­tion point is posi­tioned, just the same as if we typed it.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_VgxwH&quot;)"></div><p id="a_VgxwH">After the inser­tion, the inser­tion point will end up at the end of the <span class="my-code" decode="exclude">expr-string</span>. But we want it to be in the mid­dle of the inserted text. So first, we <span class="my-code" decode="exclude">get-start-position</span> to find out where the inser­tion point is. Then we sub­tract <span class="my-code" decode="exclude">3</span> (because our <span class="my-code" decode="exclude">expr-string</span> is <span class="my-code" decode="exclude">6</span> char­ac­ters long) and pass this adjusted posi­tion to <span class="my-code" decode="exclude">set-position</span>, which will move the inser­tion point to the right place.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_eHpvg&quot;)"></div><p id="a_eHpvg">It’s not a mir­a­cle of soft­ware engi­neer­ing. But it will work.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;testing-our-button&quot;)"></div><h3 anchor="testing-our-button" class="subhead" id="testing-our-button"><a href="#testing-our-button">Test­ing our but­ton</a></h3></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_0LrNo&quot;)"></div><p id="a_0LrNo">At this point it’s impor­tant to <strong>select the menu item <em>Racket → Reload #lang Exten­sions</em></strong> to try out the changes. While this usu­ally isn’t nec­es­sary when work­ing on a lan­guage, DrRacket caches the results of the <span class="my-code" decode="exclude">get-info</span> func­tion the first time it invokes a lan­guage. So if we’ve already been fid­dling with <span class="my-code" decode="exclude">#lang jsonic</span>, we won’t see the new but­ton until we reload the lan­guage, which forces a fresh call to <span class="my-code" decode="exclude">get-info</span>.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_9z229&quot;)"></div><p id="a_9z229">Once we do, our new but­ton will show up on the left edge of the tool­bar:</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_Vldpk6&quot;)"></div><div id="a_Vldpk6" style="text-align:center;padding:0.5rem;padding-bottom:1rem"><img style="width:90%;border:1px solid #ccc" src="button-01.gif"/></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_aM8Bo&quot;)"></div><p id="a_aM8Bo">Then, if we select some code in the win­dow:</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_Vldpk7&quot;)"></div><div id="a_Vldpk7" style="text-align:center;padding:0.5rem;padding-bottom:1rem"><img style="width:90%;border:1px solid #ccc" src="button-02.gif"/></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_wJUaC&quot;)"></div><p id="a_wJUaC">And click the <em>Insert expres­sion</em> but­ton:</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_Vldpk8&quot;)"></div><div id="a_Vldpk8" style="text-align:center;padding:0.5rem;padding-bottom:1rem"><img style="width:90%;border:1px solid #ccc" src="button-03.gif"/></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_X8Mid&quot;)"></div><p id="a_X8Mid">The selected code will be replaced with our expres­sion delim­iters, and the inser­tion point moved within:</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_Vldpk9&quot;)"></div><div id="a_Vldpk9" style="text-align:center;padding:0.5rem;padding-bottom:1rem"><img style="width:90%;border:1px solid #ccc" src="button-04.gif"/></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_koIDd&quot;)"></div><p id="a_koIDd">As with <a href="syntax-coloring.html">syn­tax col­or­ing</a> and <a href="indenting.html">indent­ing</a>, DrRacket tool­bar but­tons are com­pletely optional. They don’t affect any­thing about how our lan­guage works. We are allowed to ignore them entirely. But they’re a nice way of inte­grat­ing our lan­guage with DrRacket.</p></div><div anchorize="false" style="height:2em"></div><ul class="siblinks"><li><a href="intro.html">1&emsp;intro</a></li><li><a href="setup.html">2&emsp;setup</a></li><li><a href="contracts.html">3&emsp;con­tracts</a></li><li><a href="unit-tests.html">4&emsp;unit tests</a></li><li><a href="source-locations.html">5&emsp;source loca­tions</a></li><li><a href="drracket-integration.html">6&emsp;drracket inte­gra­tion</a></li><li><a href="syntax-coloring.html">7&emsp;syn­tax col­or­ing</a></li><li><a href="indenting.html">8&emsp;indent­ing</a></li><li><a class="here" href="toolbar-buttons.html">9&emsp;tool­bar but­tons</a></li><li><a href="recap.html">10&emsp;recap</a></li><li><a href="source-listing.html">11&emsp;source list­ing</a></li></ul></div>
    <a class="nav-left" href="indenting.html">← prev</a>
    <a class="nav-right" href="recap.html">next →</a>




</body>

<script type="text/javascript">



function show_all_forms() {
 var elems = document.getElementsByClassName('has_form');
 for (var i = 0 ; i < elems.length ; i++) {
  toggle_form(elems[i].id);
 }
}

// for debugging forms only: uncomment next line
// show_all_forms();

// sets up copy-to-clipboard buttons in code boxes
var clipboard = new Clipboard('.copy-button');
clipboard.on('success', function(e) {console.log(e);});
clipboard.on('error', function(e) {console.log(e);});
</script>