<!DOCTYPE html>
<html>
  
<!-- Mirrored from beautifulracket.com/jsonic-2/syntax-coloring.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 16 Mar 2017 05:47:20 GMT -->
<head>
    <meta charset="UTF-8">
    <title>Beautiful Racket: Level up: jsonic revisited</title>
    <link rel="stylesheet" type="text/css" media="all" href="../styles.css"/>
    <script type="text/javascript" src="../functions.js"></script>
    <script type="text/javascript" src="../clipboard.min.js"></script>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-74684045-1', 'auto');
      ga('send', 'pageview');
    </script>
  </head>
<body>
<div id="alert">Thank you for your comment</div>
    <div id="doc"><h3 class="dept" anchorize="false"><a href="../index.html">Beau­ti­ful Racket</a> / <a href="../index.html#tutorials">tuto­ri­als</a></h3><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;level-up-jsonic-revisited&quot;)"></div><h1 anchor="level-up-jsonic-revisited" id="level-up-jsonic-revisited" hyphens="none">Level up: <span class="my-code" decode="exclude">jsonic</span> revisited</h1></div><ul class="siblinks"><li><a href="intro.html">1&emsp;intro</a></li><li><a href="setup.html">2&emsp;setup</a></li><li><a href="contracts.html">3&emsp;con­tracts</a></li><li><a href="unit-tests.html">4&emsp;unit tests</a></li><li><a href="source-locations.html">5&emsp;source loca­tions</a></li><li><a href="drracket-integration.html">6&emsp;drracket inte­gra­tion</a></li><li><a class="here" href="syntax-coloring.html">7&emsp;syn­tax col­or­ing</a></li><li><a href="indenting.html">8&emsp;indent­ing</a></li><li><a href="toolbar-buttons.html">9&emsp;tool­bar but­tons</a></li><li><a href="recap.html">10&emsp;recap</a></li><li><a href="source-listing.html">11&emsp;source list­ing</a></li></ul><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_Fx3Xb&quot;)"></div><p id="a_Fx3Xb">First, when we say “syn­tax col­or­ing” it has noth­ing to do with syn­tax in the sense of a <a class="glossary" href="../appendix/glossary.html#syntax-object"><span class="glossary-link-text">syn­tax object</span></a> or <a class="glossary" href="../appendix/glossary.html#syntax-pattern"><span class="glossary-link-text">syn­tax pat­tern</span></a>. In this case, “syn­tax” just refers to the dis­played source code. “Source-code col­or­ing” would prob­a­bly have been the more accu­rate term, but “syn­tax col­or­ing” is what Racket calls it.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_8j0cf&quot;)"></div><p id="a_8j0cf">Our DrRacket syn­tax col­orer will work much like our <a href="../jsonic/the-tokenizer.html">tok­enizer</a>. With the tok­enizer, Racket gave us a port con­tain­ing the source code, and we used a <a class="glossary" href="../appendix/glossary.html#lexer"><span class="glossary-link-text">lexer</span></a> to iden­tify the small­est mean­ing­ful chunks.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_7TmgN&quot;)"></div><p id="a_7TmgN">In this case, DrRacket will give our col­or­ing func­tion a new port con­tain­ing the source code (plus a cou­ple more argu­ments to track the cur­rent col­or­ing state). But this time, instead of using a lexer to cre­ate <a class="glossary" href="../appendix/glossary.html#token"><span class="glossary-link-text">tokens</span></a>, we’ll use a lexer to asso­ciate each part of the code with a <em><a class="glossary" href="../appendix/glossary.html#coloring-annotation"><span class="glossary-link-text">col­or­ing anno­ta­tion</span></a></em>. DrRacket will rely on these anno­ta­tions to color the code. <span class="tooltip" onclick="this.classList.toggle('tooltip_visible')"> + <span class="tooltip-inner">It’s pos­si­ble to use one lexer for both roles. And we’ll do it that way in a <a href="../basic-2/the-syntax-colorer.html">later tuto­r­ial</a>. But for now, it’s sim­pler to use two.</span></span></p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;coloring-annotations&quot;)"></div><h3 anchor="coloring-annotations" class="subhead" id="coloring-annotations"><a href="#coloring-annotations">Col­or­ing anno­ta­tions</a></h3></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_3gtZ0&quot;)"></div><p id="a_3gtZ0">In most cases, our syn­tax-col­or­ing anno­ta­tions will con­tain five val­ues:</p></div><ol><li><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_YgATO&quot;)"></div><p id="a_YgATO">The matched string to be col­ored (or an <a href="http://docs.racket-lang.org/reference/port-ops.html#(def._((quote._~23~25kernel)._eof-object~3f))" class="docs" hyphens="none">eof-object?</a> that sig­nals we’ve reached the end). <span class="tooltip" onclick="this.classList.toggle('tooltip_visible')"> + <span class="tooltip-inner">Because DrRacket relies pri­mar­ily on the source-loca­tion fields for syn­tax col­or­ing, this field isn’t strictly manda­tory. If the source loca­tions are accu­rate, the syn­tax will be col­ored cor­rectly.</span></span></p></div></li><li><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_mXDlb&quot;)"></div><p id="a_mXDlb">A col­or­ing cat­e­gory, which can be one of <span class="my-code" decode="exclude">'error</span>, <span class="my-code" decode="exclude">'comment</span>, <span class="my-code" decode="exclude">'sexp-comment</span>, <span class="my-code" decode="exclude">'white-space</span>, <span class="my-code" decode="exclude">'constant</span>, <span class="my-code" decode="exclude">'string</span>, <span class="my-code" decode="exclude">'no-color</span>, <span class="my-code" decode="exclude">'parenthesis</span>, <span class="my-code" decode="exclude">'hash-colon-keyword</span>, <span class="my-code" decode="exclude">'symbol</span>, <span class="my-code" decode="exclude">'eof</span>, or <span class="my-code" decode="exclude">'other</span>. Rather than select­ing a par­tic­u­lar color, we iden­tify the code with a cat­e­gory. Then, for each cat­e­gory, user’s color theme in DrRacket deter­mines the actual color used.</p></div></li><li><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_MZ0uR&quot;)"></div><p id="a_MZ0uR">A paren­the­sis shape, which can be one of <span class="my-code" decode="exclude">()[]{}</span> or <span class="my-code" decode="exclude">#f</span>. Though the <span class="my-code" decode="exclude">'parenthesis</span> cat­e­gory sets the color, DrRacket uses the spe­cific paren­the­sis shape to han­dle other con­ve­niences around match­ing paren­the­ses &amp; col­or­ing whole expres­sions. More broadly, we can use this field with any pair of delim­iters—even if they’re not lit­er­ally paren­the­ses—when we want them to be treated like paren­the­ses in DrRacket.</p></div></li><li><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_a7AwB&quot;)"></div><p id="a_a7AwB">The <a href="source-locations.html#introducing-source-locations">source loca­tion</a> of the matched string, specif­i­cally its start­ing <a class="glossary" href="../appendix/glossary.html#position"><span class="glossary-link-text">posi­tion</span></a> ...</p></div></li><li><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_EXhQu&quot;)"></div><p id="a_EXhQu">... and its end­ing posi­tion.</p></div></li></ol><div anchorize="false" style="height:1em"></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_WF2v8&quot;)"></div><p id="a_WF2v8">In spe­cial cases where we want to track the state of the col­orer or lexer—as we do with <span class="my-code" decode="exclude">jsonic</span>, because we’re going to be alter­nat­ing between two syn­tax col­or­ers—each syn­tax-col­or­ing anno­ta­tion con­tains two sup­ple­men­tary val­ues:</p></div><ol><li><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_COuOp&quot;)"></div><p id="a_COuOp">A backup dis­tance, sig­nal­ing the max­i­mum num­ber of char­ac­ters to back up and recolor after a nearby edit. When in doubt, we can let this be <span class="my-code" decode="exclude">0</span>.</p></div></li><li><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_eXv3d&quot;)"></div><p id="a_eXv3d">A col­or­ing mode. In cases where the col­orer can be in mul­ti­ple states, this value sets the cur­rent state (which can be any value). Each time DrRacket calls the col­or­ing func­tion, it passes the col­or­ing mode back to the col­orer as an argu­ment.</p></div></li></ol><div anchorize="false" style="height:1em"></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_hJWs6&quot;)"></div><p id="a_hJWs6">By the way, col­or­ing anno­ta­tions are strictly cos­metic. They don’t change how the lan­guage works. If we goof them up, noth­ing bad will hap­pen.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;designing-the-colorer&quot;)"></div><h3 anchor="designing-the-colorer" class="subhead" id="designing-the-colorer"><a href="#designing-the-colorer">Design­ing the col­orer</a></h3></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_Ly0Sj&quot;)"></div><p id="a_Ly0Sj">Our goal for our syn­tax col­orer is to map the syn­tac­tic ele­ments of our lan­guage onto the col­or­ing cat­e­gories avail­able in DrRacket. How deep we go is up to us. For instance, it wouldn’t be wrong to make a syn­tax col­orer that just anno­tates all the code with the <span class="my-code" decode="exclude">'string</span> col­or­ing cat­e­gory.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_Zf7Et&quot;)"></div><p id="a_Zf7Et">But that would be bor­ing. So we’ll make a slightly more ambi­tious col­or­ing plan for <span class="my-code" decode="exclude">jsonic</span>:</p></div><ol><li><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_LGaww&quot;)"></div><p id="a_LGaww">Each line com­ment will be col­ored as a <span class="my-code" decode="exclude">'comment</span>.</p></div></li><li><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_pTpqM&quot;)"></div><p id="a_pTpqM">Each expres­sion delim­iter—<span class="my-code" decode="exclude">@$</span> or <span class="my-code" decode="exclude">$@</span>—will be col­ored as a <span class="my-code" decode="exclude">'parenthesis</span>. Fur­ther­more, we’ll set the paren­the­sis shape of the delim­iters to be <span class="my-code" decode="exclude">(</span> and <span class="my-code" decode="exclude">)</span> respec­tively, so that DrRacket treats these delim­iters as a matched pair.</p></div></li><li><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_ilSiE&quot;)"></div><p id="a_ilSiE">The Racket code between the expres­sion delim­iters will be col­ored accord­ing to stan­dard Racket rules. We’ll accom­plish this by import­ing Racket’s syn­tax col­orer and switch­ing to that after the open­ing delim­iter, and switch­ing back to our <span class="my-code" decode="exclude">jsonic</span> lexer at the clos­ing delim­iter. That’s the fancy sauce.</p></div></li><li><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_yQouE&quot;)"></div><p id="a_yQouE">Every­thing else will be col­ored as a <span class="my-code" decode="exclude">'string</span>.</p></div></li></ol><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;writing-the-syntax-colorer&quot;)"></div><h3 anchor="writing-the-syntax-colorer" class="subhead" id="writing-the-syntax-colorer"><a href="#writing-the-syntax-colorer">Writ­ing the syn­tax col­orer</a></h3></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_gU0fN&quot;)"></div><p id="a_gU0fN">Our syn­tax col­or­ing will be han­dled by the <span class="my-code" decode="exclude">color-jsonic</span> func­tion in <span class="my-code" decode="exclude">"jsonic/colorer"</span>. Let’s start that mod­ule now:</p></div><div class="filebox" anchorize="false"><div class="filename" anchorize="false" decode="exclude">jsonic/colorer.rkt</div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_Ush8D&quot;)"></div><div class="highlight-container" id="a_Ush8D"><div id="code_43" form="false" decode="exclude" style="font-size:0;width:0;height:0">#lang br<br/>(require brag/support syntax-color/racket-lexer)<br/><br/>(define jsonic-lexer<br/>  (lexer<br/>   ···))<br/>(jsonic-lexer port)<br/><br/>(define (color-jsonic port offset racket-coloring-mode?) ···)<br/>(provide color-jsonic)</div><div class="highlight" form="false" id="a_qeair"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="source"><pre><span class="kn">#lang </span><span class="nn">br</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._require))" class="docs" hyphens="none">require</a></span> <span class="n">brag/support</span> <span class="n">syntax-color/racket-lexer</span><span class="p">)</span>

<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="n">jsonic-lexer</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._lexer))" class="docs" hyphens="none">lexer</a></span>
   <span class="n">···</span><span class="p">))</span>
<span class="p">(</span><span class="n">jsonic-lexer</span> <span class="n">port</span><span class="p">)</span>

<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="p">(</span><span class="n">color-jsonic</span> <span class="n">port</span> <span class="n">offset</span> <span class="n">racket-coloring-mode?</span><span class="p">)</span> <span class="n">···</span><span class="p">)</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._provide))" class="docs" hyphens="none">provide</a></span> <span class="n">color-jsonic</span><span class="p">)</span>
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpk" data-clipboard-target="#code_43" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_XR075&quot;)"></div><p id="a_XR075">As we did in the <a href="../jsonic/the-tokenizer.html">tok­enizer</a>, we import <span class="my-code" decode="exclude">brag/support</span> to get <a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._lexer))" class="docs" hyphens="none">lexer</a> and other helper func­tions. We also import <span class="my-code" decode="exclude">syntax-color/racket-lexer</span> to get <span class="my-code" decode="exclude">racket-lexer</span>, Racket’s default syn­tax col­orer, which we’ll use later.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_ciLNi&quot;)"></div><p id="a_ciLNi">We have two func­tions in this mod­ule: <span class="my-code" decode="exclude">jsonic-lexer</span>, which han­dles the col­or­ing anno­ta­tions when the col­orer isn’t using the Racket lexer. Each of these col­or­ing anno­ta­tions will con­tain the five essen­tial col­or­ing-anno­ta­tion val­ues.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_eI3Ut&quot;)"></div><p id="a_eI3Ut">The other func­tion will be <span class="my-code" decode="exclude">color-jsonic</span>, the main func­tion called by DrRacket, which will tog­gle between the two lex­ers. It will also append the two sup­ple­men­tary val­ues for each col­or­ing anno­ta­tion.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;the-lexer&quot;)"></div><h3 anchor="the-lexer" class="subhead" id="the-lexer"><a href="#the-lexer">The lexer</a></h3></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_rO31f&quot;)"></div><p id="a_rO31f">First, let’s write the col­or­ing rules in <span class="my-code" decode="exclude">jsonic-lexer</span>. <a href="../jsonic/the-tokenizer.html">As before</a>, we always need a rule that han­dles the <span class="my-code" decode="exclude">eof</span> sig­nal that our port will emit when it reaches the end of the file:</p></div><div class="filebox" anchorize="false"><div class="filename" anchorize="false" decode="exclude">jsonic/colorer.rkt</div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_a8wnK&quot;)"></div><div class="highlight-container" id="a_a8wnK"><div id="code_44" form="false" decode="exclude" style="font-size:0;width:0;height:0">#lang br<br/>(require brag/support syntax-color/racket-lexer)<br/><br/>(define jsonic-lexer<br/>  (lexer<br/>   [(eof) (values lexeme 'eof #f #f #f)]))<br/>(jsonic-lexer port)<br/><br/>(define (color-jsonic port offset racket-coloring-mode?) ···)<br/>(provide color-jsonic)</div><div class="highlight" form="false" id="a_pM7kr"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="source"><pre><span class="kn">#lang </span><span class="nn">br</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._require))" class="docs" hyphens="none">require</a></span> <span class="n">brag/support</span> <span class="n">syntax-color/racket-lexer</span><span class="p">)</span>

<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="n">jsonic-lexer</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._lexer))" class="docs" hyphens="none">lexer</a></span>
<span class="hll">   <span class="p">[(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/port-ops.html#(def._((quote._~23~25kernel)._eof))" class="docs" hyphens="none">eof</a></span><span class="p">)</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/values.html#(def._((quote._~23~25kernel)._values))" class="docs" hyphens="none">values</a></span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._lexeme))" class="docs" hyphens="none">lexeme</a></span> <span class="o">&#39;</span><span class="ss">eof</span> <span class="no">#f</span> <span class="no">#f</span> <span class="no">#f</span><span class="p">)]))</span>
</span><span class="p">(</span><span class="n">jsonic-lexer</span> <span class="n">port</span><span class="p">)</span>

<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="p">(</span><span class="n">color-jsonic</span> <span class="n">port</span> <span class="n">offset</span> <span class="n">racket-coloring-mode?</span><span class="p">)</span> <span class="n">···</span><span class="p">)</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._provide))" class="docs" hyphens="none">provide</a></span> <span class="n">color-jsonic</span><span class="p">)</span>
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpk1" data-clipboard-target="#code_44" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_W6CEb&quot;)"></div><p id="a_W6CEb">Each of these lexer rules needs to return a mul­ti­ple-val­ued col­or­ing anno­ta­tion. To do this, we use <a href="http://docs.racket-lang.org/reference/values.html#(def._((quote._~23~25kernel)._values))" class="docs" hyphens="none">values</a>, which is a way of return­ing mul­ti­ple val­ues from a func­tion, and how DrRacket expects the anno­ta­tions to be pack­aged. <span class="tooltip" onclick="this.classList.toggle('tooltip_visible')"> + <span class="tooltip-inner">For more on func­tions return­ing mul­ti­ple val­ues, see <a class="explainer" href="../explainer/functions.html">func­tions</a>.</span></span> Fol­low­ing our spec­i­fi­ca­tion above, the anno­ta­tion has five val­ues: the <a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._lexeme))" class="docs" hyphens="none">lexeme</a>, the col­or­ing cat­e­gory <span class="my-code" decode="exclude">'eof</span>, and then the paren­the­sis shape and two source loca­tions are all <span class="my-code" decode="exclude">#f</span>.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_gfKZO&quot;)"></div><p id="a_gfKZO">Next we han­dle our delim­iters:</p></div><div class="filebox" anchorize="false"><div class="filename" anchorize="false" decode="exclude">jsonic/colorer.rkt</div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_4z0M6&quot;)"></div><div class="highlight-container" id="a_4z0M6"><div id="code_45" form="false" decode="exclude" style="font-size:0;width:0;height:0">#lang br<br/>(require brag/support syntax-color/racket-lexer)<br/><br/>(define jsonic-lexer<br/>  (lexer<br/>   [(eof) (values lexeme 'eof #f #f #f)]<br/>   [(:or "@$" "$@")<br/>    (values lexeme 'parenthesis<br/>            (if (equal? lexeme "@$") '|(| '|)|)<br/>            (pos lexeme-start) (pos lexeme-end))]))<br/>(jsonic-lexer port)<br/><br/>(define (color-jsonic port offset racket-coloring-mode?) ···)<br/>(provide color-jsonic)</div><div class="highlight" form="false" id="a_Mt0Ue"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="source"><pre><span class="kn">#lang </span><span class="nn">br</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._require))" class="docs" hyphens="none">require</a></span> <span class="n">brag/support</span> <span class="n">syntax-color/racket-lexer</span><span class="p">)</span>

<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="n">jsonic-lexer</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._lexer))" class="docs" hyphens="none">lexer</a></span>
   <span class="p">[(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/port-ops.html#(def._((quote._~23~25kernel)._eof))" class="docs" hyphens="none">eof</a></span><span class="p">)</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/values.html#(def._((quote._~23~25kernel)._values))" class="docs" hyphens="none">values</a></span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._lexeme))" class="docs" hyphens="none">lexeme</a></span> <span class="o">&#39;</span><span class="ss">eof</span> <span class="no">#f</span> <span class="no">#f</span> <span class="no">#f</span><span class="p">)]</span>
<span class="hll">   <span class="p">[(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(form._((lib._brag/support..rkt)._~3aor))" class="docs" hyphens="none">:or</a></span> <span class="s2">"@$"</span> <span class="s2">"$@"</span><span class="p">)</span>
</span><span class="hll">    <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/values.html#(def._((quote._~23~25kernel)._values))" class="docs" hyphens="none">values</a></span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._lexeme))" class="docs" hyphens="none">lexeme</a></span> <span class="o">&#39;</span><span class="ss">parenthesis</span>
</span><span class="hll">            <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/if.html#(form._((quote._~23~25kernel)._if))" class="docs" hyphens="none">if</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/booleans.html#(def._((quote._~23~25kernel)._equal~3f))" class="docs" hyphens="none">equal?</a></span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._lexeme))" class="docs" hyphens="none">lexeme</a></span> <span class="s2">"@$"</span><span class="p">)</span> <span class="o">&#39;</span><span class="ss">|(|</span> <span class="o">&#39;</span><span class="ss">|)|</span><span class="p">)</span>
</span><span class="hll">            <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(def._((lib._br-parser-tools/lex..rkt)._position-offset))" class="docs" hyphens="none">pos</a></span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._start-pos))" class="docs" hyphens="none">lexeme-start</a></span><span class="p">)</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(def._((lib._br-parser-tools/lex..rkt)._position-offset))" class="docs" hyphens="none">pos</a></span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._end-pos))" class="docs" hyphens="none">lexeme-end</a></span><span class="p">))]))</span>
</span><span class="p">(</span><span class="n">jsonic-lexer</span> <span class="n">port</span><span class="p">)</span>

<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="p">(</span><span class="n">color-jsonic</span> <span class="n">port</span> <span class="n">offset</span> <span class="n">racket-coloring-mode?</span><span class="p">)</span> <span class="n">···</span><span class="p">)</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._provide))" class="docs" hyphens="none">provide</a></span> <span class="n">color-jsonic</span><span class="p">)</span>
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpk2" data-clipboard-target="#code_45" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_yE3MU&quot;)"></div><p id="a_yE3MU">We assign both delim­iters to the <span class="my-code" decode="exclude">'parenthesis</span> col­or­ing cat­e­gory. For the open­ing delim­iter, we use a paren­the­sis shape of <span class="my-code" decode="exclude">'|(|</span>, and for the clos­ing delim­iter, <span class="my-code" decode="exclude">'|)|</span> (Don’t be alarmed by the funny nota­tion—because of its spe­cial role in the Racket lan­guage, we have to <a href="http://docs.racket-lang.org/reference/reader.html#%28part._parse-symbol%29">escape a paren­the­sis</a> within ver­ti­cal bars when we use it as a sym­bol.) As we <a href="source-locations.html#gathering-the-source-location-data">learned before</a>, our start and end posi­tions can be found in <span class="my-code" decode="exclude">(pos lexeme-start)</span> and <span class="my-code" decode="exclude">(pos lexeme-end)</span>.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_P4PUV&quot;)"></div><p id="a_P4PUV">Our line com­ment is straight­for­ward—we can reuse the com­ment-match­ing rule from our tok­enizer and assign it to the <span class="my-code" decode="exclude">'comment</span> cat­e­gory. And as before, we use an <span class="my-code" decode="exclude">any-char</span> rule to catch every­thing else, assign­ing it to the <span class="my-code" decode="exclude">'string</span> cat­e­gory:</p></div><div class="filebox" anchorize="false"><div class="filename" anchorize="false" decode="exclude">jsonic/colorer.rkt</div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_VKqOE&quot;)"></div><div class="highlight-container" id="a_VKqOE"><div id="code_46" form="false" decode="exclude" style="font-size:0;width:0;height:0">#lang br<br/>(require brag/support syntax-color/racket-lexer)<br/><br/>(define jsonic-lexer<br/>  (lexer<br/>   [(eof) (values lexeme 'eof #f #f #f)]<br/>   [(:or "@$" "$@")<br/>    (values lexeme 'parenthesis<br/>            (if (equal? lexeme "@$") '|(| '|)|)<br/>            (pos lexeme-start) (pos lexeme-end))]<br/>   [(from/to "//" "\n")<br/>    (values lexeme 'comment #f<br/>            (pos lexeme-start) (pos lexeme-end))]<br/>   [any-char<br/>    (values lexeme 'string #f<br/>            (pos lexeme-start) (pos lexeme-end))]))<br/>(jsonic-lexer port)<br/><br/>(define (color-jsonic port offset racket-coloring-mode?) ···)<br/>(provide color-jsonic)</div><div class="highlight" form="false" id="a_MvZQ6"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</pre></div></td><td class="code"><div class="source"><pre><span class="kn">#lang </span><span class="nn">br</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._require))" class="docs" hyphens="none">require</a></span> <span class="n">brag/support</span> <span class="n">syntax-color/racket-lexer</span><span class="p">)</span>

<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="n">jsonic-lexer</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._lexer))" class="docs" hyphens="none">lexer</a></span>
   <span class="p">[(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/port-ops.html#(def._((quote._~23~25kernel)._eof))" class="docs" hyphens="none">eof</a></span><span class="p">)</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/values.html#(def._((quote._~23~25kernel)._values))" class="docs" hyphens="none">values</a></span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._lexeme))" class="docs" hyphens="none">lexeme</a></span> <span class="o">&#39;</span><span class="ss">eof</span> <span class="no">#f</span> <span class="no">#f</span> <span class="no">#f</span><span class="p">)]</span>
   <span class="p">[(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(form._((lib._brag/support..rkt)._~3aor))" class="docs" hyphens="none">:or</a></span> <span class="s2">"@$"</span> <span class="s2">"$@"</span><span class="p">)</span>
    <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/values.html#(def._((quote._~23~25kernel)._values))" class="docs" hyphens="none">values</a></span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._lexeme))" class="docs" hyphens="none">lexeme</a></span> <span class="o">&#39;</span><span class="ss">parenthesis</span>
            <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/if.html#(form._((quote._~23~25kernel)._if))" class="docs" hyphens="none">if</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/booleans.html#(def._((quote._~23~25kernel)._equal~3f))" class="docs" hyphens="none">equal?</a></span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._lexeme))" class="docs" hyphens="none">lexeme</a></span> <span class="s2">"@$"</span><span class="p">)</span> <span class="o">&#39;</span><span class="ss">|(|</span> <span class="o">&#39;</span><span class="ss">|)|</span><span class="p">)</span>
            <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(def._((lib._br-parser-tools/lex..rkt)._position-offset))" class="docs" hyphens="none">pos</a></span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._start-pos))" class="docs" hyphens="none">lexeme-start</a></span><span class="p">)</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(def._((lib._br-parser-tools/lex..rkt)._position-offset))" class="docs" hyphens="none">pos</a></span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._end-pos))" class="docs" hyphens="none">lexeme-end</a></span><span class="p">))]</span>
<span class="hll">   <span class="p">[(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(form._((lib._brag/support..rkt)._from/to))" class="docs" hyphens="none">from/to</a></span> <span class="s2">"//"</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
</span><span class="hll">    <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/values.html#(def._((quote._~23~25kernel)._values))" class="docs" hyphens="none">values</a></span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._lexeme))" class="docs" hyphens="none">lexeme</a></span> <span class="o">&#39;</span><span class="ss">comment</span> <span class="no">#f</span>
</span><span class="hll">            <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(def._((lib._br-parser-tools/lex..rkt)._position-offset))" class="docs" hyphens="none">pos</a></span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._start-pos))" class="docs" hyphens="none">lexeme-start</a></span><span class="p">)</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(def._((lib._br-parser-tools/lex..rkt)._position-offset))" class="docs" hyphens="none">pos</a></span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._end-pos))" class="docs" hyphens="none">lexeme-end</a></span><span class="p">))]</span>
</span><span class="hll">   <span class="p">[</span><span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._any-char))" class="docs" hyphens="none">any-char</a></span>
</span><span class="hll">    <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/values.html#(def._((quote._~23~25kernel)._values))" class="docs" hyphens="none">values</a></span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._lexeme))" class="docs" hyphens="none">lexeme</a></span> <span class="o">&#39;</span><span class="ss">string</span> <span class="no">#f</span>
</span><span class="hll">            <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(def._((lib._br-parser-tools/lex..rkt)._position-offset))" class="docs" hyphens="none">pos</a></span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._start-pos))" class="docs" hyphens="none">lexeme-start</a></span><span class="p">)</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(def._((lib._br-parser-tools/lex..rkt)._position-offset))" class="docs" hyphens="none">pos</a></span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._end-pos))" class="docs" hyphens="none">lexeme-end</a></span><span class="p">))]))</span>
</span><span class="p">(</span><span class="n">jsonic-lexer</span> <span class="n">port</span><span class="p">)</span>

<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="p">(</span><span class="n">color-jsonic</span> <span class="n">port</span> <span class="n">offset</span> <span class="n">racket-coloring-mode?</span><span class="p">)</span> <span class="n">···</span><span class="p">)</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._provide))" class="docs" hyphens="none">provide</a></span> <span class="n">color-jsonic</span><span class="p">)</span>
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpk3" data-clipboard-target="#code_46" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;the-lexer-toggler&quot;)"></div><h3 anchor="the-lexer-toggler" class="subhead" id="the-lexer-toggler"><a href="#the-lexer-toggler">The lexer tog­gler</a></h3></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_UF8KY&quot;)"></div><p id="a_UF8KY">With the lexer in place, we can write <span class="my-code" decode="exclude">color-jsonic</span>, which keeps track of whether we should be using the <span class="my-code" decode="exclude">racket-lexer</span> or the <span class="my-code" decode="exclude">jsonic-lexer</span>.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_KWoxI&quot;)"></div><p id="a_KWoxI"><span class="my-code" decode="exclude">color-jsonic</span> gets three argu­ments from DrRacket: an input <span class="my-code" decode="exclude">port</span> con­tain­ing the source code, an <span class="my-code" decode="exclude">offset</span> value (that we ignore for now) and what­ever value has been set as the cur­rent col­or­ing mode, which for us will be a Boolean indi­cat­ing the <span class="my-code" decode="exclude">racket-coloring-mode?</span>. When the col­orer starts, this argu­ment defaults to <span class="my-code" decode="exclude">#f</span>. We use a <a href="http://docs.racket-lang.org/reference/if.html#(form._((lib._racket/private/letstx-scheme..rkt)._cond))" class="docs" hyphens="none">cond</a> expres­sion to deter­mine which lexer to use:</p></div><div class="filebox" anchorize="false"><div class="filename" anchorize="false" decode="exclude">jsonic/colorer.rkt</div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_YtxZ9&quot;)"></div><div class="highlight-container" id="a_YtxZ9"><div id="code_47" form="false" decode="exclude" style="font-size:0;width:0;height:0">#lang br<br/>(require brag/support syntax-color/racket-lexer)<br/><br/>(define jsonic-lexer ···)<br/><br/>(define (color-jsonic port offset racket-coloring-mode?)<br/>  (cond<br/>    [(or (not racket-coloring-mode?)<br/>         (equal? (peek-string 2 0 port) "$@"))<br/>     (define-values (str cat paren start end)<br/>       (jsonic-lexer port))<br/>     (define switch-to-racket-mode (equal? str "@$"))<br/>     (values str cat paren start end 0 switch-to-racket-mode)]<br/>    [else<br/>     ···]))</div><div class="highlight" form="false" id="a_wbL5B"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class="code"><div class="source"><pre><span class="kn">#lang </span><span class="nn">br</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._require))" class="docs" hyphens="none">require</a></span> <span class="n">brag/support</span> <span class="n">syntax-color/racket-lexer</span><span class="p">)</span>

<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="n">jsonic-lexer</span> <span class="n">···</span><span class="p">)</span>

<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="p">(</span><span class="n">color-jsonic</span> <span class="n">port</span> <span class="n">offset</span> <span class="n">racket-coloring-mode?</span><span class="p">)</span>
<span class="hll">  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/if.html#(form._((lib._racket/private/letstx-scheme..rkt)._cond))" class="docs" hyphens="none">cond</a></span>
</span><span class="hll">    <span class="p">[(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/if.html#(form._((lib._racket/private/letstx-scheme..rkt)._or))" class="docs" hyphens="none">or</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/booleans.html#(def._((quote._~23~25kernel)._not))" class="docs" hyphens="none">not</a></span> <span class="n">racket-coloring-mode?</span><span class="p">)</span>
</span><span class="hll">         <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/booleans.html#(def._((quote._~23~25kernel)._equal~3f))" class="docs" hyphens="none">equal?</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/Byte_and_String_Input.html#(def._((quote._~23~25kernel)._peek-string))" class="docs" hyphens="none">peek-string</a></span> <span class="mi">2</span> <span class="mi">0</span> <span class="n">port</span><span class="p">)</span> <span class="s2">"$@"</span><span class="p">))</span>
</span><span class="hll">     <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((quote._~23~25kernel)._define-values))" class="docs" hyphens="none">define-values</a></span> <span class="p">(</span><span class="n">str</span> <span class="n">cat</span> <span class="n">paren</span> <span class="n">start</span> <span class="n">end</span><span class="p">)</span>
</span><span class="hll">       <span class="p">(</span><span class="n">jsonic-lexer</span> <span class="n">port</span><span class="p">))</span>
</span><span class="hll">     <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="n">switch-to-racket-mode</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/booleans.html#(def._((quote._~23~25kernel)._equal~3f))" class="docs" hyphens="none">equal?</a></span> <span class="n">str</span> <span class="s2">"@$"</span><span class="p">))</span>
</span><span class="hll">     <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/values.html#(def._((quote._~23~25kernel)._values))" class="docs" hyphens="none">values</a></span> <span class="n">str</span> <span class="n">cat</span> <span class="n">paren</span> <span class="n">start</span> <span class="n">end</span> <span class="mi">0</span> <span class="n">switch-to-racket-mode</span><span class="p">)]</span>
</span>    <span class="p">[</span><span class="nb"><a href="http://docs.racket-lang.org/reference/if.html#(form._((lib._racket/private/letstx-scheme..rkt)._else))" class="docs" hyphens="none">else</a></span>
     <span class="n">···</span><span class="p">]))</span>
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpk4" data-clipboard-target="#code_47" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_sGDPB&quot;)"></div><p id="a_sGDPB">The first branch of the <span class="my-code" decode="exclude">cond</span> invokes the <span class="my-code" decode="exclude">jsonic-lexer</span> in two sit­u­a­tions:</p></div><ol><li><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_Xc7Wt&quot;)"></div><p id="a_Xc7Wt">When <span class="my-code" decode="exclude">racket-coloring-mode?</span> is <span class="my-code" decode="exclude">#f</span>. Obvi­ously.</p></div></li><li><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_FR341&quot;)"></div><p id="a_FR341">When <span class="my-code" decode="exclude">racket-coloring-mode?</span> is <span class="my-code" decode="exclude">#t</span>, but we’re about to encounter a clos­ing delim­iter <span class="my-code" decode="exclude">$@</span>, and thus need to exit Racket mode. The prob­lem with rely­ing on the default <span class="my-code" decode="exclude">racket-lexer</span> is that it doesn’t know any­thing about our spe­cial clos­ing delim­iter <span class="my-code" decode="exclude">$@</span>. So when it reaches that clos­ing delim­iter, it won’t stop lex­ing.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_7JeNt&quot;)"></div><p id="a_7JeNt">We fix this prob­lem with <a href="http://docs.racket-lang.org/reference/Byte_and_String_Input.html#(def._((quote._~23~25kernel)._peek-string))" class="docs" hyphens="none">peek-string</a>. This lets us add a looka­head con­di­tion that checks to see if the next two-char­ac­ter string avail­able from <span class="my-code" decode="exclude">port</span> will be a clos­ing delim­iter. If it is, we know that our embed­ded Racket expres­sion is done, so we should switch back to our <span class="my-code" decode="exclude">jsonic-lexer</span>. But because we’re “peek­ing” into the port rather than “read­ing”, the clos­ing delim­iter itself is left in the port to be han­dled on the next pass of the lexer.</p></div></li></ol><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_HqLUe&quot;)"></div><p id="a_HqLUe">Once we get the five-value col­or­ing anno­ta­tion from <span class="my-code" decode="exclude">jsonic-lexer</span>, we append two more val­ues. First, a <span class="my-code" decode="exclude">0</span> for the backup dis­tance (because we’re not using backup dis­tance in this project, but we have to pass a default value). Sec­ond, a value that indi­cates whether we’re switch­ing to Racket mode. The test is sim­ple: if the <span class="my-code" decode="exclude">str</span> value returned from <span class="my-code" decode="exclude">jsonic-lexer</span> is our open­ing delim­iter <span class="my-code" decode="exclude">@$</span>, we switch, because that means we’re enter­ing an embed­ded Racket expres­sion. On the next call to <span class="my-code" decode="exclude">color-jsonic</span>, this value will become the value passed as the <span class="my-code" decode="exclude">racket-coloring-mode?</span> argu­ment.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_6K7Tq&quot;)"></div><p id="a_6K7Tq">The Racket-mode branch is sim­pler:</p></div><div class="filebox" anchorize="false"><div class="filename" anchorize="false" decode="exclude">jsonic/colorer.rkt</div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_LaoJB&quot;)"></div><div class="highlight-container" id="a_LaoJB"><div id="code_48" form="false" decode="exclude" style="font-size:0;width:0;height:0">#lang br<br/>(require brag/support syntax-color/racket-lexer)<br/><br/>(define jsonic-lexer ···)<br/><br/>(define (color-jsonic port offset racket-coloring-mode?)<br/>  (cond<br/>    [(or (not racket-coloring-mode?)<br/>         (equal? (peek-string 2 0 port) "$@"))<br/>     (define-values (str cat paren start end)<br/>       (jsonic-lexer port))<br/>     (define switch-to-racket-mode (equal? str "@$"))<br/>     (values str cat paren start end 0 switch-to-racket-mode)]<br/>    [else<br/>     (define-values (str cat paren start end)<br/>       (racket-lexer port))<br/>     (values str cat paren start end 0 #t)]))</div><div class="highlight" form="false" id="a_TuhYu"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td><td class="code"><div class="source"><pre><span class="kn">#lang </span><span class="nn">br</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._require))" class="docs" hyphens="none">require</a></span> <span class="n">brag/support</span> <span class="n">syntax-color/racket-lexer</span><span class="p">)</span>

<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="n">jsonic-lexer</span> <span class="n">···</span><span class="p">)</span>

<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="p">(</span><span class="n">color-jsonic</span> <span class="n">port</span> <span class="n">offset</span> <span class="n">racket-coloring-mode?</span><span class="p">)</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/if.html#(form._((lib._racket/private/letstx-scheme..rkt)._cond))" class="docs" hyphens="none">cond</a></span>
    <span class="p">[(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/if.html#(form._((lib._racket/private/letstx-scheme..rkt)._or))" class="docs" hyphens="none">or</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/booleans.html#(def._((quote._~23~25kernel)._not))" class="docs" hyphens="none">not</a></span> <span class="n">racket-coloring-mode?</span><span class="p">)</span>
         <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/booleans.html#(def._((quote._~23~25kernel)._equal~3f))" class="docs" hyphens="none">equal?</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/Byte_and_String_Input.html#(def._((quote._~23~25kernel)._peek-string))" class="docs" hyphens="none">peek-string</a></span> <span class="mi">2</span> <span class="mi">0</span> <span class="n">port</span><span class="p">)</span> <span class="s2">"$@"</span><span class="p">))</span>
     <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((quote._~23~25kernel)._define-values))" class="docs" hyphens="none">define-values</a></span> <span class="p">(</span><span class="n">str</span> <span class="n">cat</span> <span class="n">paren</span> <span class="n">start</span> <span class="n">end</span><span class="p">)</span>
       <span class="p">(</span><span class="n">jsonic-lexer</span> <span class="n">port</span><span class="p">))</span>
     <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="n">switch-to-racket-mode</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/booleans.html#(def._((quote._~23~25kernel)._equal~3f))" class="docs" hyphens="none">equal?</a></span> <span class="n">str</span> <span class="s2">"@$"</span><span class="p">))</span>
     <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/values.html#(def._((quote._~23~25kernel)._values))" class="docs" hyphens="none">values</a></span> <span class="n">str</span> <span class="n">cat</span> <span class="n">paren</span> <span class="n">start</span> <span class="n">end</span> <span class="mi">0</span> <span class="n">switch-to-racket-mode</span><span class="p">)]</span>
<span class="hll">    <span class="p">[</span><span class="nb"><a href="http://docs.racket-lang.org/reference/if.html#(form._((lib._racket/private/letstx-scheme..rkt)._else))" class="docs" hyphens="none">else</a></span>
</span><span class="hll">     <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((quote._~23~25kernel)._define-values))" class="docs" hyphens="none">define-values</a></span> <span class="p">(</span><span class="n">str</span> <span class="n">cat</span> <span class="n">paren</span> <span class="n">start</span> <span class="n">end</span><span class="p">)</span>
</span><span class="hll">       <span class="p">(</span><span class="n">racket-lexer</span> <span class="n">port</span><span class="p">))</span>
</span><span class="hll">     <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/values.html#(def._((quote._~23~25kernel)._values))" class="docs" hyphens="none">values</a></span> <span class="n">str</span> <span class="n">cat</span> <span class="n">paren</span> <span class="n">start</span> <span class="n">end</span> <span class="mi">0</span> <span class="no">#t</span><span class="p">)]))</span>
</span></pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpk5" data-clipboard-target="#code_48" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_qvY4G&quot;)"></div><p id="a_qvY4G">Here, we just get the five basic color-anno­ta­tion val­ues from call­ing <span class="my-code" decode="exclude">racket-lexer</span>, append another default backup dis­tance of <span class="my-code" decode="exclude">0</span>, and then <span class="my-code" decode="exclude">#t</span> to indi­cate that we should stay in Racket col­or­ing mode.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_joGlF&quot;)"></div><p id="a_joGlF">And that’s it.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;adding-a-contract&quot;)"></div><h3 anchor="adding-a-contract" class="subhead" id="adding-a-contract"><a href="#adding-a-contract">Adding a con­tract</a></h3></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_wEV10&quot;)"></div><p id="a_wEV10">In the real world, we would’ve fit­ted our func­tion with <a href="contracts.html">con­tracts</a> and <a href="unit-tests.html">unit tests</a> before we wrote the mid­dle parts. Here in tuto­r­ial world, bet­ter to cover the new mate­r­ial first.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_ovUQ2&quot;)"></div><p id="a_ovUQ2">But we’ve done that. So let’s now write a con­tract for <span class="my-code" decode="exclude">color-jsonic</span>. For input, we know it takes an <a href="http://docs.racket-lang.org/reference/port-ops.html#(def._((quote._~23~25kernel)._input-port~3f))" class="docs" hyphens="none">input-port?</a>, an <span class="my-code" decode="exclude">offset</span> value, which is an <a href="http://docs.racket-lang.org/reference/number-types.html#(def._((quote._~23~25kernel)._exact-nonnegative-integer~3f))" class="docs" hyphens="none">exact-nonnegative-integer?</a>, and a mode value, which for us is a <a href="http://docs.racket-lang.org/reference/booleans.html#(def._((quote._~23~25kernel)._boolean~3f))" class="docs" hyphens="none">boolean?</a>:</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_uv8WS&quot;)"></div><div class="highlight-container" id="a_uv8WS"><div id="code_49" form="false" decode="exclude" style="font-size:0;width:0;height:0">(input-port? exact-nonnegative-integer? boolean?<br/>             . -&gt; . ···)</div><div class="highlight" form="false" id="a_DuNjr"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="source"><pre><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/port-ops.html#(def._((quote._~23~25kernel)._input-port~3f))" class="docs" hyphens="none">input-port?</a></span> <span class="nb"><a href="http://docs.racket-lang.org/reference/number-types.html#(def._((quote._~23~25kernel)._exact-nonnegative-integer~3f))" class="docs" hyphens="none">exact-nonnegative-integer?</a></span> <span class="nb"><a href="http://docs.racket-lang.org/reference/booleans.html#(def._((quote._~23~25kernel)._boolean~3f))" class="docs" hyphens="none">boolean?</a></span>
             <span class="o">.</span> <span class="nb"><a href="http://docs.racket-lang.org/reference/function-contracts.html#(form._((lib._racket/contract/base..rkt)._-~3e))" class="docs" hyphens="none">-&gt;</a></span> <span class="o">.</span> <span class="n">···</span><span class="p">)</span>
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpk6" data-clipboard-target="#code_49" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_0AcvX&quot;)"></div><p id="a_0AcvX">What about a con­tract for the return value: the color anno­ta­tion? Each color anno­ta­tion has seven val­ues inside. So we can think about this as seven smaller con­tracts pack­aged inside a <span class="my-code" decode="exclude">values</span> con­tract com­bi­na­tor (just as we used <span class="my-code" decode="exclude">values</span> to pack­age the indi­vid­ual val­ues):</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_ELrfw&quot;)"></div><div class="highlight-container" id="a_ELrfw"><div id="code_50" form="false" decode="exclude" style="font-size:0;width:0;height:0">(input-port? exact-nonnegative-integer? boolean?<br/>             . -&gt; . (values ···))</div><div class="highlight" form="false" id="a_hA6lE"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="source"><pre><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/port-ops.html#(def._((quote._~23~25kernel)._input-port~3f))" class="docs" hyphens="none">input-port?</a></span> <span class="nb"><a href="http://docs.racket-lang.org/reference/number-types.html#(def._((quote._~23~25kernel)._exact-nonnegative-integer~3f))" class="docs" hyphens="none">exact-nonnegative-integer?</a></span> <span class="nb"><a href="http://docs.racket-lang.org/reference/booleans.html#(def._((quote._~23~25kernel)._boolean~3f))" class="docs" hyphens="none">boolean?</a></span>
             <span class="o">.</span> <span class="nb"><a href="http://docs.racket-lang.org/reference/function-contracts.html#(form._((lib._racket/contract/base..rkt)._-~3e))" class="docs" hyphens="none">-&gt;</a></span> <span class="o">.</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/values.html#(def._((quote._~23~25kernel)._values))" class="docs" hyphens="none">values</a></span> <span class="n">···</span><span class="p">))</span>
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpk7" data-clipboard-target="#code_50" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_MUdjh&quot;)"></div><p id="a_MUdjh">As we learned at the top of the page, these seven val­ues are as fol­lows: a lex­eme (which is a <a href="http://docs.racket-lang.org/reference/strings.html#(def._((quote._~23~25kernel)._string~3f))" class="docs" hyphens="none">string?</a> or an <a href="http://docs.racket-lang.org/reference/port-ops.html#(def._((quote._~23~25kernel)._eof-object~3f))" class="docs" hyphens="none">eof-object?</a>), a col­or­ing cat­e­gory (<a href="http://docs.racket-lang.org/reference/symbols.html#(def._((quote._~23~25kernel)._symbol~3f))" class="docs" hyphens="none">symbol?</a>), a paren­the­sis shape (<a href="http://docs.racket-lang.org/reference/symbols.html#(def._((quote._~23~25kernel)._symbol~3f))" class="docs" hyphens="none">symbol?</a> or <span class="my-code" decode="exclude">#f</span>), a start­ing and end­ing source posi­tion (both either <a href="http://docs.racket-lang.org/reference/number-types.html#(def._((quote._~23~25kernel)._exact-positive-integer~3f))" class="docs" hyphens="none">exact-positive-integer?</a> or <span class="my-code" decode="exclude">#f</span>), a backup value (another <span class="my-code" decode="exclude">exact-nonnegative-integer?</span>) and a <span class="my-code" decode="exclude">boolean?</span> mode. So the whole con­tract looks like this:</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_flOLJ&quot;)"></div><div class="highlight-container" id="a_flOLJ"><div id="code_51" form="false" decode="exclude" style="font-size:0;width:0;height:0">(input-port? exact-nonnegative-integer? boolean?<br/>             . -&gt; . (values<br/>                     (or/c string? eof-object?)<br/>                     symbol?<br/>                     (or/c symbol? #f)<br/>                     (or/c exact-positive-integer? #f)<br/>                     (or/c exact-positive-integer? #f)<br/>                     exact-nonnegative-integer?<br/>                     boolean?))</div><div class="highlight" form="false" id="a_p9X4n"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="source"><pre><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/port-ops.html#(def._((quote._~23~25kernel)._input-port~3f))" class="docs" hyphens="none">input-port?</a></span> <span class="nb"><a href="http://docs.racket-lang.org/reference/number-types.html#(def._((quote._~23~25kernel)._exact-nonnegative-integer~3f))" class="docs" hyphens="none">exact-nonnegative-integer?</a></span> <span class="nb"><a href="http://docs.racket-lang.org/reference/booleans.html#(def._((quote._~23~25kernel)._boolean~3f))" class="docs" hyphens="none">boolean?</a></span>
             <span class="o">.</span> <span class="nb"><a href="http://docs.racket-lang.org/reference/function-contracts.html#(form._((lib._racket/contract/base..rkt)._-~3e))" class="docs" hyphens="none">-&gt;</a></span> <span class="o">.</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/values.html#(def._((quote._~23~25kernel)._values))" class="docs" hyphens="none">values</a></span>
                     <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/data-structure-contracts.html#(def._((lib._racket/contract/base..rkt)._or/c))" class="docs" hyphens="none">or/c</a></span> <span class="nb"><a href="http://docs.racket-lang.org/reference/strings.html#(def._((quote._~23~25kernel)._string~3f))" class="docs" hyphens="none">string?</a></span> <span class="nb"><a href="http://docs.racket-lang.org/reference/port-ops.html#(def._((quote._~23~25kernel)._eof-object~3f))" class="docs" hyphens="none">eof-object?</a></span><span class="p">)</span>
                     <span class="nb"><a href="http://docs.racket-lang.org/reference/symbols.html#(def._((quote._~23~25kernel)._symbol~3f))" class="docs" hyphens="none">symbol?</a></span>
                     <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/data-structure-contracts.html#(def._((lib._racket/contract/base..rkt)._or/c))" class="docs" hyphens="none">or/c</a></span> <span class="nb"><a href="http://docs.racket-lang.org/reference/symbols.html#(def._((quote._~23~25kernel)._symbol~3f))" class="docs" hyphens="none">symbol?</a></span> <span class="no">#f</span><span class="p">)</span>
                     <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/data-structure-contracts.html#(def._((lib._racket/contract/base..rkt)._or/c))" class="docs" hyphens="none">or/c</a></span> <span class="nb"><a href="http://docs.racket-lang.org/reference/number-types.html#(def._((quote._~23~25kernel)._exact-positive-integer~3f))" class="docs" hyphens="none">exact-positive-integer?</a></span> <span class="no">#f</span><span class="p">)</span>
                     <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/data-structure-contracts.html#(def._((lib._racket/contract/base..rkt)._or/c))" class="docs" hyphens="none">or/c</a></span> <span class="nb"><a href="http://docs.racket-lang.org/reference/number-types.html#(def._((quote._~23~25kernel)._exact-positive-integer~3f))" class="docs" hyphens="none">exact-positive-integer?</a></span> <span class="no">#f</span><span class="p">)</span>
                     <span class="nb"><a href="http://docs.racket-lang.org/reference/number-types.html#(def._((quote._~23~25kernel)._exact-nonnegative-integer~3f))" class="docs" hyphens="none">exact-nonnegative-integer?</a></span>
                     <span class="nb"><a href="http://docs.racket-lang.org/reference/booleans.html#(def._((quote._~23~25kernel)._boolean~3f))" class="docs" hyphens="none">boolean?</a></span><span class="p">))</span>
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpk8" data-clipboard-target="#code_51" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_GNFaF&quot;)"></div><p id="a_GNFaF">In our code, we add <span class="my-code" decode="exclude">racket/contract</span> to our imports and add our con­tract to our <a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._provide))" class="docs" hyphens="none">provide</a> expres­sion using <span class="my-code" decode="exclude">contract-out</span>, so our mod­ule so far looks like this:</p></div><div class="filebox" anchorize="false"><div class="filename" anchorize="false" decode="exclude">jsonic/colorer.rkt</div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_GpQCO&quot;)"></div><div class="highlight-container" id="a_GpQCO"><div id="code_52" form="false" decode="exclude" style="font-size:0;width:0;height:0">#lang br<br/>(require brag/support syntax-color/racket-lexer<br/>         racket/contract)<br/><br/>(define jsonic-lexer<br/>  (lexer<br/>   [(eof) (values lexeme 'eof #f #f #f)]<br/>   [(:or "@$" "$@")<br/>    (values lexeme 'parenthesis<br/>            (if (equal? lexeme "@$") '|(| '|)|)<br/>            (pos lexeme-start) (pos lexeme-end))]<br/>   [(from/to "//" "\n")<br/>    (values lexeme 'comment #f<br/>            (pos lexeme-start) (pos lexeme-end))]<br/>   [any-char<br/>    (values lexeme 'string #f<br/>            (pos lexeme-start) (pos lexeme-end))]))<br/><br/>(define (color-jsonic port offset racket-coloring-mode?)<br/>  (cond<br/>    [(or (not racket-coloring-mode?)<br/>         (equal? (peek-string 2 0 port) "$@"))<br/>     (define-values (str cat paren start end)<br/>       (jsonic-lexer port))<br/>     (define switch-to-racket-mode (equal? str "@$"))<br/>     (values str cat paren start end 0 switch-to-racket-mode)]<br/>    [else<br/>     (define-values (str cat paren start end)<br/>       (racket-lexer port))<br/>     (values str cat paren start end 0 #t)]))<br/><br/>(provide<br/> (contract-out<br/>  [color-jsonic<br/>   (input-port? exact-nonnegative-integer? boolean?<br/>                . -&gt; . (values<br/>                        (or/c string? eof-object?)<br/>                        symbol?<br/>                        (or/c symbol? #f)<br/>                        (or/c exact-positive-integer? #f)<br/>                        (or/c exact-positive-integer? #f)<br/>                        exact-nonnegative-integer?<br/>                        boolean?))]))</div><div class="highlight" form="false" id="a_CBJk7"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43</pre></div></td><td class="code"><div class="source"><pre><span class="kn">#lang </span><span class="nn">br</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._require))" class="docs" hyphens="none">require</a></span> <span class="n">brag/support</span> <span class="n">syntax-color/racket-lexer</span>
<span class="hll">         <span class="n">racket/contract</span><span class="p">)</span>
</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="n">jsonic-lexer</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._lexer))" class="docs" hyphens="none">lexer</a></span>
   <span class="p">[(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/port-ops.html#(def._((quote._~23~25kernel)._eof))" class="docs" hyphens="none">eof</a></span><span class="p">)</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/values.html#(def._((quote._~23~25kernel)._values))" class="docs" hyphens="none">values</a></span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._lexeme))" class="docs" hyphens="none">lexeme</a></span> <span class="o">&#39;</span><span class="ss">eof</span> <span class="no">#f</span> <span class="no">#f</span> <span class="no">#f</span><span class="p">)]</span>
   <span class="p">[(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(form._((lib._brag/support..rkt)._~3aor))" class="docs" hyphens="none">:or</a></span> <span class="s2">"@$"</span> <span class="s2">"$@"</span><span class="p">)</span>
    <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/values.html#(def._((quote._~23~25kernel)._values))" class="docs" hyphens="none">values</a></span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._lexeme))" class="docs" hyphens="none">lexeme</a></span> <span class="o">&#39;</span><span class="ss">parenthesis</span>
            <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/if.html#(form._((quote._~23~25kernel)._if))" class="docs" hyphens="none">if</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/booleans.html#(def._((quote._~23~25kernel)._equal~3f))" class="docs" hyphens="none">equal?</a></span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._lexeme))" class="docs" hyphens="none">lexeme</a></span> <span class="s2">"@$"</span><span class="p">)</span> <span class="o">&#39;</span><span class="ss">|(|</span> <span class="o">&#39;</span><span class="ss">|)|</span><span class="p">)</span>
            <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(def._((lib._br-parser-tools/lex..rkt)._position-offset))" class="docs" hyphens="none">pos</a></span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._start-pos))" class="docs" hyphens="none">lexeme-start</a></span><span class="p">)</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(def._((lib._br-parser-tools/lex..rkt)._position-offset))" class="docs" hyphens="none">pos</a></span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._end-pos))" class="docs" hyphens="none">lexeme-end</a></span><span class="p">))]</span>
   <span class="p">[(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(form._((lib._brag/support..rkt)._from/to))" class="docs" hyphens="none">from/to</a></span> <span class="s2">"//"</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
    <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/values.html#(def._((quote._~23~25kernel)._values))" class="docs" hyphens="none">values</a></span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._lexeme))" class="docs" hyphens="none">lexeme</a></span> <span class="o">&#39;</span><span class="ss">comment</span> <span class="no">#f</span>
            <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(def._((lib._br-parser-tools/lex..rkt)._position-offset))" class="docs" hyphens="none">pos</a></span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._start-pos))" class="docs" hyphens="none">lexeme-start</a></span><span class="p">)</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(def._((lib._br-parser-tools/lex..rkt)._position-offset))" class="docs" hyphens="none">pos</a></span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._end-pos))" class="docs" hyphens="none">lexeme-end</a></span><span class="p">))]</span>
   <span class="p">[</span><span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._any-char))" class="docs" hyphens="none">any-char</a></span>
    <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/values.html#(def._((quote._~23~25kernel)._values))" class="docs" hyphens="none">values</a></span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._lexeme))" class="docs" hyphens="none">lexeme</a></span> <span class="o">&#39;</span><span class="ss">string</span> <span class="no">#f</span>
            <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(def._((lib._br-parser-tools/lex..rkt)._position-offset))" class="docs" hyphens="none">pos</a></span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._start-pos))" class="docs" hyphens="none">lexeme-start</a></span><span class="p">)</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(def._((lib._br-parser-tools/lex..rkt)._position-offset))" class="docs" hyphens="none">pos</a></span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._end-pos))" class="docs" hyphens="none">lexeme-end</a></span><span class="p">))]))</span>

<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="p">(</span><span class="n">color-jsonic</span> <span class="n">port</span> <span class="n">offset</span> <span class="n">racket-coloring-mode?</span><span class="p">)</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/if.html#(form._((lib._racket/private/letstx-scheme..rkt)._cond))" class="docs" hyphens="none">cond</a></span>
    <span class="p">[(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/if.html#(form._((lib._racket/private/letstx-scheme..rkt)._or))" class="docs" hyphens="none">or</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/booleans.html#(def._((quote._~23~25kernel)._not))" class="docs" hyphens="none">not</a></span> <span class="n">racket-coloring-mode?</span><span class="p">)</span>
         <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/booleans.html#(def._((quote._~23~25kernel)._equal~3f))" class="docs" hyphens="none">equal?</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/Byte_and_String_Input.html#(def._((quote._~23~25kernel)._peek-string))" class="docs" hyphens="none">peek-string</a></span> <span class="mi">2</span> <span class="mi">0</span> <span class="n">port</span><span class="p">)</span> <span class="s2">"$@"</span><span class="p">))</span>
     <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((quote._~23~25kernel)._define-values))" class="docs" hyphens="none">define-values</a></span> <span class="p">(</span><span class="n">str</span> <span class="n">cat</span> <span class="n">paren</span> <span class="n">start</span> <span class="n">end</span><span class="p">)</span>
       <span class="p">(</span><span class="n">jsonic-lexer</span> <span class="n">port</span><span class="p">))</span>
     <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="n">switch-to-racket-mode</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/booleans.html#(def._((quote._~23~25kernel)._equal~3f))" class="docs" hyphens="none">equal?</a></span> <span class="n">str</span> <span class="s2">"@$"</span><span class="p">))</span>
     <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/values.html#(def._((quote._~23~25kernel)._values))" class="docs" hyphens="none">values</a></span> <span class="n">str</span> <span class="n">cat</span> <span class="n">paren</span> <span class="n">start</span> <span class="n">end</span> <span class="mi">0</span> <span class="n">switch-to-racket-mode</span><span class="p">)]</span>
    <span class="p">[</span><span class="nb"><a href="http://docs.racket-lang.org/reference/if.html#(form._((lib._racket/private/letstx-scheme..rkt)._else))" class="docs" hyphens="none">else</a></span>
     <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((quote._~23~25kernel)._define-values))" class="docs" hyphens="none">define-values</a></span> <span class="p">(</span><span class="n">str</span> <span class="n">cat</span> <span class="n">paren</span> <span class="n">start</span> <span class="n">end</span><span class="p">)</span>
       <span class="p">(</span><span class="n">racket-lexer</span> <span class="n">port</span><span class="p">))</span>
     <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/values.html#(def._((quote._~23~25kernel)._values))" class="docs" hyphens="none">values</a></span> <span class="n">str</span> <span class="n">cat</span> <span class="n">paren</span> <span class="n">start</span> <span class="n">end</span> <span class="mi">0</span> <span class="no">#t</span><span class="p">)]))</span>

<span class="hll"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._provide))" class="docs" hyphens="none">provide</a></span>
</span><span class="hll"> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/attaching-contracts-to-values.html#(form._((lib._racket/contract/base..rkt)._contract-out))" class="docs" hyphens="none">contract-out</a></span>
</span><span class="hll">  <span class="p">[</span><span class="n">color-jsonic</span>
</span><span class="hll">   <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/port-ops.html#(def._((quote._~23~25kernel)._input-port~3f))" class="docs" hyphens="none">input-port?</a></span> <span class="nb"><a href="http://docs.racket-lang.org/reference/number-types.html#(def._((quote._~23~25kernel)._exact-nonnegative-integer~3f))" class="docs" hyphens="none">exact-nonnegative-integer?</a></span> <span class="nb"><a href="http://docs.racket-lang.org/reference/booleans.html#(def._((quote._~23~25kernel)._boolean~3f))" class="docs" hyphens="none">boolean?</a></span>
</span><span class="hll">                <span class="o">.</span> <span class="nb"><a href="http://docs.racket-lang.org/reference/function-contracts.html#(form._((lib._racket/contract/base..rkt)._-~3e))" class="docs" hyphens="none">-&gt;</a></span> <span class="o">.</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/values.html#(def._((quote._~23~25kernel)._values))" class="docs" hyphens="none">values</a></span>
</span><span class="hll">                        <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/data-structure-contracts.html#(def._((lib._racket/contract/base..rkt)._or/c))" class="docs" hyphens="none">or/c</a></span> <span class="nb"><a href="http://docs.racket-lang.org/reference/strings.html#(def._((quote._~23~25kernel)._string~3f))" class="docs" hyphens="none">string?</a></span> <span class="nb"><a href="http://docs.racket-lang.org/reference/port-ops.html#(def._((quote._~23~25kernel)._eof-object~3f))" class="docs" hyphens="none">eof-object?</a></span><span class="p">)</span>
</span><span class="hll">                        <span class="nb"><a href="http://docs.racket-lang.org/reference/symbols.html#(def._((quote._~23~25kernel)._symbol~3f))" class="docs" hyphens="none">symbol?</a></span>
</span><span class="hll">                        <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/data-structure-contracts.html#(def._((lib._racket/contract/base..rkt)._or/c))" class="docs" hyphens="none">or/c</a></span> <span class="nb"><a href="http://docs.racket-lang.org/reference/symbols.html#(def._((quote._~23~25kernel)._symbol~3f))" class="docs" hyphens="none">symbol?</a></span> <span class="no">#f</span><span class="p">)</span>
</span><span class="hll">                        <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/data-structure-contracts.html#(def._((lib._racket/contract/base..rkt)._or/c))" class="docs" hyphens="none">or/c</a></span> <span class="nb"><a href="http://docs.racket-lang.org/reference/number-types.html#(def._((quote._~23~25kernel)._exact-positive-integer~3f))" class="docs" hyphens="none">exact-positive-integer?</a></span> <span class="no">#f</span><span class="p">)</span>
</span><span class="hll">                        <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/data-structure-contracts.html#(def._((lib._racket/contract/base..rkt)._or/c))" class="docs" hyphens="none">or/c</a></span> <span class="nb"><a href="http://docs.racket-lang.org/reference/number-types.html#(def._((quote._~23~25kernel)._exact-positive-integer~3f))" class="docs" hyphens="none">exact-positive-integer?</a></span> <span class="no">#f</span><span class="p">)</span>
</span><span class="hll">                        <span class="nb"><a href="http://docs.racket-lang.org/reference/number-types.html#(def._((quote._~23~25kernel)._exact-nonnegative-integer~3f))" class="docs" hyphens="none">exact-nonnegative-integer?</a></span>
</span><span class="hll">                        <span class="nb"><a href="http://docs.racket-lang.org/reference/booleans.html#(def._((quote._~23~25kernel)._boolean~3f))" class="docs" hyphens="none">boolean?</a></span><span class="p">))]))</span>
</span></pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpk9" data-clipboard-target="#code_52" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;adding-a-unit-test&quot;)"></div><h3 anchor="adding-a-unit-test" class="subhead" id="adding-a-unit-test"><a href="#adding-a-unit-test">Adding a unit test</a></h3></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_UECru&quot;)"></div><p id="a_UECru">Let’s con­sider a sim­ple test case, where we use <a href="http://docs.racket-lang.org/reference/stringport.html#(def._((quote._~23~25kernel)._open-input-string))" class="docs" hyphens="none">open-input-string</a> to con­vert the string <span class="my-code" decode="exclude">"x"</span> into an input port that can be passed to <span class="my-code" decode="exclude">color-jsonic</span>, along with a default off­set argu­ment of <span class="my-code" decode="exclude">0</span> and a default mode argu­ment of <span class="my-code" decode="exclude">#f</span>:</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_w8FIu&quot;)"></div><div class="highlight-container" id="a_w8FIu"><div id="code_53" form="false" decode="exclude" style="font-size:0;width:0;height:0">(color-jsonic (open-input-string "x") 0 #f)</div><div class="highlight" form="false" id="a_ZHlem"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="source"><pre><span class="p">(</span><span class="n">color-jsonic</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/stringport.html#(def._((quote._~23~25kernel)._open-input-string))" class="docs" hyphens="none">open-input-string</a></span> <span class="s2">"x"</span><span class="p">)</span> <span class="mi">0</span> <span class="no">#f</span><span class="p">)</span>
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpka" data-clipboard-target="#code_53" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_36r8L&quot;)"></div><p id="a_36r8L">What result do we expect? The matched string should be <span class="my-code" decode="exclude">"x"</span>, the col­or­ing cat­e­gory should be <span class="my-code" decode="exclude">'string</span>, the paren­the­sis shape is <span class="my-code" decode="exclude">#f</span>, the start­ing and end­ing posi­tions are <span class="my-code" decode="exclude">1</span> and <span class="my-code" decode="exclude">2</span>, the backup dis­tance is <span class="my-code" decode="exclude">0</span>, and the mode remains <span class="my-code" decode="exclude">#f</span>. If we enter the above expres­sion at the REPL, we see that this is so:</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_11UnB&quot;)"></div><div class="highlight-container" id="a_11UnB"><div id="code_54" form="false" decode="exclude" style="font-size:0;width:0;height:0">"x"<br/>'string<br/>#f<br/>1<br/>2<br/>0<br/>#f</div><div class="highlight" form="false" id="a_uuxzZ"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="source"><pre><span class="s2">"x"</span>
<span class="o">&#39;</span><span class="ss">string</span>
<span class="no">#f</span>
<span class="mi">1</span>
<span class="mi">2</span>
<span class="mi">0</span>
<span class="no">#f</span>
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpkb" data-clipboard-target="#code_54" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_Nj5j3&quot;)"></div><p id="a_Nj5j3">Now we want to encap­su­late this in an auto­mated <a href="http://docs.racket-lang.org/rackunit/api.html?q=rackunit"><span class="my-code" decode="exclude">rackunit</span></a> test. Test­ing a func­tion that returns mul­ti­ple val­ues requires a lit­tle spe­cial han­dling. <a href="unit-tests.html">We saw</a> how <span class="my-code" decode="exclude">rackunit</span> pro­vides func­tions like <a href="http://docs.racket-lang.org/rackunit/api.html#(def._((lib._rackunit/main..rkt)._check-equal~3f))" class="docs" hyphens="none">check-equal?</a> to test the return value of an expres­sion. But these func­tions only take one value as input. They won’t work here, because <span class="my-code" decode="exclude">color-jsonic</span> returns five val­ues:</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_zLrBJ&quot;)"></div><div class="highlight-container" id="a_zLrBJ"><div id="code_55" form="false" decode="exclude" style="font-size:0;width:0;height:0">(module+ test<br/>  (require rackunit)<br/>  (check-equal?<br/>   (color-jsonic (open-input-string "x") 0 #f) 42))</div><div class="highlight" form="false" id="a_6zHdS"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="source"><pre><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/module.html#(form._((lib._racket/private/base..rkt)._module+))" class="docs" hyphens="none">module+</a></span> <span class="n">test</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._require))" class="docs" hyphens="none">require</a></span> <span class="n">rackunit</span><span class="p">)</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/rackunit/api.html#(def._((lib._rackunit/main..rkt)._check-equal~3f))" class="docs" hyphens="none">check-equal?</a></span>
   <span class="p">(</span><span class="n">color-jsonic</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/stringport.html#(def._((quote._~23~25kernel)._open-input-string))" class="docs" hyphens="none">open-input-string</a></span> <span class="s2">"x"</span><span class="p">)</span> <span class="mi">0</span> <span class="no">#f</span><span class="p">)</span> <span class="mi">42</span><span class="p">))</span>
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpkc" data-clipboard-target="#code_55" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_ZyeBY&quot;)"></div><div class="highlight-container err" id="a_ZyeBY"><div id="code_56" form="false" decode="exclude" style="font-size:0;width:0;height:0">result arity mismatch;<br/> expected number of values not received<br/>  expected: 1<br/>  received: 7<br/>  values...:</div><div class="highlight" form="false" id="a_Mn5KT"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="source"><pre>result arity mismatch;
 expected number of values not received
  expected: 1
  received: 7
  values...:
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpkd" data-clipboard-target="#code_56" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_Noe2M&quot;)"></div><p id="a_Noe2M">We wrap our test expres­sion in <a href="http://docs.racket-lang.org/br/index.html#(form._((lib._br/list..rkt)._values-~3elist))" class="docs" hyphens="none">values-&gt;list</a>, which will repack­age our five return val­ues as a five-ele­ment list (which only counts as one return value). We can then check this list against a list con­tain­ing our expected results:</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_rg5t3&quot;)"></div><div class="highlight-container" id="a_rg5t3"><div id="code_57" form="false" decode="exclude" style="font-size:0;width:0;height:0">(module+ test<br/>  (require rackunit)<br/>  (check-equal? (values-&gt;list<br/>                 (color-jsonic (open-input-string "x") 0 #f))<br/>                (list "x" 'string #f 1 2 0 #f)))</div><div class="highlight" form="false" id="a_iD0g8"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="source"><pre><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/module.html#(form._((lib._racket/private/base..rkt)._module+))" class="docs" hyphens="none">module+</a></span> <span class="n">test</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._require))" class="docs" hyphens="none">require</a></span> <span class="n">rackunit</span><span class="p">)</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/rackunit/api.html#(def._((lib._rackunit/main..rkt)._check-equal~3f))" class="docs" hyphens="none">check-equal?</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br/index.html#(form._((lib._br/list..rkt)._values-~3elist))" class="docs" hyphens="none">values-&gt;list</a></span>
                 <span class="p">(</span><span class="n">color-jsonic</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/stringport.html#(def._((quote._~23~25kernel)._open-input-string))" class="docs" hyphens="none">open-input-string</a></span> <span class="s2">"x"</span><span class="p">)</span> <span class="mi">0</span> <span class="no">#f</span><span class="p">))</span>
                <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._list))" class="docs" hyphens="none">list</a></span> <span class="s2">"x"</span> <span class="o">&#39;</span><span class="ss">string</span> <span class="no">#f</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">0</span> <span class="no">#f</span><span class="p">)))</span>
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpke" data-clipboard-target="#code_57" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_b1Gcm&quot;)"></div><p id="a_b1Gcm">Our <span class="my-code" decode="exclude">"jsonic/colorer.rkt"</span> ends up like this:</p></div><div class="filebox" anchorize="false"><div class="filename" anchorize="false" decode="exclude">jsonic/colorer.rkt</div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_7YvJ3&quot;)"></div><div class="highlight-container" id="a_7YvJ3"><div id="code_58" form="false" decode="exclude" style="font-size:0;width:0;height:0">#lang br<br/>(require brag/support syntax-color/racket-lexer<br/>         racket/contract)<br/><br/>(define jsonic-lexer<br/>  (lexer<br/>   [(eof) (values lexeme 'eof #f #f #f)]<br/>   [(:or "@$" "$@")<br/>    (values lexeme 'parenthesis<br/>            (if (equal? lexeme "@$") '|(| '|)|)<br/>            (pos lexeme-start) (pos lexeme-end))]<br/>   [(from/to "//" "\n")<br/>    (values lexeme 'comment #f<br/>            (pos lexeme-start) (pos lexeme-end))]<br/>   [any-char<br/>    (values lexeme 'string #f<br/>            (pos lexeme-start) (pos lexeme-end))]))<br/><br/>(define (color-jsonic port offset racket-coloring-mode?)<br/>  (cond<br/>    [(or (not racket-coloring-mode?)<br/>         (equal? (peek-string 2 0 port) "$@"))<br/>     (define-values (str cat paren start end)<br/>       (jsonic-lexer port))<br/>     (define switch-to-racket-mode (equal? str "@$"))<br/>     (values str cat paren start end 0 switch-to-racket-mode)]<br/>    [else<br/>     (define-values (str cat paren start end)<br/>       (racket-lexer port))<br/>     (values str cat paren start end 0 #t)]))<br/><br/>(provide<br/> (contract-out<br/>  [color-jsonic<br/>   (input-port? exact-nonnegative-integer? boolean?<br/>                . -&gt; . (values<br/>                        (or/c string? eof-object?)<br/>                        symbol?<br/>                        (or/c symbol? #f)<br/>                        (or/c exact-positive-integer? #f)<br/>                        (or/c exact-positive-integer? #f)<br/>                        exact-nonnegative-integer?<br/>                        boolean?))]))<br/><br/>(module+ test<br/>  (require rackunit)<br/>  (check-equal? (values-&gt;list<br/>                 (color-jsonic (open-input-string "x") 0 #f))<br/>                (list "x" 'string #f 1 2 0 #f)))
</div><div class="highlight" form="false" id="a_jkSb3"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49</pre></div></td><td class="code"><div class="source"><pre><span class="kn">#lang </span><span class="nn">br</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._require))" class="docs" hyphens="none">require</a></span> <span class="n">brag/support</span> <span class="n">syntax-color/racket-lexer</span>
         <span class="n">racket/contract</span><span class="p">)</span>

<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="n">jsonic-lexer</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._lexer))" class="docs" hyphens="none">lexer</a></span>
   <span class="p">[(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/port-ops.html#(def._((quote._~23~25kernel)._eof))" class="docs" hyphens="none">eof</a></span><span class="p">)</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/values.html#(def._((quote._~23~25kernel)._values))" class="docs" hyphens="none">values</a></span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._lexeme))" class="docs" hyphens="none">lexeme</a></span> <span class="o">&#39;</span><span class="ss">eof</span> <span class="no">#f</span> <span class="no">#f</span> <span class="no">#f</span><span class="p">)]</span>
   <span class="p">[(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(form._((lib._brag/support..rkt)._~3aor))" class="docs" hyphens="none">:or</a></span> <span class="s2">"@$"</span> <span class="s2">"$@"</span><span class="p">)</span>
    <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/values.html#(def._((quote._~23~25kernel)._values))" class="docs" hyphens="none">values</a></span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._lexeme))" class="docs" hyphens="none">lexeme</a></span> <span class="o">&#39;</span><span class="ss">parenthesis</span>
            <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/if.html#(form._((quote._~23~25kernel)._if))" class="docs" hyphens="none">if</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/booleans.html#(def._((quote._~23~25kernel)._equal~3f))" class="docs" hyphens="none">equal?</a></span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._lexeme))" class="docs" hyphens="none">lexeme</a></span> <span class="s2">"@$"</span><span class="p">)</span> <span class="o">&#39;</span><span class="ss">|(|</span> <span class="o">&#39;</span><span class="ss">|)|</span><span class="p">)</span>
            <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(def._((lib._br-parser-tools/lex..rkt)._position-offset))" class="docs" hyphens="none">pos</a></span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._start-pos))" class="docs" hyphens="none">lexeme-start</a></span><span class="p">)</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(def._((lib._br-parser-tools/lex..rkt)._position-offset))" class="docs" hyphens="none">pos</a></span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._end-pos))" class="docs" hyphens="none">lexeme-end</a></span><span class="p">))]</span>
   <span class="p">[(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(form._((lib._brag/support..rkt)._from/to))" class="docs" hyphens="none">from/to</a></span> <span class="s2">"//"</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
    <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/values.html#(def._((quote._~23~25kernel)._values))" class="docs" hyphens="none">values</a></span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._lexeme))" class="docs" hyphens="none">lexeme</a></span> <span class="o">&#39;</span><span class="ss">comment</span> <span class="no">#f</span>
            <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(def._((lib._br-parser-tools/lex..rkt)._position-offset))" class="docs" hyphens="none">pos</a></span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._start-pos))" class="docs" hyphens="none">lexeme-start</a></span><span class="p">)</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(def._((lib._br-parser-tools/lex..rkt)._position-offset))" class="docs" hyphens="none">pos</a></span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._end-pos))" class="docs" hyphens="none">lexeme-end</a></span><span class="p">))]</span>
   <span class="p">[</span><span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._any-char))" class="docs" hyphens="none">any-char</a></span>
    <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/values.html#(def._((quote._~23~25kernel)._values))" class="docs" hyphens="none">values</a></span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._lexeme))" class="docs" hyphens="none">lexeme</a></span> <span class="o">&#39;</span><span class="ss">string</span> <span class="no">#f</span>
            <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(def._((lib._br-parser-tools/lex..rkt)._position-offset))" class="docs" hyphens="none">pos</a></span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._start-pos))" class="docs" hyphens="none">lexeme-start</a></span><span class="p">)</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(def._((lib._br-parser-tools/lex..rkt)._position-offset))" class="docs" hyphens="none">pos</a></span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._end-pos))" class="docs" hyphens="none">lexeme-end</a></span><span class="p">))]))</span>

<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="p">(</span><span class="n">color-jsonic</span> <span class="n">port</span> <span class="n">offset</span> <span class="n">racket-coloring-mode?</span><span class="p">)</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/if.html#(form._((lib._racket/private/letstx-scheme..rkt)._cond))" class="docs" hyphens="none">cond</a></span>
    <span class="p">[(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/if.html#(form._((lib._racket/private/letstx-scheme..rkt)._or))" class="docs" hyphens="none">or</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/booleans.html#(def._((quote._~23~25kernel)._not))" class="docs" hyphens="none">not</a></span> <span class="n">racket-coloring-mode?</span><span class="p">)</span>
         <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/booleans.html#(def._((quote._~23~25kernel)._equal~3f))" class="docs" hyphens="none">equal?</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/Byte_and_String_Input.html#(def._((quote._~23~25kernel)._peek-string))" class="docs" hyphens="none">peek-string</a></span> <span class="mi">2</span> <span class="mi">0</span> <span class="n">port</span><span class="p">)</span> <span class="s2">"$@"</span><span class="p">))</span>
     <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((quote._~23~25kernel)._define-values))" class="docs" hyphens="none">define-values</a></span> <span class="p">(</span><span class="n">str</span> <span class="n">cat</span> <span class="n">paren</span> <span class="n">start</span> <span class="n">end</span><span class="p">)</span>
       <span class="p">(</span><span class="n">jsonic-lexer</span> <span class="n">port</span><span class="p">))</span>
     <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="n">switch-to-racket-mode</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/booleans.html#(def._((quote._~23~25kernel)._equal~3f))" class="docs" hyphens="none">equal?</a></span> <span class="n">str</span> <span class="s2">"@$"</span><span class="p">))</span>
     <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/values.html#(def._((quote._~23~25kernel)._values))" class="docs" hyphens="none">values</a></span> <span class="n">str</span> <span class="n">cat</span> <span class="n">paren</span> <span class="n">start</span> <span class="n">end</span> <span class="mi">0</span> <span class="n">switch-to-racket-mode</span><span class="p">)]</span>
    <span class="p">[</span><span class="nb"><a href="http://docs.racket-lang.org/reference/if.html#(form._((lib._racket/private/letstx-scheme..rkt)._else))" class="docs" hyphens="none">else</a></span>
     <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((quote._~23~25kernel)._define-values))" class="docs" hyphens="none">define-values</a></span> <span class="p">(</span><span class="n">str</span> <span class="n">cat</span> <span class="n">paren</span> <span class="n">start</span> <span class="n">end</span><span class="p">)</span>
       <span class="p">(</span><span class="n">racket-lexer</span> <span class="n">port</span><span class="p">))</span>
     <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/values.html#(def._((quote._~23~25kernel)._values))" class="docs" hyphens="none">values</a></span> <span class="n">str</span> <span class="n">cat</span> <span class="n">paren</span> <span class="n">start</span> <span class="n">end</span> <span class="mi">0</span> <span class="no">#t</span><span class="p">)]))</span>

<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._provide))" class="docs" hyphens="none">provide</a></span>
 <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/attaching-contracts-to-values.html#(form._((lib._racket/contract/base..rkt)._contract-out))" class="docs" hyphens="none">contract-out</a></span>
  <span class="p">[</span><span class="n">color-jsonic</span>
   <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/port-ops.html#(def._((quote._~23~25kernel)._input-port~3f))" class="docs" hyphens="none">input-port?</a></span> <span class="nb"><a href="http://docs.racket-lang.org/reference/number-types.html#(def._((quote._~23~25kernel)._exact-nonnegative-integer~3f))" class="docs" hyphens="none">exact-nonnegative-integer?</a></span> <span class="nb"><a href="http://docs.racket-lang.org/reference/booleans.html#(def._((quote._~23~25kernel)._boolean~3f))" class="docs" hyphens="none">boolean?</a></span>
                <span class="o">.</span> <span class="nb"><a href="http://docs.racket-lang.org/reference/function-contracts.html#(form._((lib._racket/contract/base..rkt)._-~3e))" class="docs" hyphens="none">-&gt;</a></span> <span class="o">.</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/values.html#(def._((quote._~23~25kernel)._values))" class="docs" hyphens="none">values</a></span>
                        <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/data-structure-contracts.html#(def._((lib._racket/contract/base..rkt)._or/c))" class="docs" hyphens="none">or/c</a></span> <span class="nb"><a href="http://docs.racket-lang.org/reference/strings.html#(def._((quote._~23~25kernel)._string~3f))" class="docs" hyphens="none">string?</a></span> <span class="nb"><a href="http://docs.racket-lang.org/reference/port-ops.html#(def._((quote._~23~25kernel)._eof-object~3f))" class="docs" hyphens="none">eof-object?</a></span><span class="p">)</span>
                        <span class="nb"><a href="http://docs.racket-lang.org/reference/symbols.html#(def._((quote._~23~25kernel)._symbol~3f))" class="docs" hyphens="none">symbol?</a></span>
                        <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/data-structure-contracts.html#(def._((lib._racket/contract/base..rkt)._or/c))" class="docs" hyphens="none">or/c</a></span> <span class="nb"><a href="http://docs.racket-lang.org/reference/symbols.html#(def._((quote._~23~25kernel)._symbol~3f))" class="docs" hyphens="none">symbol?</a></span> <span class="no">#f</span><span class="p">)</span>
                        <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/data-structure-contracts.html#(def._((lib._racket/contract/base..rkt)._or/c))" class="docs" hyphens="none">or/c</a></span> <span class="nb"><a href="http://docs.racket-lang.org/reference/number-types.html#(def._((quote._~23~25kernel)._exact-positive-integer~3f))" class="docs" hyphens="none">exact-positive-integer?</a></span> <span class="no">#f</span><span class="p">)</span>
                        <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/data-structure-contracts.html#(def._((lib._racket/contract/base..rkt)._or/c))" class="docs" hyphens="none">or/c</a></span> <span class="nb"><a href="http://docs.racket-lang.org/reference/number-types.html#(def._((quote._~23~25kernel)._exact-positive-integer~3f))" class="docs" hyphens="none">exact-positive-integer?</a></span> <span class="no">#f</span><span class="p">)</span>
                        <span class="nb"><a href="http://docs.racket-lang.org/reference/number-types.html#(def._((quote._~23~25kernel)._exact-nonnegative-integer~3f))" class="docs" hyphens="none">exact-nonnegative-integer?</a></span>
                        <span class="nb"><a href="http://docs.racket-lang.org/reference/booleans.html#(def._((quote._~23~25kernel)._boolean~3f))" class="docs" hyphens="none">boolean?</a></span><span class="p">))]))</span>

<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/module.html#(form._((lib._racket/private/base..rkt)._module+))" class="docs" hyphens="none">module+</a></span> <span class="n">test</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._require))" class="docs" hyphens="none">require</a></span> <span class="n">rackunit</span><span class="p">)</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/rackunit/api.html#(def._((lib._rackunit/main..rkt)._check-equal~3f))" class="docs" hyphens="none">check-equal?</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br/index.html#(form._((lib._br/list..rkt)._values-~3elist))" class="docs" hyphens="none">values-&gt;list</a></span>
                 <span class="p">(</span><span class="n">color-jsonic</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/stringport.html#(def._((quote._~23~25kernel)._open-input-string))" class="docs" hyphens="none">open-input-string</a></span> <span class="s2">"x"</span><span class="p">)</span> <span class="mi">0</span> <span class="no">#f</span><span class="p">))</span>
                <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._list))" class="docs" hyphens="none">list</a></span> <span class="s2">"x"</span> <span class="o">&#39;</span><span class="ss">string</span> <span class="no">#f</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">0</span> <span class="no">#f</span><span class="p">)))</span>
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpkf" data-clipboard-target="#code_58" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_xsRrs&quot;)"></div><p id="a_xsRrs">Of course, in prac­tice we’d want to write (a lot) more than one unit test. But this suf­fices to intro­duce the basic pat­tern for how we’d write tests for <span class="my-code" decode="exclude">color-jsonic</span>.</p></div><div anchorize="false" style="height:2em"></div><ul class="siblinks"><li><a href="intro.html">1&emsp;intro</a></li><li><a href="setup.html">2&emsp;setup</a></li><li><a href="contracts.html">3&emsp;con­tracts</a></li><li><a href="unit-tests.html">4&emsp;unit tests</a></li><li><a href="source-locations.html">5&emsp;source loca­tions</a></li><li><a href="drracket-integration.html">6&emsp;drracket inte­gra­tion</a></li><li><a class="here" href="syntax-coloring.html">7&emsp;syn­tax col­or­ing</a></li><li><a href="indenting.html">8&emsp;indent­ing</a></li><li><a href="toolbar-buttons.html">9&emsp;tool­bar but­tons</a></li><li><a href="recap.html">10&emsp;recap</a></li><li><a href="source-listing.html">11&emsp;source list­ing</a></li></ul></div>
    <a class="nav-left" href="drracket-integration.html">← prev</a>
    <a class="nav-right" href="indenting.html">next →</a>




</body>

<script type="text/javascript">



function show_all_forms() {
 var elems = document.getElementsByClassName('has_form');
 for (var i = 0 ; i < elems.length ; i++) {
  toggle_form(elems[i].id);
 }
}

// for debugging forms only: uncomment next line
// show_all_forms();

// sets up copy-to-clipboard buttons in code boxes
var clipboard = new Clipboard('.copy-button');
clipboard.on('success', function(e) {console.log(e);});
clipboard.on('error', function(e) {console.log(e);});
</script>