<!DOCTYPE html>
<html>
  
<!-- Mirrored from beautifulracket.com/jsonic-2/source-listing.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 16 Mar 2017 05:47:33 GMT -->
<head>
    <meta charset="UTF-8">
    <title>Beautiful Racket: Level up: jsonic revisited</title>
    <link rel="stylesheet" type="text/css" media="all" href="../styles.css"/>
    <script type="text/javascript" src="../functions.js"></script>
    <script type="text/javascript" src="../clipboard.min.js"></script>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-74684045-1', 'auto');
      ga('send', 'pageview');
    </script>
  </head>
<body>
<div id="alert">Thank you for your comment</div>
    <div id="doc"><h3 class="dept" anchorize="false"><a href="../index.html">Beau­ti­ful Racket</a> / <a href="../index.html#tutorials">tuto­ri­als</a></h3><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;level-up-jsonic-revisited&quot;)"></div><h1 anchor="level-up-jsonic-revisited" id="level-up-jsonic-revisited" hyphens="none">Level up: <span class="my-code" decode="exclude">jsonic</span> revisited</h1></div><ul class="siblinks"><li><a href="intro.html">1&emsp;intro</a></li><li><a href="setup.html">2&emsp;setup</a></li><li><a href="contracts.html">3&emsp;con­tracts</a></li><li><a href="unit-tests.html">4&emsp;unit tests</a></li><li><a href="source-locations.html">5&emsp;source loca­tions</a></li><li><a href="drracket-integration.html">6&emsp;drracket inte­gra­tion</a></li><li><a href="syntax-coloring.html">7&emsp;syn­tax col­or­ing</a></li><li><a href="indenting.html">8&emsp;indent­ing</a></li><li><a href="toolbar-buttons.html">9&emsp;tool­bar but­tons</a></li><li><a href="recap.html">10&emsp;recap</a></li><li><a class="here" href="source-listing.html">11&emsp;source list­ing</a></li></ul><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_4HesN&quot;)"></div><p id="a_4HesN">This source list­ing assumes that we’ve cre­ated a <span class="my-code" decode="exclude">jsonic</span> direc­tory and installed it as a pack­age as described in <a href="setup.html">setup</a>.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_05vk3&quot;)"></div><p id="a_05vk3"><a class="ziplink" href="jsonic-2-tutorial.zip">Down­load jsonic-2-tuto­r­ial.zip</a></p></div><div class="filebox" anchorize="false"><div class="filename" anchorize="false" decode="exclude">jsonic/main.rkt</div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_HT5Y7&quot;)"></div><div class="highlight-container" id="a_HT5Y7"><div id="code_43" form="false" decode="exclude" style="font-size:0;width:0;height:0">#lang br/quicklang<br/>(module reader br<br/>  (require "reader.rkt")<br/>  (provide read-syntax get-info)<br/>  (define (get-info port src-mod src-line src-col src-pos)<br/>    (define (handle-query key default)<br/>      (case key<br/>        [(color-lexer)<br/>         (dynamic-require 'jsonic/colorer 'color-jsonic)]<br/>        [(drracket:indentation)<br/>         (dynamic-require 'jsonic/indenter 'indent-jsonic)]<br/>        [(drracket:toolbar-buttons)<br/>         (dynamic-require 'jsonic/buttons 'button-list)]<br/>        [else default]))<br/>    handle-query))<br/>
</div><div class="highlight" form="false" id="a_74DeP"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class="code"><div class="source"><pre><span class="kn">#lang </span><span class="nn">br/quicklang</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/module.html#(form._((quote._~23~25kernel)._module))" class="docs" hyphens="none">module</a></span> <span class="n">reader</span> <span class="n">br</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._require))" class="docs" hyphens="none">require</a></span> <span class="s2">"reader.rkt"</span><span class="p">)</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._provide))" class="docs" hyphens="none">provide</a></span> <span class="nb"><a href="http://docs.racket-lang.org/reference/Reading.html#(def._((quote._~23~25kernel)._read-syntax))" class="docs" hyphens="none">read-syntax</a></span> <span class="n">get-info</span><span class="p">)</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="p">(</span><span class="n">get-info</span> <span class="n">port</span> <span class="n">src-mod</span> <span class="n">src-line</span> <span class="n">src-col</span> <span class="n">src-pos</span><span class="p">)</span>
    <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="p">(</span><span class="n">handle-query</span> <span class="n">key</span> <span class="n">default</span><span class="p">)</span>
      <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/case.html#(form._((lib._racket/private/more-scheme..rkt)._case))" class="docs" hyphens="none">case</a></span> <span class="n">key</span>
        <span class="p">[(</span><span class="n">color-lexer</span><span class="p">)</span>
         <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/Module_Names_and_Loading.html#(def._((quote._~23~25kernel)._dynamic-require))" class="docs" hyphens="none">dynamic-require</a></span> <span class="o">&#39;</span><span class="ss">jsonic/colorer</span> <span class="o">&#39;</span><span class="ss">color-jsonic</span><span class="p">)]</span>
        <span class="p">[(</span><span class="n">drracket:indentation</span><span class="p">)</span>
         <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/Module_Names_and_Loading.html#(def._((quote._~23~25kernel)._dynamic-require))" class="docs" hyphens="none">dynamic-require</a></span> <span class="o">&#39;</span><span class="ss">jsonic/indenter</span> <span class="o">&#39;</span><span class="ss">indent-jsonic</span><span class="p">)]</span>
        <span class="p">[(</span><span class="n">drracket:toolbar-buttons</span><span class="p">)</span>
         <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/Module_Names_and_Loading.html#(def._((quote._~23~25kernel)._dynamic-require))" class="docs" hyphens="none">dynamic-require</a></span> <span class="o">&#39;</span><span class="ss">jsonic/buttons</span> <span class="o">&#39;</span><span class="ss">button-list</span><span class="p">)]</span>
        <span class="p">[</span><span class="nb"><a href="http://docs.racket-lang.org/reference/if.html#(form._((lib._racket/private/letstx-scheme..rkt)._else))" class="docs" hyphens="none">else</a></span> <span class="n">default</span><span class="p">]))</span>
    <span class="n">handle-query</span><span class="p">))</span>
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpk" data-clipboard-target="#code_43" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div></div><div class="filebox" anchorize="false"><div class="filename" anchorize="false" decode="exclude">jsonic/reader.rkt</div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_zW2ly&quot;)"></div><div class="highlight-container" id="a_zW2ly"><div id="code_44" form="false" decode="exclude" style="font-size:0;width:0;height:0">#lang br/quicklang<br/>(require "tokenizer.rkt" "parser.rkt" racket/contract)<br/><br/>(define (read-syntax path port)<br/>  (define parse-tree (parse path (make-tokenizer port)))<br/>  (define module-datum `(module jsonic-module jsonic/expander<br/>                          ,parse-tree))<br/>  (datum-&gt;syntax #f module-datum))<br/>(provide (contract-out<br/>          [read-syntax (any/c input-port? . -&gt; . syntax?)]))
</div><div class="highlight" form="false" id="a_EUC63"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="source"><pre><span class="kn">#lang </span><span class="nn">br/quicklang</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._require))" class="docs" hyphens="none">require</a></span> <span class="s2">"tokenizer.rkt"</span> <span class="s2">"parser.rkt"</span> <span class="n">racket/contract</span><span class="p">)</span>

<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/Reading.html#(def._((quote._~23~25kernel)._read-syntax))" class="docs" hyphens="none">read-syntax</a></span> <span class="n">path</span> <span class="n">port</span><span class="p">)</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="n">parse-tree</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(def._((lib._brag/examples/nested-word-list..rkt)._parse))" class="docs" hyphens="none">parse</a></span> <span class="n">path</span> <span class="p">(</span><span class="n">make-tokenizer</span> <span class="n">port</span><span class="p">)))</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="n">module-datum</span> <span class="o">`</span><span class="p">(</span><span class="ss">module</span> <span class="ss">jsonic-module</span> <span class="ss">jsonic/expander</span>
                          <span class="o">,</span><span class="n">parse-tree</span><span class="p">))</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/stxops.html#(def._((quote._~23~25kernel)._datum-~3esyntax))" class="docs" hyphens="none">datum-&gt;syntax</a></span> <span class="no">#f</span> <span class="n">module-datum</span><span class="p">))</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._provide))" class="docs" hyphens="none">provide</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/attaching-contracts-to-values.html#(form._((lib._racket/contract/base..rkt)._contract-out))" class="docs" hyphens="none">contract-out</a></span>
          <span class="p">[</span><span class="nb"><a href="http://docs.racket-lang.org/reference/Reading.html#(def._((quote._~23~25kernel)._read-syntax))" class="docs" hyphens="none">read-syntax</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/data-structure-contracts.html#(def._((lib._racket/contract/private/misc..rkt)._any/c))" class="docs" hyphens="none">any/c</a></span> <span class="nb"><a href="http://docs.racket-lang.org/reference/port-ops.html#(def._((quote._~23~25kernel)._input-port~3f))" class="docs" hyphens="none">input-port?</a></span> <span class="o">.</span> <span class="nb"><a href="http://docs.racket-lang.org/reference/function-contracts.html#(form._((lib._racket/contract/base..rkt)._-~3e))" class="docs" hyphens="none">-&gt;</a></span> <span class="o">.</span> <span class="nb"><a href="http://docs.racket-lang.org/reference/stxops.html#(def._((quote._~23~25kernel)._syntax~3f))" class="docs" hyphens="none">syntax?</a></span><span class="p">)]))</span>
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpk1" data-clipboard-target="#code_44" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div></div><div class="filebox" anchorize="false"><div class="filename" anchorize="false" decode="exclude">jsonic/tokenizer.rkt</div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_BIQXE&quot;)"></div><div class="highlight-container" id="a_BIQXE"><div id="code_45" form="false" decode="exclude" style="font-size:0;width:0;height:0">#lang br/quicklang<br/>(require brag/support racket/contract)<br/><br/>(module+ test<br/>  (require rackunit))<br/><br/>(define (jsonic-token? x)<br/>  (or (eof-object? x) (string? x) (token-struct? x)))<br/><br/>(module+ test<br/>  (check-true (jsonic-token? eof))<br/>  (check-true (jsonic-token? "a string"))<br/>  (check-true (jsonic-token? (token 'A-TOKEN-STRUCT "hi")))<br/>  (check-false (jsonic-token? 42)))<br/><br/>(define (make-tokenizer port)<br/>  (port-count-lines! port)<br/>  (define (next-token)<br/>    (define jsonic-lexer<br/>      (lexer<br/>       [(eof) eof]<br/>       [(from/to "//" "\n") (next-token)]<br/>       [(from/to "@$" "$@")<br/>        (token 'SEXP-TOK (trim-ends "@$" lexeme "$@")<br/>               #:position (+ (pos lexeme-start) 2)<br/>               #:line (line lexeme-start)<br/>               #:column (+ (col lexeme-start) 2)<br/>               #:span (- (pos lexeme-end)<br/>                         (pos lexeme-start) 4))]<br/>       [any-char (token 'CHAR-TOK lexeme<br/>                        #:position (pos lexeme-start)<br/>                        #:line (line lexeme-start)<br/>                        #:column (col lexeme-start)<br/>                        #:span (- (pos lexeme-end)<br/>                                  (pos lexeme-start)))]))<br/>    (jsonic-lexer port))<br/>  next-token)<br/>(provide<br/> (contract-out<br/>  [make-tokenizer (input-port? . -&gt; . (-&gt; jsonic-token?))]))<br/><br/>(module+ test<br/>  (check-equal?<br/>   (apply-tokenizer-maker make-tokenizer "// comment\n")<br/>   empty)<br/>  (check-equal?<br/>   (apply-tokenizer-maker make-tokenizer "@$ (+ 6 7) $@")<br/>   (list (token 'SEXP-TOK " (+ 6 7) "<br/>                #:position 3<br/>                #:line 1<br/>                #:column 2<br/>                #:span 9)))<br/>  (check-equal?<br/>   (apply-tokenizer-maker make-tokenizer "hi")<br/>   (list (token 'CHAR-TOK "h"<br/>                #:position 1<br/>                #:line 1<br/>                #:column 0<br/>                #:span 1)<br/>         (token 'CHAR-TOK "i"<br/>                #:position 2<br/>                #:line 1<br/>                #:column 1<br/>                #:span 1))))</div><div class="highlight" form="false" id="a_mEJD7"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64</pre></div></td><td class="code"><div class="source"><pre><span class="kn">#lang </span><span class="nn">br/quicklang</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._require))" class="docs" hyphens="none">require</a></span> <span class="n">brag/support</span> <span class="n">racket/contract</span><span class="p">)</span>

<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/module.html#(form._((lib._racket/private/base..rkt)._module+))" class="docs" hyphens="none">module+</a></span> <span class="n">test</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._require))" class="docs" hyphens="none">require</a></span> <span class="n">rackunit</span><span class="p">))</span>

<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="p">(</span><span class="n">jsonic-token?</span> <span class="n">x</span><span class="p">)</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/if.html#(form._((lib._racket/private/letstx-scheme..rkt)._or))" class="docs" hyphens="none">or</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/port-ops.html#(def._((quote._~23~25kernel)._eof-object~3f))" class="docs" hyphens="none">eof-object?</a></span> <span class="n">x</span><span class="p">)</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/strings.html#(def._((quote._~23~25kernel)._string~3f))" class="docs" hyphens="none">string?</a></span> <span class="n">x</span><span class="p">)</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(def._((lib._brag/support..rkt)._token-struct~3f))" class="docs" hyphens="none">token-struct?</a></span> <span class="n">x</span><span class="p">)))</span>

<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/module.html#(form._((lib._racket/private/base..rkt)._module+))" class="docs" hyphens="none">module+</a></span> <span class="n">test</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/rackunit/api.html#(def._((lib._rackunit/main..rkt)._check-true))" class="docs" hyphens="none">check-true</a></span> <span class="p">(</span><span class="n">jsonic-token?</span> <span class="nb"><a href="http://docs.racket-lang.org/reference/port-ops.html#(def._((quote._~23~25kernel)._eof))" class="docs" hyphens="none">eof</a></span><span class="p">))</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/rackunit/api.html#(def._((lib._rackunit/main..rkt)._check-true))" class="docs" hyphens="none">check-true</a></span> <span class="p">(</span><span class="n">jsonic-token?</span> <span class="s2">"a string"</span><span class="p">))</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/rackunit/api.html#(def._((lib._rackunit/main..rkt)._check-true))" class="docs" hyphens="none">check-true</a></span> <span class="p">(</span><span class="n">jsonic-token?</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(def._((lib._brag/support..rkt)._token))" class="docs" hyphens="none">token</a></span> <span class="o">&#39;</span><span class="ss">A-TOKEN-STRUCT</span> <span class="s2">"hi"</span><span class="p">)))</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/rackunit/api.html#(def._((lib._rackunit/main..rkt)._check-false))" class="docs" hyphens="none">check-false</a></span> <span class="p">(</span><span class="n">jsonic-token?</span> <span class="mi">42</span><span class="p">)))</span>

<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="p">(</span><span class="n">make-tokenizer</span> <span class="n">port</span><span class="p">)</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/linecol.html#(def._((quote._~23~25kernel)._port-count-lines!))" class="docs" hyphens="none">port-count-lines!</a></span> <span class="n">port</span><span class="p">)</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="p">(</span><span class="n">next-token</span><span class="p">)</span>
    <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="n">jsonic-lexer</span>
      <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._lexer))" class="docs" hyphens="none">lexer</a></span>
       <span class="p">[(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/port-ops.html#(def._((quote._~23~25kernel)._eof))" class="docs" hyphens="none">eof</a></span><span class="p">)</span> <span class="nb"><a href="http://docs.racket-lang.org/reference/port-ops.html#(def._((quote._~23~25kernel)._eof))" class="docs" hyphens="none">eof</a></span><span class="p">]</span>
       <span class="p">[(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(form._((lib._brag/support..rkt)._from/to))" class="docs" hyphens="none">from/to</a></span> <span class="s2">"//"</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span> <span class="p">(</span><span class="n">next-token</span><span class="p">)]</span>
       <span class="p">[(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(form._((lib._brag/support..rkt)._from/to))" class="docs" hyphens="none">from/to</a></span> <span class="s2">"@$"</span> <span class="s2">"$@"</span><span class="p">)</span>
        <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(def._((lib._brag/support..rkt)._token))" class="docs" hyphens="none">token</a></span> <span class="o">&#39;</span><span class="ss">SEXP-TOK</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(def._((lib._brag/support..rkt)._trim-ends))" class="docs" hyphens="none">trim-ends</a></span> <span class="s2">"@$"</span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._lexeme))" class="docs" hyphens="none">lexeme</a></span> <span class="s2">"$@"</span><span class="p">)</span>
               <span class="kd">#:position</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._+))" class="docs" hyphens="none">+</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(def._((lib._br-parser-tools/lex..rkt)._position-offset))" class="docs" hyphens="none">pos</a></span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._start-pos))" class="docs" hyphens="none">lexeme-start</a></span><span class="p">)</span> <span class="mi">2</span><span class="p">)</span>
               <span class="kd">#:line</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br/index.html#(def._((lib._br/indent..rkt)._line))" class="docs" hyphens="none">line</a></span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._start-pos))" class="docs" hyphens="none">lexeme-start</a></span><span class="p">)</span>
               <span class="kd">#:column</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._+))" class="docs" hyphens="none">+</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(def._((lib._br-parser-tools/lex..rkt)._position-col))" class="docs" hyphens="none">col</a></span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._start-pos))" class="docs" hyphens="none">lexeme-start</a></span><span class="p">)</span> <span class="mi">2</span><span class="p">)</span>
               <span class="kd">#:span</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._-))" class="docs" hyphens="none">-</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(def._((lib._br-parser-tools/lex..rkt)._position-offset))" class="docs" hyphens="none">pos</a></span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._end-pos))" class="docs" hyphens="none">lexeme-end</a></span><span class="p">)</span>
                         <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(def._((lib._br-parser-tools/lex..rkt)._position-offset))" class="docs" hyphens="none">pos</a></span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._start-pos))" class="docs" hyphens="none">lexeme-start</a></span><span class="p">)</span> <span class="mi">4</span><span class="p">))]</span>
       <span class="p">[</span><span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._any-char))" class="docs" hyphens="none">any-char</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(def._((lib._brag/support..rkt)._token))" class="docs" hyphens="none">token</a></span> <span class="o">&#39;</span><span class="ss">CHAR-TOK</span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._lexeme))" class="docs" hyphens="none">lexeme</a></span>
                        <span class="kd">#:position</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(def._((lib._br-parser-tools/lex..rkt)._position-offset))" class="docs" hyphens="none">pos</a></span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._start-pos))" class="docs" hyphens="none">lexeme-start</a></span><span class="p">)</span>
                        <span class="kd">#:line</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br/index.html#(def._((lib._br/indent..rkt)._line))" class="docs" hyphens="none">line</a></span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._start-pos))" class="docs" hyphens="none">lexeme-start</a></span><span class="p">)</span>
                        <span class="kd">#:column</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(def._((lib._br-parser-tools/lex..rkt)._position-col))" class="docs" hyphens="none">col</a></span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._start-pos))" class="docs" hyphens="none">lexeme-start</a></span><span class="p">)</span>
                        <span class="kd">#:span</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._-))" class="docs" hyphens="none">-</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(def._((lib._br-parser-tools/lex..rkt)._position-offset))" class="docs" hyphens="none">pos</a></span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._end-pos))" class="docs" hyphens="none">lexeme-end</a></span><span class="p">)</span>
                                  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(def._((lib._br-parser-tools/lex..rkt)._position-offset))" class="docs" hyphens="none">pos</a></span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._start-pos))" class="docs" hyphens="none">lexeme-start</a></span><span class="p">)))]))</span>
    <span class="p">(</span><span class="n">jsonic-lexer</span> <span class="n">port</span><span class="p">))</span>
  <span class="n">next-token</span><span class="p">)</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._provide))" class="docs" hyphens="none">provide</a></span>
 <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/attaching-contracts-to-values.html#(form._((lib._racket/contract/base..rkt)._contract-out))" class="docs" hyphens="none">contract-out</a></span>
  <span class="p">[</span><span class="n">make-tokenizer</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/port-ops.html#(def._((quote._~23~25kernel)._input-port~3f))" class="docs" hyphens="none">input-port?</a></span> <span class="o">.</span> <span class="nb"><a href="http://docs.racket-lang.org/reference/function-contracts.html#(form._((lib._racket/contract/base..rkt)._-~3e))" class="docs" hyphens="none">-&gt;</a></span> <span class="o">.</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/function-contracts.html#(form._((lib._racket/contract/base..rkt)._-~3e))" class="docs" hyphens="none">-&gt;</a></span> <span class="n">jsonic-token?</span><span class="p">))]))</span>

<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/module.html#(form._((lib._racket/private/base..rkt)._module+))" class="docs" hyphens="none">module+</a></span> <span class="n">test</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/rackunit/api.html#(def._((lib._rackunit/main..rkt)._check-equal~3f))" class="docs" hyphens="none">check-equal?</a></span>
   <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(def._((lib._brag/support..rkt)._apply-tokenizer-maker))" class="docs" hyphens="none">apply-tokenizer-maker</a></span> <span class="n">make-tokenizer</span> <span class="s2">"// comment</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
   <span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((lib._racket/list..rkt)._empty))" class="docs" hyphens="none">empty</a></span><span class="p">)</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/rackunit/api.html#(def._((lib._rackunit/main..rkt)._check-equal~3f))" class="docs" hyphens="none">check-equal?</a></span>
   <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(def._((lib._brag/support..rkt)._apply-tokenizer-maker))" class="docs" hyphens="none">apply-tokenizer-maker</a></span> <span class="n">make-tokenizer</span> <span class="s2">"@$ (+ 6 7) $@"</span><span class="p">)</span>
   <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._list))" class="docs" hyphens="none">list</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(def._((lib._brag/support..rkt)._token))" class="docs" hyphens="none">token</a></span> <span class="o">&#39;</span><span class="ss">SEXP-TOK</span> <span class="s2">" (+ 6 7) "</span>
                <span class="kd">#:position</span> <span class="mi">3</span>
                <span class="kd">#:line</span> <span class="mi">1</span>
                <span class="kd">#:column</span> <span class="mi">2</span>
                <span class="kd">#:span</span> <span class="mi">9</span><span class="p">)))</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/rackunit/api.html#(def._((lib._rackunit/main..rkt)._check-equal~3f))" class="docs" hyphens="none">check-equal?</a></span>
   <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(def._((lib._brag/support..rkt)._apply-tokenizer-maker))" class="docs" hyphens="none">apply-tokenizer-maker</a></span> <span class="n">make-tokenizer</span> <span class="s2">"hi"</span><span class="p">)</span>
   <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._list))" class="docs" hyphens="none">list</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(def._((lib._brag/support..rkt)._token))" class="docs" hyphens="none">token</a></span> <span class="o">&#39;</span><span class="ss">CHAR-TOK</span> <span class="s2">"h"</span>
                <span class="kd">#:position</span> <span class="mi">1</span>
                <span class="kd">#:line</span> <span class="mi">1</span>
                <span class="kd">#:column</span> <span class="mi">0</span>
                <span class="kd">#:span</span> <span class="mi">1</span><span class="p">)</span>
         <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(def._((lib._brag/support..rkt)._token))" class="docs" hyphens="none">token</a></span> <span class="o">&#39;</span><span class="ss">CHAR-TOK</span> <span class="s2">"i"</span>
                <span class="kd">#:position</span> <span class="mi">2</span>
                <span class="kd">#:line</span> <span class="mi">1</span>
                <span class="kd">#:column</span> <span class="mi">1</span>
                <span class="kd">#:span</span> <span class="mi">1</span><span class="p">))))</span>
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpk2" data-clipboard-target="#code_45" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div></div><div class="filebox" anchorize="false"><div class="filename" anchorize="false" decode="exclude">jsonic/parser.rkt</div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_GE34m&quot;)"></div><div class="highlight-container" id="a_GE34m"><div id="code_46" form="false" decode="exclude" style="font-size:0;width:0;height:0">#lang brag<br/>jsonic-program : (jsonic-char | jsonic-sexp)*<br/>jsonic-char    : CHAR-TOK<br/>jsonic-sexp    : SEXP-TOK
</div><div class="highlight" form="false" id="a_5vnS4"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="source"><pre>#lang brag
jsonic-program : (jsonic-char | jsonic-sexp)*
jsonic-char    : CHAR-TOK
jsonic-sexp    : SEXP-TOK
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpk3" data-clipboard-target="#code_46" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div></div><div class="filebox" anchorize="false"><div class="filename" anchorize="false" decode="exclude">jsonic/expander.rkt</div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_HfwGf&quot;)"></div><div class="highlight-container" id="a_HfwGf"><div id="code_47" form="false" decode="exclude" style="font-size:0;width:0;height:0">#lang br/quicklang<br/>(require json)<br/><br/>(define-macro (js-module-begin PARSE-TREE)<br/>  #'(#%module-begin<br/>     (define result-string PARSE-TREE)<br/>     (define validated-jsexpr (string-&gt;jsexpr result-string))<br/>     (display result-string)))<br/>(provide (rename-out [js-module-begin #%module-begin]))<br/><br/>(define-macro (jsonic-char CHAR-TOK-VALUE)<br/>  #'CHAR-TOK-VALUE)<br/>(provide jsonic-char)<br/><br/>(define-macro (jsonic-program SEXP-OR-JSON-STR ...)<br/>  #'(string-trim (string-append SEXP-OR-JSON-STR ...)))<br/>(provide jsonic-program)<br/><br/>(define-macro (jsonic-sexp SEXP-STR)<br/>  (with-pattern ([SEXP-DATUM (format-datum '~a #'SEXP-STR)])<br/>    #'(jsexpr-&gt;string SEXP-DATUM)))<br/>(provide jsonic-sexp)</div><div class="highlight" form="false" id="a_IvYw3"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22</pre></div></td><td class="code"><div class="source"><pre><span class="kn">#lang </span><span class="nn">br/quicklang</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._require))" class="docs" hyphens="none">require</a></span> <span class="n">json</span><span class="p">)</span>

<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br/index.html#(form._((lib._br/define..rkt)._define-macro))" class="docs" hyphens="none">define-macro</a></span> <span class="p">(</span><span class="n">js-module-begin</span> <span class="n">PARSE-TREE</span><span class="p">)</span>
  <span class="o">#&#39;</span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/module.html#(form._((lib._racket/private/base..rkt)._~23~25module-begin))" class="docs" hyphens="none">#%module-begin</a></span>
     <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="n">result-string</span> <span class="n">PARSE-TREE</span><span class="p">)</span>
     <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="n">validated-jsexpr</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/json/index.html#(def._((lib._json/main..rkt)._string-~3ejsexpr))" class="docs" hyphens="none">string-&gt;jsexpr</a></span> <span class="n">result-string</span><span class="p">))</span>
     <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/Writing.html#(def._((quote._~23~25kernel)._display))" class="docs" hyphens="none">display</a></span> <span class="n">result-string</span><span class="p">)))</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._provide))" class="docs" hyphens="none">provide</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._rename-out))" class="docs" hyphens="none">rename-out</a></span> <span class="p">[</span><span class="n">js-module-begin</span> <span class="nb"><a href="http://docs.racket-lang.org/reference/module.html#(form._((lib._racket/private/base..rkt)._~23~25module-begin))" class="docs" hyphens="none">#%module-begin</a></span><span class="p">]))</span>

<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br/index.html#(form._((lib._br/define..rkt)._define-macro))" class="docs" hyphens="none">define-macro</a></span> <span class="p">(</span><span class="n">jsonic-char</span> <span class="n">CHAR-TOK-VALUE</span><span class="p">)</span>
  <span class="o">#&#39;</span><span class="n">CHAR-TOK-VALUE</span><span class="p">)</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._provide))" class="docs" hyphens="none">provide</a></span> <span class="n">jsonic-char</span><span class="p">)</span>

<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br/index.html#(form._((lib._br/define..rkt)._define-macro))" class="docs" hyphens="none">define-macro</a></span> <span class="p">(</span><span class="n">jsonic-program</span> <span class="n">SEXP-OR-JSON-STR</span> <span class="nb"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))" class="docs" hyphens="none">...</a></span><span class="p">)</span>
  <span class="o">#&#39;</span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/strings.html#(def._((lib._racket/string..rkt)._string-trim))" class="docs" hyphens="none">string-trim</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/strings.html#(def._((quote._~23~25kernel)._string-append))" class="docs" hyphens="none">string-append</a></span> <span class="n">SEXP-OR-JSON-STR</span> <span class="nb"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))" class="docs" hyphens="none">...</a></span><span class="p">)))</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._provide))" class="docs" hyphens="none">provide</a></span> <span class="n">jsonic-program</span><span class="p">)</span>

<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br/index.html#(form._((lib._br/define..rkt)._define-macro))" class="docs" hyphens="none">define-macro</a></span> <span class="p">(</span><span class="n">jsonic-sexp</span> <span class="n">SEXP-STR</span><span class="p">)</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br/index.html#(form._((lib._br/syntax..rkt)._with-pattern))" class="docs" hyphens="none">with-pattern</a></span> <span class="p">([</span><span class="n">SEXP-DATUM</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br/index.html#(def._((lib._br/datum..rkt)._format-datum))" class="docs" hyphens="none">format-datum</a></span> <span class="o">&#39;</span><span class="ss">~a</span> <span class="o">#&#39;</span><span class="n">SEXP-STR</span><span class="p">)])</span>
    <span class="o">#&#39;</span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/json/index.html#(def._((lib._json/main..rkt)._jsexpr-~3estring))" class="docs" hyphens="none">jsexpr-&gt;string</a></span> <span class="n">SEXP-DATUM</span><span class="p">)))</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._provide))" class="docs" hyphens="none">provide</a></span> <span class="n">jsonic-sexp</span><span class="p">)</span>
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpk4" data-clipboard-target="#code_47" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div></div><div class="filebox" anchorize="false"><div class="filename" anchorize="false" decode="exclude">jsonic/parser-test.rkt</div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_pYKtH&quot;)"></div><div class="highlight-container" id="a_pYKtH"><div id="code_48" form="false" decode="exclude" style="font-size:0;width:0;height:0">#lang br<br/>(require "parser.rkt" "tokenizer.rkt" brag/support rackunit)<br/><br/>(check-equal?<br/> (parse-to-datum<br/>  (apply-tokenizer-maker make-tokenizer "// line commment\n"))<br/> '(jsonic-program))<br/>(check-equal?<br/> (parse-to-datum<br/>  (apply-tokenizer-maker make-tokenizer "@$ 42 $@"))<br/> '(jsonic-program (jsonic-sexp " 42 ")))<br/>(check-equal?<br/> (parse-to-datum<br/>  (apply-tokenizer-maker make-tokenizer "hi"))<br/> '(jsonic-program<br/>   (jsonic-char "h")<br/>   (jsonic-char "i")))<br/>(check-equal?<br/> (parse-to-datum<br/>  (apply-tokenizer-maker make-tokenizer<br/>                         "hi\n// comment\n@$ 42 $@"))<br/> '(jsonic-program<br/>   (jsonic-char "h")<br/>   (jsonic-char "i")<br/>   (jsonic-char "\n")<br/>   (jsonic-sexp " 42 ")))</div><div class="highlight" form="false" id="a_h715Y"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26</pre></div></td><td class="code"><div class="source"><pre><span class="kn">#lang </span><span class="nn">br</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._require))" class="docs" hyphens="none">require</a></span> <span class="s2">"parser.rkt"</span> <span class="s2">"tokenizer.rkt"</span> <span class="n">brag/support</span> <span class="n">rackunit</span><span class="p">)</span>

<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/rackunit/api.html#(def._((lib._rackunit/main..rkt)._check-equal~3f))" class="docs" hyphens="none">check-equal?</a></span>
 <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(def._((lib._brag/examples/nested-word-list..rkt)._parse-to-datum))" class="docs" hyphens="none">parse-to-datum</a></span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(def._((lib._brag/support..rkt)._apply-tokenizer-maker))" class="docs" hyphens="none">apply-tokenizer-maker</a></span> <span class="n">make-tokenizer</span> <span class="s2">"// line commment</span><span class="se">\n</span><span class="s2">"</span><span class="p">))</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="ss">jsonic-program</span><span class="p">))</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/rackunit/api.html#(def._((lib._rackunit/main..rkt)._check-equal~3f))" class="docs" hyphens="none">check-equal?</a></span>
 <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(def._((lib._brag/examples/nested-word-list..rkt)._parse-to-datum))" class="docs" hyphens="none">parse-to-datum</a></span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(def._((lib._brag/support..rkt)._apply-tokenizer-maker))" class="docs" hyphens="none">apply-tokenizer-maker</a></span> <span class="n">make-tokenizer</span> <span class="s2">"@$ 42 $@"</span><span class="p">))</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="ss">jsonic-program</span> <span class="p">(</span><span class="ss">jsonic-sexp</span> <span class="s2">" 42 "</span><span class="p">)))</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/rackunit/api.html#(def._((lib._rackunit/main..rkt)._check-equal~3f))" class="docs" hyphens="none">check-equal?</a></span>
 <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(def._((lib._brag/examples/nested-word-list..rkt)._parse-to-datum))" class="docs" hyphens="none">parse-to-datum</a></span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(def._((lib._brag/support..rkt)._apply-tokenizer-maker))" class="docs" hyphens="none">apply-tokenizer-maker</a></span> <span class="n">make-tokenizer</span> <span class="s2">"hi"</span><span class="p">))</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="ss">jsonic-program</span>
   <span class="p">(</span><span class="ss">jsonic-char</span> <span class="s2">"h"</span><span class="p">)</span>
   <span class="p">(</span><span class="ss">jsonic-char</span> <span class="s2">"i"</span><span class="p">)))</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/rackunit/api.html#(def._((lib._rackunit/main..rkt)._check-equal~3f))" class="docs" hyphens="none">check-equal?</a></span>
 <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(def._((lib._brag/examples/nested-word-list..rkt)._parse-to-datum))" class="docs" hyphens="none">parse-to-datum</a></span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(def._((lib._brag/support..rkt)._apply-tokenizer-maker))" class="docs" hyphens="none">apply-tokenizer-maker</a></span> <span class="n">make-tokenizer</span>
                         <span class="s2">"hi</span><span class="se">\n</span><span class="s2">// comment</span><span class="se">\n</span><span class="s2">@$ 42 $@"</span><span class="p">))</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="ss">jsonic-program</span>
   <span class="p">(</span><span class="ss">jsonic-char</span> <span class="s2">"h"</span><span class="p">)</span>
   <span class="p">(</span><span class="ss">jsonic-char</span> <span class="s2">"i"</span><span class="p">)</span>
   <span class="p">(</span><span class="ss">jsonic-char</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
   <span class="p">(</span><span class="ss">jsonic-sexp</span> <span class="s2">" 42 "</span><span class="p">)))</span>
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpk5" data-clipboard-target="#code_48" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div></div><div class="filebox" anchorize="false"><div class="filename" anchorize="false" decode="exclude">jsonic/colorer.rkt</div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_7YvJ3&quot;)"></div><div class="highlight-container" id="a_7YvJ3"><div id="code_49" form="false" decode="exclude" style="font-size:0;width:0;height:0">#lang br<br/>(require brag/support syntax-color/racket-lexer<br/>         racket/contract)<br/><br/>(define jsonic-lexer<br/>  (lexer<br/>   [(eof) (values lexeme 'eof #f #f #f)]<br/>   [(:or "@$" "$@")<br/>    (values lexeme 'parenthesis<br/>            (if (equal? lexeme "@$") '|(| '|)|)<br/>            (pos lexeme-start) (pos lexeme-end))]<br/>   [(from/to "//" "\n")<br/>    (values lexeme 'comment #f<br/>            (pos lexeme-start) (pos lexeme-end))]<br/>   [any-char<br/>    (values lexeme 'string #f<br/>            (pos lexeme-start) (pos lexeme-end))]))<br/><br/>(define (color-jsonic port offset racket-coloring-mode?)<br/>  (cond<br/>    [(or (not racket-coloring-mode?)<br/>         (equal? (peek-string 2 0 port) "$@"))<br/>     (define-values (str cat paren start end)<br/>       (jsonic-lexer port))<br/>     (define switch-to-racket-mode (equal? str "@$"))<br/>     (values str cat paren start end 0 switch-to-racket-mode)]<br/>    [else<br/>     (define-values (str cat paren start end)<br/>       (racket-lexer port))<br/>     (values str cat paren start end 0 #t)]))<br/><br/>(provide<br/> (contract-out<br/>  [color-jsonic<br/>   (input-port? exact-nonnegative-integer? boolean?<br/>                . -&gt; . (values<br/>                        (or/c string? eof-object?)<br/>                        symbol?<br/>                        (or/c symbol? #f)<br/>                        (or/c exact-positive-integer? #f)<br/>                        (or/c exact-positive-integer? #f)<br/>                        exact-nonnegative-integer?<br/>                        boolean?))]))<br/><br/>(module+ test<br/>  (require rackunit)<br/>  (check-equal? (values-&gt;list<br/>                 (color-jsonic (open-input-string "x") 0 #f))<br/>                (list "x" 'string #f 1 2 0 #f)))
</div><div class="highlight" form="false" id="a_jkSb3"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49</pre></div></td><td class="code"><div class="source"><pre><span class="kn">#lang </span><span class="nn">br</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._require))" class="docs" hyphens="none">require</a></span> <span class="n">brag/support</span> <span class="n">syntax-color/racket-lexer</span>
         <span class="n">racket/contract</span><span class="p">)</span>

<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="n">jsonic-lexer</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._lexer))" class="docs" hyphens="none">lexer</a></span>
   <span class="p">[(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/port-ops.html#(def._((quote._~23~25kernel)._eof))" class="docs" hyphens="none">eof</a></span><span class="p">)</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/values.html#(def._((quote._~23~25kernel)._values))" class="docs" hyphens="none">values</a></span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._lexeme))" class="docs" hyphens="none">lexeme</a></span> <span class="o">&#39;</span><span class="ss">eof</span> <span class="no">#f</span> <span class="no">#f</span> <span class="no">#f</span><span class="p">)]</span>
   <span class="p">[(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(form._((lib._brag/support..rkt)._~3aor))" class="docs" hyphens="none">:or</a></span> <span class="s2">"@$"</span> <span class="s2">"$@"</span><span class="p">)</span>
    <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/values.html#(def._((quote._~23~25kernel)._values))" class="docs" hyphens="none">values</a></span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._lexeme))" class="docs" hyphens="none">lexeme</a></span> <span class="o">&#39;</span><span class="ss">parenthesis</span>
            <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/if.html#(form._((quote._~23~25kernel)._if))" class="docs" hyphens="none">if</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/booleans.html#(def._((quote._~23~25kernel)._equal~3f))" class="docs" hyphens="none">equal?</a></span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._lexeme))" class="docs" hyphens="none">lexeme</a></span> <span class="s2">"@$"</span><span class="p">)</span> <span class="o">&#39;</span><span class="ss">|(|</span> <span class="o">&#39;</span><span class="ss">|)|</span><span class="p">)</span>
            <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(def._((lib._br-parser-tools/lex..rkt)._position-offset))" class="docs" hyphens="none">pos</a></span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._start-pos))" class="docs" hyphens="none">lexeme-start</a></span><span class="p">)</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(def._((lib._br-parser-tools/lex..rkt)._position-offset))" class="docs" hyphens="none">pos</a></span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._end-pos))" class="docs" hyphens="none">lexeme-end</a></span><span class="p">))]</span>
   <span class="p">[(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(form._((lib._brag/support..rkt)._from/to))" class="docs" hyphens="none">from/to</a></span> <span class="s2">"//"</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
    <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/values.html#(def._((quote._~23~25kernel)._values))" class="docs" hyphens="none">values</a></span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._lexeme))" class="docs" hyphens="none">lexeme</a></span> <span class="o">&#39;</span><span class="ss">comment</span> <span class="no">#f</span>
            <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(def._((lib._br-parser-tools/lex..rkt)._position-offset))" class="docs" hyphens="none">pos</a></span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._start-pos))" class="docs" hyphens="none">lexeme-start</a></span><span class="p">)</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(def._((lib._br-parser-tools/lex..rkt)._position-offset))" class="docs" hyphens="none">pos</a></span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._end-pos))" class="docs" hyphens="none">lexeme-end</a></span><span class="p">))]</span>
   <span class="p">[</span><span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._any-char))" class="docs" hyphens="none">any-char</a></span>
    <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/values.html#(def._((quote._~23~25kernel)._values))" class="docs" hyphens="none">values</a></span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._lexeme))" class="docs" hyphens="none">lexeme</a></span> <span class="o">&#39;</span><span class="ss">string</span> <span class="no">#f</span>
            <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(def._((lib._br-parser-tools/lex..rkt)._position-offset))" class="docs" hyphens="none">pos</a></span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._start-pos))" class="docs" hyphens="none">lexeme-start</a></span><span class="p">)</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(def._((lib._br-parser-tools/lex..rkt)._position-offset))" class="docs" hyphens="none">pos</a></span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._end-pos))" class="docs" hyphens="none">lexeme-end</a></span><span class="p">))]))</span>

<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="p">(</span><span class="n">color-jsonic</span> <span class="n">port</span> <span class="n">offset</span> <span class="n">racket-coloring-mode?</span><span class="p">)</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/if.html#(form._((lib._racket/private/letstx-scheme..rkt)._cond))" class="docs" hyphens="none">cond</a></span>
    <span class="p">[(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/if.html#(form._((lib._racket/private/letstx-scheme..rkt)._or))" class="docs" hyphens="none">or</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/booleans.html#(def._((quote._~23~25kernel)._not))" class="docs" hyphens="none">not</a></span> <span class="n">racket-coloring-mode?</span><span class="p">)</span>
         <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/booleans.html#(def._((quote._~23~25kernel)._equal~3f))" class="docs" hyphens="none">equal?</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/Byte_and_String_Input.html#(def._((quote._~23~25kernel)._peek-string))" class="docs" hyphens="none">peek-string</a></span> <span class="mi">2</span> <span class="mi">0</span> <span class="n">port</span><span class="p">)</span> <span class="s2">"$@"</span><span class="p">))</span>
     <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((quote._~23~25kernel)._define-values))" class="docs" hyphens="none">define-values</a></span> <span class="p">(</span><span class="n">str</span> <span class="n">cat</span> <span class="n">paren</span> <span class="n">start</span> <span class="n">end</span><span class="p">)</span>
       <span class="p">(</span><span class="n">jsonic-lexer</span> <span class="n">port</span><span class="p">))</span>
     <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="n">switch-to-racket-mode</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/booleans.html#(def._((quote._~23~25kernel)._equal~3f))" class="docs" hyphens="none">equal?</a></span> <span class="n">str</span> <span class="s2">"@$"</span><span class="p">))</span>
     <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/values.html#(def._((quote._~23~25kernel)._values))" class="docs" hyphens="none">values</a></span> <span class="n">str</span> <span class="n">cat</span> <span class="n">paren</span> <span class="n">start</span> <span class="n">end</span> <span class="mi">0</span> <span class="n">switch-to-racket-mode</span><span class="p">)]</span>
    <span class="p">[</span><span class="nb"><a href="http://docs.racket-lang.org/reference/if.html#(form._((lib._racket/private/letstx-scheme..rkt)._else))" class="docs" hyphens="none">else</a></span>
     <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((quote._~23~25kernel)._define-values))" class="docs" hyphens="none">define-values</a></span> <span class="p">(</span><span class="n">str</span> <span class="n">cat</span> <span class="n">paren</span> <span class="n">start</span> <span class="n">end</span><span class="p">)</span>
       <span class="p">(</span><span class="n">racket-lexer</span> <span class="n">port</span><span class="p">))</span>
     <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/values.html#(def._((quote._~23~25kernel)._values))" class="docs" hyphens="none">values</a></span> <span class="n">str</span> <span class="n">cat</span> <span class="n">paren</span> <span class="n">start</span> <span class="n">end</span> <span class="mi">0</span> <span class="no">#t</span><span class="p">)]))</span>

<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._provide))" class="docs" hyphens="none">provide</a></span>
 <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/attaching-contracts-to-values.html#(form._((lib._racket/contract/base..rkt)._contract-out))" class="docs" hyphens="none">contract-out</a></span>
  <span class="p">[</span><span class="n">color-jsonic</span>
   <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/port-ops.html#(def._((quote._~23~25kernel)._input-port~3f))" class="docs" hyphens="none">input-port?</a></span> <span class="nb"><a href="http://docs.racket-lang.org/reference/number-types.html#(def._((quote._~23~25kernel)._exact-nonnegative-integer~3f))" class="docs" hyphens="none">exact-nonnegative-integer?</a></span> <span class="nb"><a href="http://docs.racket-lang.org/reference/booleans.html#(def._((quote._~23~25kernel)._boolean~3f))" class="docs" hyphens="none">boolean?</a></span>
                <span class="o">.</span> <span class="nb"><a href="http://docs.racket-lang.org/reference/function-contracts.html#(form._((lib._racket/contract/base..rkt)._-~3e))" class="docs" hyphens="none">-&gt;</a></span> <span class="o">.</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/values.html#(def._((quote._~23~25kernel)._values))" class="docs" hyphens="none">values</a></span>
                        <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/data-structure-contracts.html#(def._((lib._racket/contract/base..rkt)._or/c))" class="docs" hyphens="none">or/c</a></span> <span class="nb"><a href="http://docs.racket-lang.org/reference/strings.html#(def._((quote._~23~25kernel)._string~3f))" class="docs" hyphens="none">string?</a></span> <span class="nb"><a href="http://docs.racket-lang.org/reference/port-ops.html#(def._((quote._~23~25kernel)._eof-object~3f))" class="docs" hyphens="none">eof-object?</a></span><span class="p">)</span>
                        <span class="nb"><a href="http://docs.racket-lang.org/reference/symbols.html#(def._((quote._~23~25kernel)._symbol~3f))" class="docs" hyphens="none">symbol?</a></span>
                        <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/data-structure-contracts.html#(def._((lib._racket/contract/base..rkt)._or/c))" class="docs" hyphens="none">or/c</a></span> <span class="nb"><a href="http://docs.racket-lang.org/reference/symbols.html#(def._((quote._~23~25kernel)._symbol~3f))" class="docs" hyphens="none">symbol?</a></span> <span class="no">#f</span><span class="p">)</span>
                        <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/data-structure-contracts.html#(def._((lib._racket/contract/base..rkt)._or/c))" class="docs" hyphens="none">or/c</a></span> <span class="nb"><a href="http://docs.racket-lang.org/reference/number-types.html#(def._((quote._~23~25kernel)._exact-positive-integer~3f))" class="docs" hyphens="none">exact-positive-integer?</a></span> <span class="no">#f</span><span class="p">)</span>
                        <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/data-structure-contracts.html#(def._((lib._racket/contract/base..rkt)._or/c))" class="docs" hyphens="none">or/c</a></span> <span class="nb"><a href="http://docs.racket-lang.org/reference/number-types.html#(def._((quote._~23~25kernel)._exact-positive-integer~3f))" class="docs" hyphens="none">exact-positive-integer?</a></span> <span class="no">#f</span><span class="p">)</span>
                        <span class="nb"><a href="http://docs.racket-lang.org/reference/number-types.html#(def._((quote._~23~25kernel)._exact-nonnegative-integer~3f))" class="docs" hyphens="none">exact-nonnegative-integer?</a></span>
                        <span class="nb"><a href="http://docs.racket-lang.org/reference/booleans.html#(def._((quote._~23~25kernel)._boolean~3f))" class="docs" hyphens="none">boolean?</a></span><span class="p">))]))</span>

<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/module.html#(form._((lib._racket/private/base..rkt)._module+))" class="docs" hyphens="none">module+</a></span> <span class="n">test</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._require))" class="docs" hyphens="none">require</a></span> <span class="n">rackunit</span><span class="p">)</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/rackunit/api.html#(def._((lib._rackunit/main..rkt)._check-equal~3f))" class="docs" hyphens="none">check-equal?</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br/index.html#(form._((lib._br/list..rkt)._values-~3elist))" class="docs" hyphens="none">values-&gt;list</a></span>
                 <span class="p">(</span><span class="n">color-jsonic</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/stringport.html#(def._((quote._~23~25kernel)._open-input-string))" class="docs" hyphens="none">open-input-string</a></span> <span class="s2">"x"</span><span class="p">)</span> <span class="mi">0</span> <span class="no">#f</span><span class="p">))</span>
                <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._list))" class="docs" hyphens="none">list</a></span> <span class="s2">"x"</span> <span class="o">&#39;</span><span class="ss">string</span> <span class="no">#f</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">0</span> <span class="no">#f</span><span class="p">)))</span>
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpk6" data-clipboard-target="#code_49" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div></div><div class="filebox" anchorize="false"><div class="filename" anchorize="false" decode="exclude">jsonic/indenter.rkt</div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_LX9ri&quot;)"></div><div class="highlight-container" id="a_LX9ri"><div id="code_50" form="false" decode="exclude" style="font-size:0;width:0;height:0">#lang br<br/>(require br/indent racket/contract racket/gui/base)<br/><br/>(define indent-width 2)<br/>(define (left-bracket? c) (member c (list #\{ #\[)))<br/>(define (right-bracket? c) (member c (list #\} #\])))<br/><br/>(define (indent-jsonic tbox [posn 0])<br/>  (define prev-line (previous-line tbox posn))<br/>  (define current-line (line tbox posn))<br/>  (define prev-indent (or (line-indent tbox prev-line) 0))<br/>  (define current-indent<br/>    (cond<br/>      [(left-bracket?<br/>        (line-first-visible-char tbox prev-line))<br/>       (+ prev-indent indent-width)]<br/>      [(right-bracket?<br/>        (line-first-visible-char tbox current-line))<br/>       (- prev-indent indent-width)]<br/>      [else prev-indent]))<br/>  (and (exact-positive-integer? current-indent)<br/>       current-indent))<br/>(provide<br/> (contract-out<br/>  [indent-jsonic (((is-a?/c text%)) <br/>                  (exact-nonnegative-integer?) . -&gt;* .<br/>                  (or/c exact-nonnegative-integer? #f))]))<br/><br/>(module+ test<br/>  (require rackunit)<br/>  (define test-str #&lt;&lt;HERE<br/>#lang jsonic<br/>{<br/>"value",<br/>"string":<br/>[<br/>{<br/>"array": @$(range 5)$@,<br/>"object": @$(hash 'k1 "valstring")$@<br/>}<br/>]<br/>// "bar"<br/>}<br/>HERE<br/>    )<br/>  (check-equal?<br/>   (string-indents (apply-indenter indent-jsonic test-str))<br/>   '(#f #f 2 2 2 4 6 6 4 2 2 #f)))</div><div class="highlight" form="false" id="a_slZKg"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48</pre></div></td><td class="code"><div class="source"><pre><span class="kn">#lang </span><span class="nn">br</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._require))" class="docs" hyphens="none">require</a></span> <span class="n">br/indent</span> <span class="n">racket/contract</span> <span class="n">racket/gui/base</span><span class="p">)</span>

<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="n">indent-width</span> <span class="mi">2</span><span class="p">)</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="p">(</span><span class="n">left-bracket?</span> <span class="n">c</span><span class="p">)</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((lib._racket/private/base..rkt)._member))" class="docs" hyphens="none">member</a></span> <span class="n">c</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._list))" class="docs" hyphens="none">list</a></span> <span class="sc">#\{</span> <span class="sc">#\[</span><span class="p">)))</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="p">(</span><span class="n">right-bracket?</span> <span class="n">c</span><span class="p">)</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((lib._racket/private/base..rkt)._member))" class="docs" hyphens="none">member</a></span> <span class="n">c</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._list))" class="docs" hyphens="none">list</a></span> <span class="sc">#\}</span> <span class="sc">#\]</span><span class="p">)))</span>

<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="p">(</span><span class="n">indent-jsonic</span> <span class="n">tbox</span> <span class="p">[</span><span class="n">posn</span> <span class="mi">0</span><span class="p">])</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="n">prev-line</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br/index.html#(def._((lib._br/indent..rkt)._previous-line))" class="docs" hyphens="none">previous-line</a></span> <span class="n">tbox</span> <span class="n">posn</span><span class="p">))</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="n">current-line</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br/index.html#(def._((lib._br/indent..rkt)._line))" class="docs" hyphens="none">line</a></span> <span class="n">tbox</span> <span class="n">posn</span><span class="p">))</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="n">prev-indent</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/if.html#(form._((lib._racket/private/letstx-scheme..rkt)._or))" class="docs" hyphens="none">or</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br/index.html#(def._((lib._br/indent..rkt)._line-indent))" class="docs" hyphens="none">line-indent</a></span> <span class="n">tbox</span> <span class="n">prev-line</span><span class="p">)</span> <span class="mi">0</span><span class="p">))</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="n">current-indent</span>
    <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/if.html#(form._((lib._racket/private/letstx-scheme..rkt)._cond))" class="docs" hyphens="none">cond</a></span>
      <span class="p">[(</span><span class="n">left-bracket?</span>
        <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br/index.html#(def._((lib._br/indent..rkt)._line-first-visible-char))" class="docs" hyphens="none">line-first-visible-char</a></span> <span class="n">tbox</span> <span class="n">prev-line</span><span class="p">))</span>
       <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._+))" class="docs" hyphens="none">+</a></span> <span class="n">prev-indent</span> <span class="n">indent-width</span><span class="p">)]</span>
      <span class="p">[(</span><span class="n">right-bracket?</span>
        <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br/index.html#(def._((lib._br/indent..rkt)._line-first-visible-char))" class="docs" hyphens="none">line-first-visible-char</a></span> <span class="n">tbox</span> <span class="n">current-line</span><span class="p">))</span>
       <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._-))" class="docs" hyphens="none">-</a></span> <span class="n">prev-indent</span> <span class="n">indent-width</span><span class="p">)]</span>
      <span class="p">[</span><span class="nb"><a href="http://docs.racket-lang.org/reference/if.html#(form._((lib._racket/private/letstx-scheme..rkt)._else))" class="docs" hyphens="none">else</a></span> <span class="n">prev-indent</span><span class="p">]))</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/if.html#(form._((lib._racket/private/letstx-scheme..rkt)._and))" class="docs" hyphens="none">and</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/number-types.html#(def._((quote._~23~25kernel)._exact-positive-integer~3f))" class="docs" hyphens="none">exact-positive-integer?</a></span> <span class="n">current-indent</span><span class="p">)</span>
       <span class="n">current-indent</span><span class="p">))</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._provide))" class="docs" hyphens="none">provide</a></span>
 <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/attaching-contracts-to-values.html#(form._((lib._racket/contract/base..rkt)._contract-out))" class="docs" hyphens="none">contract-out</a></span>
  <span class="p">[</span><span class="n">indent-jsonic</span> <span class="p">(((</span><span class="nb"><a href="http://docs.racket-lang.org/reference/Object_and_Class_Contracts.html#(def._((lib._racket/class..rkt)._is-a~3f/c))" class="docs" hyphens="none">is-a?/c</a></span> <span class="nb"><a href="http://docs.racket-lang.org/gui/text_.html##f" class="docs" hyphens="none">text%</a></span><span class="p">))</span> 
                  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/number-types.html#(def._((quote._~23~25kernel)._exact-nonnegative-integer~3f))" class="docs" hyphens="none">exact-nonnegative-integer?</a></span><span class="p">)</span> <span class="o">.</span> <span class="nb"><a href="http://docs.racket-lang.org/reference/function-contracts.html#(form._((lib._racket/contract/base..rkt)._-~3e*))" class="docs" hyphens="none">-&gt;*</a></span> <span class="o">.</span>
                  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/data-structure-contracts.html#(def._((lib._racket/contract/base..rkt)._or/c))" class="docs" hyphens="none">or/c</a></span> <span class="nb"><a href="http://docs.racket-lang.org/reference/number-types.html#(def._((quote._~23~25kernel)._exact-nonnegative-integer~3f))" class="docs" hyphens="none">exact-nonnegative-integer?</a></span> <span class="no">#f</span><span class="p">))]))</span>

<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/module.html#(form._((lib._racket/private/base..rkt)._module+))" class="docs" hyphens="none">module+</a></span> <span class="n">test</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._require))" class="docs" hyphens="none">require</a></span> <span class="n">rackunit</span><span class="p">)</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="n">test-str</span> <span class="sh">#&lt;&lt;HERE</span>
<span class="sh">#lang jsonic</span>
<span class="sh">{</span>
<span class="sh">"value",</span>
<span class="sh">"string":</span>
<span class="sh">[</span>
<span class="sh">{</span>
<span class="sh">"array": @$(range 5)$@,</span>
<span class="sh">"object": @$(hash &#39;k1 "valstring")$@</span>
<span class="sh">}</span>
<span class="sh">]</span>
<span class="sh">// "bar"</span>
<span class="sh">}</span>
<span class="sh">HERE</span>
    <span class="p">)</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/rackunit/api.html#(def._((lib._rackunit/main..rkt)._check-equal~3f))" class="docs" hyphens="none">check-equal?</a></span>
   <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br/index.html#(def._((lib._br/indent..rkt)._string-indents))" class="docs" hyphens="none">string-indents</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br/index.html#(def._((lib._br/indent..rkt)._apply-indenter))" class="docs" hyphens="none">apply-indenter</a></span> <span class="n">indent-jsonic</span> <span class="n">test-str</span><span class="p">))</span>
   <span class="o">&#39;</span><span class="p">(</span><span class="no">#f</span> <span class="no">#f</span> <span class="mi">2</span> <span class="mi">2</span> <span class="mi">2</span> <span class="mi">4</span> <span class="mi">6</span> <span class="mi">6</span> <span class="mi">4</span> <span class="mi">2</span> <span class="mi">2</span> <span class="no">#f</span><span class="p">)))</span>
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpk7" data-clipboard-target="#code_50" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div></div><div class="filebox" anchorize="false"><div class="filename" anchorize="false" decode="exclude">jsonic/buttons.rkt</div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_t5WrW&quot;)"></div><div class="highlight-container" id="a_t5WrW"><div id="code_51" form="false" decode="exclude" style="font-size:0;width:0;height:0">#lang br<br/>(require racket/draw)<br/><br/>(define (button-func drr-window)<br/>  (define expr-string "@$  $@")<br/>  (define editor (send drr-window get-definitions-text))<br/>  (send editor insert expr-string)<br/>  (define pos (send editor get-start-position))<br/>  (send editor set-position (- pos 3)))<br/><br/>(define our-jsonic-button<br/>  (list<br/>   "Insert expression"<br/>   (make-object bitmap% 16 16)<br/>   button-func<br/>   #f))<br/><br/>(provide button-list)<br/>(define button-list (list our-jsonic-button))         <br/><br/>
</div><div class="highlight" form="false" id="a_lDvxZ"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</pre></div></td><td class="code"><div class="source"><pre><span class="kn">#lang </span><span class="nn">br</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._require))" class="docs" hyphens="none">require</a></span> <span class="n">racket/draw</span><span class="p">)</span>

<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="p">(</span><span class="n">button-func</span> <span class="n">drr-window</span><span class="p">)</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="n">expr-string</span> <span class="s2">"@$  $@"</span><span class="p">)</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="n">editor</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/ivaraccess.html#(form._((lib._racket/private/class-internal..rkt)._send))" class="docs" hyphens="none">send</a></span> <span class="n">drr-window</span> <span class="n">get-definitions-text</span><span class="p">))</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/ivaraccess.html#(form._((lib._racket/private/class-internal..rkt)._send))" class="docs" hyphens="none">send</a></span> <span class="n">editor</span> <span class="n">insert</span> <span class="n">expr-string</span><span class="p">)</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(def._((lib._br-parser-tools/lex..rkt)._position-offset))" class="docs" hyphens="none">pos</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/ivaraccess.html#(form._((lib._racket/private/class-internal..rkt)._send))" class="docs" hyphens="none">send</a></span> <span class="n">editor</span> <span class="n">get-start-position</span><span class="p">))</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/ivaraccess.html#(form._((lib._racket/private/class-internal..rkt)._send))" class="docs" hyphens="none">send</a></span> <span class="n">editor</span> <span class="n">set-position</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._-))" class="docs" hyphens="none">-</a></span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(def._((lib._br-parser-tools/lex..rkt)._position-offset))" class="docs" hyphens="none">pos</a></span> <span class="mi">3</span><span class="p">)))</span>

<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="n">our-jsonic-button</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._list))" class="docs" hyphens="none">list</a></span>
   <span class="s2">"Insert expression"</span>
   <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/objcreation.html#(def._((lib._racket/private/class-internal..rkt)._make-object))" class="docs" hyphens="none">make-object</a></span> <span class="nb"><a href="http://docs.racket-lang.org/draw/bitmap_.html##f" class="docs" hyphens="none">bitmap%</a></span> <span class="mi">16</span> <span class="mi">16</span><span class="p">)</span>
   <span class="n">button-func</span>
   <span class="no">#f</span><span class="p">))</span>

<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._provide))" class="docs" hyphens="none">provide</a></span> <span class="n">button-list</span><span class="p">)</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="n">button-list</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._list))" class="docs" hyphens="none">list</a></span> <span class="n">our-jsonic-button</span><span class="p">))</span>         
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpk8" data-clipboard-target="#code_51" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div></div><div class="filebox" anchorize="false"><div class="filename" anchorize="false" decode="exclude">jsonic/jsonic-test.rkt</div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_TDp6P&quot;)"></div><div class="highlight-container" id="a_TDp6P"><div id="code_52" form="false" decode="exclude" style="font-size:0;width:0;height:0">#lang jsonic<br/>// a line comment<br/>[<br/>  @$ 'null $@,<br/>  @$ (* 6 7) $@,<br/>  @$ (= 2 (+ 1 1)) $@,<br/>  @$ (list "array" "of" "strings") $@,<br/>  @$ (hash 'key-1 'null<br/>           'key-2 (even? 3)<br/>           'key-3 (hash 'subkey 21)) $@<br/>]</div><div class="highlight" form="false" id="a_Fzdix"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="source"><pre>#lang jsonic
// a line comment
[
  @$ &#39;null $@,
  @$ (* 6 7) $@,
  @$ (= 2 (+ 1 1)) $@,
  @$ (list "array" "of" "strings") $@,
  @$ (hash &#39;key-1 &#39;null
           &#39;key-2 (even? 3)
           &#39;key-3 (hash &#39;subkey 21)) $@
]
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpk9" data-clipboard-target="#code_52" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div></div><div anchorize="false" style="height:2em"></div><ul class="siblinks"><li><a href="intro.html">1&emsp;intro</a></li><li><a href="setup.html">2&emsp;setup</a></li><li><a href="contracts.html">3&emsp;con­tracts</a></li><li><a href="unit-tests.html">4&emsp;unit tests</a></li><li><a href="source-locations.html">5&emsp;source loca­tions</a></li><li><a href="drracket-integration.html">6&emsp;drracket inte­gra­tion</a></li><li><a href="syntax-coloring.html">7&emsp;syn­tax col­or­ing</a></li><li><a href="indenting.html">8&emsp;indent­ing</a></li><li><a href="toolbar-buttons.html">9&emsp;tool­bar but­tons</a></li><li><a href="recap.html">10&emsp;recap</a></li><li><a class="here" href="source-listing.html">11&emsp;source list­ing</a></li></ul></div>
    <a class="nav-left" href="recap.html">← prev</a>
    <a class="nav-right" href="../jsonic-3/intro.html">next →</a>




</body>

<script type="text/javascript">



function show_all_forms() {
 var elems = document.getElementsByClassName('has_form');
 for (var i = 0 ; i < elems.length ; i++) {
  toggle_form(elems[i].id);
 }
}

// for debugging forms only: uncomment next line
// show_all_forms();

// sets up copy-to-clipboard buttons in code boxes
var clipboard = new Clipboard('.copy-button');
clipboard.on('success', function(e) {console.log(e);});
clipboard.on('error', function(e) {console.log(e);});
</script>