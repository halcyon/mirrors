<!DOCTYPE html>
<html>
  
<!-- Mirrored from beautifulracket.com/jsonic-2/unit-tests.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 16 Mar 2017 05:47:16 GMT -->
<head>
    <meta charset="UTF-8">
    <title>Beautiful Racket: Level up: jsonic revisited</title>
    <link rel="stylesheet" type="text/css" media="all" href="../styles.css"/>
    <script type="text/javascript" src="../functions.js"></script>
    <script type="text/javascript" src="../clipboard.min.js"></script>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-74684045-1', 'auto');
      ga('send', 'pageview');
    </script>
  </head>
<body>
<div id="alert">Thank you for your comment</div>
    <div id="doc"><h3 class="dept" anchorize="false"><a href="../index.html">Beau­ti­ful Racket</a> / <a href="../index.html#tutorials">tuto­ri­als</a></h3><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;level-up-jsonic-revisited&quot;)"></div><h1 anchor="level-up-jsonic-revisited" id="level-up-jsonic-revisited" hyphens="none">Level up: <span class="my-code" decode="exclude">jsonic</span> revisited</h1></div><ul class="siblinks"><li><a href="intro.html">1&emsp;intro</a></li><li><a href="setup.html">2&emsp;setup</a></li><li><a href="contracts.html">3&emsp;con­tracts</a></li><li><a class="here" href="unit-tests.html">4&emsp;unit tests</a></li><li><a href="source-locations.html">5&emsp;source loca­tions</a></li><li><a href="drracket-integration.html">6&emsp;drracket inte­gra­tion</a></li><li><a href="syntax-coloring.html">7&emsp;syn­tax col­or­ing</a></li><li><a href="indenting.html">8&emsp;indent­ing</a></li><li><a href="toolbar-buttons.html">9&emsp;tool­bar but­tons</a></li><li><a href="recap.html">10&emsp;recap</a></li><li><a href="source-listing.html">11&emsp;source list­ing</a></li></ul><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;introducing-unit-tests&quot;)"></div><h3 anchor="introducing-unit-tests" class="subhead" id="introducing-unit-tests"><a href="#introducing-unit-tests">Intro­duc­ing unit tests</a></h3></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_s7Q0v&quot;)"></div><p id="a_s7Q0v">In <a href="contracts.html">con­tracts</a>, we saw how a con­tract can be a help­ful devel­op­ment tool, because it lets us spec­ify the accept­able data types for a func­tion’s input argu­ments and return value. Once the con­tract is in place, we’ll get a detailed error when­ever the func­tion mis­be­haves.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_Q4rOr&quot;)"></div><p id="a_Q4rOr">But like any code, a con­tract is not self-exe­cut­ing. To ver­ify that a func­tion and its con­tract work cor­rectly, we need to call the func­tion with some sam­ple cases and see what hap­pens. These are known as <em><a class="glossary" href="../appendix/glossary.html#unit-test"><span class="glossary-link-text">unit tests</span></a></em>.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_8KZ3G&quot;)"></div><p id="a_8KZ3G">Unit tests are valu­able because they remove guess­work:</p></div><ol><li><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_hv8pr&quot;)"></div><p id="a_hv8pr">Unit tests con­vince us that our func­tion does what it’s sup­posed to. We make unit tests that cover all the char­ac­ter­is­tic input and out­put—and some unchar­ac­ter­is­tic cases too. Once the tests pass, we know we’re done.</p></div></li><li><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_Y9SrK&quot;)"></div><p id="a_Y9SrK">Unit tests make rewrit­ing a func­tion eas­ier, because they cre­ate an objec­tive base­line for the func­tion’s behav­ior. With­out unit tests, it’s much eas­ier to refac­tor a func­tion so that it appears to work, while acci­den­tally intro­duc­ing sub­tle defects.</p></div></li></ol><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_6xSpR&quot;)"></div><p id="a_6xSpR">We recall that <a class="glossary" href="../appendix/glossary.html#functional-programming"><span class="glossary-link-text">func­tional pro­gram­ming</span></a> encour­ages us to design func­tions so that their behav­ior depends only their input argu­ments (instead of exter­nal <a class="glossary" href="../appendix/glossary.html#state"><span class="glossary-link-text">state</span></a>) and return a value (instead of rely­ing on <a class="glossary" href="../appendix/glossary.html#mutation"><span class="glossary-link-text">muta­tion</span></a> or <a class="glossary" href="../appendix/glossary.html#side-effect"><span class="glossary-link-text">side effects</span></a>). A side ben­e­fit of this approach is that it becomes easy to write unit tests, because our func­tions have no remote depen­den­cies or effects.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_lxG8B&quot;)"></div><p id="a_lxG8B">For this rea­son, Rack­e­teers often like to write unit tests for a func­tion <em>before</em> they start writ­ing that func­tion, not after. It’s also com­mon to put the unit tests near the func­tion def­i­n­i­tion, so they can be worked in tan­dem.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_WHlF2&quot;)"></div><p id="a_WHlF2">Racket makes this style of cod­ing easy with two fea­tures: the <a href="http://docs.racket-lang.org/rackunit/api.html?q=rackunit"><span class="my-code" decode="exclude">rackunit</span></a> unit-test­ing library, and the <span class="my-code" decode="exclude">test</span> sub­mod­ule.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;writing-tests-with-rackunit&quot;)"></div><h3 anchor="writing-tests-with-rackunit" class="subhead" id="writing-tests-with-rackunit"><a href="#writing-tests-with-rackunit">Writ­ing tests with rack­u­nit</a></h3></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_8M8Qq&quot;)"></div><p id="a_8M8Qq">The <a href="http://docs.racket-lang.org/rackunit/api.html?q=rackunit"><span class="my-code" decode="exclude">rackunit</span></a> library helps us cre­ate unit tests called <em><a class="glossary" href="../appendix/glossary.html#check"><span class="glossary-link-text">checks</span></a></em>. To use it, we first add <span class="my-code" decode="exclude">(require rackunit)</span> to our pro­gram.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_fyFay&quot;)"></div><p id="a_fyFay">Then we write our checks. Each check is an asser­tion about the behav­ior of the func­tion. A check usu­ally con­sists of a func­tion call and the expected result. If the check suc­ceeds, it passes silently. If the check fails, an error is raised that tells us both the expected and actual result.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_OldAI&quot;)"></div><p id="a_OldAI">Below, we use the sim­plest test, <a href="http://docs.racket-lang.org/rackunit/api.html#(def._((lib._rackunit/main..rkt)._check-equal~3f))" class="docs" hyphens="none">check-equal?</a>, with the <span class="my-code" decode="exclude">our-div</span> func­tion we <a href="contracts.html#introducing-contracts">wrote before</a>. <span class="my-code" decode="exclude">check-equal?</span> takes two argu­ments and com­pares them with <a href="http://docs.racket-lang.org/reference/booleans.html#(def._((quote._~23~25kernel)._equal~3f))" class="docs" hyphens="none">equal?</a>:</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_hCcuC&quot;)"></div><div class="highlight-container" id="a_hCcuC"><div id="code_43" form="false" decode="exclude" style="font-size:0;width:0;height:0">(require rackunit)<br/>(define (our-div num denom)<br/>  (/ num denom))<br/>(check-equal? (our-div 42 6) 7) ; ok<br/>(check-equal? (our-div 42 2) 22) ; invalid, actual result is 21</div><div class="highlight" form="false" id="a_mVDGL"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="source"><pre><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._require))" class="docs" hyphens="none">require</a></span> <span class="n">rackunit</span><span class="p">)</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="p">(</span><span class="n">our-div</span> <span class="n">num</span> <span class="n">denom</span><span class="p">)</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._/))" class="docs" hyphens="none">/</a></span> <span class="n">num</span> <span class="n">denom</span><span class="p">))</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/rackunit/api.html#(def._((lib._rackunit/main..rkt)._check-equal~3f))" class="docs" hyphens="none">check-equal?</a></span> <span class="p">(</span><span class="n">our-div</span> <span class="mi">42</span> <span class="mi">6</span><span class="p">)</span> <span class="mi">7</span><span class="p">)</span> <span class="c1">; ok</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/rackunit/api.html#(def._((lib._rackunit/main..rkt)._check-equal~3f))" class="docs" hyphens="none">check-equal?</a></span> <span class="p">(</span><span class="n">our-div</span> <span class="mi">42</span> <span class="mi">2</span><span class="p">)</span> <span class="mi">22</span><span class="p">)</span> <span class="c1">; invalid, actual result is 21</span>
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpk" data-clipboard-target="#code_43" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_HZtwL&quot;)"></div><p id="a_HZtwL">When we run this sam­ple, the sec­ond check raises an error:</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_7IipC&quot;)"></div><div class="highlight-container err" id="a_7IipC"><div id="code_44" form="false" decode="exclude" style="font-size:0;width:0;height:0">--------------------<br/>FAILURE<br/>name:       check-equal?<br/>location:   unsaved-editor:6:0<br/>actual:     21<br/>expected:   22<br/>expression: (check-equal? (our-div 42 2) 22)<br/>--------------------</div><div class="highlight" form="false" id="a_8xOn6"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="source"><pre>--------------------
FAILURE
name:       check-equal?
location:   unsaved-editor:6:0
actual:     21
expected:   22
expression: (check-equal? (our-div 42 2) 22)
--------------------
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpk1" data-clipboard-target="#code_44" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_WQP5b&quot;)"></div><p id="a_WQP5b">We can write as many tests as we want. A thor­ough set of tests will cover obvi­ous cases, edge cases, and error cases.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_cUAPk&quot;)"></div><p id="a_cUAPk">Because error cases don’t pro­duce a return value, we instead check the error type. For instance, <span class="my-code" decode="exclude">our-div</span> will raise an error if we pass <span class="my-code" decode="exclude">0</span> as the <span class="my-code" decode="exclude">denom</span> argu­ment. Instead of <span class="my-code" decode="exclude">check-equal?</span>, we check an error with <a href="http://docs.racket-lang.org/rackunit/api.html#(def._((lib._rackunit/main..rkt)._check-exn))" class="docs" hyphens="none">check-exn</a> (<span class="my-code" decode="exclude">exn</span> is short for <span class="my-code" decode="exclude">exception</span>). The first argu­ment is the type of error we expect—in this case we’ll use the generic <a href="http://docs.racket-lang.org/reference/exns.html#(def._((quote._~23~25kernel)._exn~3afail~3f))" class="docs" hyphens="none">exn:fail?</a> pred­i­cate. <span class="tooltip" onclick="this.classList.toggle('tooltip_visible')"> + <span class="tooltip-inner">It’s bet­ter pol­icy, as it was with <a href="contracts.html">con­tracts</a>, to use the nar­row­est error pred­i­cate that applies. For more about Racket’s built-in error types, see <a class="explainer" href="../explainer/errors-and-exceptions.html">errors and excep­tions</a>.</span></span> The sec­ond argu­ment is our test case, wrapped in a <a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._lambda))" class="docs" hyphens="none">lambda</a>, which pre­vents the error from being trig­gered imme­di­ately:</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_aA1ht&quot;)"></div><div class="highlight-container" id="a_aA1ht"><div id="code_45" form="false" decode="exclude" style="font-size:0;width:0;height:0">(require rackunit)<br/><br/>(define (our-div num denom)<br/>  (/ num denom))<br/><br/>(check-equal? (our-div 42 6) 7) ; ok<br/>(check-equal? (our-div 42 2) 21) ; ok<br/>(check-exn exn:fail? (lambda () (our-div 42 0))) ; ok</div><div class="highlight" form="false" id="a_SUh09"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="source"><pre><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._require))" class="docs" hyphens="none">require</a></span> <span class="n">rackunit</span><span class="p">)</span>

<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="p">(</span><span class="n">our-div</span> <span class="n">num</span> <span class="n">denom</span><span class="p">)</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._/))" class="docs" hyphens="none">/</a></span> <span class="n">num</span> <span class="n">denom</span><span class="p">))</span>

<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/rackunit/api.html#(def._((lib._rackunit/main..rkt)._check-equal~3f))" class="docs" hyphens="none">check-equal?</a></span> <span class="p">(</span><span class="n">our-div</span> <span class="mi">42</span> <span class="mi">6</span><span class="p">)</span> <span class="mi">7</span><span class="p">)</span> <span class="c1">; ok</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/rackunit/api.html#(def._((lib._rackunit/main..rkt)._check-equal~3f))" class="docs" hyphens="none">check-equal?</a></span> <span class="p">(</span><span class="n">our-div</span> <span class="mi">42</span> <span class="mi">2</span><span class="p">)</span> <span class="mi">21</span><span class="p">)</span> <span class="c1">; ok</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/rackunit/api.html#(def._((lib._rackunit/main..rkt)._check-exn))" class="docs" hyphens="none">check-exn</a></span> <span class="nb"><a href="http://docs.racket-lang.org/reference/exns.html#(def._((quote._~23~25kernel)._exn~3afail~3f))" class="docs" hyphens="none">exn:fail?</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._lambda))" class="docs" hyphens="none">lambda</a></span> <span class="p">()</span> <span class="p">(</span><span class="n">our-div</span> <span class="mi">42</span> <span class="mi">0</span><span class="p">)))</span> <span class="c1">; ok</span>
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpk2" data-clipboard-target="#code_45" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_Zrz7e&quot;)"></div><p id="a_Zrz7e">This time, all three checks will pass. For other types of checks, see <a class="explainer" href="../explainer/unit-testing.html">unit test­ing</a>.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;running-tests-in-the-test-submodule&quot;)"></div><h3 anchor="running-tests-in-the-test-submodule" class="subhead" id="running-tests-in-the-test-submodule"><a href="#running-tests-in-the-test-submodule">Run­ning tests in the test sub­mod­ule</a></h3></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_UTiOQ&quot;)"></div><p id="a_UTiOQ">Putting unit tests directly next to our func­tion isn’t wrong. But it can be inef­fi­cient. Unit tests take time—espe­cially if we’re being thor­ough—and they don’t need to run every time a mod­ule is loaded.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_CBp3C&quot;)"></div><p id="a_CBp3C">To avoid this over­head, we could put our unit tests in a sep­a­rate source file. But this can be a drag, because the func­tions and their cor­re­spond­ing unit tests then live in two places. It’s often more ergonomic to keep them together.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_F3NvZ&quot;)"></div><p id="a_F3NvZ">Thus, as a con­ve­nience, DrRacket spe­cially coop­er­ates with an optional sub­mod­ule called <span class="my-code" decode="exclude">test</span>. When we have the source file for a mod­ule open in DrRacket and click <em>Run</em>, DrRacket will run the body of the mod­ule as usual, but will also run the <span class="my-code" decode="exclude">test</span> sub­mod­ule (if it exists). Oth­er­wise—for instance, if the mod­ule is imported into another mod­ule with <a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._require))" class="docs" hyphens="none">require</a>—its <span class="my-code" decode="exclude">test</span> sub­mod­ule will be ignored. This way, we can eas­ily (and con­tin­u­ally) run our tests when we’re actively devel­op­ing the mod­ule. <span class="tooltip" onclick="this.classList.toggle('tooltip_visible')"> + <span class="tooltip-inner">The <span class="my-code" decode="exclude">test</span> sub­mod­ule also coop­er­ates with other Racket tools, like <a href="http://docs.racket-lang.org/raco/test.html"><span class="my-code" decode="exclude">raco test</span></a>.</span></span></p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_R7RYm&quot;)"></div><p id="a_R7RYm">Let’s move our tests into a <span class="my-code" decode="exclude">test</span> sub­mod­ule. We’ve seen how to define a sub­mod­ule with <a href="http://docs.racket-lang.org/reference/module.html#(form._((quote._~23~25kernel)._module))" class="docs" hyphens="none">module</a>. For <span class="my-code" decode="exclude">test</span> we’ll use a vari­ant called <a href="http://docs.racket-lang.org/reference/module.html#(form._((lib._racket/private/base..rkt)._module+))" class="docs" hyphens="none">module+</a>. A sub­mod­ule cre­ated with <span class="my-code" decode="exclude">module+</span> has two ben­e­fits:</p></div><ol><li><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_R2nS1&quot;)"></div><p id="a_R2nS1">It auto­mat­i­cally imports the bind­ings avail­able in its sur­round­ing mod­ule, includ­ing vari­ables and func­tions. This is help­ful because our unit tests will be call­ing those func­tions.</p></div></li><li><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_qBWGf&quot;)"></div><p id="a_qBWGf">When mul­ti­ple <span class="my-code" decode="exclude">module+</span> dec­la­ra­tions for the same sub­mod­ule appear in a source file, they’re con­cate­nated into a sin­gle sub­mod­ule. Thus, <span class="my-code" decode="exclude">module+</span> lets us build up a sub­mod­ule piece by piece. This is help­ful because we can still keep unit tests for a cer­tain func­tion next to the func­tion.</p></div></li></ol><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_xCKO6&quot;)"></div><p id="a_xCKO6">Because of these spe­cial behav­iors, a sub­mod­ule declared with <span class="my-code" decode="exclude">module+</span> nec­es­sar­ily runs <strong>after</strong> its enclos­ing mod­ule is eval­u­ated.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_0ZUkK&quot;)"></div><p id="a_0ZUkK">Start­ing with our exam­ple above, let’s move our unit tests into a <span class="my-code" decode="exclude">test</span> sub­mod­ule:</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_PUWP9&quot;)"></div><div class="highlight-container" id="a_PUWP9"><div id="code_46" form="false" decode="exclude" style="font-size:0;width:0;height:0">(module+ test<br/>  (require rackunit))<br/><br/>(define (our-div num denom)<br/>  (/ num denom))<br/><br/>(module+ test<br/>  (check-equal? (our-div 42 6) 7)<br/>  (check-equal? (our-div 42 2) 21)<br/>  (check-exn exn:fail? (lambda () (our-div 42 0))))</div><div class="highlight" form="false" id="a_30dc6"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="source"><pre><span class="hll"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/module.html#(form._((lib._racket/private/base..rkt)._module+))" class="docs" hyphens="none">module+</a></span> <span class="n">test</span>
</span><span class="hll">  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._require))" class="docs" hyphens="none">require</a></span> <span class="n">rackunit</span><span class="p">))</span>
</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="p">(</span><span class="n">our-div</span> <span class="n">num</span> <span class="n">denom</span><span class="p">)</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._/))" class="docs" hyphens="none">/</a></span> <span class="n">num</span> <span class="n">denom</span><span class="p">))</span>

<span class="hll"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/module.html#(form._((lib._racket/private/base..rkt)._module+))" class="docs" hyphens="none">module+</a></span> <span class="n">test</span>
</span><span class="hll">  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/rackunit/api.html#(def._((lib._rackunit/main..rkt)._check-equal~3f))" class="docs" hyphens="none">check-equal?</a></span> <span class="p">(</span><span class="n">our-div</span> <span class="mi">42</span> <span class="mi">6</span><span class="p">)</span> <span class="mi">7</span><span class="p">)</span>
</span><span class="hll">  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/rackunit/api.html#(def._((lib._rackunit/main..rkt)._check-equal~3f))" class="docs" hyphens="none">check-equal?</a></span> <span class="p">(</span><span class="n">our-div</span> <span class="mi">42</span> <span class="mi">2</span><span class="p">)</span> <span class="mi">21</span><span class="p">)</span>
</span><span class="hll">  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/rackunit/api.html#(def._((lib._rackunit/main..rkt)._check-exn))" class="docs" hyphens="none">check-exn</a></span> <span class="nb"><a href="http://docs.racket-lang.org/reference/exns.html#(def._((quote._~23~25kernel)._exn~3afail~3f))" class="docs" hyphens="none">exn:fail?</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._lambda))" class="docs" hyphens="none">lambda</a></span> <span class="p">()</span> <span class="p">(</span><span class="n">our-div</span> <span class="mi">42</span> <span class="mi">0</span><span class="p">))))</span>
</span></pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpk3" data-clipboard-target="#code_46" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_YZnBs&quot;)"></div><p id="a_YZnBs">When we run this code, DrRacket will first run the body of the mod­ule that con­tains the def­i­n­i­tion of <span class="my-code" decode="exclude">our-div</span>. Then it will assem­ble the pieces of the <span class="my-code" decode="exclude">test</span> sub­mod­ule—putting together the <span class="my-code" decode="exclude">(require rackunit)</span> piece at the top with the checks at the bot­tom—and run it. If we were to change one of the tests so it fails, we’d get the same kind of error mes­sage as before.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_Xm005&quot;)"></div><p id="a_Xm005">Sup­pose we add a new func­tion called <span class="my-code" decode="exclude">our-mult</span>. We could orga­nize the func­tion and its related tests like this:</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_SbyIA&quot;)"></div><div class="highlight-container" id="a_SbyIA"><div id="code_47" form="false" decode="exclude" style="font-size:0;width:0;height:0">(module+ test<br/>  (require rackunit))<br/><br/>(define (our-div num denom)<br/>  (/ num denom))<br/><br/>(module+ test<br/>  (check-equal? (our-div 42 6) 7)<br/>  (check-equal? (our-div 42 2) 21)<br/>  (check-exn exn:fail? (lambda () (our-div 42 0))))<br/><br/>(define (our-mult factor1 factor2)<br/>  (* factor1 factor2))<br/><br/>(module+ test<br/>  (check-equal? (our-mult 6 7) 42)<br/>  (check-exn exn:fail? (lambda () (our-mult "a" "b"))))</div><div class="highlight" form="false" id="a_ljtBw"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td><td class="code"><div class="source"><pre><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/module.html#(form._((lib._racket/private/base..rkt)._module+))" class="docs" hyphens="none">module+</a></span> <span class="n">test</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._require))" class="docs" hyphens="none">require</a></span> <span class="n">rackunit</span><span class="p">))</span>

<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="p">(</span><span class="n">our-div</span> <span class="n">num</span> <span class="n">denom</span><span class="p">)</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._/))" class="docs" hyphens="none">/</a></span> <span class="n">num</span> <span class="n">denom</span><span class="p">))</span>

<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/module.html#(form._((lib._racket/private/base..rkt)._module+))" class="docs" hyphens="none">module+</a></span> <span class="n">test</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/rackunit/api.html#(def._((lib._rackunit/main..rkt)._check-equal~3f))" class="docs" hyphens="none">check-equal?</a></span> <span class="p">(</span><span class="n">our-div</span> <span class="mi">42</span> <span class="mi">6</span><span class="p">)</span> <span class="mi">7</span><span class="p">)</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/rackunit/api.html#(def._((lib._rackunit/main..rkt)._check-equal~3f))" class="docs" hyphens="none">check-equal?</a></span> <span class="p">(</span><span class="n">our-div</span> <span class="mi">42</span> <span class="mi">2</span><span class="p">)</span> <span class="mi">21</span><span class="p">)</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/rackunit/api.html#(def._((lib._rackunit/main..rkt)._check-exn))" class="docs" hyphens="none">check-exn</a></span> <span class="nb"><a href="http://docs.racket-lang.org/reference/exns.html#(def._((quote._~23~25kernel)._exn~3afail~3f))" class="docs" hyphens="none">exn:fail?</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._lambda))" class="docs" hyphens="none">lambda</a></span> <span class="p">()</span> <span class="p">(</span><span class="n">our-div</span> <span class="mi">42</span> <span class="mi">0</span><span class="p">))))</span>

<span class="hll"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="p">(</span><span class="n">our-mult</span> <span class="n">factor1</span> <span class="n">factor2</span><span class="p">)</span>
</span><span class="hll">  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._*))" class="docs" hyphens="none">*</a></span> <span class="n">factor1</span> <span class="n">factor2</span><span class="p">))</span>
</span><span class="hll">
</span><span class="hll"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/module.html#(form._((lib._racket/private/base..rkt)._module+))" class="docs" hyphens="none">module+</a></span> <span class="n">test</span>
</span><span class="hll">  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/rackunit/api.html#(def._((lib._rackunit/main..rkt)._check-equal~3f))" class="docs" hyphens="none">check-equal?</a></span> <span class="p">(</span><span class="n">our-mult</span> <span class="mi">6</span> <span class="mi">7</span><span class="p">)</span> <span class="mi">42</span><span class="p">)</span>
</span><span class="hll">  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/rackunit/api.html#(def._((lib._rackunit/main..rkt)._check-exn))" class="docs" hyphens="none">check-exn</a></span> <span class="nb"><a href="http://docs.racket-lang.org/reference/exns.html#(def._((quote._~23~25kernel)._exn~3afail~3f))" class="docs" hyphens="none">exn:fail?</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._lambda))" class="docs" hyphens="none">lambda</a></span> <span class="p">()</span> <span class="p">(</span><span class="n">our-mult</span> <span class="s2">"a"</span> <span class="s2">"b"</span><span class="p">))))</span>
</span></pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpk4" data-clipboard-target="#code_47" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;adding-tests-to-the-tokenizer&quot;)"></div><h3 anchor="adding-tests-to-the-tokenizer" class="subhead" id="adding-tests-to-the-tokenizer"><a href="#adding-tests-to-the-tokenizer">Adding tests to the tok­enizer</a></h3></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_MgD5B&quot;)"></div><p id="a_MgD5B">Now that we know how to use <span class="my-code" decode="exclude">rackunit</span> and the <span class="my-code" decode="exclude">test</span> sub­mod­ule, we’ll add some unit tests for <span class="my-code" decode="exclude">jsonic-token?</span> and <span class="my-code" decode="exclude">make-tokenizer</span>.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_o76Ja&quot;)"></div><p id="a_o76Ja">We intro­duce the <span class="my-code" decode="exclude">test</span> sub­mod­ule and import <span class="my-code" decode="exclude">rackunit</span>. Then we  add the unit tests. For pred­i­cates like <span class="my-code" decode="exclude">jsonic-token?</span>, it’s con­ve­nient to use <a href="http://docs.racket-lang.org/rackunit/api.html#(def._((lib._rackunit/main..rkt)._check-true))" class="docs" hyphens="none">check-true</a> and <a href="http://docs.racket-lang.org/rackunit/api.html#(def._((lib._rackunit/main..rkt)._check-false))" class="docs" hyphens="none">check-false</a>. These are like <a href="http://docs.racket-lang.org/rackunit/api.html#(def._((lib._rackunit/main..rkt)._check-equal~3f))" class="docs" hyphens="none">check-equal?</a>, but they auto­mat­i­cally com­pare the result to <span class="my-code" decode="exclude">#t</span> or <span class="my-code" decode="exclude">#f</span>. We write tests that cover each branch of the pred­i­cate, and one that fails:</p></div><div class="filebox" anchorize="false"><div class="filename" anchorize="false" decode="exclude">jsonic/tokenizer.rkt</div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_Phzpf&quot;)"></div><div class="highlight-container" id="a_Phzpf"><div id="code_48" form="false" decode="exclude" style="font-size:0;width:0;height:0">#lang br/quicklang<br/>(require brag/support racket/contract)<br/><br/>(module+ test<br/>  (require rackunit))<br/><br/>(define (jsonic-token? x)<br/>  (or (eof-object? x) (string? x) (token-struct? x)))<br/><br/>(module+ test<br/>  (check-true (jsonic-token? eof))<br/>  (check-true (jsonic-token? "a string"))<br/>  (check-true (jsonic-token? (token 'A-TOKEN-STRUCT "hi")))<br/>  (check-false (jsonic-token? 42)))<br/><br/>(define (make-tokenizer port)<br/>  (define (next-token)<br/>    (define jsonic-lexer<br/>      (lexer<br/>       [(eof) eof]<br/>       [(from/to "//" "\n") (next-token)]<br/>       [(from/to "@$" "$@")<br/>        (token 'SEXP-TOK (trim-ends "@$" lexeme "$@"))]<br/>       [any-char (token 'CHAR-TOK lexeme)]))<br/>    (jsonic-lexer port))<br/>  next-token)<br/>(provide<br/> (contract-out<br/>  [make-tokenizer (input-port? . -&gt; . (-&gt; jsonic-token?))]))</div><div class="highlight" form="false" id="a_y3NT3"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29</pre></div></td><td class="code"><div class="source"><pre><span class="kn">#lang </span><span class="nn">br/quicklang</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._require))" class="docs" hyphens="none">require</a></span> <span class="n">brag/support</span> <span class="n">racket/contract</span><span class="p">)</span>

<span class="hll"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/module.html#(form._((lib._racket/private/base..rkt)._module+))" class="docs" hyphens="none">module+</a></span> <span class="n">test</span>
</span><span class="hll">  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._require))" class="docs" hyphens="none">require</a></span> <span class="n">rackunit</span><span class="p">))</span>
</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="p">(</span><span class="n">jsonic-token?</span> <span class="n">x</span><span class="p">)</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/if.html#(form._((lib._racket/private/letstx-scheme..rkt)._or))" class="docs" hyphens="none">or</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/port-ops.html#(def._((quote._~23~25kernel)._eof-object~3f))" class="docs" hyphens="none">eof-object?</a></span> <span class="n">x</span><span class="p">)</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/strings.html#(def._((quote._~23~25kernel)._string~3f))" class="docs" hyphens="none">string?</a></span> <span class="n">x</span><span class="p">)</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(def._((lib._brag/support..rkt)._token-struct~3f))" class="docs" hyphens="none">token-struct?</a></span> <span class="n">x</span><span class="p">)))</span>

<span class="hll"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/module.html#(form._((lib._racket/private/base..rkt)._module+))" class="docs" hyphens="none">module+</a></span> <span class="n">test</span>
</span><span class="hll">  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/rackunit/api.html#(def._((lib._rackunit/main..rkt)._check-true))" class="docs" hyphens="none">check-true</a></span> <span class="p">(</span><span class="n">jsonic-token?</span> <span class="nb"><a href="http://docs.racket-lang.org/reference/port-ops.html#(def._((quote._~23~25kernel)._eof))" class="docs" hyphens="none">eof</a></span><span class="p">))</span>
</span><span class="hll">  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/rackunit/api.html#(def._((lib._rackunit/main..rkt)._check-true))" class="docs" hyphens="none">check-true</a></span> <span class="p">(</span><span class="n">jsonic-token?</span> <span class="s2">"a string"</span><span class="p">))</span>
</span><span class="hll">  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/rackunit/api.html#(def._((lib._rackunit/main..rkt)._check-true))" class="docs" hyphens="none">check-true</a></span> <span class="p">(</span><span class="n">jsonic-token?</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(def._((lib._brag/support..rkt)._token))" class="docs" hyphens="none">token</a></span> <span class="o">&#39;</span><span class="ss">A-TOKEN-STRUCT</span> <span class="s2">"hi"</span><span class="p">)))</span>
</span><span class="hll">  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/rackunit/api.html#(def._((lib._rackunit/main..rkt)._check-false))" class="docs" hyphens="none">check-false</a></span> <span class="p">(</span><span class="n">jsonic-token?</span> <span class="mi">42</span><span class="p">)))</span>
</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="p">(</span><span class="n">make-tokenizer</span> <span class="n">port</span><span class="p">)</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="p">(</span><span class="n">next-token</span><span class="p">)</span>
    <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="n">jsonic-lexer</span>
      <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._lexer))" class="docs" hyphens="none">lexer</a></span>
       <span class="p">[(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/port-ops.html#(def._((quote._~23~25kernel)._eof))" class="docs" hyphens="none">eof</a></span><span class="p">)</span> <span class="nb"><a href="http://docs.racket-lang.org/reference/port-ops.html#(def._((quote._~23~25kernel)._eof))" class="docs" hyphens="none">eof</a></span><span class="p">]</span>
       <span class="p">[(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(form._((lib._brag/support..rkt)._from/to))" class="docs" hyphens="none">from/to</a></span> <span class="s2">"//"</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span> <span class="p">(</span><span class="n">next-token</span><span class="p">)]</span>
       <span class="p">[(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(form._((lib._brag/support..rkt)._from/to))" class="docs" hyphens="none">from/to</a></span> <span class="s2">"@$"</span> <span class="s2">"$@"</span><span class="p">)</span>
        <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(def._((lib._brag/support..rkt)._token))" class="docs" hyphens="none">token</a></span> <span class="o">&#39;</span><span class="ss">SEXP-TOK</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(def._((lib._brag/support..rkt)._trim-ends))" class="docs" hyphens="none">trim-ends</a></span> <span class="s2">"@$"</span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._lexeme))" class="docs" hyphens="none">lexeme</a></span> <span class="s2">"$@"</span><span class="p">))]</span>
       <span class="p">[</span><span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._any-char))" class="docs" hyphens="none">any-char</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(def._((lib._brag/support..rkt)._token))" class="docs" hyphens="none">token</a></span> <span class="o">&#39;</span><span class="ss">CHAR-TOK</span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._lexeme))" class="docs" hyphens="none">lexeme</a></span><span class="p">)]))</span>
    <span class="p">(</span><span class="n">jsonic-lexer</span> <span class="n">port</span><span class="p">))</span>
  <span class="n">next-token</span><span class="p">)</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._provide))" class="docs" hyphens="none">provide</a></span>
 <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/attaching-contracts-to-values.html#(form._((lib._racket/contract/base..rkt)._contract-out))" class="docs" hyphens="none">contract-out</a></span>
  <span class="p">[</span><span class="n">make-tokenizer</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/port-ops.html#(def._((quote._~23~25kernel)._input-port~3f))" class="docs" hyphens="none">input-port?</a></span> <span class="o">.</span> <span class="nb"><a href="http://docs.racket-lang.org/reference/function-contracts.html#(form._((lib._racket/contract/base..rkt)._-~3e))" class="docs" hyphens="none">-&gt;</a></span> <span class="o">.</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/function-contracts.html#(form._((lib._racket/contract/base..rkt)._-~3e))" class="docs" hyphens="none">-&gt;</a></span> <span class="n">jsonic-token?</span><span class="p">))]))</span>
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpk5" data-clipboard-target="#code_48" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_1rRt5&quot;)"></div><p id="a_1rRt5">Then we add tests for <span class="my-code" decode="exclude">make-tokenizer</span>. This func­tion is a lit­tle trick­ier, because we need to feed it an <a href="http://docs.racket-lang.org/reference/port-ops.html#(def._((quote._~23~25kernel)._input-port~3f))" class="docs" hyphens="none">input-port?</a>, and what we get back is a func­tion that emits tokens. For test­ing pur­poses, it would be sim­pler to pass in a string rep­re­sent­ing a piece of source code, and get back a list of tokens.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_a07Yd&quot;)"></div><p id="a_a07Yd">Good news—the <span class="my-code" decode="exclude">brag/support</span> mod­ule pro­vides a helper func­tion, <a href="http://docs.racket-lang.org/brag/index.html#(def._((lib._brag/support..rkt)._apply-tokenizer-maker))" class="docs" hyphens="none">apply-tokenizer-maker</a>, that han­dles this minor house­keep­ing. We can use this func­tion with <span class="my-code" decode="exclude">check-equal?</span> to write our tests.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_cn7TD&quot;)"></div><p id="a_cn7TD">Now we just need some test expres­sions:</p></div><div class="filebox" anchorize="false"><div class="filename" anchorize="false" decode="exclude">jsonic/tokenizer.rkt</div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_9WQfL&quot;)"></div><div class="highlight-container" id="a_9WQfL"><div id="code_49" form="false" decode="exclude" style="font-size:0;width:0;height:0">#lang br/quicklang<br/>(require brag/support racket/contract)<br/><br/>(module+ test<br/>  (require rackunit))<br/><br/>(define (jsonic-token? x)<br/>  (or (eof-object? x) (string? x) (token-struct? x)))<br/><br/>(module+ test<br/>  (check-true (jsonic-token? eof))<br/>  (check-true (jsonic-token? "a string"))<br/>  (check-true (jsonic-token? (token 'A-TOKEN-STRUCT "hi")))<br/>  (check-false (jsonic-token? 42)))<br/><br/>(define (make-tokenizer port)<br/>  (define (next-token)<br/>    (define jsonic-lexer<br/>      (lexer<br/>       [(eof) eof]<br/>       [(from/to "//" "\n") (next-token)]<br/>       [(from/to "@$" "$@")<br/>        (token 'SEXP-TOK (trim-ends "@$" lexeme "$@"))]<br/>       [any-char (token 'CHAR-TOK lexeme)]))<br/>    (jsonic-lexer port))<br/>  next-token)<br/>(provide<br/> (contract-out<br/>  [make-tokenizer (input-port? . -&gt; . (-&gt; jsonic-token?))]))<br/><br/>(module+ test<br/>  (check-equal?<br/>   (apply-tokenizer-maker tokenize "// comment\n")<br/>   empty)<br/>  (check-equal?<br/>   (apply-tokenizer-maker tokenize "@$ (+ 6 7) $@")<br/>   (list (token-struct 'SEXP-TOK " (+ 6 7) " #f #f #f #f #f)))<br/>  (check-equal?<br/>   (apply-tokenizer-maker tokenize "hi")<br/>   (list (token-struct 'CHAR-TOK "h" #f #f #f #f #f)<br/>         (token-struct 'CHAR-TOK "i" #f #f #f #f #f))))</div><div class="highlight" form="false" id="a_u9pf9"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41</pre></div></td><td class="code"><div class="source"><pre><span class="kn">#lang </span><span class="nn">br/quicklang</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._require))" class="docs" hyphens="none">require</a></span> <span class="n">brag/support</span> <span class="n">racket/contract</span><span class="p">)</span>

<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/module.html#(form._((lib._racket/private/base..rkt)._module+))" class="docs" hyphens="none">module+</a></span> <span class="n">test</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._require))" class="docs" hyphens="none">require</a></span> <span class="n">rackunit</span><span class="p">))</span>

<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="p">(</span><span class="n">jsonic-token?</span> <span class="n">x</span><span class="p">)</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/if.html#(form._((lib._racket/private/letstx-scheme..rkt)._or))" class="docs" hyphens="none">or</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/port-ops.html#(def._((quote._~23~25kernel)._eof-object~3f))" class="docs" hyphens="none">eof-object?</a></span> <span class="n">x</span><span class="p">)</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/strings.html#(def._((quote._~23~25kernel)._string~3f))" class="docs" hyphens="none">string?</a></span> <span class="n">x</span><span class="p">)</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(def._((lib._brag/support..rkt)._token-struct~3f))" class="docs" hyphens="none">token-struct?</a></span> <span class="n">x</span><span class="p">)))</span>

<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/module.html#(form._((lib._racket/private/base..rkt)._module+))" class="docs" hyphens="none">module+</a></span> <span class="n">test</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/rackunit/api.html#(def._((lib._rackunit/main..rkt)._check-true))" class="docs" hyphens="none">check-true</a></span> <span class="p">(</span><span class="n">jsonic-token?</span> <span class="nb"><a href="http://docs.racket-lang.org/reference/port-ops.html#(def._((quote._~23~25kernel)._eof))" class="docs" hyphens="none">eof</a></span><span class="p">))</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/rackunit/api.html#(def._((lib._rackunit/main..rkt)._check-true))" class="docs" hyphens="none">check-true</a></span> <span class="p">(</span><span class="n">jsonic-token?</span> <span class="s2">"a string"</span><span class="p">))</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/rackunit/api.html#(def._((lib._rackunit/main..rkt)._check-true))" class="docs" hyphens="none">check-true</a></span> <span class="p">(</span><span class="n">jsonic-token?</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(def._((lib._brag/support..rkt)._token))" class="docs" hyphens="none">token</a></span> <span class="o">&#39;</span><span class="ss">A-TOKEN-STRUCT</span> <span class="s2">"hi"</span><span class="p">)))</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/rackunit/api.html#(def._((lib._rackunit/main..rkt)._check-false))" class="docs" hyphens="none">check-false</a></span> <span class="p">(</span><span class="n">jsonic-token?</span> <span class="mi">42</span><span class="p">)))</span>

<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="p">(</span><span class="n">make-tokenizer</span> <span class="n">port</span><span class="p">)</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="p">(</span><span class="n">next-token</span><span class="p">)</span>
    <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="n">jsonic-lexer</span>
      <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._lexer))" class="docs" hyphens="none">lexer</a></span>
       <span class="p">[(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/port-ops.html#(def._((quote._~23~25kernel)._eof))" class="docs" hyphens="none">eof</a></span><span class="p">)</span> <span class="nb"><a href="http://docs.racket-lang.org/reference/port-ops.html#(def._((quote._~23~25kernel)._eof))" class="docs" hyphens="none">eof</a></span><span class="p">]</span>
       <span class="p">[(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(form._((lib._brag/support..rkt)._from/to))" class="docs" hyphens="none">from/to</a></span> <span class="s2">"//"</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span> <span class="p">(</span><span class="n">next-token</span><span class="p">)]</span>
       <span class="p">[(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(form._((lib._brag/support..rkt)._from/to))" class="docs" hyphens="none">from/to</a></span> <span class="s2">"@$"</span> <span class="s2">"$@"</span><span class="p">)</span>
        <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(def._((lib._brag/support..rkt)._token))" class="docs" hyphens="none">token</a></span> <span class="o">&#39;</span><span class="ss">SEXP-TOK</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(def._((lib._brag/support..rkt)._trim-ends))" class="docs" hyphens="none">trim-ends</a></span> <span class="s2">"@$"</span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._lexeme))" class="docs" hyphens="none">lexeme</a></span> <span class="s2">"$@"</span><span class="p">))]</span>
       <span class="p">[</span><span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._any-char))" class="docs" hyphens="none">any-char</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(def._((lib._brag/support..rkt)._token))" class="docs" hyphens="none">token</a></span> <span class="o">&#39;</span><span class="ss">CHAR-TOK</span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._lexeme))" class="docs" hyphens="none">lexeme</a></span><span class="p">)]))</span>
    <span class="p">(</span><span class="n">jsonic-lexer</span> <span class="n">port</span><span class="p">))</span>
  <span class="n">next-token</span><span class="p">)</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._provide))" class="docs" hyphens="none">provide</a></span>
 <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/attaching-contracts-to-values.html#(form._((lib._racket/contract/base..rkt)._contract-out))" class="docs" hyphens="none">contract-out</a></span>
  <span class="p">[</span><span class="n">make-tokenizer</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/port-ops.html#(def._((quote._~23~25kernel)._input-port~3f))" class="docs" hyphens="none">input-port?</a></span> <span class="o">.</span> <span class="nb"><a href="http://docs.racket-lang.org/reference/function-contracts.html#(form._((lib._racket/contract/base..rkt)._-~3e))" class="docs" hyphens="none">-&gt;</a></span> <span class="o">.</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/function-contracts.html#(form._((lib._racket/contract/base..rkt)._-~3e))" class="docs" hyphens="none">-&gt;</a></span> <span class="n">jsonic-token?</span><span class="p">))]))</span>

<span class="hll"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/module.html#(form._((lib._racket/private/base..rkt)._module+))" class="docs" hyphens="none">module+</a></span> <span class="n">test</span>
</span><span class="hll">  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/rackunit/api.html#(def._((lib._rackunit/main..rkt)._check-equal~3f))" class="docs" hyphens="none">check-equal?</a></span>
</span><span class="hll">   <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(def._((lib._brag/support..rkt)._apply-tokenizer-maker))" class="docs" hyphens="none">apply-tokenizer-maker</a></span> <span class="n">tokenize</span> <span class="s2">"// comment</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
</span><span class="hll">   <span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((lib._racket/list..rkt)._empty))" class="docs" hyphens="none">empty</a></span><span class="p">)</span>
</span><span class="hll">  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/rackunit/api.html#(def._((lib._rackunit/main..rkt)._check-equal~3f))" class="docs" hyphens="none">check-equal?</a></span>
</span><span class="hll">   <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(def._((lib._brag/support..rkt)._apply-tokenizer-maker))" class="docs" hyphens="none">apply-tokenizer-maker</a></span> <span class="n">tokenize</span> <span class="s2">"@$ (+ 6 7) $@"</span><span class="p">)</span>
</span><span class="hll">   <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._list))" class="docs" hyphens="none">list</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(def._((lib._brag/support..rkt)._token-struct))" class="docs" hyphens="none">token-struct</a></span> <span class="o">&#39;</span><span class="ss">SEXP-TOK</span> <span class="s2">" (+ 6 7) "</span> <span class="no">#f</span> <span class="no">#f</span> <span class="no">#f</span> <span class="no">#f</span> <span class="no">#f</span><span class="p">)))</span>
</span><span class="hll">  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/rackunit/api.html#(def._((lib._rackunit/main..rkt)._check-equal~3f))" class="docs" hyphens="none">check-equal?</a></span>
</span><span class="hll">   <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(def._((lib._brag/support..rkt)._apply-tokenizer-maker))" class="docs" hyphens="none">apply-tokenizer-maker</a></span> <span class="n">tokenize</span> <span class="s2">"hi"</span><span class="p">)</span>
</span><span class="hll">   <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._list))" class="docs" hyphens="none">list</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(def._((lib._brag/support..rkt)._token-struct))" class="docs" hyphens="none">token-struct</a></span> <span class="o">&#39;</span><span class="ss">CHAR-TOK</span> <span class="s2">"h"</span> <span class="no">#f</span> <span class="no">#f</span> <span class="no">#f</span> <span class="no">#f</span> <span class="no">#f</span><span class="p">)</span>
</span><span class="hll">         <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(def._((lib._brag/support..rkt)._token-struct))" class="docs" hyphens="none">token-struct</a></span> <span class="o">&#39;</span><span class="ss">CHAR-TOK</span> <span class="s2">"i"</span> <span class="no">#f</span> <span class="no">#f</span> <span class="no">#f</span> <span class="no">#f</span> <span class="no">#f</span><span class="p">))))</span>
</span></pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpk6" data-clipboard-target="#code_49" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_NtmM8&quot;)"></div><p id="a_NtmM8">But more good news—we <a href="../jsonic/the-tokenizer.html#testing-the-tokenizer">already wrote them</a> when we first wrote <span class="my-code" decode="exclude">make-tokenizer</span>. Then, we tested <span class="my-code" decode="exclude">make-tokenizer</span> by inspect­ing the results we got by enter­ing these expres­sions on the REPL. Now, we take the same expres­sions and results and move them inside unit tests.</p></div><div anchorize="false" style="height:1em"></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_E6XxI&quot;)"></div><p id="a_E6XxI">At this point, the mod­ule seems to run the same way it always did. With unit tests, no news is good news. If we were to mon­key with the code inside <span class="my-code" decode="exclude">jsonic-token?</span> or <span class="my-code" decode="exclude">make-tokenizer</span>—for those who haven’t tried it, go ahead—our unit tests would start rais­ing errors.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_qB0Jz&quot;)"></div><p id="a_qB0Jz">With unit tests, we can con­tin­u­ally &amp; auto­mat­i­cally ver­ify the behav­ior of our func­tions. If we change these func­tions in a way that alters this behav­ior, the unit tests will flag the prob­lem imme­di­ately. This makes it eas­ier to improve the func­tions, because we have imme­di­ate test­ing feed­back.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_Gs4wK&quot;)"></div><p id="a_Gs4wK">Of course, not every update to a func­tion will be back­ward-com­pat­i­ble with our exist­ing tests (we’ll see an exam­ple of that in <a href="source-locations.html">source loca­tions</a>). When that’s the case, we can update the tests too. Like <a href="contracts.html">con­tracts</a>, tests aren’t meant to inhibit changes. Rather, by mak­ing the expected behav­ior of a func­tion explicit, they help us pro­ceed in a more dis­ci­plined and care­ful way.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;adding-parser-tests-in-a-separate-module&quot;)"></div><h3 anchor="adding-parser-tests-in-a-separate-module" class="subhead" id="adding-parser-tests-in-a-separate-module"><a href="#adding-parser-tests-in-a-separate-module">Adding parser tests in a sep­a­rate mod­ule</a></h3></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_q1nNY&quot;)"></div><p id="a_q1nNY">One lim­i­ta­tion of the <span class="my-code" decode="exclude">test</span> sub­mod­ule is that we can only use it in mod­ules that use a lan­guage that sup­ports <span class="my-code" decode="exclude">module+</span>. Our <span class="my-code" decode="exclude">"parser.rkt"</span> mod­ule, for instance, is writ­ten in <span class="my-code" decode="exclude">#lang brag</span>, which doesn’t sup­port <span class="my-code" decode="exclude">module+</span>:</p></div><div class="filebox" anchorize="false"><div class="filename" anchorize="false" decode="exclude">jsonic/parser.rkt</div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_GE34m&quot;)"></div><div class="highlight-container" id="a_GE34m"><div id="code_50" form="false" decode="exclude" style="font-size:0;width:0;height:0">#lang brag<br/>jsonic-program : (jsonic-char | jsonic-sexp)*<br/>jsonic-char    : CHAR-TOK<br/>jsonic-sexp    : SEXP-TOK
</div><div class="highlight" form="false" id="a_5vnS4"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="source"><pre>#lang brag
jsonic-program : (jsonic-char | jsonic-sexp)*
jsonic-char    : CHAR-TOK
jsonic-sexp    : SEXP-TOK
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpk7" data-clipboard-target="#code_50" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_FvC1S&quot;)"></div><p id="a_FvC1S">In this case, we can still make unit tests for <a href="http://docs.racket-lang.org/brag/index.html#(def._((lib._brag/examples/nested-word-list..rkt)._parse))" class="docs" hyphens="none">parse</a> using <span class="my-code" decode="exclude">rackunit</span>. But we’ll have to move them into a sep­a­rate file. Slightly less con­ve­nient, but a lot bet­ter than not test­ing at all.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_BuQBU&quot;)"></div><p id="a_BuQBU">As we did with <span class="my-code" decode="exclude">make-tokenizer</span>, we’ll take the infor­mal tests we <a href="../jsonic/the-parser.html#testing-the-parser">wrote in the last tuto­r­ial</a> and con­vert them into real unit tests in a new file called <span class="my-code" decode="exclude">"parser-test.rkt"</span>.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_leqrc&quot;)"></div><p id="a_leqrc">Recall that our parser <a href="../jsonic/the-parser.html#the-parser">takes a list of tokens</a> and turns them into a parse tree. There­fore, we need to import our tok­enizer so that we can process strings of source code into tokens (and we’ll also import <span class="my-code" decode="exclude">brag/support</span> so we can use <a href="http://docs.racket-lang.org/brag/index.html#(def._((lib._brag/support..rkt)._apply-tokenizer-maker))" class="docs" hyphens="none">apply-tokenizer-maker</a> func­tion again.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_IraQ1&quot;)"></div><p id="a_IraQ1">Then we can add our pre­vi­ous test cases, con­verted into <a href="http://docs.racket-lang.org/rackunit/api.html#(def._((lib._rackunit/main..rkt)._check-equal~3f))" class="docs" hyphens="none">check-equal?</a> tests. To make things eas­ier, in our tests we’ll use our parser’s <a href="http://docs.racket-lang.org/brag/index.html#(def._((lib._brag/examples/nested-word-list..rkt)._parse-to-datum))" class="docs" hyphens="none">parse-to-datum</a> func­tion, which works the same as <span class="my-code" decode="exclude">parse</span>, but con­verts the result into a sim­ple hier­ar­chi­cal list.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_nSxed&quot;)"></div><p id="a_nSxed">The whole <span class="my-code" decode="exclude">"parser-test.rkt"</span> looks like this:</p></div><div class="filebox" anchorize="false"><div class="filename" anchorize="false" decode="exclude">jsonic/parser-test.rkt</div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_bwBj1&quot;)"></div><div class="highlight-container" id="a_bwBj1"><div id="code_51" form="false" decode="exclude" style="font-size:0;width:0;height:0">#lang br<br/>(require jsonic/parser<br/>         jsonic/tokenizer<br/>         brag/support<br/>         rackunit)<br/><br/>(check-equal?<br/> (parse-to-datum<br/>  (apply-tokenizer-maker make-tokenizer "// line commment\n"))<br/> '(jsonic-program))<br/>(check-equal?<br/> (parse-to-datum<br/>  (apply-tokenizer-maker make-tokenizer "@$ 42 $@"))<br/> '(jsonic-program (jsonic-sexp " 42 ")))<br/>(check-equal?<br/> (parse-to-datum<br/>  (apply-tokenizer-maker make-tokenizer "hi"))<br/> '(jsonic-program<br/>   (jsonic-char "h")<br/>   (jsonic-char "i")))<br/>(check-equal?<br/> (parse-to-datum<br/>  (apply-tokenizer-maker make-tokenizer<br/>                         "hi\n// comment\n@$ 42 $@"))<br/> '(jsonic-program<br/>   (jsonic-char "h")<br/>   (jsonic-char "i")<br/>   (jsonic-char "\n")<br/>   (jsonic-sexp " 42 ")))</div><div class="highlight" form="false" id="a_mRCqE"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29</pre></div></td><td class="code"><div class="source"><pre><span class="kn">#lang </span><span class="nn">br</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._require))" class="docs" hyphens="none">require</a></span> <span class="n">jsonic/parser</span>
         <span class="n">jsonic/tokenizer</span>
         <span class="n">brag/support</span>
         <span class="n">rackunit</span><span class="p">)</span>

<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/rackunit/api.html#(def._((lib._rackunit/main..rkt)._check-equal~3f))" class="docs" hyphens="none">check-equal?</a></span>
 <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(def._((lib._brag/examples/nested-word-list..rkt)._parse-to-datum))" class="docs" hyphens="none">parse-to-datum</a></span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(def._((lib._brag/support..rkt)._apply-tokenizer-maker))" class="docs" hyphens="none">apply-tokenizer-maker</a></span> <span class="n">make-tokenizer</span> <span class="s2">"// line commment</span><span class="se">\n</span><span class="s2">"</span><span class="p">))</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="ss">jsonic-program</span><span class="p">))</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/rackunit/api.html#(def._((lib._rackunit/main..rkt)._check-equal~3f))" class="docs" hyphens="none">check-equal?</a></span>
 <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(def._((lib._brag/examples/nested-word-list..rkt)._parse-to-datum))" class="docs" hyphens="none">parse-to-datum</a></span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(def._((lib._brag/support..rkt)._apply-tokenizer-maker))" class="docs" hyphens="none">apply-tokenizer-maker</a></span> <span class="n">make-tokenizer</span> <span class="s2">"@$ 42 $@"</span><span class="p">))</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="ss">jsonic-program</span> <span class="p">(</span><span class="ss">jsonic-sexp</span> <span class="s2">" 42 "</span><span class="p">)))</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/rackunit/api.html#(def._((lib._rackunit/main..rkt)._check-equal~3f))" class="docs" hyphens="none">check-equal?</a></span>
 <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(def._((lib._brag/examples/nested-word-list..rkt)._parse-to-datum))" class="docs" hyphens="none">parse-to-datum</a></span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(def._((lib._brag/support..rkt)._apply-tokenizer-maker))" class="docs" hyphens="none">apply-tokenizer-maker</a></span> <span class="n">make-tokenizer</span> <span class="s2">"hi"</span><span class="p">))</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="ss">jsonic-program</span>
   <span class="p">(</span><span class="ss">jsonic-char</span> <span class="s2">"h"</span><span class="p">)</span>
   <span class="p">(</span><span class="ss">jsonic-char</span> <span class="s2">"i"</span><span class="p">)))</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/rackunit/api.html#(def._((lib._rackunit/main..rkt)._check-equal~3f))" class="docs" hyphens="none">check-equal?</a></span>
 <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(def._((lib._brag/examples/nested-word-list..rkt)._parse-to-datum))" class="docs" hyphens="none">parse-to-datum</a></span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(def._((lib._brag/support..rkt)._apply-tokenizer-maker))" class="docs" hyphens="none">apply-tokenizer-maker</a></span> <span class="n">make-tokenizer</span>
                         <span class="s2">"hi</span><span class="se">\n</span><span class="s2">// comment</span><span class="se">\n</span><span class="s2">@$ 42 $@"</span><span class="p">))</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="ss">jsonic-program</span>
   <span class="p">(</span><span class="ss">jsonic-char</span> <span class="s2">"h"</span><span class="p">)</span>
   <span class="p">(</span><span class="ss">jsonic-char</span> <span class="s2">"i"</span><span class="p">)</span>
   <span class="p">(</span><span class="ss">jsonic-char</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
   <span class="p">(</span><span class="ss">jsonic-sexp</span> <span class="s2">" 42 "</span><span class="p">)))</span>
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpk8" data-clipboard-target="#code_51" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_WSTIa&quot;)"></div><p id="a_WSTIa">When we run this file, we should get no errors, because we already ver­i­fied that these test cases work.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_ZOskD&quot;)"></div><p id="a_ZOskD">Now, let’s delib­er­ately break <span class="my-code" decode="exclude">"parser.rkt"</span>—for instance, by adding a sec­ond <span class="my-code" decode="exclude">CHAR-TOK</span> to the sec­ond pro­duc­tion rule:</p></div><div class="filebox" anchorize="false"><div class="filename" anchorize="false" decode="exclude">jsonic/parser.rkt</div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_aja0T&quot;)"></div><div class="highlight-container" id="a_aja0T"><div id="code_52" form="false" decode="exclude" style="font-size:0;width:0;height:0">#lang brag<br/>jsonic-program : (jsonic-char | jsonic-sexp)*<br/>jsonic-char    : CHAR-TOK CHAR-TOK<br/>jsonic-sexp    : SEXP-TOK</div><div class="highlight" form="false" id="a_cp8Wh"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="source"><pre>#lang brag
jsonic-program : (jsonic-char | jsonic-sexp)*
jsonic-char    : CHAR-TOK CHAR-TOK
jsonic-sexp    : SEXP-TOK
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpk9" data-clipboard-target="#code_52" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_JDYfb&quot;)"></div><p id="a_JDYfb">This time, when we run <span class="my-code" decode="exclude">"parser-test.rkt"</span>, one of our checks will fail:</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_Kb9fu&quot;)"></div><div class="highlight-container err" id="a_Kb9fu"><div id="code_53" form="false" decode="exclude" style="font-size:0;width:0;height:0">--------------------<br/>FAILURE<br/>name:       check-equal?<br/>location:   parser-test.rkt:12:0<br/>actual:     (jsonic-program (jsonic-char "h" "i"))<br/>expected:   (jsonic-program (jsonic-char "h") (jsonic-char "i"))<br/>expression: (check-equal? (parse-to-datum (apply-tokenizer-maker make-tokenizer "hi")) (quote (jsonic-program (jsonic-char "h") (jsonic-char "i"))))<br/>--------------------</div><div class="highlight" form="false" id="a_Hhh9e"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="source"><pre>--------------------
FAILURE
name:       check-equal?
location:   parser-test.rkt:12:0
actual:     (jsonic-program (jsonic-char "h" "i"))
expected:   (jsonic-program (jsonic-char "h") (jsonic-char "i"))
expression: (check-equal? (parse-to-datum (apply-tokenizer-maker make-tokenizer "hi")) (quote (jsonic-program (jsonic-char "h") (jsonic-char "i"))))
--------------------
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpka" data-clipboard-target="#code_53" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_yvdrj&quot;)"></div><p id="a_yvdrj">Let’s reset <span class="my-code" decode="exclude">"parser.rkt"</span> to its orig­i­nal state and move on.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;unit-testing-caveat&quot;)"></div><h3 anchor="unit-testing-caveat" class="subhead" id="unit-testing-caveat"><a href="#unit-testing-caveat">Unit-test­ing caveat</a></h3></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_S6CYD&quot;)"></div><p id="a_S6CYD">Those new to this idea of alter­nat­ing between cod­ing and test­ing some­times con­sider it a chore and a bore. “Why waste time writ­ing tests that’ll have to be revised later? Why not just skip it?“ </p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_2B9aX&quot;)"></div><p id="a_2B9aX">The choice is yours, of course. The prob­lem is that any func­tion is likely to be used mul­ti­ple places in a pro­gram. There­fore, the com­plex­ity of inter­ac­tions between func­tions grows faster than the num­ber of func­tions.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_4CV13&quot;)"></div><p id="a_4CV13">Sure, writ­ing tests takes a lit­tle more effort at the out­set. But over the life of a pro­gram, that invest­ment is paid back in time and annoy­ance saved. Work­ing on a pro­gram with a thor­ough suite of unit tests is a plea­sure. Work­ing on a pro­gram with­out tests—now <em>that’s</em> a chore and a bore.</p></div><div anchorize="false" style="height:2em"></div><ul class="siblinks"><li><a href="intro.html">1&emsp;intro</a></li><li><a href="setup.html">2&emsp;setup</a></li><li><a href="contracts.html">3&emsp;con­tracts</a></li><li><a class="here" href="unit-tests.html">4&emsp;unit tests</a></li><li><a href="source-locations.html">5&emsp;source loca­tions</a></li><li><a href="drracket-integration.html">6&emsp;drracket inte­gra­tion</a></li><li><a href="syntax-coloring.html">7&emsp;syn­tax col­or­ing</a></li><li><a href="indenting.html">8&emsp;indent­ing</a></li><li><a href="toolbar-buttons.html">9&emsp;tool­bar but­tons</a></li><li><a href="recap.html">10&emsp;recap</a></li><li><a href="source-listing.html">11&emsp;source list­ing</a></li></ul></div>
    <a class="nav-left" href="contracts.html">← prev</a>
    <a class="nav-right" href="source-locations.html">next →</a>




</body>

<script type="text/javascript">



function show_all_forms() {
 var elems = document.getElementsByClassName('has_form');
 for (var i = 0 ; i < elems.length ; i++) {
  toggle_form(elems[i].id);
 }
}

// for debugging forms only: uncomment next line
// show_all_forms();

// sets up copy-to-clipboard buttons in code boxes
var clipboard = new Clipboard('.copy-button');
clipboard.on('success', function(e) {console.log(e);});
clipboard.on('error', function(e) {console.log(e);});
</script>