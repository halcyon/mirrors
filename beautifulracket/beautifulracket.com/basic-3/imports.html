<!DOCTYPE html>
<html>
  
<!-- Mirrored from beautifulracket.com/basic-3/imports.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 16 Mar 2017 05:48:14 GMT -->
<head>
    <meta charset="UTF-8">
    <title>Beautiful Racket: Closing the loop: basic</title>
    <link rel="stylesheet" type="text/css" media="all" href="../styles.css"/>
    <script type="text/javascript" src="../functions.js"></script>
    <script type="text/javascript" src="../clipboard.min.js"></script>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-74684045-1', 'auto');
      ga('send', 'pageview');
    </script>
  </head>
<body>
<div id="alert">Thank you for your comment</div>
    <div id="doc"><h3 class="dept" anchorize="false"><a href="../index.html">Beau­ti­ful Racket</a> / <a href="../index.html#tutorials">tuto­ri­als</a></h3><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;closing-the-loop-basic&quot;)"></div><h1 anchor="closing-the-loop-basic" id="closing-the-loop-basic" hyphens="none">Closing the loop: <span class="my-code" decode="exclude">basic</span></h1></div><ul class="siblinks"><li><a href="intro.html">1&emsp;intro</a></li><li><a href="specification-and-setup.html">2&emsp;spec­i­fi­ca­tion and setup</a></li><li><a href="functions.html">3&emsp;func­tions</a></li><li><a class="here" href="imports.html">4&emsp;imports</a></li><li><a href="exports.html">5&emsp;exports</a></li><li><a href="the-repl.html">6&emsp;the repl</a></li><li><a href="command-line-arguments.html">7&emsp;com­mand-line argu­ments</a></li><li><a href="recap.html">8&emsp;recap</a></li><li><a href="source-listing.html">9&emsp;source list­ing</a></li></ul><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_gfTjG&quot;)"></div><p id="a_gfTjG">In days of yore, a BASIC inter­preter would include a tiny “<a class=" ext" href="http://www.atariarchives.org/basicgames/showpage.php?page=i12">stan­dard library</a>” of math oper­a­tions like <span class="my-code" decode="exclude">SIN</span>, <span class="my-code" decode="exclude">TAN</span>, <span class="my-code" decode="exclude">INT</span>, and <span class="my-code" decode="exclude">LOG</span>. All other oper­a­tions would need to be defined within the pro­gram as named <a href="functions.html">func­tions</a>.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_lP5VB&quot;)"></div><p id="a_lP5VB">We could reim­ple­ment these library func­tions in our own inter­preter. But two con­sid­er­a­tions.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_e60uQ&quot;)"></div><p id="a_e60uQ">First, it would be really bor­ing.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_kSUy5&quot;)"></div><p id="a_kSUy5">Sec­ond, given that Racket has authen­ti­cally <a href="http://docs.racket-lang.org/">vast libraries of math func­tions</a>, it would be nice to find a way to use them in our <span class="my-code" decode="exclude">basic</span> pro­grams.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_uvtMg&quot;)"></div><p id="a_uvtMg">So let’s depart from tra­di­tion and intro­duce a new <span class="my-code" decode="exclude">import</span> state­ment. It’ll work like <a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._require))" class="docs" hyphens="none">require</a> and make Racket func­tions avail­able within our pro­gram just like those cre­ated with <span class="my-code" decode="exclude">def</span>:</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_IupBD&quot;)"></div><div class="highlight-container" id="a_IupBD"><div id="code_43" form="false" decode="exclude" style="font-size:0;width:0;height:0">#lang basic-demo-3<br/>10 import [math/number-theory]<br/>20 print [nth-prime](15)<br/>30 print [prime?](24)<br/>40 import [racket/base]<br/>50 print [max](f(1), f(2), f(5), f(4))<br/>60 def f(x) = x + x</div><div class="highlight" form="false" id="a_Q0u8J"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="source"><pre>#lang basic-demo-3
<span class="nl">10</span><span class="w"> </span><span class="vg">import</span><span class="w"> </span><span class="p">[</span><span class="vg">math</span><span class="o">/</span><span class="vg">number</span><span class="o">-</span><span class="vg">theory</span><span class="p">]</span>
<span class="nl">20</span><span class="w"> </span><span class="vg">print</span><span class="w"> </span><span class="p">[</span><span class="vg">nth</span><span class="o">-</span><span class="vg">prime</span><span class="p">](</span><span class="il">15</span><span class="p">)</span>
<span class="nl">30</span><span class="w"> </span><span class="vg">print</span><span class="w"> </span><span class="p">[</span><span class="vg">prime</span><span class="o">?</span><span class="p">](</span><span class="il">24</span><span class="p">)</span>
<span class="nl">40</span><span class="w"> </span><span class="vg">import</span><span class="w"> </span><span class="p">[</span><span class="vg">racket</span><span class="o">/</span><span class="vg">base</span><span class="p">]</span>
<span class="nl">50</span><span class="w"> </span><span class="vg">print</span><span class="w"> </span><span class="p">[</span><span class="vg">max</span><span class="p">](</span><span class="vg">f</span><span class="p">(</span><span class="il">1</span><span class="p">),</span><span class="w"> </span><span class="vg">f</span><span class="p">(</span><span class="il">2</span><span class="p">),</span><span class="w"> </span><span class="vg">f</span><span class="p">(</span><span class="il">5</span><span class="p">),</span><span class="w"> </span><span class="vg">f</span><span class="p">(</span><span class="il">4</span><span class="p">))</span>
<span class="nl">60</span><span class="w"> </span><span class="vg">def</span><span class="w"> </span><span class="vg">f</span><span class="p">(</span><span class="vg">x</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="vg">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="vg">x</span>
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpk" data-clipboard-target="#code_43" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_wscfh&quot;)"></div><div class="highlight-container" id="a_wscfh"><div id="code_44" form="false" decode="exclude" style="font-size:0;width:0;height:0">53 ; the 15th prime<br/>0  ; 24 is not prime<br/>10 ; the max of 2, 4, 10, 8</div><div class="highlight" form="false" id="a_yc62O"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="source"><pre><span class="mi">53</span> <span class="c1">; the 15th prime</span>
<span class="mi">0</span>  <span class="c1">; 24 is not prime</span>
<span class="mi">10</span> <span class="c1">; the max of 2, 4, 10, 8</span>
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpk1" data-clipboard-target="#code_44" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;pedaling-uphill-again&quot;)"></div><h3 anchor="pedaling-uphill-again" class="subhead" id="pedaling-uphill-again"><a href="#pedaling-uphill-again">Ped­al­ing uphill (again)</a></h3></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_7gUfk&quot;)"></div><p id="a_7gUfk">We can see that the main tasks will be:</p></div><ol><li><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_Q60vq&quot;)"></div><p id="a_Q60vq">Con­vert­ing <span class="my-code" decode="exclude">import</span> state­ments into <span class="my-code" decode="exclude">require</span> forms.</p></div></li><li><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_uuO0a&quot;)"></div><p id="a_uuO0a">Plac­ing these <span class="my-code" decode="exclude">require</span> forms at the top level of the mod­ule.</p></div></li><li><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_3fVNJ&quot;)"></div><p id="a_3fVNJ">Mak­ing sure we get usable return val­ues from Racket func­tions.</p></div></li></ol><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_Eqmev&quot;)"></div><p id="a_Eqmev">The first task isn’t too hard. But we need to step gin­gerly when we add Racket iden­ti­fiers. BASIC sup­ports infix nota­tion, and Racket doesn’t. There­fore, cer­tain source strings that are valid BASIC expres­sions could also be read as Racket iden­ti­fiers or mod­ule names. If con­fu­sion ensues, pro­grams will break:</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_AN8ld&quot;)"></div><div class="highlight-container" id="a_AN8ld"><div id="code_45" form="false" decode="exclude" style="font-size:0;width:0;height:0">racket/list<br/>foo-bar/zim-zam<br/>random-seed<br/>x+y+z</div><div class="highlight" form="false" id="a_mNk1J"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="source"><pre>racket/list
foo-bar/zim-zam
random-seed
x+y+z
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpk2" data-clipboard-target="#code_45" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_e7WCw&quot;)"></div><p id="a_e7WCw">Our lexer and parser are going to need some extra help dis­tin­guish­ing these. So we’ll adopt a con­ven­tion that only a name in <span class="my-code" decode="exclude">[square-brackets]</span> will be treated as a Racket iden­ti­fier. Oth­er­wise, it will be treated as an ordi­nary BASIC expres­sion. That way, we can mix them in our source code with­out risk of ambi­gu­ity:</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_djebw&quot;)"></div><div class="highlight-container" id="a_djebw"><div id="code_46" form="false" decode="exclude" style="font-size:0;width:0;height:0">[racket/list]<br/>foo-bar/zim-zam<br/>[random-seed]<br/>x+y+z</div><div class="highlight" form="false" id="a_8nIw4"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="source"><pre>[racket/list]
foo-bar/zim-zam
[random-seed]
x+y+z
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpk3" data-clipboard-target="#code_46" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div><div anchorize="false" style="height:1em"></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_wH0CI&quot;)"></div><p id="a_wH0CI">Next, we need to move our <span class="my-code" decode="exclude">require</span> forms at the top level of the mod­ule. Why do we need to do this at all? <span class="my-code" decode="exclude">require</span> has spe­cial sta­tus because it intro­duces <a class="glossary" href="../appendix/glossary.html#binding"><span class="glossary-link-text">bind­ings</span></a>, and resolv­ing bind­ings is a pre­req­ui­site to expand­ing and eval­u­at­ing the pro­gram (see <a class="explainer" href="../explainer/evaluation.html">eval­u­a­tion</a>). So Racket is picky about where <span class="my-code" decode="exclude">require</span> forms can appear. For instance, putting a <span class="my-code" decode="exclude">require</span> inside an expres­sion won’t work:</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_3nxTX&quot;)"></div><div class="highlight-container" id="a_3nxTX"><div id="code_47" form="false" decode="exclude" style="font-size:0;width:0;height:0">(let ()<br/>  (require math/number-theory)<br/>  (nth-prime 15))</div><div class="highlight" form="false" id="a_JMgAD"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="source"><pre><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))" class="docs" hyphens="none">let</a></span> <span class="p">()</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._require))" class="docs" hyphens="none">require</a></span> <span class="n">math/number-theory</span><span class="p">)</span>
  <span class="p">(</span><span class="n">nth-prime</span> <span class="mi">15</span><span class="p">))</span>
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpk4" data-clipboard-target="#code_47" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_Ew9VC&quot;)"></div><div class="highlight-container err" id="a_Ew9VC"><div id="code_48" form="false" decode="exclude" style="font-size:0;width:0;height:0">require: not at module level or top level in:<br/>(require math/number-theory)</div><div class="highlight" form="false" id="a_7ZoTY"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="source"><pre>require: not at module level or top level in:
(require math/number-theory)
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpk5" data-clipboard-target="#code_48" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_cXcER&quot;)"></div><p id="a_cXcER">But mov­ing the <span class="my-code" decode="exclude">require</span> ouside the <span class="my-code" decode="exclude">let</span>, to the top level, cures the prob­lem:</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_1fRxj&quot;)"></div><div class="highlight-container" id="a_1fRxj"><div id="code_49" form="false" decode="exclude" style="font-size:0;width:0;height:0">(require math/number-theory)<br/>(let ()<br/>  (nth-prime 15)) ; 53</div><div class="highlight" form="false" id="a_WeuQb"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="source"><pre><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._require))" class="docs" hyphens="none">require</a></span> <span class="n">math/number-theory</span><span class="p">)</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))" class="docs" hyphens="none">let</a></span> <span class="p">()</span>
  <span class="p">(</span><span class="n">nth-prime</span> <span class="mi">15</span><span class="p">))</span> <span class="c1">; 53</span>
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpk6" data-clipboard-target="#code_49" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_zhtbE&quot;)"></div><p id="a_zhtbE">“Can’t we just use a syn­tax lift, like we did in <a href="functions.html">func­tions</a>?”  Unfor­tu­nately, no. Because <span class="my-code" decode="exclude">require</span> forms intro­duce bind­ings, these forms are resolved <em>before</em> deeper macro expan­sion begins. A syn­tax lift, by con­trast, can only rearrange expres­sions <em>dur­ing</em> this deeper expan­sion. So lifts hap­pen too late to help us with <span class="my-code" decode="exclude">require</span>.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_YbRxE&quot;)"></div><p id="a_YbRxE">Instead, we can adapt the tech­nique we used to imple­ment <a href="../basic-2/variables-and-input.html#updating-the-expander">vari­ables</a>. In that case, we needed to find all the unique vari­able ref­er­ences in the pro­gram so we could con­vert them into top-level <span class="my-code" decode="exclude">define</span> expres­sions. In the parser, we marked all the vari­ables with a spe­cial <span class="my-code" decode="exclude">b-id</span> rule. This rule was spliced, turn­ing it into a <a class="glossary" href="../appendix/glossary.html#syntax-property"><span class="glossary-link-text">syn­tax prop­erty</span></a> that let us locate the right ele­ments inside the parse tree.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_FVlvO&quot;)"></div><p id="a_FVlvO">This time, we’ll mark the <span class="my-code" decode="exclude">import</span> tar­gets with a spe­cial parser rule called <span class="my-code" decode="exclude">b-import-name</span>. Then, in our <span class="my-code" decode="exclude">#%module-begin</span>, we’ll pull these names out of the parse tree and con­vert them to top-level <span class="my-code" decode="exclude">require</span> forms.</p></div><div anchorize="false" style="height:1em"></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_uOn0F&quot;)"></div><p id="a_uOn0F">Before we fin­ish, we’ll also need to smooth over the dif­fer­ences between Racket and BASIC data types. BASIC can only han­dle inte­gers, dec­i­mals, and strings. Racket func­tions, by con­trast, can return many other data types. To do this, we’ll update our <span class="my-code" decode="exclude">b-func</span> macro to reject any val­ues that don’t have equiv­a­lents in BASIC.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;lexer-updates&quot;)"></div><h3 anchor="lexer-updates" class="subhead" id="lexer-updates"><a href="#lexer-updates">Lexer updates</a></h3></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_urRxJ&quot;)"></div><p id="a_urRxJ">Our cur­rent lexer rule for BASIC iden­ti­fiers allows alphanu­meric strings that start with a let­ter (and might also con­tain <span class="my-code" decode="exclude">$</span>). We’re not going to change that.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_ReSJS&quot;)"></div><p id="a_ReSJS">But Racket iden­ti­fiers and mod­ule names aren’t as restricted, and fre­quently con­tain other char­ac­ters—for instance, <span class="my-code" decode="exclude">?</span>, <span class="my-code" decode="exclude">=</span>, <span class="my-code" decode="exclude">-</span>, and <span class="my-code" decode="exclude">/</span>. So if we want to use the Racket names in our source code, we need a new lex­ing rule. To keep them dis­tinct from BASIC expres­sions, we’ll also require that these names appear between square brack­ets.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_KG9lU&quot;)"></div><p id="a_KG9lU">To help with this, we intro­duce a new lexer abbre­vi­a­tion, <span class="my-code" decode="exclude">racket-id-kapu</span>, which will denote the char­ac­ters not allowed in a Racket iden­ti­fier.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_xfyNu&quot;)"></div><p id="a_xfyNu">To derive this abbre­vi­a­tion, we look in the Racket doc­u­men­ta­tion to see <a href="http://docs.racket-lang.org/guide/symbols.html">which char­ac­ters are per­mit­ted</a> for sym­bols and iden­ti­fiers. It turns out that “any char­ac­ter can appear directly in an iden­ti­fier, except for white­space and the fol­low­ing spe­cial char­ac­ters: <span class="my-code" decode="exclude">()[]{}",'`;#|\</span>“. So we use <a href="http://docs.racket-lang.org/brag/index.html#(form._((lib._brag/support..rkt)._~3aor))" class="docs" hyphens="none">:or</a> to cre­ate a set of for­bid­den char­ac­ters, and assign this to <span class="my-code" decode="exclude">racket-id-kapu</span>.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_MVlFQ&quot;)"></div><div class="highlight-container" id="a_MVlFQ"><div id="code_50" form="false" decode="exclude" style="font-size:0;width:0;height:0">(define-lex-abbrev racket-id-kapu<br/>  (:or whitespace (char-set "()[]{}\",'`;#|\\")))</div><div class="highlight" form="false" id="a_1fPzh"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="source"><pre><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._define-lex-abbrev))" class="docs" hyphens="none">define-lex-abbrev</a></span> <span class="n">racket-id-kapu</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(form._((lib._brag/support..rkt)._~3aor))" class="docs" hyphens="none">:or</a></span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._whitespace))" class="docs" hyphens="none">whitespace</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._char-set))" class="docs" hyphens="none">char-set</a></span> <span class="s2">"()[]{}</span><span class="se">\"</span><span class="s2">,&#39;`;#|</span><span class="se">\\</span><span class="s2">"</span><span class="p">)))</span>
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpk7" data-clipboard-target="#code_50" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_yg2dt&quot;)"></div><p id="a_yg2dt">Then we use this abbre­vi­a­tion make the lexer pat­tern for our Racket iden­ti­fiers:</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_8EE0t&quot;)"></div><div class="highlight-container" id="a_8EE0t"><div id="code_51" form="false" decode="exclude" style="font-size:0;width:0;height:0">(:seq "[" (:+ (:~ racket-id-kapu)) "]")</div><div class="highlight" form="false" id="a_jOOWh"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="source"><pre><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(form._((lib._brag/support..rkt)._~3aseq))" class="docs" hyphens="none">:seq</a></span> <span class="s2">"["</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(form._((lib._brag/support..rkt)._~3a+))" class="docs" hyphens="none">:+</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(form._((lib._brag/support..rkt)._~3a~7e))" class="docs" hyphens="none">:~</a></span> <span class="n">racket-id-kapu</span><span class="p">))</span> <span class="s2">"]"</span><span class="p">)</span>
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpk8" data-clipboard-target="#code_51" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_fwRC1&quot;)"></div><p id="a_fwRC1">The lexer oper­a­tor <a href="http://docs.racket-lang.org/brag/index.html#(form._((lib._brag/support..rkt)._~3a~7e))" class="docs" hyphens="none">:~</a> means “any char­ac­ter but these”, so this pat­tern means “any sequence of char­ac­ters not in <span class="my-code" decode="exclude">racket-id-kapu</span>, between square brack­ets”.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_TM01M&quot;)"></div><p id="a_TM01M">On the right side of the rule, we trim the brack­ets from the matched <span class="my-code" decode="exclude">lexeme</span> using <a href="http://docs.racket-lang.org/brag/index.html#(def._((lib._brag/support..rkt)._trim-ends))" class="docs" hyphens="none">trim-ends</a> and con­vert it to a sym­bol before pack­ag­ing it as a new <span class="my-code" decode="exclude">RACKET-ID</span> token type.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_4gDmI&quot;)"></div><p id="a_4gDmI">In addi­tion to these changes, we also add our new <span class="my-code" decode="exclude">import</span> key­word to our list of <span class="my-code" decode="exclude">reserved-terms</span>. With these adjust­ments, our lexer looks like this:</p></div><div class="filebox" anchorize="false"><div class="filename" anchorize="false" decode="exclude">basic/lexer.rkt</div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_GUWE3&quot;)"></div><div class="highlight-container" id="a_GUWE3"><div id="code_52" form="false" decode="exclude" style="font-size:0;width:0;height:0">#lang br<br/>(require brag/support)<br/><br/>(define-lex-abbrev digits (:+ (char-set "0123456789")))<br/><br/>(define-lex-abbrev reserved-terms (:or "print" "goto" "end" "+"<br/>":" ";" "let" "=" "input" "-" "*" "/" "^" "mod" "(" ")" "def"<br/>"if" "then" "else" "&lt;" "&gt;" "&lt;&gt;" "and" "or" "not" "gosub"<br/>"return" "for" "to" "step" "next" "def" "," "import"))<br/><br/>(define-lex-abbrev racket-id-kapu<br/>  (:or whitespace (char-set "()[]{}\",'`;#|\\")))<br/><br/>(define basic-lexer<br/>  (lexer-srcloc<br/>   [(eof) (return-without-srcloc eof)]<br/>   ["\n" (token 'NEWLINE lexeme)]<br/>   [whitespace (token lexeme #:skip? #t)]<br/>   [(from/stop-before "rem" "\n") (token 'REM lexeme)]<br/>   [(:seq "[" (:+ (:~ racket-id-kapu)) "]")<br/>    (token 'RACKET-ID<br/>           (string-&gt;symbol (trim-ends "[" lexeme "]")))]<br/>   [reserved-terms (token lexeme lexeme)]<br/>   [(:seq alphabetic (:* (:or alphabetic numeric "$")))<br/>    (token 'ID (string-&gt;symbol lexeme))]<br/>   [digits (token 'INTEGER (string-&gt;number lexeme))]<br/>   [(:or (:seq (:? digits) "." digits)<br/>         (:seq digits "."))<br/>    (token 'DECIMAL (string-&gt;number lexeme))]<br/>   [(:or (from/to "\"" "\"") (from/to "'" "'"))<br/>    (token 'STRING<br/>           (substring lexeme<br/>                      1 (sub1 (string-length lexeme))))]))<br/><br/>(provide basic-lexer)</div><div class="highlight" form="false" id="a_l3LMc"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35</pre></div></td><td class="code"><div class="source"><pre><span class="kn">#lang </span><span class="nn">br</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._require))" class="docs" hyphens="none">require</a></span> <span class="n">brag/support</span><span class="p">)</span>

<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._define-lex-abbrev))" class="docs" hyphens="none">define-lex-abbrev</a></span> <span class="n">digits</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(form._((lib._brag/support..rkt)._~3a+))" class="docs" hyphens="none">:+</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._char-set))" class="docs" hyphens="none">char-set</a></span> <span class="s2">"0123456789"</span><span class="p">)))</span>

<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._define-lex-abbrev))" class="docs" hyphens="none">define-lex-abbrev</a></span> <span class="n">reserved-terms</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(form._((lib._brag/support..rkt)._~3aor))" class="docs" hyphens="none">:or</a></span> <span class="s2">"print"</span> <span class="s2">"goto"</span> <span class="s2">"end"</span> <span class="s2">"+"</span>
<span class="s2">":"</span> <span class="s2">";"</span> <span class="s2">"let"</span> <span class="s2">"="</span> <span class="s2">"input"</span> <span class="s2">"-"</span> <span class="s2">"*"</span> <span class="s2">"/"</span> <span class="s2">"^"</span> <span class="s2">"mod"</span> <span class="s2">"("</span> <span class="s2">")"</span> <span class="s2">"def"</span>
<span class="s2">"if"</span> <span class="s2">"then"</span> <span class="s2">"else"</span> <span class="s2">"&lt;"</span> <span class="s2">"&gt;"</span> <span class="s2">"&lt;&gt;"</span> <span class="s2">"and"</span> <span class="s2">"or"</span> <span class="s2">"not"</span> <span class="s2">"gosub"</span>
<span class="hll"><span class="s2">"return"</span> <span class="s2">"for"</span> <span class="s2">"to"</span> <span class="s2">"step"</span> <span class="s2">"next"</span> <span class="s2">"def"</span> <span class="s2">","</span> <span class="s2">"import"</span><span class="p">))</span>
</span>
<span class="hll"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._define-lex-abbrev))" class="docs" hyphens="none">define-lex-abbrev</a></span> <span class="n">racket-id-kapu</span>
</span><span class="hll">  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(form._((lib._brag/support..rkt)._~3aor))" class="docs" hyphens="none">:or</a></span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._whitespace))" class="docs" hyphens="none">whitespace</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._char-set))" class="docs" hyphens="none">char-set</a></span> <span class="s2">"()[]{}</span><span class="se">\"</span><span class="s2">,&#39;`;#|</span><span class="se">\\</span><span class="s2">"</span><span class="p">)))</span>
</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="n">basic-lexer</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._lexer-srcloc))" class="docs" hyphens="none">lexer-srcloc</a></span>
   <span class="p">[(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/port-ops.html#(def._((quote._~23~25kernel)._eof))" class="docs" hyphens="none">eof</a></span><span class="p">)</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._return-without-srcloc))" class="docs" hyphens="none">return-without-srcloc</a></span> <span class="nb"><a href="http://docs.racket-lang.org/reference/port-ops.html#(def._((quote._~23~25kernel)._eof))" class="docs" hyphens="none">eof</a></span><span class="p">)]</span>
   <span class="p">[</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(def._((lib._brag/support..rkt)._token))" class="docs" hyphens="none">token</a></span> <span class="o">&#39;</span><span class="ss">NEWLINE</span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._lexeme))" class="docs" hyphens="none">lexeme</a></span><span class="p">)]</span>
   <span class="p">[</span><span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._whitespace))" class="docs" hyphens="none">whitespace</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(def._((lib._brag/support..rkt)._token))" class="docs" hyphens="none">token</a></span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._lexeme))" class="docs" hyphens="none">lexeme</a></span> <span class="kd">#:skip?</span> <span class="no">#t</span><span class="p">)]</span>
   <span class="p">[(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(form._((lib._brag/support..rkt)._from/stop-before))" class="docs" hyphens="none">from/stop-before</a></span> <span class="s2">"rem"</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(def._((lib._brag/support..rkt)._token))" class="docs" hyphens="none">token</a></span> <span class="o">&#39;</span><span class="ss">REM</span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._lexeme))" class="docs" hyphens="none">lexeme</a></span><span class="p">)]</span>
<span class="hll">   <span class="p">[(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(form._((lib._brag/support..rkt)._~3aseq))" class="docs" hyphens="none">:seq</a></span> <span class="s2">"["</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(form._((lib._brag/support..rkt)._~3a+))" class="docs" hyphens="none">:+</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(form._((lib._brag/support..rkt)._~3a~7e))" class="docs" hyphens="none">:~</a></span> <span class="n">racket-id-kapu</span><span class="p">))</span> <span class="s2">"]"</span><span class="p">)</span>
</span><span class="hll">    <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(def._((lib._brag/support..rkt)._token))" class="docs" hyphens="none">token</a></span> <span class="o">&#39;</span><span class="ss">RACKET-ID</span>
</span><span class="hll">           <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/symbols.html#(def._((quote._~23~25kernel)._string-~3esymbol))" class="docs" hyphens="none">string-&gt;symbol</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(def._((lib._brag/support..rkt)._trim-ends))" class="docs" hyphens="none">trim-ends</a></span> <span class="s2">"["</span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._lexeme))" class="docs" hyphens="none">lexeme</a></span> <span class="s2">"]"</span><span class="p">)))]</span>
</span>   <span class="p">[</span><span class="n">reserved-terms</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(def._((lib._brag/support..rkt)._token))" class="docs" hyphens="none">token</a></span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._lexeme))" class="docs" hyphens="none">lexeme</a></span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._lexeme))" class="docs" hyphens="none">lexeme</a></span><span class="p">)]</span>
   <span class="p">[(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(form._((lib._brag/support..rkt)._~3aseq))" class="docs" hyphens="none">:seq</a></span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._alphabetic))" class="docs" hyphens="none">alphabetic</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(form._((lib._brag/support..rkt)._~3a*))" class="docs" hyphens="none">:*</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(form._((lib._brag/support..rkt)._~3aor))" class="docs" hyphens="none">:or</a></span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._alphabetic))" class="docs" hyphens="none">alphabetic</a></span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._numeric))" class="docs" hyphens="none">numeric</a></span> <span class="s2">"$"</span><span class="p">)))</span>
    <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(def._((lib._brag/support..rkt)._token))" class="docs" hyphens="none">token</a></span> <span class="o">&#39;</span><span class="ss">ID</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/symbols.html#(def._((quote._~23~25kernel)._string-~3esymbol))" class="docs" hyphens="none">string-&gt;symbol</a></span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._lexeme))" class="docs" hyphens="none">lexeme</a></span><span class="p">))]</span>
   <span class="p">[</span><span class="n">digits</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(def._((lib._brag/support..rkt)._token))" class="docs" hyphens="none">token</a></span> <span class="o">&#39;</span><span class="ss">INTEGER</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._string-~3enumber))" class="docs" hyphens="none">string-&gt;number</a></span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._lexeme))" class="docs" hyphens="none">lexeme</a></span><span class="p">))]</span>
   <span class="p">[(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(form._((lib._brag/support..rkt)._~3aor))" class="docs" hyphens="none">:or</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(form._((lib._brag/support..rkt)._~3aseq))" class="docs" hyphens="none">:seq</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(form._((lib._brag/support..rkt)._~3a~3f))" class="docs" hyphens="none">:?</a></span> <span class="n">digits</span><span class="p">)</span> <span class="s2">"."</span> <span class="n">digits</span><span class="p">)</span>
         <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(form._((lib._brag/support..rkt)._~3aseq))" class="docs" hyphens="none">:seq</a></span> <span class="n">digits</span> <span class="s2">"."</span><span class="p">))</span>
    <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(def._((lib._brag/support..rkt)._token))" class="docs" hyphens="none">token</a></span> <span class="o">&#39;</span><span class="ss">DECIMAL</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._string-~3enumber))" class="docs" hyphens="none">string-&gt;number</a></span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._lexeme))" class="docs" hyphens="none">lexeme</a></span><span class="p">))]</span>
   <span class="p">[(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(form._((lib._brag/support..rkt)._~3aor))" class="docs" hyphens="none">:or</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(form._((lib._brag/support..rkt)._from/to))" class="docs" hyphens="none">from/to</a></span> <span class="s2">"</span><span class="se">\"</span><span class="s2">"</span> <span class="s2">"</span><span class="se">\"</span><span class="s2">"</span><span class="p">)</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(form._((lib._brag/support..rkt)._from/to))" class="docs" hyphens="none">from/to</a></span> <span class="s2">"&#39;"</span> <span class="s2">"&#39;"</span><span class="p">))</span>
    <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(def._((lib._brag/support..rkt)._token))" class="docs" hyphens="none">token</a></span> <span class="o">&#39;</span><span class="ss">STRING</span>
           <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/strings.html#(def._((quote._~23~25kernel)._substring))" class="docs" hyphens="none">substring</a></span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._lexeme))" class="docs" hyphens="none">lexeme</a></span>
                      <span class="mi">1</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._sub1))" class="docs" hyphens="none">sub1</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/strings.html#(def._((quote._~23~25kernel)._string-length))" class="docs" hyphens="none">string-length</a></span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._lexeme))" class="docs" hyphens="none">lexeme</a></span><span class="p">))))]))</span>

<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._provide))" class="docs" hyphens="none">provide</a></span> <span class="n">basic-lexer</span><span class="p">)</span>
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpk9" data-clipboard-target="#code_52" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;parser-updates&quot;)"></div><h3 anchor="parser-updates" class="subhead" id="parser-updates"><a href="#parser-updates">Parser updates</a></h3></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_6IeYF&quot;)"></div><p id="a_6IeYF">Our parser updates are sim­pler. We add a new <span class="my-code" decode="exclude">b-import</span> rule to han­dle the <span class="my-code" decode="exclude">import</span> state­ment, and add <span class="my-code" decode="exclude">b-import</span> to the right side of the <span class="my-code" decode="exclude">b-statement</span> rule.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_6aaRL&quot;)"></div><p id="a_6aaRL">We also mark the <span class="my-code" decode="exclude">import</span> state­ment argu­ment with a spliced <span class="my-code" decode="exclude">b-import-name</span> rule. In the parse tree, this will be attached to the argu­ment as a <a class="glossary" href="../appendix/glossary.html#syntax-property"><span class="glossary-link-text">syn­tax prop­erty</span></a>:</p></div><div class="filebox" anchorize="false"><div class="filename" anchorize="false" decode="exclude">basic/parser.rkt</div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_ceCBc&quot;)"></div><div class="highlight-container" id="a_ceCBc"><div id="code_53" form="false" decode="exclude" style="font-size:0;width:0;height:0">#lang brag<br/>b-program : [b-line] (/NEWLINE [b-line])*<br/>b-line : b-line-num [b-statement] (/":" [b-statement])* [b-rem]<br/>@b-line-num : INTEGER<br/>b-rem : REM<br/>@b-statement : b-end | b-print | b-goto<br/>             | b-let | b-input | b-if<br/>             | b-gosub | b-return | b-for | b-next<br/>             | b-def | b-import<br/>b-end : /"end"<br/>b-print : /"print" [b-printable] (/";" [b-printable])*<br/>@b-printable : STRING | b-expr<br/>b-goto : /"goto" b-expr<br/>b-let : [/"let"] b-id /"=" (STRING | b-expr)<br/>b-if : /"if" b-expr /"then" (b-statement | b-expr)<br/>                   [/"else" (b-statement | b-expr)]<br/>b-input : /"input" b-id<br/>@b-id : ID<br/>b-gosub : /"gosub" b-expr<br/>b-return : /"return"<br/>b-for : /"for" b-id /"=" b-expr /"to" b-expr [/"step" b-expr]<br/>b-next : /"next" b-id<br/>b-def : /"def" b-id /"(" b-id [/"," b-id]* /")" /"=" b-expr<br/>b-import : /"import" b-import-name<br/>@b-import-name : RACKET-ID | STRING<br/>b-expr : b-or-expr<br/>b-or-expr : [b-or-expr "or"] b-and-expr<br/>b-and-expr : [b-and-expr "and"] b-not-expr<br/>b-not-expr : ["not"] b-comp-expr<br/>b-comp-expr : [b-comp-expr ("="|"&lt;"|"&gt;"|"&lt;&gt;")] b-sum<br/>b-sum : [b-sum ("+"|"-")] b-product<br/>b-product : [b-product ("*"|"/"|"mod")] b-neg<br/>b-neg : ["-"] b-expt<br/>b-expt : [b-expt ("^")] b-value<br/>@b-value : b-number | b-id | /"(" b-expr /")" | b-func<br/>b-func : ID /"(" b-expr [/"," b-expr]* /")"<br/>@b-number : INTEGER | DECIMAL</div><div class="highlight" form="false" id="a_rfDT5"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37</pre></div></td><td class="code"><div class="source"><pre>#lang brag
b-program : [b-line] (/NEWLINE [b-line])*
b-line : b-line-num [b-statement] (/":" [b-statement])* [b-rem]
@b-line-num : INTEGER
b-rem : REM
@b-statement : b-end | b-print | b-goto
             | b-let | b-input | b-if
             | b-gosub | b-return | b-for | b-next
<span class="hll">             | b-def | b-import
</span>b-end : /"end"
b-print : /"print" [b-printable] (/";" [b-printable])*
@b-printable : STRING | b-expr
b-goto : /"goto" b-expr
b-let : [/"let"] b-id /"=" (STRING | b-expr)
b-if : /"if" b-expr /"then" (b-statement | b-expr)
                   [/"else" (b-statement | b-expr)]
b-input : /"input" b-id
@b-id : ID
b-gosub : /"gosub" b-expr
b-return : /"return"
b-for : /"for" b-id /"=" b-expr /"to" b-expr [/"step" b-expr]
b-next : /"next" b-id
b-def : /"def" b-id /"(" b-id [/"," b-id]* /")" /"=" b-expr
<span class="hll">b-import : /"import" b-import-name
</span><span class="hll">@b-import-name : RACKET-ID | STRING
</span>b-expr : b-or-expr
b-or-expr : [b-or-expr "or"] b-and-expr
b-and-expr : [b-and-expr "and"] b-not-expr
b-not-expr : ["not"] b-comp-expr
b-comp-expr : [b-comp-expr ("="|"&lt;"|"&gt;"|"&lt;&gt;")] b-sum
b-sum : [b-sum ("+"|"-")] b-product
b-product : [b-product ("*"|"/"|"mod")] b-neg
b-neg : ["-"] b-expt
b-expt : [b-expt ("^")] b-value
@b-value : b-number | b-id | /"(" b-expr /")" | b-func
b-func : ID /"(" b-expr [/"," b-expr]* /")"
@b-number : INTEGER | DECIMAL
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpka" data-clipboard-target="#code_53" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_2P8pO&quot;)"></div><p id="a_2P8pO">The pat­tern for our <span class="my-code" decode="exclude">b-import-name</span> allows either a <span class="my-code" decode="exclude">RACKET-ID</span> or a <span class="my-code" decode="exclude">STRING</span>, because imported mod­ules can be spec­i­fied with either an iden­ti­fier (e.g., <span class="my-code" decode="exclude">math/number-theory</span>) or a path name (e.g., <span class="my-code" decode="exclude">"number-theory.rkt"</span>).</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;expander-updates&quot;)"></div><h3 anchor="expander-updates" class="subhead" id="expander-updates"><a href="#expander-updates">Expander updates</a></h3></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_3c8af&quot;)"></div><p id="a_3c8af">First, we need to update <span class="my-code" decode="exclude">"expander.rkt"</span>:</p></div><div class="filebox" anchorize="false"><div class="filename" anchorize="false" decode="exclude">basic/expander.rkt</div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_9YzOG&quot;)"></div><div class="highlight-container" id="a_9YzOG"><div id="code_54" form="false" decode="exclude" style="font-size:0;width:0;height:0">#lang br/quicklang<br/>(require "struct.rkt" "run.rkt" "elements.rkt")<br/>(provide (rename-out [b-module-begin #%module-begin])<br/>         (all-from-out "elements.rkt"))<br/><br/>(define-macro (b-module-begin (b-program LINE ...))<br/>  (with-pattern<br/>      ([((b-line NUM STMT ...) ...) #'(LINE ...)]<br/>       [(LINE-FUNC ...) (prefix-id "line-" #'(NUM ...))]<br/>       [(VAR-ID ...) (find-property 'b-id #'(LINE ...))]<br/>       [(IMPORT-NAME ...)<br/>        (find-property 'b-import-name #'(LINE ...))])<br/>    #'(#%module-begin<br/>       (require IMPORT-NAME ...)<br/>       (define VAR-ID 0) ...<br/>       LINE ...<br/>       (define line-table<br/>         (apply hasheqv (append (list NUM LINE-FUNC) ...)))<br/>       (void (run line-table)))))<br/><br/>(begin-for-syntax<br/>  (require racket/list)<br/>  (define (find-property which line-stxs)<br/>    (remove-duplicates<br/>     (for/list ([stx (in-list (stx-flatten line-stxs))]<br/>                #:when (syntax-property stx which))<br/>               stx)<br/>     #:key syntax-&gt;datum)))</div><div class="highlight" form="false" id="a_UUagF"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28</pre></div></td><td class="code"><div class="source"><pre><span class="kn">#lang </span><span class="nn">br/quicklang</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._require))" class="docs" hyphens="none">require</a></span> <span class="s2">"struct.rkt"</span> <span class="s2">"run.rkt"</span> <span class="s2">"elements.rkt"</span><span class="p">)</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._provide))" class="docs" hyphens="none">provide</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._rename-out))" class="docs" hyphens="none">rename-out</a></span> <span class="p">[</span><span class="n">b-module-begin</span> <span class="nb"><a href="http://docs.racket-lang.org/reference/module.html#(form._((lib._racket/private/base..rkt)._~23~25module-begin))" class="docs" hyphens="none">#%module-begin</a></span><span class="p">])</span>
         <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._all-from-out))" class="docs" hyphens="none">all-from-out</a></span> <span class="s2">"elements.rkt"</span><span class="p">))</span>

<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br/index.html#(form._((lib._br/define..rkt)._define-macro))" class="docs" hyphens="none">define-macro</a></span> <span class="p">(</span><span class="n">b-module-begin</span> <span class="p">(</span><span class="n">b-program</span> <span class="n">LINE</span> <span class="nb"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))" class="docs" hyphens="none">...</a></span><span class="p">))</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br/index.html#(form._((lib._br/syntax..rkt)._with-pattern))" class="docs" hyphens="none">with-pattern</a></span>
      <span class="p">([((</span><span class="n">b-line</span> <span class="n">NUM</span> <span class="n">STMT</span> <span class="nb"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))" class="docs" hyphens="none">...</a></span><span class="p">)</span> <span class="nb"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))" class="docs" hyphens="none">...</a></span><span class="p">)</span> <span class="o">#&#39;</span><span class="p">(</span><span class="n">LINE</span> <span class="nb"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))" class="docs" hyphens="none">...</a></span><span class="p">)]</span>
       <span class="p">[(</span><span class="n">LINE-FUNC</span> <span class="nb"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))" class="docs" hyphens="none">...</a></span><span class="p">)</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br/index.html#(def._((lib._br/syntax..rkt)._prefix-id))" class="docs" hyphens="none">prefix-id</a></span> <span class="s2">"line-"</span> <span class="o">#&#39;</span><span class="p">(</span><span class="n">NUM</span> <span class="nb"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))" class="docs" hyphens="none">...</a></span><span class="p">))]</span>
<span class="hll">       <span class="p">[(</span><span class="n">VAR-ID</span> <span class="nb"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))" class="docs" hyphens="none">...</a></span><span class="p">)</span> <span class="p">(</span><span class="n">find-property</span> <span class="o">&#39;</span><span class="ss">b-id</span> <span class="o">#&#39;</span><span class="p">(</span><span class="n">LINE</span> <span class="nb"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))" class="docs" hyphens="none">...</a></span><span class="p">))]</span>
</span><span class="hll">       <span class="p">[(</span><span class="n">IMPORT-NAME</span> <span class="nb"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))" class="docs" hyphens="none">...</a></span><span class="p">)</span>
</span><span class="hll">        <span class="p">(</span><span class="n">find-property</span> <span class="o">&#39;</span><span class="ss">b-import-name</span> <span class="o">#&#39;</span><span class="p">(</span><span class="n">LINE</span> <span class="nb"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))" class="docs" hyphens="none">...</a></span><span class="p">))])</span>
</span>    <span class="o">#&#39;</span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/module.html#(form._((lib._racket/private/base..rkt)._~23~25module-begin))" class="docs" hyphens="none">#%module-begin</a></span>
<span class="hll">       <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._require))" class="docs" hyphens="none">require</a></span> <span class="n">IMPORT-NAME</span> <span class="nb"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))" class="docs" hyphens="none">...</a></span><span class="p">)</span>
</span>       <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="n">VAR-ID</span> <span class="mi">0</span><span class="p">)</span> <span class="nb"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))" class="docs" hyphens="none">...</a></span>
       <span class="n">LINE</span> <span class="nb"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))" class="docs" hyphens="none">...</a></span>
       <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="n">line-table</span>
         <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/procedures.html#(def._((lib._racket/private/base..rkt)._apply))" class="docs" hyphens="none">apply</a></span> <span class="nb"><a href="http://docs.racket-lang.org/reference/hashtables.html#(def._((quote._~23~25kernel)._hasheqv))" class="docs" hyphens="none">hasheqv</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._append))" class="docs" hyphens="none">append</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._list))" class="docs" hyphens="none">list</a></span> <span class="n">NUM</span> <span class="n">LINE-FUNC</span><span class="p">)</span> <span class="nb"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))" class="docs" hyphens="none">...</a></span><span class="p">)))</span>
       <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/void.html#(def._((quote._~23~25kernel)._void))" class="docs" hyphens="none">void</a></span> <span class="p">(</span><span class="n">run</span> <span class="n">line-table</span><span class="p">)))))</span>

<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/begin.html#(form._((quote._~23~25kernel)._begin-for-syntax))" class="docs" hyphens="none">begin-for-syntax</a></span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._require))" class="docs" hyphens="none">require</a></span> <span class="n">racket/list</span><span class="p">)</span>
<span class="hll">  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="p">(</span><span class="n">find-property</span> <span class="n">which</span> <span class="n">line-stxs</span><span class="p">)</span>
</span><span class="hll">    <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((lib._racket/list..rkt)._remove-duplicates))" class="docs" hyphens="none">remove-duplicates</a></span>
</span><span class="hll">     <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/for.html#(form._((lib._racket/private/base..rkt)._for/list))" class="docs" hyphens="none">for/list</a></span> <span class="p">([</span><span class="n">stx</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/sequences.html#(def._((lib._racket/private/base..rkt)._in-list))" class="docs" hyphens="none">in-list</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br/index.html#(def._((lib._br/syntax..rkt)._stx-flatten))" class="docs" hyphens="none">stx-flatten</a></span> <span class="n">line-stxs</span><span class="p">))]</span>
</span><span class="hll">                <span class="kd">#:when</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/stxprops.html#(def._((quote._~23~25kernel)._syntax-property))" class="docs" hyphens="none">syntax-property</a></span> <span class="n">stx</span> <span class="n">which</span><span class="p">))</span>
</span><span class="hll">               <span class="n">stx</span><span class="p">)</span>
</span><span class="hll">     <span class="kd">#:key</span> <span class="nb"><a href="http://docs.racket-lang.org/reference/stxops.html#(def._((quote._~23~25kernel)._syntax-~3edatum))" class="docs" hyphens="none">syntax-&gt;datum</a></span><span class="p">)))</span>
</span></pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpkb" data-clipboard-target="#code_54" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_5p23v&quot;)"></div><p id="a_5p23v">As promised at the out­set, we extract our <span class="my-code" decode="exclude">IMPORT-NAME</span> argu­ments by search­ing through the parse tree for unique ele­ments car­ry­ing the <span class="my-code" decode="exclude">'b-import-name</span> syn­tax prop­erty.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_uTC7j&quot;)"></div><p id="a_uTC7j">To do this, we first update our <span class="my-code" decode="exclude">find-property</span> helper func­tion to take an argu­ment that deter­mines <span class="my-code" decode="exclude">which</span> prop­erty to find. We then update our calls to this func­tion, pass­ing it the prop­erty to find and a list of <span class="my-code" decode="exclude">#'(LINE ...)</span> syn­tax objects.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_9Ci3i&quot;)"></div><p id="a_9Ci3i">Hav­ing located the <span class="my-code" decode="exclude">IMPORT-NAME</span> objects, all we need to do is put them into a <span class="my-code" decode="exclude">require</span> at the top of the mod­ule.</p></div><div anchorize="false" style="height:1em"></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_ZSDQT&quot;)"></div><p id="a_ZSDQT">Once we have Racket func­tions avail­able, we also need to smooth the dif­fer­ences between Racket val­ues and BASIC val­ues. So let’s also update our <span class="my-code" decode="exclude">b-func</span> macro in <span class="my-code" decode="exclude">"expr.rkt"</span>:</p></div><div class="filebox" anchorize="false"><div class="filename" anchorize="false" decode="exclude">basic/expr.rkt</div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_sbVNI&quot;)"></div><div class="highlight-container" id="a_sbVNI"><div id="code_55" form="false" decode="exclude" style="font-size:0;width:0;height:0">#lang br<br/>(require "line.rkt")<br/>(provide b-expr b-sum b-product b-neg b-expt b-def b-func)<br/><br/>(define (b-expr expr)<br/>  (if (integer? expr) (inexact-&gt;exact expr) expr))<br/><br/>(define-macro-cases b-sum<br/>  [(_ VAL) #'VAL]<br/>  [(_ LEFT "+" RIGHT) #'(+ LEFT RIGHT)]<br/>  [(_ LEFT "-" RIGHT) #'(- LEFT RIGHT)])<br/><br/>(define-macro-cases b-product<br/>  [(_ VAL) #'VAL]<br/>  [(_ LEFT "*" RIGHT) #'(* LEFT RIGHT)]<br/>  [(_ LEFT "/" RIGHT) #'(/ LEFT RIGHT 1.0)]<br/>  [(_ LEFT "mod" RIGHT) #'(modulo LEFT RIGHT)])<br/><br/>(define-macro-cases b-neg<br/>  [(_ VAL) #'VAL]<br/>  [(_ "-" VAL) #'(- VAL)])<br/><br/>(define-macro-cases b-expt<br/>  [(_ VAL) #'VAL]<br/>  [(_ LEFT "^" RIGHT) #'(expt LEFT RIGHT)])<br/><br/>(define-macro (b-def FUNC-ID VAR-ID ... EXPR)<br/>  (syntax-local-lift-expression<br/>   #'(set! FUNC-ID (λ (VAR-ID ...) EXPR))))<br/><br/>(define-macro (b-func FUNC-ID ARG ...)<br/>  #'(if (procedure? FUNC-ID)<br/>        (convert-result (FUNC-ID ARG ...))<br/>        (raise-line-error<br/>         (format "expected ~a to be a function, got ~v"<br/>                 'FUNC-ID FUNC-ID))))<br/><br/>(define (convert-result result)<br/>  (cond<br/>    [(number? result) (b-expr result)]<br/>    [(string? result) result]<br/>    [(boolean? result) (if result 1 0)]<br/>    [else<br/>     (raise-line-error<br/>      (format "unknown data type: ~v" result))]))</div><div class="highlight" form="false" id="a_UwVEj"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45</pre></div></td><td class="code"><div class="source"><pre><span class="kn">#lang </span><span class="nn">br</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._require))" class="docs" hyphens="none">require</a></span> <span class="s2">"line.rkt"</span><span class="p">)</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._provide))" class="docs" hyphens="none">provide</a></span> <span class="n">b-expr</span> <span class="n">b-sum</span> <span class="n">b-product</span> <span class="n">b-neg</span> <span class="n">b-expt</span> <span class="n">b-def</span> <span class="n">b-func</span><span class="p">)</span>

<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="p">(</span><span class="n">b-expr</span> <span class="n">expr</span><span class="p">)</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/if.html#(form._((quote._~23~25kernel)._if))" class="docs" hyphens="none">if</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/number-types.html#(def._((quote._~23~25kernel)._integer~3f))" class="docs" hyphens="none">integer?</a></span> <span class="n">expr</span><span class="p">)</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/number-types.html#(def._((quote._~23~25kernel)._inexact-~3eexact))" class="docs" hyphens="none">inexact-&gt;exact</a></span> <span class="n">expr</span><span class="p">)</span> <span class="n">expr</span><span class="p">))</span>

<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br/index.html#(form._((lib._br/define..rkt)._define-macro-cases))" class="docs" hyphens="none">define-macro-cases</a></span> <span class="n">b-sum</span>
  <span class="p">[(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt).__))" class="docs" hyphens="none">_</a></span> <span class="n">VAL</span><span class="p">)</span> <span class="o">#&#39;</span><span class="n">VAL</span><span class="p">]</span>
  <span class="p">[(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt).__))" class="docs" hyphens="none">_</a></span> <span class="n">LEFT</span> <span class="s2">"+"</span> <span class="n">RIGHT</span><span class="p">)</span> <span class="o">#&#39;</span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._+))" class="docs" hyphens="none">+</a></span> <span class="n">LEFT</span> <span class="n">RIGHT</span><span class="p">)]</span>
  <span class="p">[(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt).__))" class="docs" hyphens="none">_</a></span> <span class="n">LEFT</span> <span class="s2">"-"</span> <span class="n">RIGHT</span><span class="p">)</span> <span class="o">#&#39;</span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._-))" class="docs" hyphens="none">-</a></span> <span class="n">LEFT</span> <span class="n">RIGHT</span><span class="p">)])</span>

<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br/index.html#(form._((lib._br/define..rkt)._define-macro-cases))" class="docs" hyphens="none">define-macro-cases</a></span> <span class="n">b-product</span>
  <span class="p">[(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt).__))" class="docs" hyphens="none">_</a></span> <span class="n">VAL</span><span class="p">)</span> <span class="o">#&#39;</span><span class="n">VAL</span><span class="p">]</span>
  <span class="p">[(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt).__))" class="docs" hyphens="none">_</a></span> <span class="n">LEFT</span> <span class="s2">"*"</span> <span class="n">RIGHT</span><span class="p">)</span> <span class="o">#&#39;</span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._*))" class="docs" hyphens="none">*</a></span> <span class="n">LEFT</span> <span class="n">RIGHT</span><span class="p">)]</span>
  <span class="p">[(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt).__))" class="docs" hyphens="none">_</a></span> <span class="n">LEFT</span> <span class="s2">"/"</span> <span class="n">RIGHT</span><span class="p">)</span> <span class="o">#&#39;</span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._/))" class="docs" hyphens="none">/</a></span> <span class="n">LEFT</span> <span class="n">RIGHT</span> <span class="mf">1.0</span><span class="p">)]</span>
  <span class="p">[(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt).__))" class="docs" hyphens="none">_</a></span> <span class="n">LEFT</span> <span class="s2">"mod"</span> <span class="n">RIGHT</span><span class="p">)</span> <span class="o">#&#39;</span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._modulo))" class="docs" hyphens="none">modulo</a></span> <span class="n">LEFT</span> <span class="n">RIGHT</span><span class="p">)])</span>

<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br/index.html#(form._((lib._br/define..rkt)._define-macro-cases))" class="docs" hyphens="none">define-macro-cases</a></span> <span class="n">b-neg</span>
  <span class="p">[(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt).__))" class="docs" hyphens="none">_</a></span> <span class="n">VAL</span><span class="p">)</span> <span class="o">#&#39;</span><span class="n">VAL</span><span class="p">]</span>
  <span class="p">[(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt).__))" class="docs" hyphens="none">_</a></span> <span class="s2">"-"</span> <span class="n">VAL</span><span class="p">)</span> <span class="o">#&#39;</span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._-))" class="docs" hyphens="none">-</a></span> <span class="n">VAL</span><span class="p">)])</span>

<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br/index.html#(form._((lib._br/define..rkt)._define-macro-cases))" class="docs" hyphens="none">define-macro-cases</a></span> <span class="n">b-expt</span>
  <span class="p">[(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt).__))" class="docs" hyphens="none">_</a></span> <span class="n">VAL</span><span class="p">)</span> <span class="o">#&#39;</span><span class="n">VAL</span><span class="p">]</span>
  <span class="p">[(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt).__))" class="docs" hyphens="none">_</a></span> <span class="n">LEFT</span> <span class="s2">"^"</span> <span class="n">RIGHT</span><span class="p">)</span> <span class="o">#&#39;</span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._expt))" class="docs" hyphens="none">expt</a></span> <span class="n">LEFT</span> <span class="n">RIGHT</span><span class="p">)])</span>

<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br/index.html#(form._((lib._br/define..rkt)._define-macro))" class="docs" hyphens="none">define-macro</a></span> <span class="p">(</span><span class="n">b-def</span> <span class="n">FUNC-ID</span> <span class="n">VAR-ID</span> <span class="nb"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))" class="docs" hyphens="none">...</a></span> <span class="n">EXPR</span><span class="p">)</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/stxtrans.html#(def._((quote._~23~25kernel)._syntax-local-lift-expression))" class="docs" hyphens="none">syntax-local-lift-expression</a></span>
   <span class="o">#&#39;</span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/set_.html#(form._((quote._~23~25kernel)._set!))" class="docs" hyphens="none">set!</a></span> <span class="n">FUNC-ID</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))" class="docs" hyphens="none">λ</a></span> <span class="p">(</span><span class="n">VAR-ID</span> <span class="nb"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))" class="docs" hyphens="none">...</a></span><span class="p">)</span> <span class="n">EXPR</span><span class="p">))))</span>

<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br/index.html#(form._((lib._br/define..rkt)._define-macro))" class="docs" hyphens="none">define-macro</a></span> <span class="p">(</span><span class="n">b-func</span> <span class="n">FUNC-ID</span> <span class="n">ARG</span> <span class="nb"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))" class="docs" hyphens="none">...</a></span><span class="p">)</span>
  <span class="o">#&#39;</span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/if.html#(form._((quote._~23~25kernel)._if))" class="docs" hyphens="none">if</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/procedures.html#(def._((quote._~23~25kernel)._procedure~3f))" class="docs" hyphens="none">procedure?</a></span> <span class="n">FUNC-ID</span><span class="p">)</span>
<span class="hll">        <span class="p">(</span><span class="n">convert-result</span> <span class="p">(</span><span class="n">FUNC-ID</span> <span class="n">ARG</span> <span class="nb"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))" class="docs" hyphens="none">...</a></span><span class="p">))</span>
</span>        <span class="p">(</span><span class="n">raise-line-error</span>
         <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/Writing.html#(def._((quote._~23~25kernel)._format))" class="docs" hyphens="none">format</a></span> <span class="s2">"expected ~a to be a function, got ~v"</span>
                 <span class="o">&#39;</span><span class="ss">FUNC-ID</span> <span class="n">FUNC-ID</span><span class="p">))))</span>

<span class="hll"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="p">(</span><span class="n">convert-result</span> <span class="n">result</span><span class="p">)</span>
</span><span class="hll">  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/if.html#(form._((lib._racket/private/letstx-scheme..rkt)._cond))" class="docs" hyphens="none">cond</a></span>
</span><span class="hll">    <span class="p">[(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/number-types.html#(def._((quote._~23~25kernel)._number~3f))" class="docs" hyphens="none">number?</a></span> <span class="n">result</span><span class="p">)</span> <span class="p">(</span><span class="n">b-expr</span> <span class="n">result</span><span class="p">)]</span>
</span><span class="hll">    <span class="p">[(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/strings.html#(def._((quote._~23~25kernel)._string~3f))" class="docs" hyphens="none">string?</a></span> <span class="n">result</span><span class="p">)</span> <span class="n">result</span><span class="p">]</span>
</span><span class="hll">    <span class="p">[(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/booleans.html#(def._((quote._~23~25kernel)._boolean~3f))" class="docs" hyphens="none">boolean?</a></span> <span class="n">result</span><span class="p">)</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/if.html#(form._((quote._~23~25kernel)._if))" class="docs" hyphens="none">if</a></span> <span class="n">result</span> <span class="mi">1</span> <span class="mi">0</span><span class="p">)]</span>
</span><span class="hll">    <span class="p">[</span><span class="nb"><a href="http://docs.racket-lang.org/reference/if.html#(form._((lib._racket/private/letstx-scheme..rkt)._else))" class="docs" hyphens="none">else</a></span>
</span><span class="hll">     <span class="p">(</span><span class="n">raise-line-error</span>
</span><span class="hll">      <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/Writing.html#(def._((quote._~23~25kernel)._format))" class="docs" hyphens="none">format</a></span> <span class="s2">"unknown data type: ~v"</span> <span class="n">result</span><span class="p">))]))</span>
</span></pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpkc" data-clipboard-target="#code_55" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_XsRMr&quot;)"></div><p id="a_XsRMr">Here, we test the <span class="my-code" decode="exclude">result</span> of the func­tion expres­sion by pass­ing it to the helper func­tion <span class="my-code" decode="exclude">convert-result</span>. If it’s a num­ber, we hand it off to <span class="my-code" decode="exclude">b-expr</span>. If it’s a string, we pass it through. If it’s a Boolean, we con­vert it to an inte­ger. Oth­er­wise, we raise an error. <span class="tooltip" onclick="this.classList.toggle('tooltip_visible')"> + <span class="tooltip-inner">We could’ve put the <span class="my-code" decode="exclude">convert-result</span> code inside the macro. But it’s good prac­tice to make the out­put of a macro as small as pos­si­ble. See <a class="explainer" href="../explainer/macros.html">macros</a>.</span></span></p></div><div anchorize="false" style="height:1em"></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_HerfW&quot;)"></div><p id="a_HerfW">Finally, though we’ve hoisted our actual imports into <span class="my-code" decode="exclude">require</span> forms at the top level of the mod­ule, we still need to do some­thing with the <span class="my-code" decode="exclude">b-import</span> nodes that remain in the parse tree. So we just add a macro to <span class="my-code" decode="exclude">"misc.rkt"</span> that con­verts these nodes into <span class="my-code" decode="exclude">(void)</span>:</p></div><div class="filebox" anchorize="false"><div class="filename" anchorize="false" decode="exclude">basic/misc.rkt</div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_2nJqM&quot;)"></div><div class="highlight-container" id="a_2nJqM"><div id="code_56" form="false" decode="exclude" style="font-size:0;width:0;height:0">#lang br<br/>(require "struct.rkt" "expr.rkt")<br/>(provide b-rem b-print b-let b-input b-import)<br/><br/>(define (b-rem val) (void))<br/><br/>(define (b-print . vals)<br/>  (displayln (string-append* (map ~a vals))))<br/><br/>(define-macro (b-let ID VAL) #'(set! ID VAL))<br/><br/>(define-macro (b-input ID)<br/>  #'(b-let ID (let* ([str (read-line)]<br/>                     [num (string-&gt;number (string-trim str))])<br/>                (or num str))))<br/><br/>(define-macro (b-import NAME) #'(void))</div><div class="highlight" form="false" id="a_5ynzQ"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td><td class="code"><div class="source"><pre><span class="kn">#lang </span><span class="nn">br</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._require))" class="docs" hyphens="none">require</a></span> <span class="s2">"struct.rkt"</span> <span class="s2">"expr.rkt"</span><span class="p">)</span>
<span class="hll"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._provide))" class="docs" hyphens="none">provide</a></span> <span class="n">b-rem</span> <span class="n">b-print</span> <span class="n">b-let</span> <span class="n">b-input</span> <span class="n">b-import</span><span class="p">)</span>
</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="p">(</span><span class="n">b-rem</span> <span class="n">val</span><span class="p">)</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/void.html#(def._((quote._~23~25kernel)._void))" class="docs" hyphens="none">void</a></span><span class="p">))</span>

<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="p">(</span><span class="n">b-print</span> <span class="o">.</span> <span class="n">vals</span><span class="p">)</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/Writing.html#(def._((lib._racket/private/misc..rkt)._displayln))" class="docs" hyphens="none">displayln</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/strings.html#(def._((lib._racket/string..rkt)._string-append*))" class="docs" hyphens="none">string-append*</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((lib._racket/private/map..rkt)._map))" class="docs" hyphens="none">map</a></span> <span class="nb"><a href="http://docs.racket-lang.org/reference/strings.html#(def._((lib._racket/format..rkt)._~7ea))" class="docs" hyphens="none">~a</a></span> <span class="n">vals</span><span class="p">))))</span>

<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br/index.html#(form._((lib._br/define..rkt)._define-macro))" class="docs" hyphens="none">define-macro</a></span> <span class="p">(</span><span class="n">b-let</span> <span class="n">ID</span> <span class="n">VAL</span><span class="p">)</span> <span class="o">#&#39;</span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/set_.html#(form._((quote._~23~25kernel)._set!))" class="docs" hyphens="none">set!</a></span> <span class="n">ID</span> <span class="n">VAL</span><span class="p">))</span>

<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br/index.html#(form._((lib._br/define..rkt)._define-macro))" class="docs" hyphens="none">define-macro</a></span> <span class="p">(</span><span class="n">b-input</span> <span class="n">ID</span><span class="p">)</span>
  <span class="o">#&#39;</span><span class="p">(</span><span class="n">b-let</span> <span class="n">ID</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let*))" class="docs" hyphens="none">let*</a></span> <span class="p">([</span><span class="n">str</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/Byte_and_String_Input.html#(def._((quote._~23~25kernel)._read-line))" class="docs" hyphens="none">read-line</a></span><span class="p">)]</span>
                     <span class="p">[</span><span class="n">num</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._string-~3enumber))" class="docs" hyphens="none">string-&gt;number</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/strings.html#(def._((lib._racket/string..rkt)._string-trim))" class="docs" hyphens="none">string-trim</a></span> <span class="n">str</span><span class="p">))])</span>
                <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/if.html#(form._((lib._racket/private/letstx-scheme..rkt)._or))" class="docs" hyphens="none">or</a></span> <span class="n">num</span> <span class="n">str</span><span class="p">))))</span>

<span class="hll"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br/index.html#(form._((lib._br/define..rkt)._define-macro))" class="docs" hyphens="none">define-macro</a></span> <span class="p">(</span><span class="n">b-import</span> <span class="n">NAME</span><span class="p">)</span> <span class="o">#&#39;</span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/void.html#(def._((quote._~23~25kernel)._void))" class="docs" hyphens="none">void</a></span><span class="p">))</span>
</span></pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpkd" data-clipboard-target="#code_56" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;testing-our-imports&quot;)"></div><h3 anchor="testing-our-imports" class="subhead" id="testing-our-imports"><a href="#testing-our-imports">Test­ing our imports</a></h3></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_uhhdH&quot;)"></div><p id="a_uhhdH">That should be all we need to make our orig­i­nal exam­ple work:</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_0yLYW&quot;)"></div><div class="highlight-container" id="a_0yLYW"><div id="code_57" form="false" decode="exclude" style="font-size:0;width:0;height:0">#lang basic<br/>10 import [math/number-theory]<br/>20 print [nth-prime](15)<br/>30 print [prime?](24)<br/>40 import [racket/base]<br/>50 print [max](f(1), f(2), f(5), f(4))<br/>60 def f(x) = x + x</div><div class="highlight" form="false" id="a_bzYlZ"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="source"><pre>#lang basic
<span class="nl">10</span><span class="w"> </span><span class="vg">import</span><span class="w"> </span><span class="p">[</span><span class="vg">math</span><span class="o">/</span><span class="vg">number</span><span class="o">-</span><span class="vg">theory</span><span class="p">]</span>
<span class="nl">20</span><span class="w"> </span><span class="vg">print</span><span class="w"> </span><span class="p">[</span><span class="vg">nth</span><span class="o">-</span><span class="vg">prime</span><span class="p">](</span><span class="il">15</span><span class="p">)</span>
<span class="nl">30</span><span class="w"> </span><span class="vg">print</span><span class="w"> </span><span class="p">[</span><span class="vg">prime</span><span class="o">?</span><span class="p">](</span><span class="il">24</span><span class="p">)</span>
<span class="nl">40</span><span class="w"> </span><span class="vg">import</span><span class="w"> </span><span class="p">[</span><span class="vg">racket</span><span class="o">/</span><span class="vg">base</span><span class="p">]</span>
<span class="nl">50</span><span class="w"> </span><span class="vg">print</span><span class="w"> </span><span class="p">[</span><span class="vg">max</span><span class="p">](</span><span class="vg">f</span><span class="p">(</span><span class="il">1</span><span class="p">),</span><span class="w"> </span><span class="vg">f</span><span class="p">(</span><span class="il">2</span><span class="p">),</span><span class="w"> </span><span class="vg">f</span><span class="p">(</span><span class="il">5</span><span class="p">),</span><span class="w"> </span><span class="vg">f</span><span class="p">(</span><span class="il">4</span><span class="p">))</span>
<span class="nl">60</span><span class="w"> </span><span class="vg">def</span><span class="w"> </span><span class="vg">f</span><span class="p">(</span><span class="vg">x</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="vg">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="vg">x</span>
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpke" data-clipboard-target="#code_57" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_ExwOf&quot;)"></div><div class="highlight-container" id="a_ExwOf"><div id="code_58" form="false" decode="exclude" style="font-size:0;width:0;height:0">53<br/>0<br/>10</div><div class="highlight" form="false" id="a_1dBTj"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="source"><pre><span class="mi">53</span>
<span class="mi">0</span>
<span class="mi">10</span>
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpkf" data-clipboard-target="#code_58" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_u3IrI&quot;)"></div><p id="a_u3IrI">Let’s remove the first <span class="my-code" decode="exclude">import</span> state­ment and con­firm that we get a sen­si­ble error:</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_Uv2Pp&quot;)"></div><div class="highlight-container" id="a_Uv2Pp"><div id="code_59" form="false" decode="exclude" style="font-size:0;width:0;height:0">#lang basic<br/>20 print [nth-prime](15)<br/>30 print [prime?](24)<br/>40 import [racket/base]<br/>50 print [max](f(1), f(2), f(5), f(4))<br/>60 def f(x) = x + x</div><div class="highlight" form="false" id="a_dZje1"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="source"><pre>#lang basic
<span class="nl">20</span><span class="w"> </span><span class="vg">print</span><span class="w"> </span><span class="p">[</span><span class="vg">nth</span><span class="o">-</span><span class="vg">prime</span><span class="p">](</span><span class="il">15</span><span class="p">)</span>
<span class="nl">30</span><span class="w"> </span><span class="vg">print</span><span class="w"> </span><span class="p">[</span><span class="vg">prime</span><span class="o">?</span><span class="p">](</span><span class="il">24</span><span class="p">)</span>
<span class="nl">40</span><span class="w"> </span><span class="vg">import</span><span class="w"> </span><span class="p">[</span><span class="vg">racket</span><span class="o">/</span><span class="vg">base</span><span class="p">]</span>
<span class="nl">50</span><span class="w"> </span><span class="vg">print</span><span class="w"> </span><span class="p">[</span><span class="vg">max</span><span class="p">](</span><span class="vg">f</span><span class="p">(</span><span class="il">1</span><span class="p">),</span><span class="w"> </span><span class="vg">f</span><span class="p">(</span><span class="il">2</span><span class="p">),</span><span class="w"> </span><span class="vg">f</span><span class="p">(</span><span class="il">5</span><span class="p">),</span><span class="w"> </span><span class="vg">f</span><span class="p">(</span><span class="il">4</span><span class="p">))</span>
<span class="nl">60</span><span class="w"> </span><span class="vg">def</span><span class="w"> </span><span class="vg">f</span><span class="p">(</span><span class="vg">x</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="vg">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="vg">x</span>
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpkg" data-clipboard-target="#code_59" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_qoaWm&quot;)"></div><div class="highlight-container err" id="a_qoaWm"><div id="code_60" form="false" decode="exclude" style="font-size:0;width:0;height:0">nth-prime: unbound identifier in module in: nth-prime</div><div class="highlight" form="false" id="a_VdjAI"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="source"><pre>nth-prime: unbound identifier in module in: nth-prime
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpkh" data-clipboard-target="#code_60" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_QMhGg&quot;)"></div><p id="a_QMhGg">Let’s also try call­ing a func­tion that returns an unus­able data type, in this case a <a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._list))" class="docs" hyphens="none">list</a>:</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_CkWQR&quot;)"></div><div class="highlight-container" id="a_CkWQR"><div id="code_61" form="false" decode="exclude" style="font-size:0;width:0;height:0">#lang basic<br/>40 import [racket/base]<br/>50 print [list](f(1), f(2), f(5), f(4))<br/>60 def f(x) = x + x</div><div class="highlight" form="false" id="a_i5qeH"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="source"><pre>#lang basic
<span class="nl">40</span><span class="w"> </span><span class="vg">import</span><span class="w"> </span><span class="p">[</span><span class="vg">racket</span><span class="o">/</span><span class="vg">base</span><span class="p">]</span>
<span class="nl">50</span><span class="w"> </span><span class="vg">print</span><span class="w"> </span><span class="p">[</span><span class="vg">list</span><span class="p">](</span><span class="vg">f</span><span class="p">(</span><span class="il">1</span><span class="p">),</span><span class="w"> </span><span class="vg">f</span><span class="p">(</span><span class="il">2</span><span class="p">),</span><span class="w"> </span><span class="vg">f</span><span class="p">(</span><span class="il">5</span><span class="p">),</span><span class="w"> </span><span class="vg">f</span><span class="p">(</span><span class="il">4</span><span class="p">))</span>
<span class="nl">60</span><span class="w"> </span><span class="vg">def</span><span class="w"> </span><span class="vg">f</span><span class="p">(</span><span class="vg">x</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="vg">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="vg">x</span>
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpki" data-clipboard-target="#code_61" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_kSKZd&quot;)"></div><div class="highlight-container err" id="a_kSKZd"><div id="code_62" form="false" decode="exclude" style="font-size:0;width:0;height:0">error in line 50: unknown data type: '(2 4 10 8)</div><div class="highlight" form="false" id="a_En4im"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="source"><pre>error in line 50: unknown data type: &#39;(2 4 10 8)
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpkj" data-clipboard-target="#code_62" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_yQsvi&quot;)"></div><p id="a_yQsvi">Looks good.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;by-the-way&quot;)"></div><h3 anchor="by-the-way" class="subhead" id="by-the-way"><a href="#by-the-way">By the way</a></h3></div><ul><li><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_m5nZ6&quot;)"></div><p id="a_m5nZ6">Our focus here was math-related func­tions, so we only con­sid­ered expres­sions as argu­ments to func­tions. It would be easy, how­ever, to also allow strings as input, so we could also use Racket’s string-manip­u­la­tion func­tions. We’d just need to change the right side of the <span class="my-code" decode="exclude">b-func</span> parser rule to accept <span class="my-code" decode="exclude">STRING</span> tokens as well.</p></div></li><li><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_H2ZfL&quot;)"></div><p id="a_H2ZfL">Obvi­ously, when using Racket func­tions, we lose a lot by not being able to use <a class="glossary" href="../appendix/glossary.html#list"><span class="glossary-link-text">lists</span></a> as input or return val­ues. Seri­ous nerds will recall that BASIC has a <span class="my-code" decode="exclude">dim</span> state­ment that cre­ates arrays sim­i­lar to <a class="glossary" href="../appendix/glossary.html#list"><span class="glossary-link-text">lists</span></a> in Racket. They’re not hard to imple­ment, but we won’t get to them here.</p></div></li><li><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_31f3t&quot;)"></div><p id="a_31f3t">Though it’s easy to con­vert a Boolean return value to an inte­ger, it’s harder to go the other way. If our BASIC pro­gram invokes a Racket func­tion with <span class="my-code" decode="exclude">0</span> as an argu­ment, should it be treated as the inte­ger <span class="my-code" decode="exclude">0</span> or the Boolean <span class="my-code" decode="exclude">#f</span>? A tricky ques­tion that we’ll leave for curi­ous char­ac­ters.</p></div></li></ul><div anchorize="false" style="height:2em"></div><ul class="siblinks"><li><a href="intro.html">1&emsp;intro</a></li><li><a href="specification-and-setup.html">2&emsp;spec­i­fi­ca­tion and setup</a></li><li><a href="functions.html">3&emsp;func­tions</a></li><li><a class="here" href="imports.html">4&emsp;imports</a></li><li><a href="exports.html">5&emsp;exports</a></li><li><a href="the-repl.html">6&emsp;the repl</a></li><li><a href="command-line-arguments.html">7&emsp;com­mand-line argu­ments</a></li><li><a href="recap.html">8&emsp;recap</a></li><li><a href="source-listing.html">9&emsp;source list­ing</a></li></ul></div>
    <a class="nav-left" href="functions.html">← prev</a>
    <a class="nav-right" href="exports.html">next →</a>




</body>

<script type="text/javascript">



function show_all_forms() {
 var elems = document.getElementsByClassName('has_form');
 for (var i = 0 ; i < elems.length ; i++) {
  toggle_form(elems[i].id);
 }
}

// for debugging forms only: uncomment next line
// show_all_forms();

// sets up copy-to-clipboard buttons in code boxes
var clipboard = new Clipboard('.copy-button');
clipboard.on('success', function(e) {console.log(e);});
clipboard.on('error', function(e) {console.log(e);});
</script>