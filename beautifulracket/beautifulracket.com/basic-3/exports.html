<!DOCTYPE html>
<html>
  
<!-- Mirrored from beautifulracket.com/basic-3/exports.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 16 Mar 2017 05:48:14 GMT -->
<head>
    <meta charset="UTF-8">
    <title>Beautiful Racket: Closing the loop: basic</title>
    <link rel="stylesheet" type="text/css" media="all" href="../styles.css"/>
    <script type="text/javascript" src="../functions.js"></script>
    <script type="text/javascript" src="../clipboard.min.js"></script>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-74684045-1', 'auto');
      ga('send', 'pageview');
    </script>
  </head>
<body>
<div id="alert">Thank you for your comment</div>
    <div id="doc"><h3 class="dept" anchorize="false"><a href="../index.html">Beau­ti­ful Racket</a> / <a href="../index.html#tutorials">tuto­ri­als</a></h3><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;closing-the-loop-basic&quot;)"></div><h1 anchor="closing-the-loop-basic" id="closing-the-loop-basic" hyphens="none">Closing the loop: <span class="my-code" decode="exclude">basic</span></h1></div><ul class="siblinks"><li><a href="intro.html">1&emsp;intro</a></li><li><a href="specification-and-setup.html">2&emsp;spec­i­fi­ca­tion and setup</a></li><li><a href="functions.html">3&emsp;func­tions</a></li><li><a href="imports.html">4&emsp;imports</a></li><li><a class="here" href="exports.html">5&emsp;exports</a></li><li><a href="the-repl.html">6&emsp;the repl</a></li><li><a href="command-line-arguments.html">7&emsp;com­mand-line argu­ments</a></li><li><a href="recap.html">8&emsp;recap</a></li><li><a href="source-listing.html">9&emsp;source list­ing</a></li></ul><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_CTnC5&quot;)"></div><p id="a_CTnC5">Hav­ing fig­ured out <a href="imports.html">imports</a>, let’s go the other direc­tion and add exports to BASIC. (Again, not some­thing that was ever part of the orig­i­nal lan­guage. Don’t panic.)</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_PjGtn&quot;)"></div><p id="a_PjGtn">How could this work? Let’s sup­pose we have a BASIC pro­gram that defines vari­ables and func­tions (tem­porar­ily using <span class="my-code" decode="exclude">basic-demo-3</span> as the lan­guage, just to see how it works):</p></div><div class="filebox" anchorize="false"><div class="filename" anchorize="false" decode="exclude">basic/sample-exporter.rkt</div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_5zroq&quot;)"></div><div class="highlight-container" id="a_5zroq"><div id="code_43" form="false" decode="exclude" style="font-size:0;width:0;height:0">#lang basic-demo-3<br/>10 def div(num, denom) = num / denom<br/>20 x = 5 : y = 10<br/>30 print x - 4<br/>40 x = 15 : y = 30<br/>50 print div(y, x)<br/>60 x = 20<br/>70 print div((x + x + x), x)</div><div class="highlight" form="false" id="a_LnWK0"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="source"><pre>#lang basic-demo-3
<span class="nl">10</span><span class="w"> </span><span class="vg">def</span><span class="w"> </span><span class="vg">div</span><span class="p">(</span><span class="vg">num</span><span class="p">,</span><span class="w"> </span><span class="vg">denom</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="vg">num</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="vg">denom</span>
<span class="nl">20</span><span class="w"> </span><span class="vg">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="il">5</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="vg">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="il">10</span>
<span class="nl">30</span><span class="w"> </span><span class="vg">print</span><span class="w"> </span><span class="vg">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="il">4</span>
<span class="nl">40</span><span class="w"> </span><span class="vg">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="il">15</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="vg">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="il">30</span>
<span class="nl">50</span><span class="w"> </span><span class="vg">print</span><span class="w"> </span><span class="vg">div</span><span class="p">(</span><span class="vg">y</span><span class="p">,</span><span class="w"> </span><span class="vg">x</span><span class="p">)</span>
<span class="nl">60</span><span class="w"> </span><span class="vg">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="il">20</span>
<span class="nl">70</span><span class="w"> </span><span class="vg">print</span><span class="w"> </span><span class="vg">div</span><span class="p">((</span><span class="vg">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="vg">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="vg">x</span><span class="p">),</span><span class="w"> </span><span class="vg">x</span><span class="p">)</span>
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpk" data-clipboard-target="#code_43" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_bVidq&quot;)"></div><p id="a_bVidq">The result of this pro­gram:</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_RERvd&quot;)"></div><div class="highlight-container" id="a_RERvd"><div id="code_44" form="false" decode="exclude" style="font-size:0;width:0;height:0">1<br/>2<br/>3</div><div class="highlight" form="false" id="a_BnGgg"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="source"><pre>1
2
3
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpk1" data-clipboard-target="#code_44" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_lBllz&quot;)"></div><p id="a_lBllz">Now let’s sup­pose we want to make the func­tion <span class="my-code" decode="exclude">div</span> and the vari­able <span class="my-code" decode="exclude">x</span> avail­able to other pro­grams. To do this, we add two <span class="my-code" decode="exclude">export</span> state­ments (to the end of the pro­gram, but as with <span class="my-code" decode="exclude">import</span>, the loca­tion shouldn’t mat­ter):</p></div><div class="filebox" anchorize="false"><div class="filename" anchorize="false" decode="exclude">basic/sample-exporter.rkt</div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_34HkC&quot;)"></div><div class="highlight-container" id="a_34HkC"><div id="code_45" form="false" decode="exclude" style="font-size:0;width:0;height:0">#lang basic-demo-3<br/>10 def div(num, denom) = num / denom<br/>20 x = 5 : y = 10<br/>30 print x - 4<br/>40 x = 15 : y = 30<br/>50 print div(y, x)<br/>60 x = 20<br/>70 print div((x + x + x), x)<br/>80 export div : export x</div><div class="highlight" form="false" id="a_0gUkt"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="source"><pre>#lang basic-demo-3
<span class="nl">10</span><span class="w"> </span><span class="vg">def</span><span class="w"> </span><span class="vg">div</span><span class="p">(</span><span class="vg">num</span><span class="p">,</span><span class="w"> </span><span class="vg">denom</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="vg">num</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="vg">denom</span>
<span class="nl">20</span><span class="w"> </span><span class="vg">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="il">5</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="vg">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="il">10</span>
<span class="nl">30</span><span class="w"> </span><span class="vg">print</span><span class="w"> </span><span class="vg">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="il">4</span>
<span class="nl">40</span><span class="w"> </span><span class="vg">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="il">15</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="vg">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="il">30</span>
<span class="nl">50</span><span class="w"> </span><span class="vg">print</span><span class="w"> </span><span class="vg">div</span><span class="p">(</span><span class="vg">y</span><span class="p">,</span><span class="w"> </span><span class="vg">x</span><span class="p">)</span>
<span class="nl">60</span><span class="w"> </span><span class="vg">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="il">20</span>
<span class="nl">70</span><span class="w"> </span><span class="vg">print</span><span class="w"> </span><span class="vg">div</span><span class="p">((</span><span class="vg">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="vg">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="vg">x</span><span class="p">),</span><span class="w"> </span><span class="vg">x</span><span class="p">)</span>
<span class="nl">80</span><span class="w"> </span><span class="vg">export</span><span class="w"> </span><span class="vg">div</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="vg">export</span><span class="w"> </span><span class="vg">x</span>
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpk2" data-clipboard-target="#code_45" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_5np5V&quot;)"></div><p id="a_5np5V">This pro­gram will still run the same way:</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_RERvd5&quot;)"></div><div class="highlight-container" id="a_RERvd5"><div id="code_46" form="false" decode="exclude" style="font-size:0;width:0;height:0">1<br/>2<br/>3</div><div class="highlight" form="false" id="a_BnGgg3"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="source"><pre>1
2
3
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpk4" data-clipboard-target="#code_46" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_vyxlE&quot;)"></div><p id="a_vyxlE">But now, if we import this <span class="my-code" decode="exclude">"sample-exporter.rkt"</span> mod­ule into another Racket pro­gram using <span class="my-code" decode="exclude">require</span>, we can use <span class="my-code" decode="exclude">div</span> as a func­tion and <span class="my-code" decode="exclude">x</span> as a value:</p></div><div class="filebox" anchorize="false"><div class="filename" anchorize="false" decode="exclude">basic/sample-importer.rkt</div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_xO3fu&quot;)"></div><div class="highlight-container" id="a_xO3fu"><div id="code_47" form="false" decode="exclude" style="font-size:0;width:0;height:0">#lang br<br/>(require basic/sample-exporter)<br/>div<br/>x<br/>(div x 10)</div><div class="highlight" form="false" id="a_g6JRg"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="source"><pre><span class="kn">#lang </span><span class="nn">br</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._require))" class="docs" hyphens="none">require</a></span> <span class="n">basic/sample-exporter</span><span class="p">)</span>
<span class="n">div</span>
<span class="n">x</span>
<span class="p">(</span><span class="n">div</span> <span class="n">x</span> <span class="mi">10</span><span class="p">)</span>
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpk6" data-clipboard-target="#code_47" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_6XRGM&quot;)"></div><div class="highlight-container" id="a_6XRGM"><div id="code_48" form="false" decode="exclude" style="font-size:0;width:0;height:0">#&lt;procedure:div&gt;<br/>20<br/>2</div><div class="highlight" form="false" id="a_109jm"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="source"><pre>#&lt;procedure:div&gt;
20
2
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpk7" data-clipboard-target="#code_48" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_TVeUj&quot;)"></div><p id="a_TVeUj">Let’s also notice what’s <em>not</em> hap­pen­ing when we import <span class="my-code" decode="exclude">"sample-exporter.rkt"</span>: though the BASIC pro­gram inside is run­ning, its <span class="my-code" decode="exclude">print</span> state­ments don’t pro­duce any results on the REPL.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;means-of-suppression&quot;)"></div><h3 anchor="means-of-suppression" class="subhead" id="means-of-suppression"><a href="#means-of-suppression">Means of sup­pres­sion</a></h3></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_97mWF&quot;)"></div><p id="a_97mWF">To make exports work, we have two tasks:</p></div><ol><li><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_Puf42&quot;)"></div><p id="a_Puf42">We need to find the the <span class="my-code" decode="exclude">export</span> state­ments in the pro­gram and con­vert them to top-level <span class="my-code" decode="exclude">provide</span> forms.</p></div></li><li><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_dHw6L&quot;)"></div><p id="a_dHw6L">We need to sup­press the out­put when the pro­gram is being used with <span class="my-code" decode="exclude">require</span> or other import­ing form.</p></div></li></ol><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_ZEdGp&quot;)"></div><p id="a_ZEdGp">For the first task, we can run the same play we used for <a href="imports.html">imports</a>. We’ll use the parser to mark our exported names with new parser rule—let’s call it <span class="my-code" decode="exclude">b-export-name</span>. We’ll splice this rule so that the export names end up car­ry­ing a <a class="glossary" href="../appendix/glossary.html#syntax-property"><span class="glossary-link-text">syn­tax prop­erty</span></a> called <span class="my-code" decode="exclude">'b-export-name</span>. We’ll use this syn­tax prop­erty to find the names in our parse tree. Then we can put them inside a <span class="my-code" decode="exclude">provide</span> form at the top level of our mod­ule. We’ll also need to con­vert the <span class="my-code" decode="exclude">b-export</span> state­ment itself into a <span class="my-code" decode="exclude">(void)</span> form.</p></div><div anchorize="false" style="height:1em"></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_VXCCA&quot;)"></div><p id="a_VXCCA">The sec­ond task—sup­press­ing the out­put of the pro­gram—presents a new kind of prob­lem. How do we change the behav­ior of <span class="my-code" decode="exclude">print</span> state­ments in cer­tain con­di­tions?</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_fiOg7&quot;)"></div><p id="a_fiOg7">Let’s zoom out so we can see the big­ger pic­ture. Our task is a par­tic­u­lar ver­sion of a more gen­eral prob­lem: how to change the behav­ior of a mod­ule when it’s run directly vs. when it’s imported into another mod­ule.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_622O2&quot;)"></div><p id="a_622O2">We first encoun­tered this prob­lem in <a href="../wires/index.html"><span class="my-code" decode="exclude">wires</span></a>. In that case, we needed to set up the lan­guage so that it printed cer­tain results after the wire func­tions were defined. To do this, we used <a href="../wires/the-expander.html#helper-define-display">the <span class="my-code" decode="exclude">main</span> sub­mod­ule</a>, a spe­cial sub­mod­ule that Racket only invokes when the mod­ule is run directly, but not when it’s imported.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_cAxOJ&quot;)"></div><p id="a_cAxOJ">Sounds promis­ing. Can a <span class="my-code" decode="exclude">main</span> sub­mod­ule help us here? Not quite. The lim­i­ta­tion of a <span class="my-code" decode="exclude">main</span> sub­mod­ule is that it’s only invoked <em>after</em> the rest of the mod­ule has run. In <a href="../wires/index.html"><span class="my-code" decode="exclude">wires</span></a>, that worked fine, because we wanted to print some results after cer­tain func­tions were defined in the body of the mod­ule.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_qLH9m&quot;)"></div><p id="a_qLH9m">In BASIC, how­ever, the <span class="my-code" decode="exclude">print</span> state­ments can be mixed any­where among the func­tion and vari­able def­i­n­i­tions in the source. There’s no way for us to rearrange the order of state­ments with­out chang­ing the way the pro­gram works.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_Mc1Z3&quot;)"></div><p id="a_Mc1Z3">Sup­pose we had the idea to col­lect the result of every <span class="my-code" decode="exclude">print</span> state­ment into a buffer list of strings, and then use a <span class="my-code" decode="exclude">main</span> sub­mod­ule to dis­play that list at the end of the pro­gram. Not a bad plan, until we try to run this pro­gram:</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_49eXJ&quot;)"></div><div class="highlight-container" id="a_49eXJ"><div id="code_49" form="false" decode="exclude" style="font-size:0;width:0;height:0">#lang basic-demo-3<br/>10 print "HELLO WORLD!"<br/>20 goto 10</div><div class="highlight" form="false" id="a_eZl4Z"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="source"><pre>#lang basic-demo-3
<span class="nl">10</span><span class="w"> </span><span class="vg">print</span><span class="w"> </span><span class="s2">"HELLO WORLD!"</span>
<span class="nl">20</span><span class="w"> </span><span class="vg">goto</span><span class="w"> </span><span class="il">10</span>
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpk8" data-clipboard-target="#code_49" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_lp5Ln&quot;)"></div><p id="a_lp5Ln">In this case, the <span class="my-code" decode="exclude">main</span> sub­mod­ule would never run, because the rest of the pro­gram never ter­mi­nates. So there would be no out­put at all. That’s wrong.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;introducing-the-configure-runtimesubmodule&quot;)"></div><h3 anchor="introducing-the-configure-runtimesubmodule" class="subhead" id="introducing-the-configure-runtimesubmodule"><a href="#introducing-the-configure-runtimesubmodule">Intro­duc­ing the con­fig­ure-run­time sub­mod­ule</a></h3></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_t5h4r&quot;)"></div><p id="a_t5h4r">What we’re look­ing for is a sub­mod­ule that, like the <span class="my-code" decode="exclude">main</span> sub­mod­ule, only runs when its enclos­ing mod­ule is run directly, and not when it’s imported. But unlike <span class="my-code" decode="exclude">main</span>, we want this sub­mod­ule to be invoked <em>before</em> the rest of the mod­ule, so we can set up <span class="my-code" decode="exclude">print</span> to work a dif­fer­ent way.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_xLLxH&quot;)"></div><p id="a_xLLxH">For­tu­nately, this option exists: it’s called the <span class="my-code" decode="exclude">configure-runtime</span> sub­mod­ule.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_fWesN&quot;)"></div><p id="a_fWesN">To avoid con­fu­sion, let’s con­cede that <span class="my-code" decode="exclude">configure-runtime</span> is a mis­lead­ing name. Through­out Racket, the term “run time” refers to the main phase of mod­ule <a class="explainer" href="../explainer/evaluation.html">eval­u­a­tion</a>. So no mat­ter whether a mod­ule is imported, or run directly, it always has a run-time eval­u­a­tion phase.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_fhKrU&quot;)"></div><p id="a_fhKrU">Con­trary to this ter­mi­nol­ogy, the <span class="my-code" decode="exclude">configure-runtime</span> sub­mod­ule is <em>only</em> invoked when its enclos­ing mod­ule is run directly. Really, it would’ve been bet­ter named <span class="my-code" decode="exclude">configure</span>. But—we’ll live with it.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_MdzOr&quot;)"></div><p id="a_MdzOr">To use the <span class="my-code" decode="exclude">configure-runtime</span> sub­mod­ule, we sim­ply add it to the top level of our lan­guage mod­ule. In our case it’ll look like this:</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_Re1CV&quot;)"></div><div class="highlight-container" id="a_Re1CV"><div id="code_50" form="false" decode="exclude" style="font-size:0;width:0;height:0">#'(#%module-begin<br/>   (module configure-runtime br<br/>     (require basic/setup)<br/>     (do-setup!))<br/>   ···)</div><div class="highlight" form="false" id="a_j4tZG"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="source"><pre><span class="o">#&#39;</span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/module.html#(form._((lib._racket/private/base..rkt)._~23~25module-begin))" class="docs" hyphens="none">#%module-begin</a></span>
   <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/module.html#(form._((quote._~23~25kernel)._module))" class="docs" hyphens="none">module</a></span> <span class="n">configure-runtime</span> <span class="n">br</span>
     <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._require))" class="docs" hyphens="none">require</a></span> <span class="n">basic/setup</span><span class="p">)</span>
     <span class="p">(</span><span class="n">do-setup!</span><span class="p">))</span>
   <span class="n">···</span><span class="p">)</span>
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpk9" data-clipboard-target="#code_50" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_PSLGU&quot;)"></div><p id="a_PSLGU">Although the sub­mod­ule can do the setup tasks itself, usu­ally it loads another mod­ule (like <span class="my-code" decode="exclude">basic/setup</span>) and invokes a setup func­tion (like <span class="my-code" decode="exclude">do-setup!</span>). There’s no magic to the names of the setup mod­ule or func­tion. What mat­ters is the <span class="my-code" decode="exclude">configure-runtime</span> name on the sub­mod­ule.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_lKI8M&quot;)"></div><p id="a_lKI8M">The <span class="my-code" decode="exclude">configure-runtime</span> sub­mod­ule has to use a full <a href="http://docs.racket-lang.org/reference/module.html#(form._((quote._~23~25kernel)._module))" class="docs" hyphens="none">module</a> dec­la­ra­tion rather than <a href="http://docs.racket-lang.org/reference/module.html#(form._((lib._racket/private/base..rkt)._module+))" class="docs" hyphens="none">module+</a>. Why? Because <span class="my-code" decode="exclude">module+</span> assumes that the sur­round­ing mod­ule has been invoked, and builds atop it. Since the <span class="my-code" decode="exclude">configure-runtime</span> sub­mod­ule runs before the other code, it needs a full <span class="my-code" decode="exclude">module</span> dec­la­ra­tion so it can run inde­pen­dently.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_bL2VB&quot;)"></div><p id="a_bL2VB">With that back­ground, let’s get into the code.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;lexer-updates&quot;)"></div><h3 anchor="lexer-updates" class="subhead" id="lexer-updates"><a href="#lexer-updates">Lexer updates</a></h3></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_TBcKD&quot;)"></div><p id="a_TBcKD">Very sim­ple—we just add our new <span class="my-code" decode="exclude">export</span> key­word to the list of <span class="my-code" decode="exclude">reserved-terms</span>:</p></div><div class="filebox" anchorize="false"><div class="filename" anchorize="false" decode="exclude">basic/lexer.rkt</div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_hWy95&quot;)"></div><div class="highlight-container" id="a_hWy95"><div id="code_51" form="false" decode="exclude" style="font-size:0;width:0;height:0">#lang br<br/>(require brag/support)<br/><br/>(define-lex-abbrev digits (:+ (char-set "0123456789")))<br/><br/>(define-lex-abbrev reserved-terms (:or "print" "goto" "end" "+"<br/>":" ";" "let" "=" "input" "-" "*" "/" "^" "mod" "(" ")" "def"<br/>"if" "then" "else" "&lt;" "&gt;" "&lt;&gt;" "and" "or" "not" "gosub"<br/>"return" "for" "to" "step" "next" "def" "," "import" "export"))<br/><br/>(define-lex-abbrev racket-id-kapu<br/>  (:or whitespace (char-set "()[]{}\",'`;#|\\")))<br/><br/>(define basic-lexer<br/>  (lexer-srcloc<br/>   [(eof) (return-without-srcloc eof)]<br/>   ["\n" (token 'NEWLINE lexeme)]<br/>   [whitespace (token lexeme #:skip? #t)]<br/>   [(from/stop-before "rem" "\n") (token 'REM lexeme)]<br/>   [(:seq "[" (:+ (:~ racket-id-kapu)) "]")<br/>    (token 'RACKET-ID<br/>           (string-&gt;symbol (trim-ends "[" lexeme "]")))]<br/>   [reserved-terms (token lexeme lexeme)]<br/>   [(:seq alphabetic (:* (:or alphabetic numeric "$")))<br/>    (token 'ID (string-&gt;symbol lexeme))]<br/>   [digits (token 'INTEGER (string-&gt;number lexeme))]<br/>   [(:or (:seq (:? digits) "." digits)<br/>         (:seq digits "."))<br/>    (token 'DECIMAL (string-&gt;number lexeme))]<br/>   [(:or (from/to "\"" "\"") (from/to "'" "'"))<br/>    (token 'STRING<br/>           (substring lexeme<br/>                      1 (sub1 (string-length lexeme))))]))<br/><br/>(provide basic-lexer)</div><div class="highlight" form="false" id="a_lu2kE"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35</pre></div></td><td class="code"><div class="source"><pre><span class="kn">#lang </span><span class="nn">br</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._require))" class="docs" hyphens="none">require</a></span> <span class="n">brag/support</span><span class="p">)</span>

<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._define-lex-abbrev))" class="docs" hyphens="none">define-lex-abbrev</a></span> <span class="n">digits</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(form._((lib._brag/support..rkt)._~3a+))" class="docs" hyphens="none">:+</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._char-set))" class="docs" hyphens="none">char-set</a></span> <span class="s2">"0123456789"</span><span class="p">)))</span>

<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._define-lex-abbrev))" class="docs" hyphens="none">define-lex-abbrev</a></span> <span class="n">reserved-terms</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(form._((lib._brag/support..rkt)._~3aor))" class="docs" hyphens="none">:or</a></span> <span class="s2">"print"</span> <span class="s2">"goto"</span> <span class="s2">"end"</span> <span class="s2">"+"</span>
<span class="s2">":"</span> <span class="s2">";"</span> <span class="s2">"let"</span> <span class="s2">"="</span> <span class="s2">"input"</span> <span class="s2">"-"</span> <span class="s2">"*"</span> <span class="s2">"/"</span> <span class="s2">"^"</span> <span class="s2">"mod"</span> <span class="s2">"("</span> <span class="s2">")"</span> <span class="s2">"def"</span>
<span class="s2">"if"</span> <span class="s2">"then"</span> <span class="s2">"else"</span> <span class="s2">"&lt;"</span> <span class="s2">"&gt;"</span> <span class="s2">"&lt;&gt;"</span> <span class="s2">"and"</span> <span class="s2">"or"</span> <span class="s2">"not"</span> <span class="s2">"gosub"</span>
<span class="hll"><span class="s2">"return"</span> <span class="s2">"for"</span> <span class="s2">"to"</span> <span class="s2">"step"</span> <span class="s2">"next"</span> <span class="s2">"def"</span> <span class="s2">","</span> <span class="s2">"import"</span> <span class="s2">"export"</span><span class="p">))</span>
</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._define-lex-abbrev))" class="docs" hyphens="none">define-lex-abbrev</a></span> <span class="n">racket-id-kapu</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(form._((lib._brag/support..rkt)._~3aor))" class="docs" hyphens="none">:or</a></span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._whitespace))" class="docs" hyphens="none">whitespace</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._char-set))" class="docs" hyphens="none">char-set</a></span> <span class="s2">"()[]{}</span><span class="se">\"</span><span class="s2">,&#39;`;#|</span><span class="se">\\</span><span class="s2">"</span><span class="p">)))</span>

<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="n">basic-lexer</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._lexer-srcloc))" class="docs" hyphens="none">lexer-srcloc</a></span>
   <span class="p">[(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/port-ops.html#(def._((quote._~23~25kernel)._eof))" class="docs" hyphens="none">eof</a></span><span class="p">)</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._return-without-srcloc))" class="docs" hyphens="none">return-without-srcloc</a></span> <span class="nb"><a href="http://docs.racket-lang.org/reference/port-ops.html#(def._((quote._~23~25kernel)._eof))" class="docs" hyphens="none">eof</a></span><span class="p">)]</span>
   <span class="p">[</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(def._((lib._brag/support..rkt)._token))" class="docs" hyphens="none">token</a></span> <span class="o">&#39;</span><span class="ss">NEWLINE</span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._lexeme))" class="docs" hyphens="none">lexeme</a></span><span class="p">)]</span>
   <span class="p">[</span><span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._whitespace))" class="docs" hyphens="none">whitespace</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(def._((lib._brag/support..rkt)._token))" class="docs" hyphens="none">token</a></span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._lexeme))" class="docs" hyphens="none">lexeme</a></span> <span class="kd">#:skip?</span> <span class="no">#t</span><span class="p">)]</span>
   <span class="p">[(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(form._((lib._brag/support..rkt)._from/stop-before))" class="docs" hyphens="none">from/stop-before</a></span> <span class="s2">"rem"</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(def._((lib._brag/support..rkt)._token))" class="docs" hyphens="none">token</a></span> <span class="o">&#39;</span><span class="ss">REM</span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._lexeme))" class="docs" hyphens="none">lexeme</a></span><span class="p">)]</span>
   <span class="p">[(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(form._((lib._brag/support..rkt)._~3aseq))" class="docs" hyphens="none">:seq</a></span> <span class="s2">"["</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(form._((lib._brag/support..rkt)._~3a+))" class="docs" hyphens="none">:+</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(form._((lib._brag/support..rkt)._~3a~7e))" class="docs" hyphens="none">:~</a></span> <span class="n">racket-id-kapu</span><span class="p">))</span> <span class="s2">"]"</span><span class="p">)</span>
    <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(def._((lib._brag/support..rkt)._token))" class="docs" hyphens="none">token</a></span> <span class="o">&#39;</span><span class="ss">RACKET-ID</span>
           <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/symbols.html#(def._((quote._~23~25kernel)._string-~3esymbol))" class="docs" hyphens="none">string-&gt;symbol</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(def._((lib._brag/support..rkt)._trim-ends))" class="docs" hyphens="none">trim-ends</a></span> <span class="s2">"["</span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._lexeme))" class="docs" hyphens="none">lexeme</a></span> <span class="s2">"]"</span><span class="p">)))]</span>
   <span class="p">[</span><span class="n">reserved-terms</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(def._((lib._brag/support..rkt)._token))" class="docs" hyphens="none">token</a></span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._lexeme))" class="docs" hyphens="none">lexeme</a></span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._lexeme))" class="docs" hyphens="none">lexeme</a></span><span class="p">)]</span>
   <span class="p">[(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(form._((lib._brag/support..rkt)._~3aseq))" class="docs" hyphens="none">:seq</a></span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._alphabetic))" class="docs" hyphens="none">alphabetic</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(form._((lib._brag/support..rkt)._~3a*))" class="docs" hyphens="none">:*</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(form._((lib._brag/support..rkt)._~3aor))" class="docs" hyphens="none">:or</a></span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._alphabetic))" class="docs" hyphens="none">alphabetic</a></span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._numeric))" class="docs" hyphens="none">numeric</a></span> <span class="s2">"$"</span><span class="p">)))</span>
    <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(def._((lib._brag/support..rkt)._token))" class="docs" hyphens="none">token</a></span> <span class="o">&#39;</span><span class="ss">ID</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/symbols.html#(def._((quote._~23~25kernel)._string-~3esymbol))" class="docs" hyphens="none">string-&gt;symbol</a></span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._lexeme))" class="docs" hyphens="none">lexeme</a></span><span class="p">))]</span>
   <span class="p">[</span><span class="n">digits</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(def._((lib._brag/support..rkt)._token))" class="docs" hyphens="none">token</a></span> <span class="o">&#39;</span><span class="ss">INTEGER</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._string-~3enumber))" class="docs" hyphens="none">string-&gt;number</a></span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._lexeme))" class="docs" hyphens="none">lexeme</a></span><span class="p">))]</span>
   <span class="p">[(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(form._((lib._brag/support..rkt)._~3aor))" class="docs" hyphens="none">:or</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(form._((lib._brag/support..rkt)._~3aseq))" class="docs" hyphens="none">:seq</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(form._((lib._brag/support..rkt)._~3a~3f))" class="docs" hyphens="none">:?</a></span> <span class="n">digits</span><span class="p">)</span> <span class="s2">"."</span> <span class="n">digits</span><span class="p">)</span>
         <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(form._((lib._brag/support..rkt)._~3aseq))" class="docs" hyphens="none">:seq</a></span> <span class="n">digits</span> <span class="s2">"."</span><span class="p">))</span>
    <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(def._((lib._brag/support..rkt)._token))" class="docs" hyphens="none">token</a></span> <span class="o">&#39;</span><span class="ss">DECIMAL</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._string-~3enumber))" class="docs" hyphens="none">string-&gt;number</a></span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._lexeme))" class="docs" hyphens="none">lexeme</a></span><span class="p">))]</span>
   <span class="p">[(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(form._((lib._brag/support..rkt)._~3aor))" class="docs" hyphens="none">:or</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(form._((lib._brag/support..rkt)._from/to))" class="docs" hyphens="none">from/to</a></span> <span class="s2">"</span><span class="se">\"</span><span class="s2">"</span> <span class="s2">"</span><span class="se">\"</span><span class="s2">"</span><span class="p">)</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(form._((lib._brag/support..rkt)._from/to))" class="docs" hyphens="none">from/to</a></span> <span class="s2">"&#39;"</span> <span class="s2">"&#39;"</span><span class="p">))</span>
    <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(def._((lib._brag/support..rkt)._token))" class="docs" hyphens="none">token</a></span> <span class="o">&#39;</span><span class="ss">STRING</span>
           <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/strings.html#(def._((quote._~23~25kernel)._substring))" class="docs" hyphens="none">substring</a></span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._lexeme))" class="docs" hyphens="none">lexeme</a></span>
                      <span class="mi">1</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._sub1))" class="docs" hyphens="none">sub1</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/strings.html#(def._((quote._~23~25kernel)._string-length))" class="docs" hyphens="none">string-length</a></span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._lexeme))" class="docs" hyphens="none">lexeme</a></span><span class="p">))))]))</span>

<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._provide))" class="docs" hyphens="none">provide</a></span> <span class="n">basic-lexer</span><span class="p">)</span>
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpka" data-clipboard-target="#code_51" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;parser-updates&quot;)"></div><h3 anchor="parser-updates" class="subhead" id="parser-updates"><a href="#parser-updates">Parser updates</a></h3></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_tfvXU&quot;)"></div><p id="a_tfvXU">We add a new <span class="my-code" decode="exclude">b-export</span> rule to han­dle the <span class="my-code" decode="exclude">export</span> state­ment, and add <span class="my-code" decode="exclude">b-export</span> to the right side of the <span class="my-code" decode="exclude">b-statement</span> rule.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_zrHY3&quot;)"></div><p id="a_zrHY3">We also mark the <span class="my-code" decode="exclude">export</span> state­ment argu­ment with a spliced <span class="my-code" decode="exclude">b-export-name</span> rule. In the parse tree, this will be attached to the argu­ment as a <a class="glossary" href="../appendix/glossary.html#syntax-property"><span class="glossary-link-text">syn­tax prop­erty</span></a>:</p></div><div class="filebox" anchorize="false"><div class="filename" anchorize="false" decode="exclude">basic/parser.rkt</div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_RjcUt&quot;)"></div><div class="highlight-container" id="a_RjcUt"><div id="code_52" form="false" decode="exclude" style="font-size:0;width:0;height:0">#lang brag<br/>b-program : [b-line] (/NEWLINE [b-line])*<br/>b-line : b-line-num [b-statement] (/":" [b-statement])* [b-rem]<br/>@b-line-num : INTEGER<br/>b-rem : REM<br/>@b-statement : b-end | b-print | b-goto<br/>             | b-let | b-input | b-if<br/>             | b-gosub | b-return | b-for | b-next<br/>             | b-def | b-import | b-export<br/>b-end : /"end"<br/>b-print : /"print" [b-printable] (/";" [b-printable])*<br/>@b-printable : STRING | b-expr<br/>b-goto : /"goto" b-expr<br/>b-let : [/"let"] b-id /"=" (STRING | b-expr)<br/>b-if : /"if" b-expr /"then" (b-statement | b-expr)<br/>                   [/"else" (b-statement | b-expr)]<br/>b-input : /"input" b-id<br/>@b-id : ID<br/>b-gosub : /"gosub" b-expr<br/>b-return : /"return"<br/>b-for : /"for" b-id /"=" b-expr /"to" b-expr [/"step" b-expr]<br/>b-next : /"next" b-id<br/>b-def : /"def" b-id /"(" b-id [/"," b-id]* /")" /"=" b-expr<br/>b-import : /"import" b-import-name<br/>@b-import-name : RACKET-ID | STRING<br/>b-export : /"export" b-export-name<br/>@b-export-name : ID<br/>b-expr : b-or-expr<br/>b-or-expr : [b-or-expr "or"] b-and-expr<br/>b-and-expr : [b-and-expr "and"] b-not-expr<br/>b-not-expr : ["not"] b-comp-expr<br/>b-comp-expr : [b-comp-expr ("="|"&lt;"|"&gt;"|"&lt;&gt;")] b-sum<br/>b-sum : [b-sum ("+"|"-")] b-product<br/>b-product : [b-product ("*"|"/"|"mod")] b-neg<br/>b-neg : ["-"] b-expt<br/>b-expt : [b-expt ("^")] b-value<br/>@b-value : b-number | b-id | /"(" b-expr /")" | b-func<br/>b-func : ID /"(" b-expr [/"," b-expr]* /")"<br/>@b-number : INTEGER | DECIMAL</div><div class="highlight" form="false" id="a_uRJPD"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39</pre></div></td><td class="code"><div class="source"><pre>#lang brag
b-program : [b-line] (/NEWLINE [b-line])*
b-line : b-line-num [b-statement] (/":" [b-statement])* [b-rem]
@b-line-num : INTEGER
b-rem : REM
@b-statement : b-end | b-print | b-goto
             | b-let | b-input | b-if
             | b-gosub | b-return | b-for | b-next
<span class="hll">             | b-def | b-import | b-export
</span>b-end : /"end"
b-print : /"print" [b-printable] (/";" [b-printable])*
@b-printable : STRING | b-expr
b-goto : /"goto" b-expr
b-let : [/"let"] b-id /"=" (STRING | b-expr)
b-if : /"if" b-expr /"then" (b-statement | b-expr)
                   [/"else" (b-statement | b-expr)]
b-input : /"input" b-id
@b-id : ID
b-gosub : /"gosub" b-expr
b-return : /"return"
b-for : /"for" b-id /"=" b-expr /"to" b-expr [/"step" b-expr]
b-next : /"next" b-id
b-def : /"def" b-id /"(" b-id [/"," b-id]* /")" /"=" b-expr
b-import : /"import" b-import-name
@b-import-name : RACKET-ID | STRING
<span class="hll">b-export : /"export" b-export-name
</span><span class="hll">@b-export-name : ID
</span>b-expr : b-or-expr
b-or-expr : [b-or-expr "or"] b-and-expr
b-and-expr : [b-and-expr "and"] b-not-expr
b-not-expr : ["not"] b-comp-expr
b-comp-expr : [b-comp-expr ("="|"&lt;"|"&gt;"|"&lt;&gt;")] b-sum
b-sum : [b-sum ("+"|"-")] b-product
b-product : [b-product ("*"|"/"|"mod")] b-neg
b-neg : ["-"] b-expt
b-expt : [b-expt ("^")] b-value
@b-value : b-number | b-id | /"(" b-expr /")" | b-func
b-func : ID /"(" b-expr [/"," b-expr]* /")"
@b-number : INTEGER | DECIMAL
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpkb" data-clipboard-target="#code_52" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_p0Gey&quot;)"></div><p id="a_p0Gey">As we did in the <span class="my-code" decode="exclude">b-func</span> rule for <a href="functions.html">func­tions</a>, we’re delib­er­ately using an <span class="my-code" decode="exclude">ID</span> in our <span class="my-code" decode="exclude">b-export-name</span> pat­tern rather than a <span class="my-code" decode="exclude">b-id</span>. Why? Because oth­er­wise, an <span class="my-code" decode="exclude">export</span> state­ment would trig­ger the default def­i­n­i­tion of an iden­ti­fier. In that case, a pro­gram like this wouldn’t raise an error:</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_5Szzb&quot;)"></div><div class="highlight-container" id="a_5Szzb"><div id="code_53" form="false" decode="exclude" style="font-size:0;width:0;height:0">#lang basic<br/>10 export x</div><div class="highlight" form="false" id="a_0e6nX"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="source"><pre>#lang basic
<span class="nl">10</span><span class="w"> </span><span class="vg">export</span><span class="w"> </span><span class="vg">x</span>
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpkc" data-clipboard-target="#code_53" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_ISsH8&quot;)"></div><p id="a_ISsH8">Here, the vari­able <span class="my-code" decode="exclude">x</span> would be cre­ated with the default value of <span class="my-code" decode="exclude">0</span>, and that would be the exported value.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_mzXmZ&quot;)"></div><p id="a_mzXmZ">Instead, we’d like to mimic the behav­ior of a Racket pro­gram that tries to <span class="my-code" decode="exclude">provide</span> an unde­fined iden­ti­fier:</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_Dis6I&quot;)"></div><div class="highlight-container" id="a_Dis6I"><div id="code_54" form="false" decode="exclude" style="font-size:0;width:0;height:0">(provide x)</div><div class="highlight" form="false" id="a_DYpCd"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="source"><pre><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._provide))" class="docs" hyphens="none">provide</a></span> <span class="n">x</span><span class="p">)</span>
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpkd" data-clipboard-target="#code_54" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_ir9al&quot;)"></div><div class="highlight-container err" id="a_ir9al"><div id="code_55" form="false" decode="exclude" style="font-size:0;width:0;height:0">module: provided identifier not defined or imported for phase 0 in: x</div><div class="highlight" form="false" id="a_j4hr8"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="source"><pre>module: provided identifier not defined or imported for phase 0 in: x
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpke" data-clipboard-target="#code_55" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_Ci1S0&quot;)"></div><p id="a_Ci1S0">By using <span class="my-code" decode="exclude">ID</span> in the rule pat­tern rather than <span class="my-code" decode="exclude">b-id</span>, we can make this hap­pen.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;introducing-parameters&quot;)"></div><h3 anchor="introducing-parameters" class="subhead" id="introducing-parameters"><a href="#introducing-parameters">Intro­duc­ing para­me­ters</a></h3></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_gURR6&quot;)"></div><p id="a_gURR6">Let’s stub out our new <span class="my-code" decode="exclude">"setup.rkt"</span> mod­ule that will be invoked from our <span class="my-code" decode="exclude">configure-runtime</span> sub­mod­ule:</p></div><div class="filebox" anchorize="false"><div class="filename" anchorize="false" decode="exclude">basic/setup.rkt</div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_4JBFu&quot;)"></div><div class="highlight-container" id="a_4JBFu"><div id="code_56" form="false" decode="exclude" style="font-size:0;width:0;height:0">#lang br<br/>(provide do-setup!)<br/><br/>(define (do-setup!)<br/>  ···)</div><div class="highlight" form="false" id="a_KoXGQ"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="source"><pre><span class="kn">#lang </span><span class="nn">br</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._provide))" class="docs" hyphens="none">provide</a></span> <span class="n">do-setup!</span><span class="p">)</span>

<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="p">(</span><span class="n">do-setup!</span><span class="p">)</span>
  <span class="n">···</span><span class="p">)</span>
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpkf" data-clipboard-target="#code_56" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_qXWwl&quot;)"></div><p id="a_qXWwl">Before we can pro­ceed, we’ll have to get more pre­cise about how to sup­press our <span class="my-code" decode="exclude">print</span> state­ments when the mod­ule is run directly.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_iKjHA&quot;)"></div><p id="a_iKjHA">We know that every <span class="my-code" decode="exclude">print</span> state­ment expands into a call to <a href="http://docs.racket-lang.org/reference/Writing.html#(def._((lib._racket/private/misc..rkt)._displayln))" class="docs" hyphens="none">displayln</a>. (See <span class="my-code" decode="exclude">"basic/misc.rkt"</span>.) In turn, <span class="my-code" decode="exclude">displayln</span> sends its out­put to the <a href="http://docs.racket-lang.org/reference/port-ops.html#(def._((quote._~23~25kernel)._current-output-port))" class="docs" hyphens="none">current-output-port</a>, which is a Racket <a class="glossary" href="../appendix/glossary.html#parameter"><span class="glossary-link-text">para­me­ter</span></a> that holds a ref­er­ence to the port where things get printed. <span class="tooltip" onclick="this.classList.toggle('tooltip_visible')"> + <span class="tooltip-inner">To use a Unix anal­ogy, <span class="my-code" decode="exclude">current-output-port</span> is like <span class="my-code" decode="exclude">stdout</span>. In fact, <span class="my-code" decode="exclude">current-output-port</span> often points to <span class="my-code" decode="exclude">stdout</span>.</span></span></p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_PLJJy&quot;)"></div><p id="a_PLJJy">Para­me­ters are a spe­cial class of items in Racket that approx­i­mate the role of global vari­ables. They’re used spar­ingly, usu­ally for sys­tem-wide set­tings that would oth­er­wise be dif­fi­cult to reach.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_oQG1e&quot;)"></div><p id="a_oQG1e">Unlike global vari­ables, para­me­ters are func­tions. To read the value of a para­me­ter, we invoke it as a func­tion. To set the value, we pass the new value as an argu­ment.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_CLNsQ&quot;)"></div><p id="a_CLNsQ">For exam­ple, the <a href="http://docs.racket-lang.org/reference/exns.html#(def._((quote._~23~25kernel)._error-print-width))" class="docs" hyphens="none">error-print-width</a> para­me­ter con­trols the max­i­mum width of an error mes­sage:</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_3jGoj&quot;)"></div><div class="highlight-container" id="a_3jGoj"><div id="code_57" form="false" decode="exclude" style="font-size:0;width:0;height:0">(error-print-width)     ; 250 (default value)<br/>(error-print-width 500) ; sets parameter to 500<br/>(error-print-width)     ; now 500</div><div class="highlight" form="false" id="a_Qa4PT"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="source"><pre><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/exns.html#(def._((quote._~23~25kernel)._error-print-width))" class="docs" hyphens="none">error-print-width</a></span><span class="p">)</span>     <span class="c1">; 250 (default value)</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/exns.html#(def._((quote._~23~25kernel)._error-print-width))" class="docs" hyphens="none">error-print-width</a></span> <span class="mi">500</span><span class="p">)</span> <span class="c1">; sets parameter to 500</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/exns.html#(def._((quote._~23~25kernel)._error-print-width))" class="docs" hyphens="none">error-print-width</a></span><span class="p">)</span>     <span class="c1">; now 500</span>
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpkg" data-clipboard-target="#code_57" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_CPOSY&quot;)"></div><p id="a_CPOSY">As shown above, we can set para­me­ters imper­a­tively, by pass­ing a value as an argu­ment. But para­me­ters also coop­er­ate with <a href="http://docs.racket-lang.org/reference/parameters.html#(form._((lib._racket/private/more-scheme..rkt)._parameterize))" class="docs" hyphens="none">parameterize</a>, a <span class="my-code" decode="exclude">let</span>-like form that lets us tem­porar­ily set a para­me­ter to a cer­tain value dur­ing the eval­u­a­tion of the <span class="my-code" decode="exclude">parameterize</span> body:</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_OgPLZ&quot;)"></div><div class="highlight-container" id="a_OgPLZ"><div id="code_58" form="false" decode="exclude" style="font-size:0;width:0;height:0">(error-print-width) ; 250<br/>(parameterize ([error-print-width 500])<br/>  (error-print-width)) ; 500<br/>(error-print-width) ; 250</div><div class="highlight" form="false" id="a_YFXcm"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="source"><pre><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/exns.html#(def._((quote._~23~25kernel)._error-print-width))" class="docs" hyphens="none">error-print-width</a></span><span class="p">)</span> <span class="c1">; 250</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/parameters.html#(form._((lib._racket/private/more-scheme..rkt)._parameterize))" class="docs" hyphens="none">parameterize</a></span> <span class="p">([</span><span class="nb"><a href="http://docs.racket-lang.org/reference/exns.html#(def._((quote._~23~25kernel)._error-print-width))" class="docs" hyphens="none">error-print-width</a></span> <span class="mi">500</span><span class="p">])</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/exns.html#(def._((quote._~23~25kernel)._error-print-width))" class="docs" hyphens="none">error-print-width</a></span><span class="p">))</span> <span class="c1">; 500</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/exns.html#(def._((quote._~23~25kernel)._error-print-width))" class="docs" hyphens="none">error-print-width</a></span><span class="p">)</span> <span class="c1">; 250</span>
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpkh" data-clipboard-target="#code_58" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_tvUhI&quot;)"></div><p id="a_tvUhI"><span class="my-code" decode="exclude">parameterize</span> has two ben­e­fits. First, it remem­bers the orig­i­nal value of the para­me­ter, and resets the para­me­ter to that value after <span class="my-code" decode="exclude">parameterize</span> exits. Sec­ond, the effect of the new para­me­ter value is bounded: it only affects expres­sions invoked, directly or indi­rectly, dur­ing the body of the <span class="my-code" decode="exclude">parameterize</span>.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_GmUb9&quot;)"></div><p id="a_GmUb9">Let’s see an exam­ple using <a href="http://docs.racket-lang.org/reference/Writing.html#(def._((lib._racket/private/misc..rkt)._displayln))" class="docs" hyphens="none">displayln</a>. We cre­ate <span class="my-code" decode="exclude">ostr</span>, an out­put port that cap­tures out­put to a string. Then we use <span class="my-code" decode="exclude">parameterize</span> to tem­porar­ily use it as the <span class="my-code" decode="exclude">current-output-port</span>, and call <span class="my-code" decode="exclude">func</span>:</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_PKnr8&quot;)"></div><div class="highlight-container" id="a_PKnr8"><div id="code_59" form="false" decode="exclude" style="font-size:0;width:0;height:0">(define (func str) (displayln str))<br/><br/>(define ostr (open-output-string))<br/>(parameterize ([current-output-port ostr])<br/>  (func "inside")) ; output temporarily redirected to ostr<br/><br/>(func "outside")<br/>(display (format "ostr = ~a" (get-output-string ostr)))</div><div class="highlight" form="false" id="a_6FaGV"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="source"><pre><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="p">(</span><span class="n">func</span> <span class="n">str</span><span class="p">)</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/Writing.html#(def._((lib._racket/private/misc..rkt)._displayln))" class="docs" hyphens="none">displayln</a></span> <span class="n">str</span><span class="p">))</span>

<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="n">ostr</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/stringport.html#(def._((quote._~23~25kernel)._open-output-string))" class="docs" hyphens="none">open-output-string</a></span><span class="p">))</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/parameters.html#(form._((lib._racket/private/more-scheme..rkt)._parameterize))" class="docs" hyphens="none">parameterize</a></span> <span class="p">([</span><span class="nb"><a href="http://docs.racket-lang.org/reference/port-ops.html#(def._((quote._~23~25kernel)._current-output-port))" class="docs" hyphens="none">current-output-port</a></span> <span class="n">ostr</span><span class="p">])</span>
  <span class="p">(</span><span class="n">func</span> <span class="s2">"inside"</span><span class="p">))</span> <span class="c1">; output temporarily redirected to ostr</span>

<span class="p">(</span><span class="n">func</span> <span class="s2">"outside"</span><span class="p">)</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/Writing.html#(def._((quote._~23~25kernel)._display))" class="docs" hyphens="none">display</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/Writing.html#(def._((quote._~23~25kernel)._format))" class="docs" hyphens="none">format</a></span> <span class="s2">"ostr = ~a"</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/stringport.html#(def._((quote._~23~25kernel)._get-output-string))" class="docs" hyphens="none">get-output-string</a></span> <span class="n">ostr</span><span class="p">)))</span>
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpki" data-clipboard-target="#code_59" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_HSgAb&quot;)"></div><div class="highlight-container" id="a_HSgAb"><div id="code_60" form="false" decode="exclude" style="font-size:0;width:0;height:0">outside<br/>ostr = inside</div><div class="highlight" form="false" id="a_oeGZR"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="source"><pre>outside
ostr = inside
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpkj" data-clipboard-target="#code_60" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_hY1QU&quot;)"></div><p id="a_hY1QU">The <span class="my-code" decode="exclude">func</span> within the <span class="my-code" decode="exclude">parameterize</span> has no vis­i­ble out­put, because the out­put of <span class="my-code" decode="exclude">displayln</span> is being redi­rected to <span class="my-code" decode="exclude">ostr</span>. In other words, <span class="my-code" decode="exclude">parameterize</span> affects <span class="my-code" decode="exclude">displayln</span>, even though it’s called from inside <span class="my-code" decode="exclude">func</span>. But after the <span class="my-code" decode="exclude">parameterize</span>, we can call <span class="my-code" decode="exclude">func</span> and it will dis­play text nor­mally. We can also retrieve the stored con­tents of <span class="my-code" decode="exclude">ostr</span>.</p></div><div anchorize="false" style="height:1em"></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_Cm35r&quot;)"></div><p id="a_Cm35r">With that in mind, we’ll invert our approach. Rather than sup­press­ing <span class="my-code" decode="exclude">print</span> state­ments only when the mod­ule is imported, we’ll sup­press all <span class="my-code" decode="exclude">print</span> state­ments by default. When the mod­ule is run directly, we’ll use the <span class="my-code" decode="exclude">configure-runtime</span> sub­mod­ule to make them vis­i­ble. How?</p></div><ol><li><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_E1CGL&quot;)"></div><p id="a_E1CGL">We’ll cre­ate a new para­me­ter called <span class="my-code" decode="exclude">basic-output-port</span> that holds an out­put port. By default, this port will dis­card any out­put.</p></div></li><li><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_h2Pdf&quot;)"></div><p id="a_h2Pdf">In our main <span class="my-code" decode="exclude">"expander.rkt"</span> mod­ule, we’ll wrap the main pro­gram loop in <span class="my-code" decode="exclude">parameterize</span>, and set the <span class="my-code" decode="exclude">current-output-port</span> to be this new <span class="my-code" decode="exclude">basic-output-port</span>. Why? Because then, every time <span class="my-code" decode="exclude">displayln</span> is invoked by a <span class="my-code" decode="exclude">print</span> state­ment, the out­put will be sent to <span class="my-code" decode="exclude">basic-output-port</span>. And by default, it will be dis­carded.</p></div></li><li><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_8Gkma&quot;)"></div><p id="a_8Gkma">Our <span class="my-code" decode="exclude">configure-runtime</span> sub­mod­ule will call <span class="my-code" decode="exclude">do-setup!</span>, which will set the <span class="my-code" decode="exclude">basic-output-port</span> to the usual <span class="my-code" decode="exclude">current-output-port</span>. That way, when the mod­ule is run directly, the results of <span class="my-code" decode="exclude">print</span> state­ments will be vis­i­ble.</p></div></li></ol><div anchorize="false" style="height:1em"></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_py4Kq&quot;)"></div><p id="a_py4Kq">That gives us enough guid­ance to fin­ish our <span class="my-code" decode="exclude">"setup.rkt"</span> mod­ule:</p></div><div class="filebox" anchorize="false"><div class="filename" anchorize="false" decode="exclude">basic/setup.rkt</div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_a7T4I&quot;)"></div><div class="highlight-container" id="a_a7T4I"><div id="code_61" form="false" decode="exclude" style="font-size:0;width:0;height:0">#lang br<br/>(provide basic-output-port do-setup!)<br/><br/>(define basic-output-port<br/>  (make-parameter (open-output-nowhere)))<br/><br/>(define (do-setup!)<br/>  (basic-output-port (current-output-port)))</div><div class="highlight" form="false" id="a_5YPAj"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="source"><pre><span class="kn">#lang </span><span class="nn">br</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._provide))" class="docs" hyphens="none">provide</a></span> <span class="n">basic-output-port</span> <span class="n">do-setup!</span><span class="p">)</span>

<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="n">basic-output-port</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/parameters.html#(def._((quote._~23~25kernel)._make-parameter))" class="docs" hyphens="none">make-parameter</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/port-lib.html#(def._((lib._racket/port..rkt)._open-output-nowhere))" class="docs" hyphens="none">open-output-nowhere</a></span><span class="p">)))</span>

<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="p">(</span><span class="n">do-setup!</span><span class="p">)</span>
  <span class="p">(</span><span class="n">basic-output-port</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/port-ops.html#(def._((quote._~23~25kernel)._current-output-port))" class="docs" hyphens="none">current-output-port</a></span><span class="p">)))</span>
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpkk" data-clipboard-target="#code_61" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_i4SxN&quot;)"></div><p id="a_i4SxN">We define <span class="my-code" decode="exclude">basic-output-port</span> as a new par­maeter using <a href="http://docs.racket-lang.org/reference/parameters.html#(def._((quote._~23~25kernel)._make-parameter))" class="docs" hyphens="none">make-parameter</a>. To make an out­put port that dis­cards its out­put, we use <a href="http://docs.racket-lang.org/reference/port-lib.html#(def._((lib._racket/port..rkt)._open-output-nowhere))" class="docs" hyphens="none">open-output-nowhere</a>.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_juanw&quot;)"></div><p id="a_juanw">In <span class="my-code" decode="exclude">do-setup!</span>, we imper­a­tively set <span class="my-code" decode="exclude">basic-output-port</span> to be the same as <span class="my-code" decode="exclude">current-output-port</span>.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;expander-updates&quot;)"></div><h3 anchor="expander-updates" class="subhead" id="expander-updates"><a href="#expander-updates">Expander updates</a></h3></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_UvWRo&quot;)"></div><p id="a_UvWRo">The key updates are in <span class="my-code" decode="exclude">"expander.rkt"</span>. At the top, we import our new <span class="my-code" decode="exclude">"setup.rkt"</span> mod­ule so we can use the <span class="my-code" decode="exclude">basic-output-port</span> para­me­ter. We also extract the <span class="my-code" decode="exclude">EXPORT-NAME</span> syn­tax objects the same way we did in <a href="imports.html">imports</a>—by call­ing <span class="my-code" decode="exclude">find-property</span>, this time with the <span class="my-code" decode="exclude">'b-export-name</span> key:</p></div><div class="filebox" anchorize="false"><div class="filename" anchorize="false" decode="exclude">basic/expander.rkt</div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_aKsBM&quot;)"></div><div class="highlight-container" id="a_aKsBM"><div id="code_62" form="false" decode="exclude" style="font-size:0;width:0;height:0">#lang br/quicklang<br/>(require "struct.rkt" "run.rkt" "elements.rkt" "setup.rkt")<br/>(provide (rename-out [b-module-begin #%module-begin])<br/>         (all-from-out "elements.rkt"))<br/><br/>(define-macro (b-module-begin (b-program LINE ...))<br/>  (with-pattern<br/>      ([((b-line NUM STMT ...) ...) #'(LINE ...)]<br/>       [(LINE-FUNC ...) (prefix-id "line-" #'(NUM ...))]<br/>       [(VAR-ID ...) (find-property 'b-id #'(LINE ...))]<br/>       [(IMPORT-NAME ...)<br/>        (find-property 'b-import-name #'(LINE ...))]<br/>       [(EXPORT-NAME ...)<br/>        (find-property 'b-export-name #'(LINE ...))])<br/>    #'(#%module-begin<br/>       (module configure-runtime br<br/>         (require basic/setup)<br/>         (do-setup!))<br/>       (require IMPORT-NAME ...)<br/>       (provide EXPORT-NAME ...)<br/>       (define VAR-ID 0) ...<br/>       LINE ...<br/>       (define line-table<br/>         (apply hasheqv (append (list NUM LINE-FUNC) ...)))<br/>       (parameterize<br/>           ([current-output-port (basic-output-port)])<br/>         (void (run line-table))))))<br/><br/>(begin-for-syntax<br/>  (require racket/list)<br/>  (define (find-property which line-stxs)<br/>    (remove-duplicates<br/>     (for/list ([stx (in-list (stx-flatten line-stxs))]<br/>                #:when (syntax-property stx which))<br/>               stx)<br/>     #:key syntax-&gt;datum)))</div><div class="highlight" form="false" id="a_R5t0R"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36</pre></div></td><td class="code"><div class="source"><pre><span class="kn">#lang </span><span class="nn">br/quicklang</span>
<span class="hll"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._require))" class="docs" hyphens="none">require</a></span> <span class="s2">"struct.rkt"</span> <span class="s2">"run.rkt"</span> <span class="s2">"elements.rkt"</span> <span class="s2">"setup.rkt"</span><span class="p">)</span>
</span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._provide))" class="docs" hyphens="none">provide</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._rename-out))" class="docs" hyphens="none">rename-out</a></span> <span class="p">[</span><span class="n">b-module-begin</span> <span class="nb"><a href="http://docs.racket-lang.org/reference/module.html#(form._((lib._racket/private/base..rkt)._~23~25module-begin))" class="docs" hyphens="none">#%module-begin</a></span><span class="p">])</span>
         <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._all-from-out))" class="docs" hyphens="none">all-from-out</a></span> <span class="s2">"elements.rkt"</span><span class="p">))</span>

<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br/index.html#(form._((lib._br/define..rkt)._define-macro))" class="docs" hyphens="none">define-macro</a></span> <span class="p">(</span><span class="n">b-module-begin</span> <span class="p">(</span><span class="n">b-program</span> <span class="n">LINE</span> <span class="nb"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))" class="docs" hyphens="none">...</a></span><span class="p">))</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br/index.html#(form._((lib._br/syntax..rkt)._with-pattern))" class="docs" hyphens="none">with-pattern</a></span>
      <span class="p">([((</span><span class="n">b-line</span> <span class="n">NUM</span> <span class="n">STMT</span> <span class="nb"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))" class="docs" hyphens="none">...</a></span><span class="p">)</span> <span class="nb"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))" class="docs" hyphens="none">...</a></span><span class="p">)</span> <span class="o">#&#39;</span><span class="p">(</span><span class="n">LINE</span> <span class="nb"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))" class="docs" hyphens="none">...</a></span><span class="p">)]</span>
       <span class="p">[(</span><span class="n">LINE-FUNC</span> <span class="nb"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))" class="docs" hyphens="none">...</a></span><span class="p">)</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br/index.html#(def._((lib._br/syntax..rkt)._prefix-id))" class="docs" hyphens="none">prefix-id</a></span> <span class="s2">"line-"</span> <span class="o">#&#39;</span><span class="p">(</span><span class="n">NUM</span> <span class="nb"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))" class="docs" hyphens="none">...</a></span><span class="p">))]</span>
       <span class="p">[(</span><span class="n">VAR-ID</span> <span class="nb"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))" class="docs" hyphens="none">...</a></span><span class="p">)</span> <span class="p">(</span><span class="n">find-property</span> <span class="o">&#39;</span><span class="ss">b-id</span> <span class="o">#&#39;</span><span class="p">(</span><span class="n">LINE</span> <span class="nb"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))" class="docs" hyphens="none">...</a></span><span class="p">))]</span>
       <span class="p">[(</span><span class="n">IMPORT-NAME</span> <span class="nb"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))" class="docs" hyphens="none">...</a></span><span class="p">)</span>
        <span class="p">(</span><span class="n">find-property</span> <span class="o">&#39;</span><span class="ss">b-import-name</span> <span class="o">#&#39;</span><span class="p">(</span><span class="n">LINE</span> <span class="nb"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))" class="docs" hyphens="none">...</a></span><span class="p">))]</span>
<span class="hll">       <span class="p">[(</span><span class="n">EXPORT-NAME</span> <span class="nb"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))" class="docs" hyphens="none">...</a></span><span class="p">)</span>
</span><span class="hll">        <span class="p">(</span><span class="n">find-property</span> <span class="o">&#39;</span><span class="ss">b-export-name</span> <span class="o">#&#39;</span><span class="p">(</span><span class="n">LINE</span> <span class="nb"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))" class="docs" hyphens="none">...</a></span><span class="p">))])</span>
</span>    <span class="o">#&#39;</span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/module.html#(form._((lib._racket/private/base..rkt)._~23~25module-begin))" class="docs" hyphens="none">#%module-begin</a></span>
<span class="hll">       <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/module.html#(form._((quote._~23~25kernel)._module))" class="docs" hyphens="none">module</a></span> <span class="n">configure-runtime</span> <span class="n">br</span>
</span><span class="hll">         <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._require))" class="docs" hyphens="none">require</a></span> <span class="n">basic/setup</span><span class="p">)</span>
</span><span class="hll">         <span class="p">(</span><span class="n">do-setup!</span><span class="p">))</span>
</span>       <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._require))" class="docs" hyphens="none">require</a></span> <span class="n">IMPORT-NAME</span> <span class="nb"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))" class="docs" hyphens="none">...</a></span><span class="p">)</span>
<span class="hll">       <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._provide))" class="docs" hyphens="none">provide</a></span> <span class="n">EXPORT-NAME</span> <span class="nb"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))" class="docs" hyphens="none">...</a></span><span class="p">)</span>
</span>       <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="n">VAR-ID</span> <span class="mi">0</span><span class="p">)</span> <span class="nb"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))" class="docs" hyphens="none">...</a></span>
       <span class="n">LINE</span> <span class="nb"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))" class="docs" hyphens="none">...</a></span>
       <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="n">line-table</span>
         <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/procedures.html#(def._((lib._racket/private/base..rkt)._apply))" class="docs" hyphens="none">apply</a></span> <span class="nb"><a href="http://docs.racket-lang.org/reference/hashtables.html#(def._((quote._~23~25kernel)._hasheqv))" class="docs" hyphens="none">hasheqv</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._append))" class="docs" hyphens="none">append</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._list))" class="docs" hyphens="none">list</a></span> <span class="n">NUM</span> <span class="n">LINE-FUNC</span><span class="p">)</span> <span class="nb"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))" class="docs" hyphens="none">...</a></span><span class="p">)))</span>
<span class="hll">       <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/parameters.html#(form._((lib._racket/private/more-scheme..rkt)._parameterize))" class="docs" hyphens="none">parameterize</a></span>
</span><span class="hll">           <span class="p">([</span><span class="nb"><a href="http://docs.racket-lang.org/reference/port-ops.html#(def._((quote._~23~25kernel)._current-output-port))" class="docs" hyphens="none">current-output-port</a></span> <span class="p">(</span><span class="n">basic-output-port</span><span class="p">)])</span>
</span><span class="hll">         <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/void.html#(def._((quote._~23~25kernel)._void))" class="docs" hyphens="none">void</a></span> <span class="p">(</span><span class="n">run</span> <span class="n">line-table</span><span class="p">))))))</span>
</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/begin.html#(form._((quote._~23~25kernel)._begin-for-syntax))" class="docs" hyphens="none">begin-for-syntax</a></span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._require))" class="docs" hyphens="none">require</a></span> <span class="n">racket/list</span><span class="p">)</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="p">(</span><span class="n">find-property</span> <span class="n">which</span> <span class="n">line-stxs</span><span class="p">)</span>
    <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((lib._racket/list..rkt)._remove-duplicates))" class="docs" hyphens="none">remove-duplicates</a></span>
     <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/for.html#(form._((lib._racket/private/base..rkt)._for/list))" class="docs" hyphens="none">for/list</a></span> <span class="p">([</span><span class="n">stx</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/sequences.html#(def._((lib._racket/private/base..rkt)._in-list))" class="docs" hyphens="none">in-list</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br/index.html#(def._((lib._br/syntax..rkt)._stx-flatten))" class="docs" hyphens="none">stx-flatten</a></span> <span class="n">line-stxs</span><span class="p">))]</span>
                <span class="kd">#:when</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/stxprops.html#(def._((quote._~23~25kernel)._syntax-property))" class="docs" hyphens="none">syntax-property</a></span> <span class="n">stx</span> <span class="n">which</span><span class="p">))</span>
               <span class="n">stx</span><span class="p">)</span>
     <span class="kd">#:key</span> <span class="nb"><a href="http://docs.racket-lang.org/reference/stxops.html#(def._((quote._~23~25kernel)._syntax-~3edatum))" class="docs" hyphens="none">syntax-&gt;datum</a></span><span class="p">)))</span>
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpkl" data-clipboard-target="#code_62" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_ujWQe&quot;)"></div><p id="a_ujWQe">At the top of our <span class="my-code" decode="exclude">#%module-begin</span> syn­tax tem­plate, we add the <span class="my-code" decode="exclude">configure-runtime</span> sub­mod­ule that we saw ear­lier. All it does is import <span class="my-code" decode="exclude">basic/setup</span> and call <span class="my-code" decode="exclude">do-setup!</span>. <span class="tooltip" onclick="this.classList.toggle('tooltip_visible')"> + <span class="tooltip-inner">We can’t use a rel­a­tive path like <span class="my-code" decode="exclude">"setup.rkt"</span> inside the sub­mod­ule. Why not? Because this sub­mod­ule will be eval­u­ated within a source file that lives else­where in the filesys­tem. So we need a full mod­ule path.</span></span></p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_CsJmp&quot;)"></div><p id="a_CsJmp">Below that, we also add a <span class="my-code" decode="exclude">provide</span> form that con­tains our new list of <span class="my-code" decode="exclude">EXPORT-NAME ...</span> items.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_9vUXD&quot;)"></div><p id="a_9vUXD">At the bot­tom of the <span class="my-code" decode="exclude">#%module-begin</span> syn­tax tem­plate, we wrap our main pro­gram loop in <span class="my-code" decode="exclude">parameterize</span>, set­ting the <span class="my-code" decode="exclude">current-output-port</span> to our new <span class="my-code" decode="exclude">basic-output-port</span> para­me­ter.</p></div><div anchorize="false" style="height:1em"></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_341qz&quot;)"></div><p id="a_341qz">Finally, as we did for <span class="my-code" decode="exclude">b-import</span>, we need to con­vert <span class="my-code" decode="exclude">b-export</span> nodes into <span class="my-code" decode="exclude">(void)</span> expres­sions. So we update <span class="my-code" decode="exclude">"misc.rkt"</span>:</p></div><div class="filebox" anchorize="false"><div class="filename" anchorize="false" decode="exclude">basic/misc.rkt</div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_FEmeZ&quot;)"></div><div class="highlight-container" id="a_FEmeZ"><div id="code_63" form="false" decode="exclude" style="font-size:0;width:0;height:0">#lang br<br/>(require "struct.rkt" "expr.rkt")<br/>(provide b-rem b-print b-let b-input b-import b-export)<br/><br/>(define (b-rem val) (void))<br/><br/>(define (b-print . vals)<br/>  (displayln (string-append* (map ~a vals))))<br/><br/>(define-macro (b-let ID VAL) #'(set! ID VAL))<br/><br/>(define-macro (b-input ID)<br/>  #'(b-let ID (let* ([str (read-line)]<br/>                     [num (string-&gt;number (string-trim str))])<br/>                (or num str))))<br/><br/>(define-macro (b-import NAME) #'(void))<br/><br/>(define-macro (b-export NAME) #'(void))</div><div class="highlight" form="false" id="a_gvZeA"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</pre></div></td><td class="code"><div class="source"><pre><span class="kn">#lang </span><span class="nn">br</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._require))" class="docs" hyphens="none">require</a></span> <span class="s2">"struct.rkt"</span> <span class="s2">"expr.rkt"</span><span class="p">)</span>
<span class="hll"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._provide))" class="docs" hyphens="none">provide</a></span> <span class="n">b-rem</span> <span class="n">b-print</span> <span class="n">b-let</span> <span class="n">b-input</span> <span class="n">b-import</span> <span class="n">b-export</span><span class="p">)</span>
</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="p">(</span><span class="n">b-rem</span> <span class="n">val</span><span class="p">)</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/void.html#(def._((quote._~23~25kernel)._void))" class="docs" hyphens="none">void</a></span><span class="p">))</span>

<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="p">(</span><span class="n">b-print</span> <span class="o">.</span> <span class="n">vals</span><span class="p">)</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/Writing.html#(def._((lib._racket/private/misc..rkt)._displayln))" class="docs" hyphens="none">displayln</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/strings.html#(def._((lib._racket/string..rkt)._string-append*))" class="docs" hyphens="none">string-append*</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((lib._racket/private/map..rkt)._map))" class="docs" hyphens="none">map</a></span> <span class="nb"><a href="http://docs.racket-lang.org/reference/strings.html#(def._((lib._racket/format..rkt)._~7ea))" class="docs" hyphens="none">~a</a></span> <span class="n">vals</span><span class="p">))))</span>

<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br/index.html#(form._((lib._br/define..rkt)._define-macro))" class="docs" hyphens="none">define-macro</a></span> <span class="p">(</span><span class="n">b-let</span> <span class="n">ID</span> <span class="n">VAL</span><span class="p">)</span> <span class="o">#&#39;</span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/set_.html#(form._((quote._~23~25kernel)._set!))" class="docs" hyphens="none">set!</a></span> <span class="n">ID</span> <span class="n">VAL</span><span class="p">))</span>

<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br/index.html#(form._((lib._br/define..rkt)._define-macro))" class="docs" hyphens="none">define-macro</a></span> <span class="p">(</span><span class="n">b-input</span> <span class="n">ID</span><span class="p">)</span>
  <span class="o">#&#39;</span><span class="p">(</span><span class="n">b-let</span> <span class="n">ID</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let*))" class="docs" hyphens="none">let*</a></span> <span class="p">([</span><span class="n">str</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/Byte_and_String_Input.html#(def._((quote._~23~25kernel)._read-line))" class="docs" hyphens="none">read-line</a></span><span class="p">)]</span>
                     <span class="p">[</span><span class="n">num</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._string-~3enumber))" class="docs" hyphens="none">string-&gt;number</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/strings.html#(def._((lib._racket/string..rkt)._string-trim))" class="docs" hyphens="none">string-trim</a></span> <span class="n">str</span><span class="p">))])</span>
                <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/if.html#(form._((lib._racket/private/letstx-scheme..rkt)._or))" class="docs" hyphens="none">or</a></span> <span class="n">num</span> <span class="n">str</span><span class="p">))))</span>

<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br/index.html#(form._((lib._br/define..rkt)._define-macro))" class="docs" hyphens="none">define-macro</a></span> <span class="p">(</span><span class="n">b-import</span> <span class="n">NAME</span><span class="p">)</span> <span class="o">#&#39;</span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/void.html#(def._((quote._~23~25kernel)._void))" class="docs" hyphens="none">void</a></span><span class="p">))</span>

<span class="hll"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br/index.html#(form._((lib._br/define..rkt)._define-macro))" class="docs" hyphens="none">define-macro</a></span> <span class="p">(</span><span class="n">b-export</span> <span class="n">NAME</span><span class="p">)</span> <span class="o">#&#39;</span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/void.html#(def._((quote._~23~25kernel)._void))" class="docs" hyphens="none">void</a></span><span class="p">))</span>
</span></pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpkm" data-clipboard-target="#code_63" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;testing-our-exports&quot;)"></div><h3 anchor="testing-our-exports" class="subhead" id="testing-our-exports"><a href="#testing-our-exports">Test­ing our exports</a></h3></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_YmMQs&quot;)"></div><p id="a_YmMQs">Now we can test our orig­i­nal <span class="my-code" decode="exclude">"sample-exporter.rkt"</span> mod­ule:</p></div><div class="filebox" anchorize="false"><div class="filename" anchorize="false" decode="exclude">basic/sample-exporter.rkt</div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_8F9XU&quot;)"></div><div class="highlight-container" id="a_8F9XU"><div id="code_64" form="false" decode="exclude" style="font-size:0;width:0;height:0">#lang basic<br/>10 def div(num, denom) = num / denom<br/>20 x = 5 : y = 10<br/>30 print x - 4<br/>40 x = 15 : y = 30<br/>50 print div(y, x)<br/>60 x = 20<br/>70 print div((x + x + x), x)<br/>80 export div : export x</div><div class="highlight" form="false" id="a_slaip"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="source"><pre>#lang basic
<span class="nl">10</span><span class="w"> </span><span class="vg">def</span><span class="w"> </span><span class="vg">div</span><span class="p">(</span><span class="vg">num</span><span class="p">,</span><span class="w"> </span><span class="vg">denom</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="vg">num</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="vg">denom</span>
<span class="nl">20</span><span class="w"> </span><span class="vg">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="il">5</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="vg">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="il">10</span>
<span class="nl">30</span><span class="w"> </span><span class="vg">print</span><span class="w"> </span><span class="vg">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="il">4</span>
<span class="nl">40</span><span class="w"> </span><span class="vg">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="il">15</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="vg">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="il">30</span>
<span class="nl">50</span><span class="w"> </span><span class="vg">print</span><span class="w"> </span><span class="vg">div</span><span class="p">(</span><span class="vg">y</span><span class="p">,</span><span class="w"> </span><span class="vg">x</span><span class="p">)</span>
<span class="nl">60</span><span class="w"> </span><span class="vg">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="il">20</span>
<span class="nl">70</span><span class="w"> </span><span class="vg">print</span><span class="w"> </span><span class="vg">div</span><span class="p">((</span><span class="vg">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="vg">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="vg">x</span><span class="p">),</span><span class="w"> </span><span class="vg">x</span><span class="p">)</span>
<span class="nl">80</span><span class="w"> </span><span class="vg">export</span><span class="w"> </span><span class="vg">div</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="vg">export</span><span class="w"> </span><span class="vg">x</span>
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpkn" data-clipboard-target="#code_64" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_z1L49&quot;)"></div><p id="a_z1L49">If we did every­thing right, when we run this pro­gram directly, it will dis­play its out­put nor­mally:</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_RERvdq&quot;)"></div><div class="highlight-container" id="a_RERvdq"><div id="code_65" form="false" decode="exclude" style="font-size:0;width:0;height:0">1<br/>2<br/>3</div><div class="highlight" form="false" id="a_BnGggo"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="source"><pre>1
2
3
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpkp" data-clipboard-target="#code_65" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_7q6aR&quot;)"></div><p id="a_7q6aR">What a relief. We should also be able to import the mod­ule. This time, we expect the <span class="my-code" decode="exclude">1 2 3</span> out­put will be sup­pressed, and we’ll only see the out­put from <span class="my-code" decode="exclude">"sample-importer.rkt"</span>:</p></div><div class="filebox" anchorize="false"><div class="filename" anchorize="false" decode="exclude">basic/sample-importer.rkt</div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_xO3fut&quot;)"></div><div class="highlight-container" id="a_xO3fut"><div id="code_66" form="false" decode="exclude" style="font-size:0;width:0;height:0">#lang br<br/>(require basic/sample-exporter)<br/>div<br/>x<br/>(div x 10)</div><div class="highlight" form="false" id="a_g6JRgr"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="source"><pre><span class="kn">#lang </span><span class="nn">br</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._require))" class="docs" hyphens="none">require</a></span> <span class="n">basic/sample-exporter</span><span class="p">)</span>
<span class="n">div</span>
<span class="n">x</span>
<span class="p">(</span><span class="n">div</span> <span class="n">x</span> <span class="mi">10</span><span class="p">)</span>
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpks" data-clipboard-target="#code_66" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_6XRGMw&quot;)"></div><div class="highlight-container" id="a_6XRGMw"><div id="code_67" form="false" decode="exclude" style="font-size:0;width:0;height:0">#&lt;procedure:div&gt;<br/>20<br/>2</div><div class="highlight" form="false" id="a_109jmu"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="source"><pre>#&lt;procedure:div&gt;
20
2
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpkv" data-clipboard-target="#code_67" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_WtJTq&quot;)"></div><p id="a_WtJTq">Very nice. Let’s also check that try­ing to export an unde­fined iden­ti­fier gives us the error we were hop­ing for:</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_5Szzbz&quot;)"></div><div class="highlight-container" id="a_5Szzbz"><div id="code_68" form="false" decode="exclude" style="font-size:0;width:0;height:0">#lang basic<br/>10 export x</div><div class="highlight" form="false" id="a_0e6nXx"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="source"><pre>#lang basic
<span class="nl">10</span><span class="w"> </span><span class="vg">export</span><span class="w"> </span><span class="vg">x</span>
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpky" data-clipboard-target="#code_68" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_ir9alC&quot;)"></div><div class="highlight-container err" id="a_ir9alC"><div id="code_69" form="false" decode="exclude" style="font-size:0;width:0;height:0">module: provided identifier not defined or imported for phase 0 in: x</div><div class="highlight" form="false" id="a_j4hr8A"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="source"><pre>module: provided identifier not defined or imported for phase 0 in: x
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_VldpkB" data-clipboard-target="#code_69" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_CPF90&quot;)"></div><p id="a_CPF90">Though we had to take a slightly scenic route, our exports work the way we hoped.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_Trvc3&quot;)"></div><p id="a_Trvc3">For­tu­nately, every­thing we learned about the <span class="my-code" decode="exclude">configure-runtime</span> will be use­ful in the next sec­tion, where we repro­gram <a href="the-repl.html">the REPL</a>.</p></div><div anchorize="false" style="height:2em"></div><ul class="siblinks"><li><a href="intro.html">1&emsp;intro</a></li><li><a href="specification-and-setup.html">2&emsp;spec­i­fi­ca­tion and setup</a></li><li><a href="functions.html">3&emsp;func­tions</a></li><li><a href="imports.html">4&emsp;imports</a></li><li><a class="here" href="exports.html">5&emsp;exports</a></li><li><a href="the-repl.html">6&emsp;the repl</a></li><li><a href="command-line-arguments.html">7&emsp;com­mand-line argu­ments</a></li><li><a href="recap.html">8&emsp;recap</a></li><li><a href="source-listing.html">9&emsp;source list­ing</a></li></ul></div>
    <a class="nav-left" href="imports.html">← prev</a>
    <a class="nav-right" href="the-repl.html">next →</a>




</body>

<script type="text/javascript">



function show_all_forms() {
 var elems = document.getElementsByClassName('has_form');
 for (var i = 0 ; i < elems.length ; i++) {
  toggle_form(elems[i].id);
 }
}

// for debugging forms only: uncomment next line
// show_all_forms();

// sets up copy-to-clipboard buttons in code boxes
var clipboard = new Clipboard('.copy-button');
clipboard.on('success', function(e) {console.log(e);});
clipboard.on('error', function(e) {console.log(e);});
</script>