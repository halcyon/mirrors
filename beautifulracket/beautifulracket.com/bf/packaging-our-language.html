<!DOCTYPE html>
<html>
  
<!-- Mirrored from beautifulracket.com/bf/packaging-our-language.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 16 Mar 2017 05:47:16 GMT -->
<head>
    <meta charset="UTF-8">
    <title>Beautiful Racket: Follow the grammar: bf</title>
    <link rel="stylesheet" type="text/css" media="all" href="../styles.css"/>
    <script type="text/javascript" src="../functions.js"></script>
    <script type="text/javascript" src="../clipboard.min.js"></script>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-74684045-1', 'auto');
      ga('send', 'pageview');
    </script>
  </head>
<body>
<div id="alert">Thank you for your comment</div>
    <div id="doc"><h3 class="dept" anchorize="false"><a href="../index.html">Beau­ti­ful Racket</a> / <a href="../index.html#tutorials">tuto­ri­als</a></h3><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;follow-the-grammar-bf&quot;)"></div><h1 anchor="follow-the-grammar-bf" id="follow-the-grammar-bf" hyphens="none">Follow the grammar: <span class="my-code" decode="exclude">bf</span></h1></div><ul class="siblinks"><li><a href="intro.html">1&emsp;intro</a></li><li><a href="grammars-and-parsers.html">2&emsp;gram­mars and parsers</a></li><li><a href="grammar-notation.html">3&emsp;gram­mar nota­tion</a></li><li><a href="the-parser.html">4&emsp;the parser</a></li><li><a href="the-tokenizer-and-reader.html">5&emsp;the tok­enizer and reader</a></li><li><a href="an-imperative-expander.html">6&emsp;an imper­a­tive expander</a></li><li><a href="a-functional-expander.html">7&emsp;a func­tional expander</a></li><li><a class="here" href="packaging-our-language.html">8&emsp;pack­ag­ing our lan­guage</a></li><li><a href="recap.html">9&emsp;recap</a></li><li><a href="source-listing.html">10&emsp;source list­ing</a></li></ul><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_TQw0P&quot;)"></div><div class="author-note" id="a_TQw0P"><p anchorize="false">If you opted for <a href="../setup.html#quick-setup">Quick Setup</a> at the out­set, you can go no fur­ther. This next part relies on Racket’s com­mand-line tools. You’ll need to com­plete the <a href="../setup.html#full-setup">Full Setup</a> to con­tinue.</p></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;packaging-our-language&quot;)"></div><h3 anchor="packaging-our-language" class="subhead" id="packaging-our-language"><a href="#packaging-our-language">Pack­ag­ing our lan­guage</a></h3></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_iO4dg&quot;)"></div><p id="a_iO4dg">Now that we have a taste for <span class="my-code" decode="exclude">bf</span> pro­gram­ming, we might want to use our inter­preter more freely. The <span class="my-code" decode="exclude">#lang reader "reader.rkt"</span> boot­strap­ping only works for source files that are stored in the same direc­tory. What a drag. We’d rather be able to invoke our lan­guage within a source file any­where as <span class="my-code" decode="exclude">#lang bf</span>.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_KIJED&quot;)"></div><p id="a_KIJED">To do this, we need to install our code as a <em><a class="glossary" href="../appendix/glossary.html#package"><span class="glossary-link-text">pack­age</span></a></em>. A pack­age is Racket’s basic unit of instal­lable soft­ware. The <span class="my-code" decode="exclude">#lang</span> nota­tion at the top of a source file coop­er­ates with the pack­age sys­tem: when we write <span class="my-code" decode="exclude">#lang <em>name</em></span>, Racket tries to find <span class="my-code" decode="exclude"><em>name</em></span> among our installed pack­ages. (Con­versely, until we install our lan­guage as a pack­age, we have to keep using the <span class="my-code" decode="exclude">#lang reader <em>path</em></span> form.)</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_lWGWe&quot;)"></div><p id="a_lWGWe">Here’s how we install our project as pack­age:</p></div><ol><li><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_tZANj&quot;)"></div><p id="a_tZANj">We cre­ate a direc­tory for our pack­age. For now, the name of the direc­tory needs to match what we use in the <span class="my-code" decode="exclude">#lang <em>name</em></span> form. Since we want to invoke our inter­preter as <span class="my-code" decode="exclude">#lang bf</span>, we’ll call our pack­age direc­tory <span class="my-code" decode="exclude">bf</span>. <span class="tooltip" onclick="this.classList.toggle('tooltip_visible')"> + <span class="tooltip-inner">It’s pos­si­ble to make the pack­age name and the <span class="my-code" decode="exclude">#lang</span> name dif­fer­ent. We’ll see how to do this in a <a href="../jsonic-3/the-info.rkt-file.html">later tuto­r­ial</a>.</span></span> Cre­ate this direc­tory some­where con­ve­nient. </p></div></li><li><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_Lq7O2&quot;)"></div><p id="a_Lq7O2">We move our three mod­ules—<span class="my-code" decode="exclude">"parser.rkt"</span>, <span class="my-code" decode="exclude">"reader.rkt"</span>, and <span class="my-code" decode="exclude">"expander.rkt"</span>—into this new <span class="my-code" decode="exclude">bf</span> direc­tory.</p></div></li><li><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_966ex&quot;)"></div><p id="a_966ex">When we invoke <span class="my-code" decode="exclude">#lang bf</span>, Racket will look for a <span class="my-code" decode="exclude">"main.rkt"</span> mod­ule in the <span class="my-code" decode="exclude">bf</span> direc­tory. In that mod­ule, it will expect to find a <span class="my-code" decode="exclude">reader</span> sub­mod­ule that pro­vides our <span class="my-code" decode="exclude">read-syntax</span> func­tion. If we wanted, we could put our actual <span class="my-code" decode="exclude">read-syntax</span> code there. But it’s just as easy to just use <span class="my-code" decode="exclude">require</span> and <span class="my-code" decode="exclude">provide</span> within the <span class="my-code" decode="exclude">reader</span> sub­mod­ule:</p></div><div class="filebox" anchorize="false"><div class="filename" anchorize="false" decode="exclude">main.rkt</div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_5snmO&quot;)"></div><div class="highlight-container" id="a_5snmO"><div id="code_43" form="false" decode="exclude" style="font-size:0;width:0;height:0">#lang br/quicklang<br/>(module reader br<br/>  (require "reader.rkt")<br/>  (provide read-syntax))
</div><div class="highlight" form="false" id="a_ssPlz"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="source"><pre><span class="kn">#lang </span><span class="nn">br/quicklang</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/module.html#(form._((quote._~23~25kernel)._module))" class="docs" hyphens="none">module</a></span> <span class="n">reader</span> <span class="n">br</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._require))" class="docs" hyphens="none">require</a></span> <span class="s2">"reader.rkt"</span><span class="p">)</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._provide))" class="docs" hyphens="none">provide</a></span> <span class="nb"><a href="http://docs.racket-lang.org/reference/Reading.html#(def._((quote._~23~25kernel)._read-syntax))" class="docs" hyphens="none">read-syntax</a></span><span class="p">))</span>
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpk" data-clipboard-target="#code_43" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_qfDwD&quot;)"></div><p id="a_qfDwD">We also need to adjust our <span class="my-code" decode="exclude">read-syntax</span> func­tion in <span class="my-code" decode="exclude">"reader.rkt"</span>. The mod­ule code returned by this func­tion refers to <span class="my-code" decode="exclude">"expander.rkt"</span>. This is a rel­a­tive path string, which won’t be valid once we start mak­ing <span class="my-code" decode="exclude">bf</span> source files in other direc­to­ries. Instead, we ref­er­ence the expander using its new pack­age name, <span class="my-code" decode="exclude">bf/expander</span> (as a mod­ule path, it loses its <span class="my-code" decode="exclude">.rkt</span> exten­sion):</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_CcUvG&quot;)"></div><div class="highlight-container" id="a_CcUvG"><div id="code_44" form="false" decode="exclude" style="font-size:0;width:0;height:0">(define (read-syntax path port)<br/>  (define parse-tree (parse path (tokenize port)))<br/>  (define module-datum `(module bf-mod bf/expander<br/>                          ,parse-tree))<br/>  (datum-&gt;syntax #f module-datum))</div><div class="highlight" form="false" id="a_B6wAH"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="source"><pre><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/Reading.html#(def._((quote._~23~25kernel)._read-syntax))" class="docs" hyphens="none">read-syntax</a></span> <span class="n">path</span> <span class="n">port</span><span class="p">)</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="n">parse-tree</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(def._((lib._brag/examples/nested-word-list..rkt)._parse))" class="docs" hyphens="none">parse</a></span> <span class="n">path</span> <span class="p">(</span><span class="n">tokenize</span> <span class="n">port</span><span class="p">)))</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="n">module-datum</span> <span class="o">`</span><span class="p">(</span><span class="ss">module</span> <span class="ss">bf-mod</span> <span class="ss">bf/expander</span>
                          <span class="o">,</span><span class="n">parse-tree</span><span class="p">))</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/stxops.html#(def._((quote._~23~25kernel)._datum-~3esyntax))" class="docs" hyphens="none">datum-&gt;syntax</a></span> <span class="no">#f</span> <span class="n">module-datum</span><span class="p">))</span>
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpk1" data-clipboard-target="#code_44" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_R78VX&quot;)"></div><p id="a_R78VX">By the way, we could change the other mod­ule ref­er­ences in our code to use this new pack­age nota­tion. For instance, in <span class="my-code" decode="exclude">"reader.rkt"</span> we could <span class="my-code" decode="exclude">require</span> <span class="my-code" decode="exclude">bf/parser</span> rather than <span class="my-code" decode="exclude">"parser.rkt"</span>. But it’s unnec­es­sary, because those files will remain in the same direc­tory, so they can use local path strings.</p></div></li><li><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_kBGfp&quot;)"></div><p id="a_kBGfp">Finally, we use Racket’s com­mand-line pro­gram <span class="my-code" decode="exclude">raco</span> to install our pack­age. In a ter­mi­nal win­dow, we’ll move into our new <span class="my-code" decode="exclude">bf</span> direc­tory and do <span class="my-code" decode="exclude">raco pkg install</span>:</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_tufsg&quot;)"></div><div class="highlight-container" id="a_tufsg"><div id="code_45" form="false" decode="exclude" style="font-size:0;width:0;height:0">&gt; cd path/to/bf<br/>&gt; raco pkg install</div><div class="highlight" form="false" id="a_69Y8E"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="source"><pre>&gt; cd path/to/bf
&gt; raco pkg install
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpk2" data-clipboard-target="#code_45" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_6VsJR&quot;)"></div><p id="a_6VsJR">This will trig­ger a flurry of sta­tus mes­sages as Racket updates our instal­la­tion.</p></div></li><li><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_ZldZj&quot;)"></div><p id="a_ZldZj">If there are no errors, we can go back to DrRacket and test that our pack­age works by writ­ing a <span class="my-code" decode="exclude">#lang bf</span> pro­gram:</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_Hogt7&quot;)"></div><div class="highlight-container" id="a_Hogt7"><div id="code_46" form="false" decode="exclude" style="font-size:0;width:0;height:0">#lang bf<br/>Greatest language ever!<br/>++++++++[&gt;++++++++&lt;-]&gt;.</div><div class="highlight" form="false" id="a_KDKuT"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="source"><pre>#lang bf
<span class="c">Greatest language ever!</span>
<span class="nb">++++++++</span><span class="k">[</span><span class="nv">&gt;</span><span class="nb">++++++++</span><span class="nv">&lt;</span><span class="nb">-</span><span class="k">]</span><span class="nv">&gt;</span><span class="nt">.</span><span class="c"></span>
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpk3" data-clipboard-target="#code_46" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_vXFJF&quot;)"></div><div class="highlight-container" id="a_vXFJF"><div id="code_47" form="false" decode="exclude" style="font-size:0;width:0;height:0">@</div><div class="highlight" form="false" id="a_HzK2V"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="source"><pre>@
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpk4" data-clipboard-target="#code_47" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div></li><li><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_gyLsC&quot;)"></div><p id="a_gyLsC">If we ever want to delete the pack­age, we can do</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_NnuHk&quot;)"></div><div class="highlight-container" id="a_NnuHk"><div id="code_48" form="false" decode="exclude" style="font-size:0;width:0;height:0">&gt; raco pkg remove bf</div><div class="highlight" form="false" id="a_cV1uV"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="source"><pre>&gt; raco pkg remove bf
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpk5" data-clipboard-target="#code_48" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div></li><li><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_nwzpe&quot;)"></div><p id="a_nwzpe">If we want to rename the pack­age, we can delete it, rename the direc­tory, update the name of the expander in <span class="my-code" decode="exclude">read-syntax</span>, and then rein­stall it using the pro­ce­dure above.</p></div></li></ol><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_RmO90&quot;)"></div><p id="a_RmO90">We waited until the end of our <span class="my-code" decode="exclude">bf</span> project to install it as a pack­age. Could we have done this at the begin­ning? Sure. Once we install a project as a pack­age, we can still work on the mod­ules inside. Over­all, there’s a tiny bit more house­keep­ing involved with a pack­age, but the <span class="my-code" decode="exclude">#lang <em>name</em></span> nota­tion is con­ve­nient.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_ix4mh&quot;)"></div><p id="a_ix4mh">We’ve only scratched the sur­face of pack­ages. In a <a href="../jsonic-3/index.html">later tuto­r­ial</a>, we’ll see how we can add doc­u­men­ta­tion and tests to a Racket pack­age, and dis­trib­ute it to oth­ers using Racket’s online pack­age server.</p></div><div anchorize="false" style="height:2em"></div><ul class="siblinks"><li><a href="intro.html">1&emsp;intro</a></li><li><a href="grammars-and-parsers.html">2&emsp;gram­mars and parsers</a></li><li><a href="grammar-notation.html">3&emsp;gram­mar nota­tion</a></li><li><a href="the-parser.html">4&emsp;the parser</a></li><li><a href="the-tokenizer-and-reader.html">5&emsp;the tok­enizer and reader</a></li><li><a href="an-imperative-expander.html">6&emsp;an imper­a­tive expander</a></li><li><a href="a-functional-expander.html">7&emsp;a func­tional expander</a></li><li><a class="here" href="packaging-our-language.html">8&emsp;pack­ag­ing our lan­guage</a></li><li><a href="recap.html">9&emsp;recap</a></li><li><a href="source-listing.html">10&emsp;source list­ing</a></li></ul></div>
    <a class="nav-left" href="a-functional-expander.html">← prev</a>
    <a class="nav-right" href="recap.html">next →</a>




</body>

<script type="text/javascript">



function show_all_forms() {
 var elems = document.getElementsByClassName('has_form');
 for (var i = 0 ; i < elems.length ; i++) {
  toggle_form(elems[i].id);
 }
}

// for debugging forms only: uncomment next line
// show_all_forms();

// sets up copy-to-clipboard buttons in code boxes
var clipboard = new Clipboard('.copy-button');
clipboard.on('success', function(e) {console.log(e);});
clipboard.on('error', function(e) {console.log(e);});
</script>