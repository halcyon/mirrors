<!DOCTYPE html>
<html>
  
<!-- Mirrored from beautifulracket.com/bf/the-tokenizer-and-reader.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 16 Mar 2017 05:47:16 GMT -->
<head>
    <meta charset="UTF-8">
    <title>Beautiful Racket: Follow the grammar: bf</title>
    <link rel="stylesheet" type="text/css" media="all" href="../styles.css"/>
    <script type="text/javascript" src="../functions.js"></script>
    <script type="text/javascript" src="../clipboard.min.js"></script>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-74684045-1', 'auto');
      ga('send', 'pageview');
    </script>
  </head>
<body>
<div id="alert">Thank you for your comment</div>
    <div id="doc"><h3 class="dept" anchorize="false"><a href="../index.html">Beau­ti­ful Racket</a> / <a href="../index.html#tutorials">tuto­ri­als</a></h3><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;follow-the-grammar-bf&quot;)"></div><h1 anchor="follow-the-grammar-bf" id="follow-the-grammar-bf" hyphens="none">Follow the grammar: <span class="my-code" decode="exclude">bf</span></h1></div><ul class="siblinks"><li><a href="intro.html">1&emsp;intro</a></li><li><a href="grammars-and-parsers.html">2&emsp;gram­mars and parsers</a></li><li><a href="grammar-notation.html">3&emsp;gram­mar nota­tion</a></li><li><a href="the-parser.html">4&emsp;the parser</a></li><li><a class="here" href="the-tokenizer-and-reader.html">5&emsp;the tok­enizer and reader</a></li><li><a href="an-imperative-expander.html">6&emsp;an imper­a­tive expander</a></li><li><a href="a-functional-expander.html">7&emsp;a func­tional expander</a></li><li><a href="packaging-our-language.html">8&emsp;pack­ag­ing our lan­guage</a></li><li><a href="recap.html">9&emsp;recap</a></li><li><a href="source-listing.html">10&emsp;source list­ing</a></li></ul><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;introducing-the-tokenizer&quot;)"></div><h3 anchor="introducing-the-tokenizer" class="subhead" id="introducing-the-tokenizer"><a href="#introducing-the-tokenizer">Intro­duc­ing the tok­enizer</a></h3></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_27uCf&quot;)"></div><p id="a_27uCf">Though it’s essen­tially true that the parser takes a string of source code as input, we glossed over a detail. It’s more pre­cise to say that the parser takes as input a sequence of <em><a class="glossary" href="../appendix/glossary.html#token"><span class="glossary-link-text">tokens</span></a></em>. A token is the small­est mean­ing­ful chunk of a string of source code. A source string is con­verted to tokens with a func­tion called a <em><a class="glossary" href="../appendix/glossary.html#tokenizer"><span class="glossary-link-text">tok­enizer</span></a></em> that sits between the source string and the parser.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_7siJF&quot;)"></div><p id="a_7siJF">Strictly speak­ing, a tok­enizer is optional. If we don’t use a tok­enizer, then every char­ac­ter that appears in our source code counts as a token, and thus also has to appear in our gram­mar.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_MdBJY&quot;)"></div><p id="a_MdBJY">For that rea­son, a tok­enizer is often con­ve­nient, because it reduces the num­ber of dis­tinct tokens we have to han­dle in our gram­mar. Because of this, the tok­enizer and parser aren’t fully inde­pen­dent. Rather, the tok­enizer gives us options for allo­cat­ing the labor.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_Log9s&quot;)"></div><p id="a_Log9s">For instance, some tasks are more eas­ily han­dled with a tok­enizer:</p></div><ol><li><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_Wp1Xw&quot;)"></div><p id="a_Wp1Xw">Strings in the source code that are mean­ing­less—e.g., those that rep­re­sent com­ments—can be removed.</p></div></li><li><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_ui4De&quot;)"></div><p id="a_ui4De">Strings that rep­re­sent a type of value—e.g., those that rep­re­sent num­bers—can be labeled with a generic token type, like <span class="my-code" decode="exclude">NUMBER</span>. This sim­pli­fies the gram­mar, as we can just use <span class="my-code" decode="exclude">NUMBER</span> to mean any num­ber string, rather than hav­ing to make gram­mar rules that cover every pos­si­ble num­ber pat­tern, e.g., <span class="my-code" decode="exclude">23.8</span>, <span class="my-code" decode="exclude">3/4</span>, <span class="my-code" decode="exclude">42+3i</span>.</p></div></li><li><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_pkq8b&quot;)"></div><p id="a_pkq8b">Strings that should be han­dled lit­er­ally—e.g., a sin­gle char­ac­ter like <span class="my-code" decode="exclude">&lt;</span> rep­re­sent­ing an oper­a­tion—can just pass through.</p></div></li></ol><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_qlWda&quot;)"></div><p id="a_qlWda">Recall our zip-code gram­mar:</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_54Bvp&quot;)"></div><div class="highlight-container" id="a_54Bvp"><div id="code_43" form="false" decode="exclude" style="font-size:0;width:0;height:0">zip-code : digit digit digit digit digit<br/>digit    : "0" | "1" | "2" | "3" | "4"<br/>         | "5" | "6" | "7" | "8" | "9"</div><div class="highlight" form="false" id="a_jvMG2"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="source"><pre>zip-code : digit digit digit digit digit
digit    : "0" | "1" | "2" | "3" | "4"
         | "5" | "6" | "7" | "8" | "9"
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpk" data-clipboard-target="#code_43" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_TAbzC&quot;)"></div><p id="a_TAbzC">The tok­enizer gets a string as input (or a <a class="glossary" href="../appendix/glossary.html#port"><span class="glossary-link-text">port</span></a> point­ing at a string), so any func­tion that we can use with a string can be used in the tok­enizer. Here, we could use a reg­u­lar expres­sion to match the strings <span class="my-code" decode="exclude">"0"</span> through <span class="my-code" decode="exclude">"9"</span> and con­vert each of these to the token type <span class="my-code" decode="exclude">DIGIT-TOKEN</span>. We could then rewrite our gram­mar like this:</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_IthpM&quot;)"></div><div class="highlight-container" id="a_IthpM"><div id="code_44" form="false" decode="exclude" style="font-size:0;width:0;height:0">zip-code : digit digit digit digit digit<br/>digit    : DIGIT-TOKEN</div><div class="highlight" form="false" id="a_af2Am"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="source"><pre>zip-code : digit digit digit digit digit
digit    : DIGIT-TOKEN
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpk1" data-clipboard-target="#code_44" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_n0Ene&quot;)"></div><p id="a_n0Ene">The parse tree for a zip code like <span class="my-code" decode="exclude">01234</span> will look the same:</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_vQQzi&quot;)"></div><div class="highlight-container" id="a_vQQzi"><div id="code_45" form="false" decode="exclude" style="font-size:0;width:0;height:0">'(zip-code<br/>  (digit "0")<br/>  (digit "1")<br/>  (digit "2")<br/>  (digit "3")<br/>  (digit "4"))</div><div class="highlight" form="false" id="a_QPCny"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="source"><pre><span class="o">&#39;</span><span class="p">(</span><span class="ss">zip-code</span>
  <span class="p">(</span><span class="ss">digit</span> <span class="s2">"0"</span><span class="p">)</span>
  <span class="p">(</span><span class="ss">digit</span> <span class="s2">"1"</span><span class="p">)</span>
  <span class="p">(</span><span class="ss">digit</span> <span class="s2">"2"</span><span class="p">)</span>
  <span class="p">(</span><span class="ss">digit</span> <span class="s2">"3"</span><span class="p">)</span>
  <span class="p">(</span><span class="ss">digit</span> <span class="s2">"4"</span><span class="p">))</span>
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpk2" data-clipboard-target="#code_45" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_flbWQ&quot;)"></div><p id="a_flbWQ">In that way, the tok­enizer can hide details about the source string that the gram­mar doesn’t need to care about.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_nn7iM&quot;)"></div><p id="a_nn7iM">What’s the down­side of a tok­enizer?</p></div><ul><li><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_u3fFo&quot;)"></div><p id="a_u3fFo">Sub­strings from the source code that are removed (like com­ments) are then com­pletely invis­i­ble to the parser.</p></div></li><li><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_AK9Dq&quot;)"></div><p id="a_AK9Dq">Tokens are indi­vis­i­ble. Once we fuse a sub­string into a token, it can’t be decom­posed fur­ther by the parser.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_fJk2Y&quot;)"></div><p id="a_fJk2Y">For instance, we could put a reg­u­lar expres­sion inside the tok­enizer to match five sequen­tial dig­its, and then pack­age them into the token type <span class="my-code" decode="exclude">FIVE-DIGIT-TOKEN</span>. Then we could update our gram­mar to look like this:</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_po00i&quot;)"></div><div class="highlight-container" id="a_po00i"><div id="code_46" form="false" decode="exclude" style="font-size:0;width:0;height:0">zip-code : FIVE-DIGIT-TOKEN</div><div class="highlight" form="false" id="a_sk9IF"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="source"><pre>zip-code : FIVE-DIGIT-TOKEN
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpk3" data-clipboard-target="#code_46" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_tfRgS&quot;)"></div><p id="a_tfRgS">This isn’t wrong. But our parse tree would now look like this, which might be less detail than we need:</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_ee0XU&quot;)"></div><div class="highlight-container" id="a_ee0XU"><div id="code_47" form="false" decode="exclude" style="font-size:0;width:0;height:0">'(zip-code "01234")</div><div class="highlight" form="false" id="a_p6cKM"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="source"><pre>&#39;(zip-code "01234")
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpk4" data-clipboard-target="#code_47" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_ciTVQ&quot;)"></div><p id="a_ciTVQ">Big­ger tokens can be con­ve­nient, because they reduce the com­plex­ity of the gram­mar. But they also reduce its flex­i­bil­ity. Sup­pose we wanted to upgrade our zip-code gram­mar to cover nine-digit zip codes (= five dig­its, opti­nally fol­lowed by a hyphen and four more dig­its). We wouldn’t be able to do it with <span class="my-code" decode="exclude">FIVE-DIGIT-TOKEN</span>, because it’s not gran­u­lar enough. But we could do it with <span class="my-code" decode="exclude">DIGIT-TOKEN</span>:</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_5lrU2&quot;)"></div><div class="highlight-container" id="a_5lrU2"><div id="code_48" form="false" decode="exclude" style="font-size:0;width:0;height:0">zip-code     : five-digits [("-" four-digits)]<br/>five-digits  : digit digit digit digit digit<br/>four-digits  : digit digit digit digit<br/>digit        : DIGIT-TOKEN</div><div class="highlight" form="false" id="a_08l06"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="source"><pre>zip-code     : five-digits [("-" four-digits)]
five-digits  : digit digit digit digit digit
four-digits  : digit digit digit digit
digit        : DIGIT-TOKEN
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpk5" data-clipboard-target="#code_48" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div></li></ul><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_fIgzH&quot;)"></div><p id="a_fIgzH">All that said, the divi­sion of labor between parser and tok­enizer is more art than sci­ence. We can use the tok­enizer in what­ever way makes the most sense for a given lan­guage.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;designing-the-bf-tokenizer&quot;)"></div><h3 anchor="designing-the-bf-tokenizer" class="subhead" id="designing-the-bf-tokenizer"><a href="#designing-the-bf-tokenizer">Design­ing the BF tok­enizer</a></h3></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_TV1iV&quot;)"></div><p id="a_TV1iV">Let’s recall our <span class="my-code" decode="exclude">bf</span> gram­mar:</p></div><div class="filebox" anchorize="false"><div class="filename" anchorize="false" decode="exclude">parser.rkt</div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_mqxaR&quot;)"></div><div class="highlight-container" id="a_mqxaR"><div id="code_49" form="false" decode="exclude" style="font-size:0;width:0;height:0">#lang brag<br/>bf-program : (bf-op | bf-loop)*<br/>bf-op      : "&gt;" | "&lt;" | "+" | "-" | "." | ","<br/>bf-loop    : "[" (bf-op | bf-loop)* "]"</div><div class="highlight" form="false" id="a_LGaA2"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="source"><pre><span class="kn">#lang </span><span class="nn">brag</span>
<span class="n">bf-program</span> <span class="n">:</span> <span class="p">(</span><span class="n">bf-op</span> <span class="n">| bf-loop)*</span>
<span class="n">bf-op      : "&gt;" |</span> <span class="s2">"&lt;"</span> <span class="n">| "+" |</span> <span class="s2">"-"</span> <span class="n">| "." |</span> <span class="s2">","</span>
<span class="n">bf-loop</span>    <span class="n">:</span> <span class="s2">"["</span> <span class="p">(</span><span class="n">bf-op</span> <span class="err">|</span> <span class="n">bf-loop</span><span class="p">)</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._*))" class="docs" hyphens="none">*</a></span> <span class="s2">"]"</span>
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpk6" data-clipboard-target="#code_49" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_zbyzh&quot;)"></div><p id="a_zbyzh">This cap­tures the struc­ture of any <span class="my-code" decode="exclude">bf</span> pro­gram. But it omits one detail about <span class="my-code" decode="exclude">bf</span> source files: any char­ac­ters aside from the eight used in the gram­mar, includ­ing white­space, should be ignored.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_nMxKs&quot;)"></div><p id="a_nMxKs">So our tok­enizer for <span class="my-code" decode="exclude">bf</span> will be sim­ple: we’ll pass through the eight mean­ing­ful char­ac­ters intact, and toss out every­thing else.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;writing-a-reader-with-a-tokenizer&quot;)"></div><h3 anchor="writing-a-reader-with-a-tokenizer" class="subhead" id="writing-a-reader-with-a-tokenizer"><a href="#writing-a-reader-with-a-tokenizer">Writ­ing a reader with a tok­enizer</a></h3></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_H2aC5&quot;)"></div><p id="a_H2aC5">We can start assem­bling the reader for <span class="my-code" decode="exclude">bf</span>. Let’s cre­ate a file called <span class="my-code" decode="exclude">"reader.rkt"</span> in the same folder as the exist­ing <span class="my-code" decode="exclude">"parser.rkt"</span>. We need to <a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._require))" class="docs" hyphens="none">require</a> our <span class="my-code" decode="exclude">"parser.rkt"</span> mod­ule (to get access to <span class="my-code" decode="exclude">parse</span>) and add a <span class="my-code" decode="exclude">read-syntax</span> func­tion:</p></div><div class="filebox" anchorize="false"><div class="filename" anchorize="false" decode="exclude">reader.rkt</div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_7TdqX&quot;)"></div><div class="highlight-container" id="a_7TdqX"><div id="code_50" form="false" decode="exclude" style="font-size:0;width:0;height:0">#lang br/quicklang<br/>(require "parser.rkt")<br/><br/>(define (read-syntax path port)<br/>  (define parse-tree (parse path (make-tokenizer port)))<br/>  (define module-datum `(module bf-mod "expander.rkt"<br/>                          ,parse-tree))<br/>  (datum-&gt;syntax #f module-datum))<br/>(provide read-syntax)</div><div class="highlight" form="false" id="a_S05R5"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="source"><pre><span class="kn">#lang </span><span class="nn">br/quicklang</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._require))" class="docs" hyphens="none">require</a></span> <span class="s2">"parser.rkt"</span><span class="p">)</span>

<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/Reading.html#(def._((quote._~23~25kernel)._read-syntax))" class="docs" hyphens="none">read-syntax</a></span> <span class="n">path</span> <span class="n">port</span><span class="p">)</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="n">parse-tree</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(def._((lib._brag/examples/nested-word-list..rkt)._parse))" class="docs" hyphens="none">parse</a></span> <span class="n">path</span> <span class="p">(</span><span class="n">make-tokenizer</span> <span class="n">port</span><span class="p">)))</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="n">module-datum</span> <span class="o">`</span><span class="p">(</span><span class="ss">module</span> <span class="ss">bf-mod</span> <span class="s2">"expander.rkt"</span>
                          <span class="o">,</span><span class="n">parse-tree</span><span class="p">))</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/stxops.html#(def._((quote._~23~25kernel)._datum-~3esyntax))" class="docs" hyphens="none">datum-&gt;syntax</a></span> <span class="no">#f</span> <span class="n">module-datum</span><span class="p">))</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._provide))" class="docs" hyphens="none">provide</a></span> <span class="nb"><a href="http://docs.racket-lang.org/reference/Reading.html#(def._((quote._~23~25kernel)._read-syntax))" class="docs" hyphens="none">read-syntax</a></span><span class="p">)</span>
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpk7" data-clipboard-target="#code_50" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_qdESL&quot;)"></div><p id="a_qdESL">Here’s the plan:</p></div><ul><li><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_eiL13&quot;)"></div><p id="a_eiL13">Just like the <span class="my-code" decode="exclude">read-syntax</span> in <a href="../stacker/index.html"><span class="my-code" decode="exclude">stacker</span></a>—and every <span class="my-code" decode="exclude">read-syntax</span> we’ll ever write—this <span class="my-code" decode="exclude">read-syntax</span> will take as input a source <span class="my-code" decode="exclude">path</span> and input <span class="my-code" decode="exclude">port</span>.</p></div></li><li><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_cpDC8&quot;)"></div><p id="a_cpDC8">But this time, instead of man­u­ally read­ing strings of code from <span class="my-code" decode="exclude">port</span>, we pass the port to <span class="my-code" decode="exclude">make-tokenizer</span>, which returns a func­tion that reads char­ac­ters from the port and gen­er­ates tokens.</p></div></li><li><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_rNEZb&quot;)"></div><p id="a_rNEZb">In turn, we make these tokens avail­able to <span class="my-code" decode="exclude">parse</span>, which uses our gram­mar to pro­duce our <span class="my-code" decode="exclude">parse-tree</span>.</p></div></li><li><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_2vwFQ&quot;)"></div><p id="a_2vwFQ">As we did in <span class="my-code" decode="exclude">stacker</span>, we cre­ate a <span class="my-code" decode="exclude">module-datum</span> rep­re­sent­ing the code for a mod­ule, and put our parse tree inside it.</p></div></li><li><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_98yfn&quot;)"></div><p id="a_98yfn">Finally, we use <span class="my-code" decode="exclude">datum-&gt;syntax</span> to pack­age this code as a <a class="glossary" href="../appendix/glossary.html#syntax-object"><span class="glossary-link-text">syn­tax object</span></a>.</p></div></li></ul><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_Lv2Jr&quot;)"></div><p id="a_Lv2Jr">In <span class="my-code" decode="exclude">stacker</span>, we put the reader and expander in the same source file. This time we’re putting our expander in its own file. Within our mod­ule datum, we des­ig­nate <span class="my-code" decode="exclude">"expander.rkt"</span> as the path to our expander (though we still need to cre­ate that file).</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_3xHSy&quot;)"></div><p id="a_3xHSy">Next, we add our new <span class="my-code" decode="exclude">make-tokenizer</span> func­tion. We’re pass­ing <span class="my-code" decode="exclude">make-tokenizer</span> the input <span class="my-code" decode="exclude">port</span> that points to the source string. Rather than return one big pile of tokens, <span class="my-code" decode="exclude">make-tokenizer</span> cre­ates &amp; returns a func­tion called <span class="my-code" decode="exclude">next-token</span> that the parser will call repeat­edly to retrieve new tokens: <span class="tooltip" onclick="this.classList.toggle('tooltip_visible')"> + <span class="tooltip-inner">This “incre­men­tal tok­eniz­ing” approach is con­sis­tent with the idea of using a port to read from a source file incre­men­tally.</span></span></p></div><div class="filebox" anchorize="false"><div class="filename" anchorize="false" decode="exclude">reader.rkt</div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_x9Cog&quot;)"></div><div class="highlight-container" id="a_x9Cog"><div id="code_51" form="false" decode="exclude" style="font-size:0;width:0;height:0">#lang br/quicklang<br/>(require "parser.rkt")<br/><br/>(define (read-syntax path port)<br/>  (define parse-tree (parse path (make-tokenizer port)))<br/>  (define module-datum `(module bf-mod "expander.rkt"<br/>                          ,parse-tree))<br/>  (datum-&gt;syntax #f module-datum))<br/>(provide read-syntax)<br/><br/>(define (make-tokenizer port)<br/>  (define (next-token)<br/>    ···)<br/>  next-token)</div><div class="highlight" form="false" id="a_pfSnD"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="source"><pre><span class="kn">#lang </span><span class="nn">br/quicklang</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._require))" class="docs" hyphens="none">require</a></span> <span class="s2">"parser.rkt"</span><span class="p">)</span>

<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/Reading.html#(def._((quote._~23~25kernel)._read-syntax))" class="docs" hyphens="none">read-syntax</a></span> <span class="n">path</span> <span class="n">port</span><span class="p">)</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="n">parse-tree</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(def._((lib._brag/examples/nested-word-list..rkt)._parse))" class="docs" hyphens="none">parse</a></span> <span class="n">path</span> <span class="p">(</span><span class="n">make-tokenizer</span> <span class="n">port</span><span class="p">)))</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="n">module-datum</span> <span class="o">`</span><span class="p">(</span><span class="ss">module</span> <span class="ss">bf-mod</span> <span class="s2">"expander.rkt"</span>
                          <span class="o">,</span><span class="n">parse-tree</span><span class="p">))</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/stxops.html#(def._((quote._~23~25kernel)._datum-~3esyntax))" class="docs" hyphens="none">datum-&gt;syntax</a></span> <span class="no">#f</span> <span class="n">module-datum</span><span class="p">))</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._provide))" class="docs" hyphens="none">provide</a></span> <span class="nb"><a href="http://docs.racket-lang.org/reference/Reading.html#(def._((quote._~23~25kernel)._read-syntax))" class="docs" hyphens="none">read-syntax</a></span><span class="p">)</span>

<span class="hll"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="p">(</span><span class="n">make-tokenizer</span> <span class="n">port</span><span class="p">)</span>
</span><span class="hll">  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="p">(</span><span class="n">next-token</span><span class="p">)</span>
</span><span class="hll">    <span class="n">···</span><span class="p">)</span>
</span><span class="hll">  <span class="n">next-token</span><span class="p">)</span>
</span></pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpk8" data-clipboard-target="#code_51" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_foDRn&quot;)"></div><p id="a_foDRn">Finally, the tok­eniz­ing rules. This isn’t the moment for us to go deep on tok­enizer-rule nota­tion—we’ll save that for a <a href="../jsonic/the-tokenizer.html">later tuto­r­ial</a>. In short, the tok­enizer relies on a helper func­tion called a <em><a class="glossary" href="../appendix/glossary.html#lexer"><span class="glossary-link-text">lexer</span></a></em>. Each branch of the lexer rep­re­sents a rule. On the left side of the branch is a pat­tern that works like a reg­u­lar expres­sion. On the right side is a token-cre­at­ing expres­sion. Each time <span class="my-code" decode="exclude">next-token</span> is called, <span class="my-code" decode="exclude">bf-lexer</span> will read as many char­ac­ters from the <span class="my-code" decode="exclude">port</span> as it can while still match­ing a rule pat­tern (aka “greedy” match­ing). The right side of the rule will con­vert the matched char­ac­ters into a token, and this token will be returned as the result.</p></div><div class="filebox" anchorize="false"><div class="filename" anchorize="false" decode="exclude">reader.rkt</div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_uBh4F&quot;)"></div><div class="highlight-container" id="a_uBh4F"><div id="code_52" form="false" decode="exclude" style="font-size:0;width:0;height:0">#lang br/quicklang<br/>(require "parser.rkt")<br/><br/>(define (read-syntax path port)<br/>  (define parse-tree (parse path (make-tokenizer port)))<br/>  (define module-datum `(module bf-mod "expander.rkt"<br/>                          ,parse-tree))<br/>  (datum-&gt;syntax #f module-datum))<br/>(provide read-syntax)<br/><br/>(require brag/support)<br/>(define (make-tokenizer port)<br/>  (define (next-token)<br/>    (define bf-lexer<br/>      (lexer<br/>       [(eof) eof]<br/>       [(char-set "&gt;&lt;-.,+[]") lexeme]<br/>       [any-char (next-token)]))<br/>    (bf-lexer port))  <br/>  next-token)
</div><div class="highlight" form="false" id="a_YCI7q"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</pre></div></td><td class="code"><div class="source"><pre><span class="kn">#lang </span><span class="nn">br/quicklang</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._require))" class="docs" hyphens="none">require</a></span> <span class="s2">"parser.rkt"</span><span class="p">)</span>

<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/Reading.html#(def._((quote._~23~25kernel)._read-syntax))" class="docs" hyphens="none">read-syntax</a></span> <span class="n">path</span> <span class="n">port</span><span class="p">)</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="n">parse-tree</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(def._((lib._brag/examples/nested-word-list..rkt)._parse))" class="docs" hyphens="none">parse</a></span> <span class="n">path</span> <span class="p">(</span><span class="n">make-tokenizer</span> <span class="n">port</span><span class="p">)))</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="n">module-datum</span> <span class="o">`</span><span class="p">(</span><span class="ss">module</span> <span class="ss">bf-mod</span> <span class="s2">"expander.rkt"</span>
                          <span class="o">,</span><span class="n">parse-tree</span><span class="p">))</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/stxops.html#(def._((quote._~23~25kernel)._datum-~3esyntax))" class="docs" hyphens="none">datum-&gt;syntax</a></span> <span class="no">#f</span> <span class="n">module-datum</span><span class="p">))</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._provide))" class="docs" hyphens="none">provide</a></span> <span class="nb"><a href="http://docs.racket-lang.org/reference/Reading.html#(def._((quote._~23~25kernel)._read-syntax))" class="docs" hyphens="none">read-syntax</a></span><span class="p">)</span>

<span class="hll"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._require))" class="docs" hyphens="none">require</a></span> <span class="n">brag/support</span><span class="p">)</span>
</span><span class="hll"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="p">(</span><span class="n">make-tokenizer</span> <span class="n">port</span><span class="p">)</span>
</span><span class="hll">  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="p">(</span><span class="n">next-token</span><span class="p">)</span>
</span><span class="hll">    <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="n">bf-lexer</span>
</span><span class="hll">      <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._lexer))" class="docs" hyphens="none">lexer</a></span>
</span><span class="hll">       <span class="p">[(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/port-ops.html#(def._((quote._~23~25kernel)._eof))" class="docs" hyphens="none">eof</a></span><span class="p">)</span> <span class="nb"><a href="http://docs.racket-lang.org/reference/port-ops.html#(def._((quote._~23~25kernel)._eof))" class="docs" hyphens="none">eof</a></span><span class="p">]</span>
</span><span class="hll">       <span class="p">[(</span><span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._char-set))" class="docs" hyphens="none">char-set</a></span> <span class="s2">"&gt;&lt;-.,+[]"</span><span class="p">)</span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._lexeme))" class="docs" hyphens="none">lexeme</a></span><span class="p">]</span>
</span><span class="hll">       <span class="p">[</span><span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._any-char))" class="docs" hyphens="none">any-char</a></span> <span class="p">(</span><span class="n">next-token</span><span class="p">)]))</span>
</span><span class="hll">    <span class="p">(</span><span class="n">bf-lexer</span> <span class="n">port</span><span class="p">))</span>  
</span><span class="hll">  <span class="n">next-token</span><span class="p">)</span>
</span></pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpk9" data-clipboard-target="#code_52" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_p5bMu&quot;)"></div><p id="a_p5bMu">We <span class="my-code" decode="exclude">require</span> <span class="my-code" decode="exclude">brag/support</span> so we can get <a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._lexer))" class="docs" hyphens="none">lexer</a>, which man­ages the pat­tern match­ing.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_kXquI&quot;)"></div><p id="a_kXquI">When a port reaches the end of a file, it emits the spe­cial <a href="http://docs.racket-lang.org/reference/port-ops.html#(def._((quote._~23~25kernel)._eof))" class="docs" hyphens="none">eof</a> sig­nal. Thus, we always need a rule that han­dles <span class="my-code" decode="exclude">eof</span>. We’ll put that in the first branch, pass­ing it through to the parser as an <span class="my-code" decode="exclude">eof</span> token, which will stop the parser.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_80t18&quot;)"></div><p id="a_80t18">The sec­ond branch uses the lexer helper <a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._char-set))" class="docs" hyphens="none">char-set</a> to match one of our eight spe­cial <span class="my-code" decode="exclude">bf</span> char­ac­ters <span class="my-code" decode="exclude">&gt;&lt;-.,+[]</span>. We pass these through directly with the spe­cial lexer vari­able <a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._lexeme))" class="docs" hyphens="none">lexeme</a> (= need­lessly obscure word for “that thing we just matched”).</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_cDP0J&quot;)"></div><p id="a_cDP0J">The final rule uses the lexer helper <a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._any-char))" class="docs" hyphens="none">any-char</a>, which matches any other char­ac­ter—we can think of it like an <span class="my-code" decode="exclude">else</span> branch. In <span class="my-code" decode="exclude">bf</span>, these char­ac­ters should all be ignored. We can accom­plish this by call­ing <span class="my-code" decode="exclude">(next-token)</span> again, which has the effect of skip­ping to the next avail­able token.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_JD0g0&quot;)"></div><p id="a_JD0g0">That’s it. Our tok­enizer is done. There­fore, so is our reader. We’ll keep in mind that if we ever want to extend our <span class="my-code" decode="exclude">bf</span> inter­preter—for instance, to sup­port new char­ac­ters with other mean­ings—we’ll first have to adjust our <span class="my-code" decode="exclude">make-tokenizer</span> func­tion to let them through, and then update our gram­mar to han­dle them.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;testing-the-reader&quot;)"></div><h3 anchor="testing-the-reader" class="subhead" id="testing-the-reader"><a href="#testing-the-reader">Test­ing the reader</a></h3></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_iJsIk&quot;)"></div><p id="a_iJsIk">We already did a <a href="the-parser.html#converting-a-grammar-to-a-parser">quick test</a> of our parser to make sure a snip­pet of <span class="my-code" decode="exclude">bf</span> source code could be con­verted into a parse tree. Now that our reader is assem­bled, let’s make sure we get the same result from a full source file.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_2TYHB&quot;)"></div><p id="a_2TYHB">We’ll take the code for our <a href="intro.html#how-bf-works">demo pro­gram</a> and make it into a source file that relies on our new <span class="my-code" decode="exclude">bf</span> reader. As before, we’ll use the <span class="my-code" decode="exclude">#lang reader <em>path</em></span> boot­strap­ping com­mand. Save this file in the same direc­tory as <span class="my-code" decode="exclude">"reader.rkt"</span>:</p></div><div class="filebox" anchorize="false"><div class="filename" anchorize="false" decode="exclude">atsign.rkt</div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_qs9uS&quot;)"></div><div class="highlight-container" id="a_qs9uS"><div id="code_53" form="false" decode="exclude" style="font-size:0;width:0;height:0">#lang reader "reader.rkt"<br/>Greatest language ever!<br/>++++-+++-++-++[&gt;++++-+++-++-++&lt;-]&gt;.</div><div class="highlight" form="false" id="a_ihAov"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="source"><pre>#lang reader "reader.rkt"
<span class="c">Greatest language ever!</span>
<span class="nb">++++-+++-++-++</span><span class="k">[</span><span class="nv">&gt;</span><span class="nb">++++-+++-++-++</span><span class="nv">&lt;</span><span class="nb">-</span><span class="k">]</span><span class="nv">&gt;</span><span class="nt">.</span><span class="c"></span>
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpka" data-clipboard-target="#code_53" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_Z1gZG&quot;)"></div><p id="a_Z1gZG">When we run this file, we’ll get an error like this:</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_uzYM6&quot;)"></div><div class="highlight-container err" id="a_uzYM6"><div id="code_54" form="false" decode="exclude" style="font-size:0;width:0;height:0">open-input-file: cannot open module file<br/>  module path: #&lt;path:/my/dir/expander.rkt&gt;<br/>  path: /my/dir/expander.rkt<br/>  ···</div><div class="highlight" form="false" id="a_NO06e"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="source"><pre>open-input-file: cannot open module file
  module path: #&lt;path:/my/dir/expander.rkt&gt;
  path: /my/dir/expander.rkt
  ···
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpkb" data-clipboard-target="#code_54" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_WpMbL&quot;)"></div><p id="a_WpMbL">That’s a good sign. It means we’re suc­cess­fully invok­ing <span class="my-code" decode="exclude">"reader.rkt"</span>, which in turn is look­ing for <span class="my-code" decode="exclude">"expander.rkt"</span>, but can’t find it. Because we haven’t made it.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_EE4wf&quot;)"></div><p id="a_EE4wf">So let’s stub it out. As usual, our expander needs to start with a macro called <span class="my-code" decode="exclude">#%module-begin</span>. As we did in <a href="../stacker/index.html"><span class="my-code" decode="exclude">stacker</span></a>, we’ll avoid a con­flict with the <span class="my-code" decode="exclude">#%module-begin</span> already defined by <span class="my-code" decode="exclude">br/quicklang</span> by call­ing our new macro <span class="my-code" decode="exclude">bf-module-begin</span>, and then using <span class="my-code" decode="exclude">rename-out</span> to change the exported name.</p></div><div class="filebox" anchorize="false"><div class="filename" anchorize="false" decode="exclude">expander.rkt</div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_LCg3i&quot;)"></div><div class="highlight-container" id="a_LCg3i"><div id="code_55" form="false" decode="exclude" style="font-size:0;width:0;height:0">#lang br/quicklang<br/><br/>(define-macro (bf-module-begin PARSE-TREE)<br/>  #'(#%module-begin<br/>     'PARSE-TREE))<br/>(provide (rename-out [bf-module-begin #%module-begin]))</div><div class="highlight" form="false" id="a_fcKmh"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="source"><pre><span class="kn">#lang </span><span class="nn">br/quicklang</span>

<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br/index.html#(form._((lib._br/define..rkt)._define-macro))" class="docs" hyphens="none">define-macro</a></span> <span class="p">(</span><span class="n">bf-module-begin</span> <span class="n">PARSE-TREE</span><span class="p">)</span>
  <span class="o">#&#39;</span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/module.html#(form._((lib._racket/private/base..rkt)._~23~25module-begin))" class="docs" hyphens="none">#%module-begin</a></span>
     <span class="o">&#39;</span><span class="ss">PARSE-TREE</span><span class="p">))</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._provide))" class="docs" hyphens="none">provide</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._rename-out))" class="docs" hyphens="none">rename-out</a></span> <span class="p">[</span><span class="n">bf-module-begin</span> <span class="nb"><a href="http://docs.racket-lang.org/reference/module.html#(form._((lib._racket/private/base..rkt)._~23~25module-begin))" class="docs" hyphens="none">#%module-begin</a></span><span class="p">]))</span>
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpkc" data-clipboard-target="#code_55" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_gONqY&quot;)"></div><p id="a_gONqY">Look care­fully—the only work that <span class="my-code" decode="exclude">bf-module-begin</span> is doing is adding a <span class="my-code" decode="exclude">'</span> pre­fix to the <span class="my-code" decode="exclude">PARSE-TREE</span> that’s arriv­ing from the reader as our input. <a href="../stacker/the-expander.html#testing-our-expander">We did this</a> in <span class="my-code" decode="exclude">stacker</span> too—it’s a quick way to print and debug the result we’re get­ting from the reader.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_eLozG&quot;)"></div><p id="a_eLozG">Now when we run <span class="my-code" decode="exclude">"atsign.rkt"</span>, we’ll reveal the parse tree:</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_XgVMI&quot;)"></div><div class="highlight-container" id="a_XgVMI"><div id="code_56" form="false" decode="exclude" style="font-size:0;width:0;height:0">'(bf-program<br/>  (bf-op "+")<br/>  (bf-op "+")<br/>  (bf-op "+")<br/>  (bf-op "+")<br/>  (bf-op "-")<br/>  (bf-op "+")<br/>  (bf-op "+")<br/>  (bf-op "+")<br/>  (bf-op "-")<br/>  (bf-op "+")<br/>  (bf-op "+")<br/>  (bf-op "-")<br/>  (bf-op "+")<br/>  (bf-op "+")<br/>  (bf-loop<br/>   "["<br/>   (bf-op "&gt;")<br/>   (bf-op "+")<br/>   (bf-op "+")<br/>   (bf-op "+")<br/>   (bf-op "+")<br/>   (bf-op "-")<br/>   (bf-op "+")<br/>   (bf-op "+")<br/>   (bf-op "+")<br/>   (bf-op "-")<br/>   (bf-op "+")<br/>   (bf-op "+")<br/>   (bf-op "-")<br/>   (bf-op "+")<br/>   (bf-op "+")<br/>   (bf-op "&lt;")<br/>   (bf-op "-")<br/>   "]")<br/>  (bf-op "&gt;")<br/>  (bf-op "."))</div><div class="highlight" form="false" id="a_mLbbU"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37</pre></div></td><td class="code"><div class="source"><pre><span class="o">&#39;</span><span class="p">(</span><span class="ss">bf-program</span>
  <span class="p">(</span><span class="ss">bf-op</span> <span class="s2">"+"</span><span class="p">)</span>
  <span class="p">(</span><span class="ss">bf-op</span> <span class="s2">"+"</span><span class="p">)</span>
  <span class="p">(</span><span class="ss">bf-op</span> <span class="s2">"+"</span><span class="p">)</span>
  <span class="p">(</span><span class="ss">bf-op</span> <span class="s2">"+"</span><span class="p">)</span>
  <span class="p">(</span><span class="ss">bf-op</span> <span class="s2">"-"</span><span class="p">)</span>
  <span class="p">(</span><span class="ss">bf-op</span> <span class="s2">"+"</span><span class="p">)</span>
  <span class="p">(</span><span class="ss">bf-op</span> <span class="s2">"+"</span><span class="p">)</span>
  <span class="p">(</span><span class="ss">bf-op</span> <span class="s2">"+"</span><span class="p">)</span>
  <span class="p">(</span><span class="ss">bf-op</span> <span class="s2">"-"</span><span class="p">)</span>
  <span class="p">(</span><span class="ss">bf-op</span> <span class="s2">"+"</span><span class="p">)</span>
  <span class="p">(</span><span class="ss">bf-op</span> <span class="s2">"+"</span><span class="p">)</span>
  <span class="p">(</span><span class="ss">bf-op</span> <span class="s2">"-"</span><span class="p">)</span>
  <span class="p">(</span><span class="ss">bf-op</span> <span class="s2">"+"</span><span class="p">)</span>
  <span class="p">(</span><span class="ss">bf-op</span> <span class="s2">"+"</span><span class="p">)</span>
  <span class="p">(</span><span class="ss">bf-loop</span>
   <span class="s2">"["</span>
   <span class="p">(</span><span class="ss">bf-op</span> <span class="s2">"&gt;"</span><span class="p">)</span>
   <span class="p">(</span><span class="ss">bf-op</span> <span class="s2">"+"</span><span class="p">)</span>
   <span class="p">(</span><span class="ss">bf-op</span> <span class="s2">"+"</span><span class="p">)</span>
   <span class="p">(</span><span class="ss">bf-op</span> <span class="s2">"+"</span><span class="p">)</span>
   <span class="p">(</span><span class="ss">bf-op</span> <span class="s2">"+"</span><span class="p">)</span>
   <span class="p">(</span><span class="ss">bf-op</span> <span class="s2">"-"</span><span class="p">)</span>
   <span class="p">(</span><span class="ss">bf-op</span> <span class="s2">"+"</span><span class="p">)</span>
   <span class="p">(</span><span class="ss">bf-op</span> <span class="s2">"+"</span><span class="p">)</span>
   <span class="p">(</span><span class="ss">bf-op</span> <span class="s2">"+"</span><span class="p">)</span>
   <span class="p">(</span><span class="ss">bf-op</span> <span class="s2">"-"</span><span class="p">)</span>
   <span class="p">(</span><span class="ss">bf-op</span> <span class="s2">"+"</span><span class="p">)</span>
   <span class="p">(</span><span class="ss">bf-op</span> <span class="s2">"+"</span><span class="p">)</span>
   <span class="p">(</span><span class="ss">bf-op</span> <span class="s2">"-"</span><span class="p">)</span>
   <span class="p">(</span><span class="ss">bf-op</span> <span class="s2">"+"</span><span class="p">)</span>
   <span class="p">(</span><span class="ss">bf-op</span> <span class="s2">"+"</span><span class="p">)</span>
   <span class="p">(</span><span class="ss">bf-op</span> <span class="s2">"&lt;"</span><span class="p">)</span>
   <span class="p">(</span><span class="ss">bf-op</span> <span class="s2">"-"</span><span class="p">)</span>
   <span class="s2">"]"</span><span class="p">)</span>
  <span class="p">(</span><span class="ss">bf-op</span> <span class="s2">"&gt;"</span><span class="p">)</span>
  <span class="p">(</span><span class="ss">bf-op</span> <span class="s2">"."</span><span class="p">))</span>
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpkd" data-clipboard-target="#code_56" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_GsD5K&quot;)"></div><p id="a_GsD5K">What are we see­ing here? Two things:</p></div><ol><li><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_qfbe5&quot;)"></div><p id="a_qfbe5">We’re see­ing the effect of our tok­enizer, which dis­carded the char­ac­ters in the line <span class="my-code" decode="exclude">Greatest language ever!</span>. They never reached the parser, so they don’t appear in the parse tree.</p></div></li><li><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_yKYuW&quot;)"></div><p id="a_yKYuW">We’re oth­er­wise see­ing the same parse tree that <a href="the-parser.html#converting-a-grammar-to-a-parser">we got before</a>—as we should. All the char­ac­ters in our source code appear in a node of the parse tree, and these nodes cor­re­spond to the names and pat­terns of the pro­duc­tion rules.</p></div></li></ol><div anchorize="false" style="height:1em"></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_bcTDM&quot;)"></div><p id="a_bcTDM">While we’re here, let’s see what hap­pens when we run a poorly formed <span class="my-code" decode="exclude">bf</span> pro­gram. We know that brack­ets have to come in pairs. So let’s delib­er­ately add an unmatched left bracket to the end of the pro­gram:</p></div><div class="filebox" anchorize="false"><div class="filename" anchorize="false" decode="exclude">atsign.rkt</div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_jxeoG&quot;)"></div><div class="highlight-container" id="a_jxeoG"><div id="code_57" form="false" decode="exclude" style="font-size:0;width:0;height:0">#lang reader "reader.rkt"<br/>Greatest language ever!<br/>++++-+++-++-++[&gt;++++-+++-++-++&lt;-]&gt;.[</div><div class="highlight" form="false" id="a_MONIk"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="source"><pre><span class="kn">#lang </span><span class="nn">reader</span> <span class="s2">"reader.rkt"</span>
<span class="n">Greatest</span> <span class="n">language</span> <span class="n">ever!</span>
<span class="n">++++-+++-++-++</span><span class="p">[</span><span class="n">&gt;++++-+++-++-++&lt;-</span><span class="p">]</span><span class="n">&gt;.</span><span class="p">[</span>
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpke" data-clipboard-target="#code_57" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_I4gTh&quot;)"></div><p id="a_I4gTh">This time, when we run the pro­gram, we won’t see a parse tree—instead we’ll get an error like this:</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_18Z81&quot;)"></div><div class="highlight-container err" id="a_18Z81"><div id="code_58" form="false" decode="exclude" style="font-size:0;width:0;height:0">Encountered parsing error near "[" (token '|[|) while parsing #&lt;path:atsign.rkt&gt; [line=#f, column=#f, offset=#f]</div><div class="highlight" form="false" id="a_Gni9v"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="source"><pre>Encountered parsing error near "[" (token &#39;|[|) while parsing #&lt;path:atsign.rkt&gt; [line=#f, column=#f, offset=#f]
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpkf" data-clipboard-target="#code_58" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_VTSMD&quot;)"></div><p id="a_VTSMD">This is the right result. Our parser can’t find a way to match this defec­tive code string to its gram­mar. Thus, when it reaches the unmatched bracket—<span class="my-code wrappable" decode="exclude">"["</span>—it gives up and raises an error.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_E5DvH&quot;)"></div><p id="a_E5DvH">Before we con­tinue, let’s remove the spu­ri­ous left bracket from the end of <span class="my-code" decode="exclude">"atsign.rkt"</span>, and also the <span class="my-code" decode="exclude">'</span> pre­fix from <span class="my-code" decode="exclude">PARSE-TREE</span>, so our files look like this:</p></div><div class="filebox" anchorize="false"><div class="filename" anchorize="false" decode="exclude">atsign.rkt</div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_qs9uSi&quot;)"></div><div class="highlight-container" id="a_qs9uSi"><div id="code_59" form="false" decode="exclude" style="font-size:0;width:0;height:0">#lang reader "reader.rkt"<br/>Greatest language ever!<br/>++++-+++-++-++[&gt;++++-+++-++-++&lt;-]&gt;.</div><div class="highlight" form="false" id="a_ihAovg"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="source"><pre><span class="kn">#lang </span><span class="nn">reader</span> <span class="s2">"reader.rkt"</span>
<span class="n">Greatest</span> <span class="n">language</span> <span class="n">ever!</span>
<span class="n">++++-+++-++-++</span><span class="p">[</span><span class="n">&gt;++++-+++-++-++&lt;-</span><span class="p">]</span><span class="n">&gt;.</span>
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpkh" data-clipboard-target="#code_59" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div></div><div class="filebox" anchorize="false"><div class="filename" anchorize="false" decode="exclude">expander.rkt</div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_Y8nhE&quot;)"></div><div class="highlight-container" id="a_Y8nhE"><div id="code_60" form="false" decode="exclude" style="font-size:0;width:0;height:0">#lang br/quicklang<br/><br/>(define-macro (bf-module-begin PARSE-TREE)<br/>  #'(#%module-begin<br/>     PARSE-TREE))<br/>(provide (rename-out [bf-module-begin #%module-begin]))</div><div class="highlight" form="false" id="a_fcKmhj"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="source"><pre><span class="kn">#lang </span><span class="nn">br/quicklang</span>

<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br/index.html#(form._((lib._br/define..rkt)._define-macro))" class="docs" hyphens="none">define-macro</a></span> <span class="p">(</span><span class="n">bf-module-begin</span> <span class="n">PARSE-TREE</span><span class="p">)</span>
  <span class="o">#&#39;</span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/module.html#(form._((lib._racket/private/base..rkt)._~23~25module-begin))" class="docs" hyphens="none">#%module-begin</a></span>
     <span class="n">PARSE-TREE</span><span class="p">))</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._provide))" class="docs" hyphens="none">provide</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._rename-out))" class="docs" hyphens="none">rename-out</a></span> <span class="p">[</span><span class="n">bf-module-begin</span> <span class="nb"><a href="http://docs.racket-lang.org/reference/module.html#(form._((lib._racket/private/base..rkt)._~23~25module-begin))" class="docs" hyphens="none">#%module-begin</a></span><span class="p">]))</span>
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpkk" data-clipboard-target="#code_60" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div></div><div class="filebox" anchorize="false"><div class="filename" anchorize="false" decode="exclude">reader.rkt</div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_uBh4Fn&quot;)"></div><div class="highlight-container" id="a_uBh4Fn"><div id="code_61" form="false" decode="exclude" style="font-size:0;width:0;height:0">#lang br/quicklang<br/>(require "parser.rkt")<br/><br/>(define (read-syntax path port)<br/>  (define parse-tree (parse path (make-tokenizer port)))<br/>  (define module-datum `(module bf-mod "expander.rkt"<br/>                          ,parse-tree))<br/>  (datum-&gt;syntax #f module-datum))<br/>(provide read-syntax)<br/><br/>(require brag/support)<br/>(define (make-tokenizer port)<br/>  (define (next-token)<br/>    (define bf-lexer<br/>      (lexer<br/>       [(eof) eof]<br/>       [(char-set "&gt;&lt;-.,+[]") lexeme]<br/>       [any-char (next-token)]))<br/>    (bf-lexer port))  <br/>  next-token)
</div><div class="highlight" form="false" id="a_YCI7ql"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</pre></div></td><td class="code"><div class="source"><pre><span class="kn">#lang </span><span class="nn">br/quicklang</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._require))" class="docs" hyphens="none">require</a></span> <span class="s2">"parser.rkt"</span><span class="p">)</span>

<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/Reading.html#(def._((quote._~23~25kernel)._read-syntax))" class="docs" hyphens="none">read-syntax</a></span> <span class="n">path</span> <span class="n">port</span><span class="p">)</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="n">parse-tree</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(def._((lib._brag/examples/nested-word-list..rkt)._parse))" class="docs" hyphens="none">parse</a></span> <span class="n">path</span> <span class="p">(</span><span class="n">make-tokenizer</span> <span class="n">port</span><span class="p">)))</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="n">module-datum</span> <span class="o">`</span><span class="p">(</span><span class="ss">module</span> <span class="ss">bf-mod</span> <span class="s2">"expander.rkt"</span>
                          <span class="o">,</span><span class="n">parse-tree</span><span class="p">))</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/stxops.html#(def._((quote._~23~25kernel)._datum-~3esyntax))" class="docs" hyphens="none">datum-&gt;syntax</a></span> <span class="no">#f</span> <span class="n">module-datum</span><span class="p">))</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._provide))" class="docs" hyphens="none">provide</a></span> <span class="nb"><a href="http://docs.racket-lang.org/reference/Reading.html#(def._((quote._~23~25kernel)._read-syntax))" class="docs" hyphens="none">read-syntax</a></span><span class="p">)</span>

<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._require))" class="docs" hyphens="none">require</a></span> <span class="n">brag/support</span><span class="p">)</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="p">(</span><span class="n">make-tokenizer</span> <span class="n">port</span><span class="p">)</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="p">(</span><span class="n">next-token</span><span class="p">)</span>
    <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="n">bf-lexer</span>
      <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._lexer))" class="docs" hyphens="none">lexer</a></span>
       <span class="p">[(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/port-ops.html#(def._((quote._~23~25kernel)._eof))" class="docs" hyphens="none">eof</a></span><span class="p">)</span> <span class="nb"><a href="http://docs.racket-lang.org/reference/port-ops.html#(def._((quote._~23~25kernel)._eof))" class="docs" hyphens="none">eof</a></span><span class="p">]</span>
       <span class="p">[(</span><span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._char-set))" class="docs" hyphens="none">char-set</a></span> <span class="s2">"&gt;&lt;-.,+[]"</span><span class="p">)</span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._lexeme))" class="docs" hyphens="none">lexeme</a></span><span class="p">]</span>
       <span class="p">[</span><span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._any-char))" class="docs" hyphens="none">any-char</a></span> <span class="p">(</span><span class="n">next-token</span><span class="p">)]))</span>
    <span class="p">(</span><span class="n">bf-lexer</span> <span class="n">port</span><span class="p">))</span>  
  <span class="n">next-token</span><span class="p">)</span>
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpkm" data-clipboard-target="#code_61" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_tHS4M&quot;)"></div><p id="a_tHS4M">Now we can fin­ish the expander.</p></div><div anchorize="false" style="height:2em"></div><ul class="siblinks"><li><a href="intro.html">1&emsp;intro</a></li><li><a href="grammars-and-parsers.html">2&emsp;gram­mars and parsers</a></li><li><a href="grammar-notation.html">3&emsp;gram­mar nota­tion</a></li><li><a href="the-parser.html">4&emsp;the parser</a></li><li><a class="here" href="the-tokenizer-and-reader.html">5&emsp;the tok­enizer and reader</a></li><li><a href="an-imperative-expander.html">6&emsp;an imper­a­tive expander</a></li><li><a href="a-functional-expander.html">7&emsp;a func­tional expander</a></li><li><a href="packaging-our-language.html">8&emsp;pack­ag­ing our lan­guage</a></li><li><a href="recap.html">9&emsp;recap</a></li><li><a href="source-listing.html">10&emsp;source list­ing</a></li></ul></div>
    <a class="nav-left" href="the-parser.html">← prev</a>
    <a class="nav-right" href="an-imperative-expander.html">next →</a>




</body>

<script type="text/javascript">



function show_all_forms() {
 var elems = document.getElementsByClassName('has_form');
 for (var i = 0 ; i < elems.length ; i++) {
  toggle_form(elems[i].id);
 }
}

// for debugging forms only: uncomment next line
// show_all_forms();

// sets up copy-to-clipboard buttons in code boxes
var clipboard = new Clipboard('.copy-button');
clipboard.on('success', function(e) {console.log(e);});
clipboard.on('error', function(e) {console.log(e);});
</script>