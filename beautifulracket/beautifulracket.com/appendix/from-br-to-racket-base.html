<!DOCTYPE html>
<html>
  
<!-- Mirrored from beautifulracket.com/appendix/from-br-to-racket-base.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 16 Mar 2017 05:46:56 GMT -->
<head>
    <meta charset="UTF-8">
    <title>Beautiful Racket: From br to racket/base</title>
    <link rel="stylesheet" type="text/css" media="all" href="../styles.css"/>
    <script type="text/javascript" src="../functions.js"></script>
    <script type="text/javascript" src="../clipboard.min.js"></script>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-74684045-1', 'auto');
      ga('send', 'pageview');
    </script>
  </head>
<body>
<div id="alert">Thank you for your comment</div>
    <div id="doc"><h3 class="dept" anchorize="false"><a href="../index.html">Beau­ti­ful Racket</a> / <a href="../index.html#appendix">appen­dix</a></h3><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;from-br-to-racket-base&quot;)"></div><h1 anchor="from-br-to-racket-base" id="from-br-to-racket-base" hyphens="none">From <span class="my-code" decode="exclude">br</span> to <span class="my-code" decode="exclude">racket/base</span></h1></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_W6yFG&quot;)"></div><p id="a_W6yFG">Now the truth can be told: the <span class="my-code" decode="exclude">br</span> lan­guage that we’ve used through­out this book is a not-very-spe­cial dialect of Racket. It’s just the foun­da­tional Racket lan­guage—which is called <a href="https://docs.racket-lang.org/reference/index.html?q=racket%2Fbase"><span class="my-code" decode="exclude">#lang racket/base</span></a>—with some extra Racket libraries auto­mat­i­cally imported, and some <span class="my-code" decode="exclude">br</span>-spe­cific libraries intended to defer a few com­pli­ca­tions until later in your Racket career. (Namely: now.)</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_y3DGo&quot;)"></div><p id="a_y3DGo">There’s noth­ing wrong with using <span class="my-code" decode="exclude">#lang br</span> in mod­ules or projects. But as a devel­oper, it’s a more vir­tu­ous habit to use <span class="my-code" decode="exclude">#lang racket/base</span> instead. Why?</p></div><ol><li><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_fQ6kL&quot;)"></div><p id="a_fQ6kL">As a rule of thumb, it’s bet­ter prac­tice to start with the foun­da­tional lan­guage—that is, <span class="my-code" decode="exclude">racket/base</span>—and use <a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._require))" class="docs" hyphens="none">require</a> to import what you need. This makes your project (a lit­tle) faster to start up, and reduces depen­den­cies.</p></div></li><li><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_WkBYy&quot;)"></div><p id="a_WkBYy">Both <span class="my-code" decode="exclude">#lang br</span> and this book will con­tinue to be revised and enlarged. <span class="my-code" decode="exclude">#lang racket/base</span>, by con­trast, is guar­an­teed to remain the foun­da­tional con­fig­u­ra­tion of Racket.</p></div></li><li><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_YjyaC&quot;)"></div><p id="a_YjyaC"><span class="my-code" decode="exclude">racket/base</span> is ubiq­ui­tous through­out other Racket projects, so rec­og­niz­ing com­mon <span class="my-code" decode="exclude">racket/base</span> idioms is essen­tial for being able to read other peo­ple’s code.</p></div></li></ol><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_y6ErA&quot;)"></div><p id="a_y6ErA">A few options for those switch­ing from <span class="my-code" decode="exclude">br</span> to <span class="my-code" decode="exclude">racket/base</span>:</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;using-br-libraries&quot;)"></div><h3 anchor="using-br-libraries" class="subhead" id="using-br-libraries"><a href="#using-br-libraries">Using br libraries</a></h3></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_9M1sW&quot;)"></div><p id="a_9M1sW">Rather than using <span class="my-code" decode="exclude">#lang br</span>, you can import just the parts you like. The <span class="my-code" decode="exclude">br</span> lan­guage is built from smaller mod­ules like <a href="https://docs.racket-lang.org/br/index.html?q=br#%28mod-path._br%2Flist%29"><span class="my-code" decode="exclude">br/list</span></a>, <a href="https://docs.racket-lang.org/br/index.html?q=br#%28mod-path._br%2Fdefine%29"><span class="my-code" decode="exclude">br/define</span></a>, and <a href="https://docs.racket-lang.org/br/index.html?q=br#%28mod-path._br%2Fsyntax%29"><span class="my-code" decode="exclude">br/syntax</span></a>. These are all com­pat­i­ble with <span class="my-code" decode="exclude">racket/base</span>. See <a href="http://docs.racket-lang.org/br/">the doc­u­men­ta­tion</a> for what’s included in each.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;copying-and-adapting-code&quot;)"></div><h3 anchor="copying-and-adapting-code" class="subhead" id="copying-and-adapting-code"><a href="#copying-and-adapting-code">Copy­ing &amp; adapt­ing code</a></h3></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_FH5wY&quot;)"></div><p id="a_FH5wY">The <span class="my-code" decode="exclude">br</span> code is avail­able under the MIT license. Rather than depend on the <span class="my-code" decode="exclude">br</span> pack­age, you’re wel­come to copy the code—indi­vid­ual func­tions, or whole mod­ules—into your own projects, or adapt it.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_WZPFt&quot;)"></div><p id="a_WZPFt">None of the code is espe­cially com­pli­cated, though some of it uses tech­niques not cov­ered in this book. (If you make improve­ments, I wel­come pull requests at the <a class=" ext" href="https://github.com/mbutterick/beautiful-racket"><span class="my-code" decode="exclude">beautiful-racket</span></a> repo).</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;rewriting&quot;)"></div><h3 anchor="rewriting" class="subhead" id="rewriting"><a href="#rewriting">Rewrit­ing</a></h3></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_BEd2s&quot;)"></div><p id="a_BEd2s">You can also just learn to rewrite your code with­out the <span class="my-code" decode="exclude">br</span> idioms and pat­terns. You can peek inside the <span class="my-code" decode="exclude">br</span> source code to see what’s going on, but these are the high­lights.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;macro-definitions&quot;)"></div><h3 anchor="macro-definitions" class="subhead" id="macro-definitions"><a href="#macro-definitions">Macro def­i­n­i­tions</a></h3></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_qg865&quot;)"></div><p id="a_qg865"><a href="http://docs.racket-lang.org/br/index.html#(form._((lib._br/define..rkt)._define-macro))" class="docs" hyphens="none">define-macro</a> and <a href="http://docs.racket-lang.org/br/index.html#(form._((lib._br/define..rkt)._define-macro-cases))" class="docs" hyphens="none">define-macro-cases</a> are lightly dis­guised forms of <a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define-syntax))" class="docs" hyphens="none">define-syntax</a> with <a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._syntax-case))" class="docs" hyphens="none">syntax-case</a>. Here are three equiv­a­lent ways of writ­ing the same macro:</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_iqFTL&quot;)"></div><div class="highlight-container" id="a_iqFTL"><div id="code_43" form="false" decode="exclude" style="font-size:0;width:0;height:0">(define-macro (mac1 X bar Y)<br/>  #'(list X "second" Y))<br/><br/>(define-macro-cases mac2<br/>  [(_ X bar Y) #'(list X "second" Y)])<br/><br/>(define-syntax (mac3 caller-stx)<br/>  (syntax-case caller-stx (bar)<br/>    [(foo X bar Y) #'(list X "second" Y)]<br/>    [else<br/>     (raise-syntax-error<br/>      'foo3<br/>      (format "no matching case for calling pattern in: ~a"<br/>              (syntax-&gt;datum caller-stx)))]))<br/><br/>(mac1 "first" bar "third") ; '("first" "second" "third")<br/>(mac2 "first" bar "third") ; '("first" "second" "third")<br/>(mac3 "first" bar "third") ; '("first" "second" "third")</div><div class="highlight" form="false" id="a_ABbzG"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</pre></div></td><td class="code"><div class="source"><pre><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br/index.html#(form._((lib._br/define..rkt)._define-macro))" class="docs" hyphens="none">define-macro</a></span> <span class="p">(</span><span class="n">mac1</span> <span class="n">X</span> <span class="n">bar</span> <span class="n">Y</span><span class="p">)</span>
  <span class="o">#&#39;</span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._list))" class="docs" hyphens="none">list</a></span> <span class="n">X</span> <span class="s2">"second"</span> <span class="n">Y</span><span class="p">))</span>

<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br/index.html#(form._((lib._br/define..rkt)._define-macro-cases))" class="docs" hyphens="none">define-macro-cases</a></span> <span class="n">mac2</span>
  <span class="p">[(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt).__))" class="docs" hyphens="none">_</a></span> <span class="n">X</span> <span class="n">bar</span> <span class="n">Y</span><span class="p">)</span> <span class="o">#&#39;</span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._list))" class="docs" hyphens="none">list</a></span> <span class="n">X</span> <span class="s2">"second"</span> <span class="n">Y</span><span class="p">)])</span>

<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define-syntax))" class="docs" hyphens="none">define-syntax</a></span> <span class="p">(</span><span class="n">mac3</span> <span class="nb"><a href="http://docs.racket-lang.org/br/index.html#(def._((lib._br/define..rkt)._caller-stx))" class="docs" hyphens="none">caller-stx</a></span><span class="p">)</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._syntax-case))" class="docs" hyphens="none">syntax-case</a></span> <span class="nb"><a href="http://docs.racket-lang.org/br/index.html#(def._((lib._br/define..rkt)._caller-stx))" class="docs" hyphens="none">caller-stx</a></span> <span class="p">(</span><span class="n">bar</span><span class="p">)</span>
    <span class="p">[(</span><span class="n">foo</span> <span class="n">X</span> <span class="n">bar</span> <span class="n">Y</span><span class="p">)</span> <span class="o">#&#39;</span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._list))" class="docs" hyphens="none">list</a></span> <span class="n">X</span> <span class="s2">"second"</span> <span class="n">Y</span><span class="p">)]</span>
    <span class="p">[</span><span class="nb"><a href="http://docs.racket-lang.org/reference/if.html#(form._((lib._racket/private/letstx-scheme..rkt)._else))" class="docs" hyphens="none">else</a></span>
     <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/exns.html#(def._((quote._~23~25kernel)._raise-syntax-error))" class="docs" hyphens="none">raise-syntax-error</a></span>
      <span class="o">&#39;</span><span class="ss">foo3</span>
      <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/Writing.html#(def._((quote._~23~25kernel)._format))" class="docs" hyphens="none">format</a></span> <span class="s2">"no matching case for calling pattern in: ~a"</span>
              <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/stxops.html#(def._((quote._~23~25kernel)._syntax-~3edatum))" class="docs" hyphens="none">syntax-&gt;datum</a></span> <span class="nb"><a href="http://docs.racket-lang.org/br/index.html#(def._((lib._br/define..rkt)._caller-stx))" class="docs" hyphens="none">caller-stx</a></span><span class="p">)))]))</span>

<span class="p">(</span><span class="n">mac1</span> <span class="s2">"first"</span> <span class="n">bar</span> <span class="s2">"third"</span><span class="p">)</span> <span class="c1">; &#39;("first" "second" "third")</span>
<span class="p">(</span><span class="n">mac2</span> <span class="s2">"first"</span> <span class="n">bar</span> <span class="s2">"third"</span><span class="p">)</span> <span class="c1">; &#39;("first" "second" "third")</span>
<span class="p">(</span><span class="n">mac3</span> <span class="s2">"first"</span> <span class="n">bar</span> <span class="s2">"third"</span><span class="p">)</span> <span class="c1">; &#39;("first" "second" "third")</span>
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpk" data-clipboard-target="#code_43" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_iXuE0&quot;)"></div><p id="a_iXuE0">Under the hood, <span class="my-code" decode="exclude">define-macro</span> is just a short­hand ver­sion of the one-case instance of <span class="my-code" decode="exclude">define-macro-cases</span>, which is a short­hand ver­sion of the full <span class="my-code" decode="exclude">define-syntax</span> + <span class="my-code" decode="exclude">syntax-case</span> macro.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_q0CTB&quot;)"></div><p id="a_q0CTB"><span class="my-code" decode="exclude">define-syntax</span> is Racket’s basic tool for intro­duc­ing a <a class="glossary" href="glossary.html#macro"><span class="glossary-link-text">macro</span></a>. <span class="my-code" decode="exclude">define-syntax</span> can only be used to bind an iden­ti­fier (like <span class="my-code" decode="exclude">mac3</span>, in the exam­ple above) to a func­tion that takes one syn­tax object as an argu­ment, and returns another syn­tax object.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_etOA7&quot;)"></div><p id="a_etOA7">Racket has a num­ber of tools that cre­ate syn­tax trans­form­ers, or help process the input of a macro. <span class="my-code" decode="exclude">syntax-case</span> is in the lat­ter cat­e­gory: it’s sim­i­lar to <a href="http://docs.racket-lang.org/reference/if.html#(form._((lib._racket/private/letstx-scheme..rkt)._cond))" class="docs" hyphens="none">cond</a> or <a href="http://docs.racket-lang.org/reference/case.html#(form._((lib._racket/private/more-scheme..rkt)._case))" class="docs" hyphens="none">case</a>, in that it takes a syn­tax object as input and tries to match it to a series of clauses with a syn­tax pat­tern on the left. When a match is found, the right side of the clause is eval­u­ated. The <span class="my-code" decode="exclude">(bar)</span> argu­ment in syn­tax case is a list of iden­ti­fiers that will be matched lit­er­ally.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_CdAjO&quot;)"></div><p id="a_CdAjO">Key dif­fer­ences between <span class="my-code" decode="exclude">define-macro</span> or <span class="my-code" decode="exclude">define-macro-cases</span> and <span class="my-code" decode="exclude">define-syntax</span> with <span class="my-code" decode="exclude">syntax-case</span>:</p></div><ul><li><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_7haio&quot;)"></div><p id="a_7haio">In <span class="my-code" decode="exclude">define-macro</span> and <span class="my-code" decode="exclude">define-macro-cases</span>, the <span class="my-code" decode="exclude">caller-stx</span> value is avail­able, but hid­den by default. In <span class="my-code" decode="exclude">define-syntax</span>, it’s explicit. <span class="tooltip" onclick="this.classList.toggle('tooltip_visible')"> + <span class="tooltip-inner">In your own <span class="my-code" decode="exclude">define-syntax</span> macros, you don’t have to name the input argu­ment <span class="my-code" decode="exclude">caller-stx</span>—we’re using that name here to show the cor­re­spon­dence between the forms. More often, it’s just called <span class="my-code" decode="exclude">stx</span>.</span></span></p></div></li><li><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_XzGq9&quot;)"></div><p id="a_XzGq9">In <span class="my-code" decode="exclude">define-macro</span> and <span class="my-code" decode="exclude">define-macro-cases</span>, if no <span class="my-code" decode="exclude">else</span> clause is included, one is auto­mat­i­cally gen­er­ated with a friendly error mes­sage.</p></div></li><li><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_70LwO&quot;)"></div><p id="a_70LwO">In <span class="my-code" decode="exclude">define-macro</span> and <span class="my-code" decode="exclude">define-macro-cases</span>, <a class="glossary" href="glossary.html#pattern-variable"><span class="glossary-link-text">pat­tern vari­ables</span></a> in the <a class="glossary" href="glossary.html#syntax-pattern"><span class="glossary-link-text">syn­tax pat­tern</span></a> have to be writ­ten in <span class="my-code" decode="exclude">UPPERCASE</span>, and every­thing else is treated as a lit­eral match. In <span class="my-code" decode="exclude">syntax-case</span>, this pre­sump­tion is reversed: every iden­ti­fier in a syn­tax pat­tern is treated as a pat­tern vari­able, and only the iden­ti­fiers in the lit­er­als list at the top are treated as lit­er­als. <span class="tooltip" onclick="this.classList.toggle('tooltip_visible')"> + <span class="tooltip-inner">You can still use <span class="my-code" decode="exclude">UPPERCASE</span> to label pat­tern vari­ables, but in <span class="my-code" decode="exclude">syntax-case</span> it’s an option, not a require­ment.</span></span></p></div></li></ul><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;macro-helpers&quot;)"></div><h3 anchor="macro-helpers" class="subhead" id="macro-helpers"><a href="#macro-helpers">Macro helpers</a></h3></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_dzdwo&quot;)"></div><p id="a_dzdwo">Sim­i­larly, <a href="http://docs.racket-lang.org/br/index.html#(form._((lib._br/syntax..rkt)._with-pattern))" class="docs" hyphens="none">with-pattern</a> is an alter­na­tive to Racket’s <a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._with-syntax))" class="docs" hyphens="none">with-syntax</a>.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_r2WL2&quot;)"></div><div class="highlight-container" id="a_r2WL2"><div id="code_44" form="false" decode="exclude" style="font-size:0;width:0;height:0">(define stx #'(foo bar 42))<br/><br/>(syntax-&gt;datum<br/> (with-pattern ([(FIRST SECOND THIRD) stx])<br/>   #'(list THIRD SECOND FIRST))) ; '(list 42 bar foo)<br/><br/>(syntax-&gt;datum<br/> (with-syntax ([(FIRST SECOND THIRD) stx])<br/>   #'(list THIRD SECOND FIRST))) ; '(list 42 bar foo)</div><div class="highlight" form="false" id="a_kxigg"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="source"><pre><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="n">stx</span> <span class="o">#&#39;</span><span class="p">(</span><span class="n">foo</span> <span class="n">bar</span> <span class="mi">42</span><span class="p">))</span>

<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/stxops.html#(def._((quote._~23~25kernel)._syntax-~3edatum))" class="docs" hyphens="none">syntax-&gt;datum</a></span>
 <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br/index.html#(form._((lib._br/syntax..rkt)._with-pattern))" class="docs" hyphens="none">with-pattern</a></span> <span class="p">([(</span><span class="n">FIRST</span> <span class="n">SECOND</span> <span class="n">THIRD</span><span class="p">)</span> <span class="n">stx</span><span class="p">])</span>
   <span class="o">#&#39;</span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._list))" class="docs" hyphens="none">list</a></span> <span class="n">THIRD</span> <span class="n">SECOND</span> <span class="n">FIRST</span><span class="p">)))</span> <span class="c1">; &#39;(list 42 bar foo)</span>

<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/stxops.html#(def._((quote._~23~25kernel)._syntax-~3edatum))" class="docs" hyphens="none">syntax-&gt;datum</a></span>
 <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._with-syntax))" class="docs" hyphens="none">with-syntax</a></span> <span class="p">([(</span><span class="n">FIRST</span> <span class="n">SECOND</span> <span class="n">THIRD</span><span class="p">)</span> <span class="n">stx</span><span class="p">])</span>
   <span class="o">#&#39;</span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._list))" class="docs" hyphens="none">list</a></span> <span class="n">THIRD</span> <span class="n">SECOND</span> <span class="n">FIRST</span><span class="p">)))</span> <span class="c1">; &#39;(list 42 bar foo)</span>
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpk1" data-clipboard-target="#code_44" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_dKC00&quot;)"></div><p id="a_dKC00">Key dif­fer­ences:</p></div><ul><li><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_Lq4Nc&quot;)"></div><p id="a_Lq4Nc">In <span class="my-code" decode="exclude">with-pattern</span>, pat­tern vari­ables matched in ear­lier lines can be used in later lines. In <a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._with-syntax))" class="docs" hyphens="none">with-syntax</a>, they can­not. <span class="tooltip" onclick="this.classList.toggle('tooltip_visible')"> + <span class="tooltip-inner">But see <a href="http://docs.racket-lang.org/reference/syntax-util.html#(form._((lib._racket/syntax..rkt)._with-syntax*))" class="docs" hyphens="none">with-syntax*</a>, which per­mits ref­er­ences to pre­vi­ously matched pat­tern vari­ables.</span></span></p></div></li><li><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_0KpmJ&quot;)"></div><p id="a_0KpmJ">In <span class="my-code" decode="exclude">with-pattern</span>, as with <span class="my-code" decode="exclude">define-macro</span> and <span class="my-code" decode="exclude">define-macro-cases</span>, pat­tern vari­ables in the syn­tax pat­terns have to be writ­ten in <span class="my-code" decode="exclude">UPPERCASE</span>. Every­thing else is treated as a lit­eral match. In <span class="my-code" decode="exclude">with-syntax</span>, this pre­sump­tion is reversed: every iden­ti­fier in a syn­tax pat­tern is treated as a pat­tern vari­able. There is no way to match an iden­ti­fier lit­er­ally.</p></div></li></ul><div anchorize="false" style="height:1em"></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_HXxgb&quot;)"></div><p id="a_HXxgb"><a href="http://docs.racket-lang.org/br/index.html#(def._((lib._br/syntax..rkt)._prefix-id))" class="docs" hyphens="none">prefix-id</a> and <a href="http://docs.racket-lang.org/br/index.html#(def._((lib._br/syntax..rkt)._suffix-id))" class="docs" hyphens="none">suffix-id</a> are con­ve­nient ways of using <a href="http://docs.racket-lang.org/reference/syntax-util.html#(def._((lib._racket/syntax..rkt)._format-id))" class="docs" hyphens="none">format-id</a> (which in turn is just a con­ve­nient way of using <a href="http://docs.racket-lang.org/reference/stxops.html#(def._((quote._~23~25kernel)._datum-~3esyntax))" class="docs" hyphens="none">datum-&gt;syntax</a>). The major dif­fer­ence is that <span class="my-code" decode="exclude">prefix-id</span> and <span class="my-code" decode="exclude">suffix-id</span> auto­mat­i­cally gen­er­ate iden­ti­fiers that live in the same <a class="glossary" href="glossary.html#lexical-context"><span class="glossary-link-text">lex­i­cal con­text</span></a> as the base iden­ti­fier. Whereas with <span class="my-code" decode="exclude">datum-&gt;syntax</span> and <span class="my-code" decode="exclude">format-id</span>, you always have to pro­vide an explicit lex­i­cal-con­text argu­ment:</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_6jzCQ&quot;)"></div><div class="highlight-container" id="a_6jzCQ"><div id="code_45" form="false" decode="exclude" style="font-size:0;width:0;height:0">(require racket/syntax)<br/><br/>(define-macro (make-bars)<br/>  (define id #'foo)<br/>  (with-pattern ([BAR1 (datum-&gt;syntax id 'bar1)]<br/>                 [BAR2 (format-id id "~a" 'bar2)]<br/>                 [BAR23 (suffix-id #'BAR2 "3")])<br/>    #'(begin<br/>        (define BAR1 'BAR1)<br/>        (define BAR2 'BAR2)<br/>        (define BAR23 'BAR23)<br/>        (list BAR1 BAR2 BAR23))))<br/><br/>(make-bars) ; '(bar1 bar2 bar23)</div><div class="highlight" form="false" id="a_Ezuk3"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="source"><pre><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._require))" class="docs" hyphens="none">require</a></span> <span class="n">racket/syntax</span><span class="p">)</span>

<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br/index.html#(form._((lib._br/define..rkt)._define-macro))" class="docs" hyphens="none">define-macro</a></span> <span class="p">(</span><span class="n">make-bars</span><span class="p">)</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="n">id</span> <span class="o">#&#39;</span><span class="n">foo</span><span class="p">)</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br/index.html#(form._((lib._br/syntax..rkt)._with-pattern))" class="docs" hyphens="none">with-pattern</a></span> <span class="p">([</span><span class="n">BAR1</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/stxops.html#(def._((quote._~23~25kernel)._datum-~3esyntax))" class="docs" hyphens="none">datum-&gt;syntax</a></span> <span class="n">id</span> <span class="o">&#39;</span><span class="ss">bar1</span><span class="p">)]</span>
                 <span class="p">[</span><span class="n">BAR2</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/syntax-util.html#(def._((lib._racket/syntax..rkt)._format-id))" class="docs" hyphens="none">format-id</a></span> <span class="n">id</span> <span class="s2">"~a"</span> <span class="o">&#39;</span><span class="ss">bar2</span><span class="p">)]</span>
                 <span class="p">[</span><span class="n">BAR23</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br/index.html#(def._((lib._br/syntax..rkt)._suffix-id))" class="docs" hyphens="none">suffix-id</a></span> <span class="o">#&#39;</span><span class="n">BAR2</span> <span class="s2">"3"</span><span class="p">)])</span>
    <span class="o">#&#39;</span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/begin.html#(form._((quote._~23~25kernel)._begin))" class="docs" hyphens="none">begin</a></span>
        <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="n">BAR1</span> <span class="o">&#39;</span><span class="ss">BAR1</span><span class="p">)</span>
        <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="n">BAR2</span> <span class="o">&#39;</span><span class="ss">BAR2</span><span class="p">)</span>
        <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="n">BAR23</span> <span class="o">&#39;</span><span class="ss">BAR23</span><span class="p">)</span>
        <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._list))" class="docs" hyphens="none">list</a></span> <span class="n">BAR1</span> <span class="n">BAR2</span> <span class="n">BAR23</span><span class="p">))))</span>

<span class="p">(</span><span class="n">make-bars</span><span class="p">)</span> <span class="c1">; &#39;(bar1 bar2 bar23)</span>
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpk2" data-clipboard-target="#code_45" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;function-definitions&quot;)"></div><h3 anchor="function-definitions" class="subhead" id="function-definitions"><a href="#function-definitions">Func­tion def­i­n­i­tions</a></h3></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_T54ek&quot;)"></div><p id="a_T54ek"><a href="http://docs.racket-lang.org/br/index.html#(form._((lib._br/define..rkt)._define-cases))" class="docs" hyphens="none">define-cases</a>: a vari­ant of <a href="http://docs.racket-lang.org/reference/lambda.html#(form._((quote._~23~25kernel)._case-lambda))" class="docs" hyphens="none">case-lambda</a>, mod­i­fied to be more sim­i­lar in form to <span class="my-code" decode="exclude">define-macro-cases</span>, but oth­er­wise works the same way:</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_XCIsh&quot;)"></div><div class="highlight-container" id="a_XCIsh"><div id="code_46" form="false" decode="exclude" style="font-size:0;width:0;height:0">(define f<br/>  (case-lambda<br/>    [() 10]<br/>    [(x) x]<br/>    [(x y) (list y x)]<br/>    [r r]))<br/><br/>(list (f) (f 1) (f 1 2) (f 1 2 3)) ; '(10 1 (2 1) (1 2 3))<br/><br/>(define-cases g<br/>  [(g) 10]<br/>  [(g x) x]<br/>  [(g x y) (list y x)]<br/>  [(g . r) r])<br/><br/>(list (g) (g 1) (g 1 2) (g 1 2 3)) ; '(10 1 (2 1) (1 2 3))</div><div class="highlight" form="false" id="a_72RCR"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="source"><pre><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="n">f</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((quote._~23~25kernel)._case-lambda))" class="docs" hyphens="none">case-lambda</a></span>
    <span class="p">[()</span> <span class="mi">10</span><span class="p">]</span>
    <span class="p">[(</span><span class="n">x</span><span class="p">)</span> <span class="n">x</span><span class="p">]</span>
    <span class="p">[(</span><span class="n">x</span> <span class="n">y</span><span class="p">)</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._list))" class="docs" hyphens="none">list</a></span> <span class="n">y</span> <span class="n">x</span><span class="p">)]</span>
    <span class="p">[</span><span class="n">r</span> <span class="n">r</span><span class="p">]))</span>

<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._list))" class="docs" hyphens="none">list</a></span> <span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="p">(</span><span class="n">f</span> <span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="n">f</span> <span class="mi">1</span> <span class="mi">2</span><span class="p">)</span> <span class="p">(</span><span class="n">f</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span><span class="p">))</span> <span class="c1">; &#39;(10 1 (2 1) (1 2 3))</span>

<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br/index.html#(form._((lib._br/define..rkt)._define-cases))" class="docs" hyphens="none">define-cases</a></span> <span class="n">g</span>
  <span class="p">[(</span><span class="n">g</span><span class="p">)</span> <span class="mi">10</span><span class="p">]</span>
  <span class="p">[(</span><span class="n">g</span> <span class="n">x</span><span class="p">)</span> <span class="n">x</span><span class="p">]</span>
  <span class="p">[(</span><span class="n">g</span> <span class="n">x</span> <span class="n">y</span><span class="p">)</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._list))" class="docs" hyphens="none">list</a></span> <span class="n">y</span> <span class="n">x</span><span class="p">)]</span>
  <span class="p">[(</span><span class="n">g</span> <span class="o">.</span> <span class="n">r</span><span class="p">)</span> <span class="n">r</span><span class="p">])</span>

<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._list))" class="docs" hyphens="none">list</a></span> <span class="p">(</span><span class="n">g</span><span class="p">)</span> <span class="p">(</span><span class="n">g</span> <span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="n">g</span> <span class="mi">1</span> <span class="mi">2</span><span class="p">)</span> <span class="p">(</span><span class="n">g</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span><span class="p">))</span> <span class="c1">; &#39;(10 1 (2 1) (1 2 3))</span>
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpk3" data-clipboard-target="#code_46" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;conditionals&quot;)"></div><h3 anchor="conditionals" class="subhead" id="conditionals"><a href="#conditionals">Con­di­tion­als</a></h3></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_pfFB8&quot;)"></div><p id="a_pfFB8">There is no <a href="http://docs.racket-lang.org/br/index.html#(form._((lib._br/cond..rkt)._until))" class="docs" hyphens="none">until</a> or <a href="http://docs.racket-lang.org/br/index.html#(form._((lib._br/cond..rkt)._while))" class="docs" hyphens="none">while</a> in Racket, but they can be eas­ily derived from <a href="http://docs.racket-lang.org/reference/when_unless.html#(form._((lib._racket/private/letstx-scheme..rkt)._unless))" class="docs" hyphens="none">unless</a> and <a href="http://docs.racket-lang.org/reference/when_unless.html#(form._((lib._racket/private/letstx-scheme..rkt)._when))" class="docs" hyphens="none">when</a> (as they are in <span class="my-code" decode="exclude">br/cond</span>):</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_wA2uQ&quot;)"></div><div class="highlight-container" id="a_wA2uQ"><div id="code_47" form="false" decode="exclude" style="font-size:0;width:0;height:0">(define-macro (until COND EXPR ...)<br/>  #'(let loop ()<br/>      (unless COND<br/>        EXPR ...<br/>        (loop))))<br/><br/>(define-macro (while COND EXPR ...)<br/>  #'(let loop ()<br/>      (when COND<br/>        EXPR ...<br/>        (loop))))</div><div class="highlight" form="false" id="a_wnDmv"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="source"><pre><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br/index.html#(form._((lib._br/define..rkt)._define-macro))" class="docs" hyphens="none">define-macro</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br/index.html#(form._((lib._br/cond..rkt)._until))" class="docs" hyphens="none">until</a></span> <span class="n">COND</span> <span class="n">EXPR</span> <span class="nb"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))" class="docs" hyphens="none">...</a></span><span class="p">)</span>
  <span class="o">#&#39;</span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))" class="docs" hyphens="none">let</a></span> <span class="n">loop</span> <span class="p">()</span>
      <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/when_unless.html#(form._((lib._racket/private/letstx-scheme..rkt)._unless))" class="docs" hyphens="none">unless</a></span> <span class="n">COND</span>
        <span class="n">EXPR</span> <span class="nb"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))" class="docs" hyphens="none">...</a></span>
        <span class="p">(</span><span class="n">loop</span><span class="p">))))</span>

<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br/index.html#(form._((lib._br/define..rkt)._define-macro))" class="docs" hyphens="none">define-macro</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br/index.html#(form._((lib._br/cond..rkt)._while))" class="docs" hyphens="none">while</a></span> <span class="n">COND</span> <span class="n">EXPR</span> <span class="nb"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))" class="docs" hyphens="none">...</a></span><span class="p">)</span>
  <span class="o">#&#39;</span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))" class="docs" hyphens="none">let</a></span> <span class="n">loop</span> <span class="p">()</span>
      <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/when_unless.html#(form._((lib._racket/private/letstx-scheme..rkt)._when))" class="docs" hyphens="none">when</a></span> <span class="n">COND</span>
        <span class="n">EXPR</span> <span class="nb"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))" class="docs" hyphens="none">...</a></span>
        <span class="p">(</span><span class="n">loop</span><span class="p">))))</span>
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpk4" data-clipboard-target="#code_47" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;the-br-quicklang-dialect&quot;)"></div><h3 anchor="the-br-quicklang-dialect" class="subhead" id="the-br-quicklang-dialect"><a href="#the-br-quicklang-dialect">The br/quick­lang dialect</a></h3></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_ub2to&quot;)"></div><p id="a_ub2to"><span class="my-code" decode="exclude">#lang br/quicklang</span> is a vari­ant of the <span class="my-code" decode="exclude">#lang br</span> lan­guage for <a class="glossary" href="glossary.html#expander"><span class="glossary-link-text">expander</span></a> mod­ules that auto­mat­i­cally exports <a href="http://docs.racket-lang.org/reference/__top.html#(form._((quote._~23~25kernel)._~23~25top))" class="docs" hyphens="none">#%top</a>, <a href="http://docs.racket-lang.org/reference/application.html#(form._((lib._racket/private/base..rkt)._~23~25app))" class="docs" hyphens="none">#%app</a>, <a href="http://docs.racket-lang.org/reference/quote.html#(form._((quote._~23~25kernel)._~23~25datum))" class="docs" hyphens="none">#%datum</a>, and <a href="http://docs.racket-lang.org/reference/__top-interaction.html#(form._((lib._racket/private/base..rkt)._~23~25top-interaction))" class="docs" hyphens="none">#%top-interaction</a>. As above, if you’re embark­ing on your own lan­guage, you should build on <span class="my-code" decode="exclude">racket/base</span>, because <span class="my-code" decode="exclude">br/quicklang</span> does noth­ing that you couldn’t do your­self in two lines of code.</p></div></div>
    <a class="nav-left" href="domain-specific-languages.html">← prev</a>
    <a class="nav-right" href="glossary.html">next →</a>




</body>

<script type="text/javascript">



function show_all_forms() {
 var elems = document.getElementsByClassName('has_form');
 for (var i = 0 ; i < elems.length ; i++) {
  toggle_form(elems[i].id);
 }
}

// for debugging forms only: uncomment next line
// show_all_forms();

// sets up copy-to-clipboard buttons in code boxes
var clipboard = new Clipboard('.copy-button');
clipboard.on('success', function(e) {console.log(e);});
clipboard.on('error', function(e) {console.log(e);});
</script>