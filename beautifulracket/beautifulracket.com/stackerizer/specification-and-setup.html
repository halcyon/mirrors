<!DOCTYPE html>
<html>
  
<!-- Mirrored from beautifulracket.com/stackerizer/specification-and-setup.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 16 Mar 2017 05:47:16 GMT -->
<head>
    <meta charset="UTF-8">
    <title>Beautiful Racket: Dive deeper into macros: stackerizer</title>
    <link rel="stylesheet" type="text/css" media="all" href="../styles.css"/>
    <script type="text/javascript" src="../functions.js"></script>
    <script type="text/javascript" src="../clipboard.min.js"></script>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-74684045-1', 'auto');
      ga('send', 'pageview');
    </script>
  </head>
<body>
<div id="alert">Thank you for your comment</div>
    <div id="doc"><h3 class="dept" anchorize="false"><a href="../index.html">Beau­ti­ful Racket</a> / <a href="../index.html#tutorials">tuto­ri­als</a></h3><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;dive-deeper-into-macros-stackerizer&quot;)"></div><h1 anchor="dive-deeper-into-macros-stackerizer" id="dive-deeper-into-macros-stackerizer" hyphens="none">Dive deeper into macros: <span class="my-code" decode="exclude">stackerizer</span></h1></div><ul class="siblinks"><li><a href="intro.html">1&emsp;intro</a></li><li><a class="here" href="specification-and-setup.html">2&emsp;spec­i­fi­ca­tion and setup</a></li><li><a href="the-expander.html">3&emsp;the expander</a></li><li><a href="recap.html">4&emsp;recap</a></li><li><a href="source-listing.html">5&emsp;source list­ing</a></li></ul><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;specification&quot;)"></div><h3 anchor="specification" class="subhead" id="specification"><a href="#specification">Spec­i­fi­ca­tion</a></h3></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_GYWcJ&quot;)"></div><p id="a_GYWcJ">We said that <span class="my-code" decode="exclude">stackerizer</span> would con­vert an “appro­pri­ate” Racket S-expres­sion into a <span class="my-code" decode="exclude">stacker</span> pro­gram. To keep things sim­ple, we’ll sup­port only a lim­ited vocab­u­lary of S-expres­sions:</p></div><ul><li><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_5neXu&quot;)"></div><p id="a_5neXu">The <span class="my-code" decode="exclude">+</span> and <span class="my-code" decode="exclude">*</span> oper­a­tors. Of course.</p></div></li><li><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_xm31W&quot;)"></div><p id="a_xm31W">Any num­bers as argu­ments to these oper­a­tors, in any quan­tity. Let’s remem­ber that <span class="my-code" decode="exclude">stacker</span> can only per­form oper­a­tions on two argu­ments at a time, so we’ll need to make some kind of trans­la­tion there.</p></div></li><li><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_vKTfd&quot;)"></div><p id="a_vKTfd">Any degree of nest­ing. <span class="my-code" decode="exclude">stacker</span> only han­dles a flat list of argu­ments, so we’ll have to flat­ten the nest­ing some­how.</p></div></li><li><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_KraSM&quot;)"></div><p id="a_KraSM">A <span class="my-code" decode="exclude">stacker</span> pro­gram rep­re­sents a sin­gle expres­sion. There­fore, the <span class="my-code" decode="exclude">stackerizer</span> lan­guage only needs to han­dle a sin­gle expres­sion as input.</p></div></li></ul><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;setup&quot;)"></div><h3 anchor="setup" class="subhead" id="setup"><a href="#setup">Setup</a></h3></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_SDGIm&quot;)"></div><p id="a_SDGIm">Open DrRacket. Start a new file called <span class="my-code" decode="exclude">"stackerizer.rkt"</span> and save it in a con­ve­nient loca­tion. All we need for now is the <span class="my-code" decode="exclude">#lang</span> line:</p></div><div class="filebox" anchorize="false"><div class="filename" anchorize="false" decode="exclude">stackerizer.rkt</div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_ueZEA&quot;)"></div><div class="highlight-container" id="a_ueZEA"><div id="code_43" form="false" decode="exclude" style="font-size:0;width:0;height:0">#lang br/quicklang</div><div class="highlight" form="false" id="a_wDVlz"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="source"><pre><span class="kn">#lang </span><span class="nn">br/quicklang</span>
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpk" data-clipboard-target="#code_43" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_saVUx&quot;)"></div><p id="a_saVUx">In the same direc­tory, cre­ate a sec­ond file called <span class="my-code" decode="exclude">"stackerizer-test.rkt"</span>, also blank except for the <span class="my-code" decode="exclude">#lang</span> line:</p></div><div class="filebox" anchorize="false"><div class="filename" anchorize="false" decode="exclude">stackerizer-test.rkt</div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_9oOU0&quot;)"></div><div class="highlight-container" id="a_9oOU0"><div id="code_44" form="false" decode="exclude" style="font-size:0;width:0;height:0">#lang s-exp "stackerizer.rkt"
</div><div class="highlight" form="false" id="a_ndR0J"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="source"><pre><span class="kn">#lang </span><span class="nn">s-exp</span> <span class="s2">"stackerizer.rkt"</span>
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpk1" data-clipboard-target="#code_44" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_XoqkJ&quot;)"></div><p id="a_XoqkJ">Instead of <span class="my-code" decode="exclude">#lang reader <em>path</em></span>, we’re using the new <span class="my-code" decode="exclude">#lang s-exp <em>path</em></span> nota­tion. Recall that <span class="my-code" decode="exclude">#lang reader <em>path</em></span> was con­ve­nient for a pro­to­type lan­guage, because it allows us to boot­strap into a cer­tain <a class="glossary" href="../appendix/glossary.html#reader"><span class="glossary-link-text">reader</span></a> (which in turn points to an <a class="glossary" href="../appendix/glossary.html#expander"><span class="glossary-link-text">expander</span></a>).</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_xFklp&quot;)"></div><p id="a_xFklp">By con­trast, <span class="my-code" decode="exclude">#lang s-exp <em>path</em></span> does two things.</p></div><ol><li><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_EXrEn&quot;)"></div><p id="a_EXrEn">Instead of mak­ing our own reader, <span class="my-code" decode="exclude">#lang s-exp</span> invokes Racket’s default reader (which reads <a class="glossary" href="../appendix/glossary.html#s-expression"><span class="glossary-link-text">S-expres­sions</span></a>, thus it’s abbre­vi­ated <span class="my-code" decode="exclude">s-exp</span>). In other words, because our new lan­guage is already made of S-expres­sions, we can skip the fan­dango of mak­ing our own <span class="my-code" decode="exclude">read-syntax</span> func­tion.</p></div></li><li><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_qS6Pw&quot;)"></div><p id="a_qS6Pw">We can­not, how­ever, skip mak­ing an expander. So the other job of <span class="my-code" decode="exclude">#lang s-exp</span> is to iden­tify the expander we want to use, in this case <span class="my-code" decode="exclude">"stackerizer.rkt"</span>.</p></div></li></ol><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_QOk6w&quot;)"></div><p id="a_QOk6w">Every­thing else works the same way. Just like the <span class="my-code" decode="exclude">read-syntax</span> func­tion we made before, the <span class="my-code" decode="exclude">s-exp</span> reader returns the code for a mod­ule, pack­aged as a <a class="glossary" href="../appendix/glossary.html#syntax-object"><span class="glossary-link-text">syn­tax object</span></a>. And as before, our expander will need to start with a <span class="my-code" decode="exclude">#%module-begin</span> macro.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_n0wrz&quot;)"></div><p id="a_n0wrz">In Racket lingo, a lan­guage that uses the stan­dard S-expres­sion reader is known as a <em><a class="glossary" href="../appendix/glossary.html#module-language"><span class="glossary-link-text">mod­ule lan­guage</span></a></em>. Like <a class="glossary" href="../appendix/glossary.html#macro"><span class="glossary-link-text">macro</span></a> vs. <a class="glossary" href="../appendix/glossary.html#function"><span class="glossary-link-text">func­tion</span></a>, this ter­mi­nol­ogy is coun­ter­in­tu­itive. All Racket code lives in some <a class="glossary" href="../appendix/glossary.html#module"><span class="glossary-link-text">mod­ule</span></a>. There­fore, a lan­guage that uses a cus­tom reader can only get it from a mod­ule. Any­how. If we see “mod­ule lan­guage” in the Racket docs, we’ll know that it refers more pre­cisely to a lan­guage that has no cus­tom reader.</p></div><div anchorize="false" style="height:2em"></div><ul class="siblinks"><li><a href="intro.html">1&emsp;intro</a></li><li><a class="here" href="specification-and-setup.html">2&emsp;spec­i­fi­ca­tion and setup</a></li><li><a href="the-expander.html">3&emsp;the expander</a></li><li><a href="recap.html">4&emsp;recap</a></li><li><a href="source-listing.html">5&emsp;source list­ing</a></li></ul></div>
    <a class="nav-left" href="intro.html">← prev</a>
    <a class="nav-right" href="the-expander.html">next →</a>




</body>

<script type="text/javascript">



function show_all_forms() {
 var elems = document.getElementsByClassName('has_form');
 for (var i = 0 ; i < elems.length ; i++) {
  toggle_form(elems[i].id);
 }
}

// for debugging forms only: uncomment next line
// show_all_forms();

// sets up copy-to-clipboard buttons in code boxes
var clipboard = new Clipboard('.copy-button');
clipboard.on('success', function(e) {console.log(e);});
clipboard.on('error', function(e) {console.log(e);});
</script>