<!DOCTYPE html>
<html>
  
<!-- Mirrored from beautifulracket.com/explainer/hygiene.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 16 Mar 2017 05:46:55 GMT -->
<head>
    <meta charset="UTF-8">
    <title>Beautiful Racket: Hygiene</title>
    <link rel="stylesheet" type="text/css" media="all" href="../styles.css"/>
    <script type="text/javascript" src="../functions.js"></script>
    <script type="text/javascript" src="../clipboard.min.js"></script>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-74684045-1', 'auto');
      ga('send', 'pageview');
    </script>
  </head>
<body>
<div id="alert">Thank you for your comment</div>
    <div id="doc"><h3 class="dept" anchorize="false"><a href="../index.html">Beau­ti­ful Racket</a> / <a href="../index.html#explainers">explain­ers</a></h3><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;hygiene&quot;)"></div><h1 anchor="hygiene" id="hygiene" hyphens="none">Hygiene</h1></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_YobBI&quot;)"></div><p id="a_YobBI"><em>Hygiene</em> is the orga­niz­ing pol­icy of Racket’s <a class="glossary" href="../appendix/glossary.html#macro"><span class="glossary-link-text">macro</span></a> sys­tem. Under­stand­ing hygiene is the key to under­stand­ing how macros work, and by exten­sion, how to write good macros of your own. Con­versely, not under­stand­ing hygiene can make Racket macros seem con­fus­ing and mys­te­ri­ous. But they are not.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_5e45i&quot;)"></div><p id="a_5e45i">Hygiene is the answer to a sim­ple ques­tion: a macro gen­er­ates code that gets deposited else­where. When that code is eval­u­ated, how should we deter­mine the <a class="glossary" href="../appendix/glossary.html#binding"><span class="glossary-link-text">bind­ings</span></a> of the <a class="glossary" href="../appendix/glossary.html#identifier"><span class="glossary-link-text">iden­ti­fiers</span></a> inside? <span class="tooltip" onclick="this.classList.toggle('tooltip_visible')"> + <span class="tooltip-inner">Because a Racket pro­gram can’t run unless every iden­ti­fier has a bind­ing. See <a class="explainer" href="identifiers.html">iden­ti­fiers</a>.</span></span> We have two choices:</p></div><ol><li><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_gYkV0&quot;)"></div><p id="a_gYkV0">Deter­mine the bind­ings accord­ing to what the iden­ti­fiers mean at the place where the macro was defined (aka the <a class="glossary" href="../appendix/glossary.html#definition-site"><span class="glossary-link-text">def­i­n­i­tion site</span></a>). This is Racket’s default pol­icy, and part of what is implied by hygiene.</p></div></li><li><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_RKErx&quot;)"></div><p id="a_RKErx">Deter­mine the bind­ings accord­ing to what the iden­ti­fiers mean at the place where the macro was invoked (aka the <a class="glossary" href="../appendix/glossary.html#calling-site"><span class="glossary-link-text">call­ing site</span></a>). Some­times this is the behav­ior we want, so Racket lets us “break hygiene” when we need to.</p></div></li></ol><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_dMXof&quot;)"></div><p id="a_dMXof">To deter­mine the bind­ing of an iden­ti­fier, we look inside the <a class="glossary" href="../appendix/glossary.html#lexical-context"><span class="glossary-link-text">lex­i­cal con­text</span></a> attached to the code, which holds all the avail­able bind­ings. So hygiene can be seen as a way of man­ag­ing lex­i­cal con­texts. In the exam­ple below, there are two iden­ti­fiers named <span class="my-code" decode="exclude">x</span>. But they live in sep­a­rate lex­i­cal con­texts, so thanks to hygiene, they don’t col­lide:</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_4dEx0&quot;)"></div><div class="highlight-container" id="a_4dEx0"><div id="code_43" form="false" decode="exclude" style="font-size:0;width:0;height:0">(define x 42)<br/>(define-macro (def-print-x)<br/>  #'(begin<br/>      (define x 84)<br/>      (println x)))<br/>(def-print-x) ; 84<br/>(println x) ; 42</div><div class="highlight" form="false" id="a_UAuMj"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="source"><pre><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="n">x</span> <span class="mi">42</span><span class="p">)</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br/index.html#(form._((lib._br/define..rkt)._define-macro))" class="docs" hyphens="none">define-macro</a></span> <span class="p">(</span><span class="n">def-print-x</span><span class="p">)</span>
  <span class="o">#&#39;</span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/begin.html#(form._((quote._~23~25kernel)._begin))" class="docs" hyphens="none">begin</a></span>
      <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="n">x</span> <span class="mi">84</span><span class="p">)</span>
      <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/Writing.html#(def._((lib._racket/private/misc..rkt)._println))" class="docs" hyphens="none">println</a></span> <span class="n">x</span><span class="p">)))</span>
<span class="p">(</span><span class="n">def-print-x</span><span class="p">)</span> <span class="c1">; 84</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/Writing.html#(def._((lib._racket/private/misc..rkt)._println))" class="docs" hyphens="none">println</a></span> <span class="n">x</span><span class="p">)</span> <span class="c1">; 42</span>
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpk" data-clipboard-target="#code_43" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;what-problem-does-hygiene-solve&quot;)"></div><h3 anchor="what-problem-does-hygiene-solve" class="subhead" id="what-problem-does-hygiene-solve"><a href="#what-problem-does-hygiene-solve">What prob­lem does hygiene solve?</a></h3></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_5nFwP&quot;)"></div><p id="a_5nFwP">With­out hygiene, every iden­ti­fier would be treated as if it lived in the lex­i­cal con­text of the call­ing site. While this has an appeal­ing sim­plic­ity, it quickly runs aground on the shoals of prac­ti­cal­ity.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_j6jK3&quot;)"></div><p id="a_j6jK3">Let’s con­vert the exam­ple above into an unhy­gienic macro, so it invades the lex­i­cal con­text of the call­ing site. It won’t work, because the two iden­ti­fiers named <span class="my-code" decode="exclude">x</span> now col­lide:</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_p02nq&quot;)"></div><div class="highlight-container" id="a_p02nq"><div id="code_44" form="false" decode="exclude" style="font-size:0;width:0;height:0">(define x 42)<br/>(define-unhygienic-macro (def-print-x)<br/>  #'(begin<br/>      (define x 84)<br/>      (println x)))<br/>(def-print-x) ; error: duplicate definition</div><div class="highlight" form="false" id="a_770Sv"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="source"><pre><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="n">x</span> <span class="mi">42</span><span class="p">)</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br/index.html#(form._((lib._br/define..rkt)._define-unhygienic-macro))" class="docs" hyphens="none">define-unhygienic-macro</a></span> <span class="p">(</span><span class="n">def-print-x</span><span class="p">)</span>
  <span class="o">#&#39;</span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/begin.html#(form._((quote._~23~25kernel)._begin))" class="docs" hyphens="none">begin</a></span>
      <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="n">x</span> <span class="mi">84</span><span class="p">)</span>
      <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/Writing.html#(def._((lib._racket/private/misc..rkt)._println))" class="docs" hyphens="none">println</a></span> <span class="n">x</span><span class="p">)))</span>
<span class="p">(</span><span class="n">def-print-x</span><span class="p">)</span> <span class="c1">; error: duplicate definition</span>
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpk1" data-clipboard-target="#code_44" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_8Y9TV&quot;)"></div><p id="a_8Y9TV">“No prob­lem—just change the macro to use an iden­ti­fier with a dis­tinct name.” But how? The macro doesn’t know any­thing about where it will be called, or what iden­ti­fiers are already being used there. So there’s no way to guar­an­tee any par­tic­u­lar iden­ti­fier will be dis­tinct. Hygiene, by con­trast, keeps lex­i­cal con­texts sep­a­rate, thereby elim­i­nat­ing the pos­si­bil­ity of inad­ver­tent name col­li­sions. <span class="tooltip" onclick="this.classList.toggle('tooltip_visible')"> + <span class="tooltip-inner">A prob­lem also known as <em>iden­ti­fier cap­ture</em>.</span></span></p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_phxIO&quot;)"></div><p id="a_phxIO">The prob­lem can run in the oppo­site direc­tion as well:</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_rAXNz&quot;)"></div><div class="highlight-container" id="a_rAXNz"><div id="code_45" form="false" decode="exclude" style="font-size:0;width:0;height:0">(define-macro (mac) #'(println "mac runs"))<br/>(define-unhygienic-macro (u-mac) #'(println "u-mac runs"))<br/>(mac)<br/>(u-mac)<br/>(module+ main<br/>  (define (println thing) (error 'zombie-apocalypse-started))<br/>  (mac)<br/>  (u-mac))</div><div class="highlight" form="false" id="a_DkTmr"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="source"><pre><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br/index.html#(form._((lib._br/define..rkt)._define-macro))" class="docs" hyphens="none">define-macro</a></span> <span class="p">(</span><span class="n">mac</span><span class="p">)</span> <span class="o">#&#39;</span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/Writing.html#(def._((lib._racket/private/misc..rkt)._println))" class="docs" hyphens="none">println</a></span> <span class="s2">"mac runs"</span><span class="p">))</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br/index.html#(form._((lib._br/define..rkt)._define-unhygienic-macro))" class="docs" hyphens="none">define-unhygienic-macro</a></span> <span class="p">(</span><span class="n">u-mac</span><span class="p">)</span> <span class="o">#&#39;</span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/Writing.html#(def._((lib._racket/private/misc..rkt)._println))" class="docs" hyphens="none">println</a></span> <span class="s2">"u-mac runs"</span><span class="p">))</span>
<span class="p">(</span><span class="n">mac</span><span class="p">)</span>
<span class="p">(</span><span class="n">u-mac</span><span class="p">)</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/module.html#(form._((lib._racket/private/base..rkt)._module+))" class="docs" hyphens="none">module+</a></span> <span class="n">main</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/Writing.html#(def._((lib._racket/private/misc..rkt)._println))" class="docs" hyphens="none">println</a></span> <span class="n">thing</span><span class="p">)</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/exns.html#(def._((quote._~23~25kernel)._error))" class="docs" hyphens="none">error</a></span> <span class="o">&#39;</span><span class="ss">zombie-apocalypse-started</span><span class="p">))</span>
  <span class="p">(</span><span class="n">mac</span><span class="p">)</span>
  <span class="p">(</span><span class="n">u-mac</span><span class="p">))</span>
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpk2" data-clipboard-target="#code_45" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_F91W5&quot;)"></div><div class="highlight-container" id="a_F91W5"><div id="code_46" form="false" decode="exclude" style="font-size:0;width:0;height:0">"mac runs"<br/>"u-mac runs"<br/>"mac runs"<br/>error: zombie-apocalypse-started</div><div class="highlight" form="false" id="a_8ofZm"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="source"><pre><span class="s2">"mac runs"</span>
<span class="s2">"u-mac runs"</span>
<span class="s2">"mac runs"</span>
<span class="n">error:</span> <span class="n">zombie-apocalypse-started</span>
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpk3" data-clipboard-target="#code_46" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_PYQ6B&quot;)"></div><p id="a_PYQ6B">In this exam­ple, our <span class="my-code" decode="exclude">mac</span> and <span class="my-code" decode="exclude">u-mac</span> macros impliedly rely on <a href="http://docs.racket-lang.org/reference/Writing.html#(def._((lib._racket/private/misc..rkt)._println))" class="docs" hyphens="none">println</a> hav­ing its usual mean­ing. But it might not. Within the <span class="my-code" decode="exclude">main</span> mod­ule, <span class="my-code" decode="exclude">println</span> has been rede­fined. At that point, the behav­ior of the hygienic macro remains con­sis­tent: thanks to hygiene, it retains the orig­i­nal bind­ing of <span class="my-code" decode="exclude">println</span>. Whereas the unhy­gienic macro becomes unpre­dictable.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_k8NMG&quot;)"></div><p id="a_k8NMG">More broadly, hygiene can be seen as a way of mak­ing macros more <a class="glossary" href="../appendix/glossary.html#composable"><span class="glossary-link-text">com­pos­able</span></a>, which is a gen­eral design goal of func­tional lan­guages. Macros can’t know any­thing about the bind­ings used at the call­ing site. There­fore, the best way to ensure con­sis­tent behav­ior is to make macro-gen­er­ated code as self-con­tained as pos­si­ble.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;the-golden-rules&quot;)"></div><h3 anchor="the-golden-rules" class="subhead" id="the-golden-rules"><a href="#the-golden-rules">The golden rules</a></h3></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_TNiOW&quot;)"></div><p id="a_TNiOW">For the macro writer, there are four golden rules of hygiene:</p></div><ol><li><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_1ZcG5&quot;)"></div><p id="a_1ZcG5">Code pro­duced by a macro adopts the lex­i­cal con­text of the macro-def­i­n­i­tion site. There­fore, this code can only rely on iden­ti­fiers that have bind­ings at the def­i­n­i­tion site. Below, the <span class="my-code" decode="exclude">def-print-x</span> macro can cre­ate code that refers to <span class="my-code" decode="exclude">x</span>, because <span class="my-code" decode="exclude">x</span> has a bind­ing at the macro-def­i­n­i­tion site (albeit out­side the macro):</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_dXK0m&quot;)"></div><div class="highlight-container" id="a_dXK0m"><div id="code_47" form="false" decode="exclude" style="font-size:0;width:0;height:0">(define x 42)<br/>(define-macro (def-print-x)<br/>  #'(println x))<br/>(def-print-x) ; 42</div><div class="highlight" form="false" id="a_p5mAA"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="source"><pre><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="n">x</span> <span class="mi">42</span><span class="p">)</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br/index.html#(form._((lib._br/define..rkt)._define-macro))" class="docs" hyphens="none">define-macro</a></span> <span class="p">(</span><span class="n">def-print-x</span><span class="p">)</span>
  <span class="o">#&#39;</span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/Writing.html#(def._((lib._racket/private/misc..rkt)._println))" class="docs" hyphens="none">println</a></span> <span class="n">x</span><span class="p">))</span>
<span class="p">(</span><span class="n">def-print-x</span><span class="p">)</span> <span class="c1">; 42</span>
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpk4" data-clipboard-target="#code_47" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div></li><li><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_Ok8rJ&quot;)"></div><p id="a_Ok8rJ">Within code pro­duced by the macro, new bind­ings can <a class="glossary" href="../appendix/glossary.html#shadow"><span class="glossary-link-text">shadow</span></a> exist­ing bind­ings at the def­i­n­i­tion site (sim­i­lar to how <a href="http://docs.racket-lang.org/reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))" class="docs" hyphens="none">let</a> works). For exam­ple, this updated <span class="my-code" decode="exclude">def-print-x</span> macro defines its own <span class="my-code" decode="exclude">x</span>, which over­rides the <span class="my-code" decode="exclude">x</span> defined out­side the macro, so the result is now <span class="my-code" decode="exclude">84</span>:</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_8b4nN&quot;)"></div><div class="highlight-container" id="a_8b4nN"><div id="code_48" form="false" decode="exclude" style="font-size:0;width:0;height:0">(define x 42)<br/>(define-macro (def-print-x)<br/>  #'(begin<br/>      (define x 84)<br/>      (println x)))<br/>(def-print-x) ; 84</div><div class="highlight" form="false" id="a_N5xRT"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="source"><pre><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="n">x</span> <span class="mi">42</span><span class="p">)</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br/index.html#(form._((lib._br/define..rkt)._define-macro))" class="docs" hyphens="none">define-macro</a></span> <span class="p">(</span><span class="n">def-print-x</span><span class="p">)</span>
  <span class="o">#&#39;</span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/begin.html#(form._((quote._~23~25kernel)._begin))" class="docs" hyphens="none">begin</a></span>
      <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="n">x</span> <span class="mi">84</span><span class="p">)</span>
      <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/Writing.html#(def._((lib._racket/private/misc..rkt)._println))" class="docs" hyphens="none">println</a></span> <span class="n">x</span><span class="p">)))</span>
<span class="p">(</span><span class="n">def-print-x</span><span class="p">)</span> <span class="c1">; 84</span>
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpk5" data-clipboard-target="#code_48" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div></li><li><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_Df6iR&quot;)"></div><p id="a_Df6iR">Bind­ings intro­duced by a macro are only vis­i­ble to other code pro­duced by that macro. In the exam­ple below, one <span class="my-code" decode="exclude">x</span> is defined out­side the <span class="my-code" decode="exclude">def-print-x</span> macro; another is defined inside. The <span class="my-code" decode="exclude">(println x)</span> gen­er­ated by the macro refers to the <span class="my-code" decode="exclude">x</span> defined by the macro. The <span class="my-code" decode="exclude">(println x)</span> out­side the macro refers to the <span class="my-code" decode="exclude">x</span> defined out­side the macro. So we end up with two iden­ti­fiers called <span class="my-code" decode="exclude">x</span> with dif­fer­ent val­ues:</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_4dEx08&quot;)"></div><div class="highlight-container" id="a_4dEx08"><div id="code_49" form="false" decode="exclude" style="font-size:0;width:0;height:0">(define x 42)<br/>(define-macro (def-print-x)<br/>  #'(begin<br/>      (define x 84)<br/>      (println x)))<br/>(def-print-x) ; 84<br/>(println x) ; 42</div><div class="highlight" form="false" id="a_UAuMj6"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="source"><pre><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="n">x</span> <span class="mi">42</span><span class="p">)</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br/index.html#(form._((lib._br/define..rkt)._define-macro))" class="docs" hyphens="none">define-macro</a></span> <span class="p">(</span><span class="n">def-print-x</span><span class="p">)</span>
  <span class="o">#&#39;</span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/begin.html#(form._((quote._~23~25kernel)._begin))" class="docs" hyphens="none">begin</a></span>
      <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="n">x</span> <span class="mi">84</span><span class="p">)</span>
      <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/Writing.html#(def._((lib._racket/private/misc..rkt)._println))" class="docs" hyphens="none">println</a></span> <span class="n">x</span><span class="p">)))</span>
<span class="p">(</span><span class="n">def-print-x</span><span class="p">)</span> <span class="c1">; 84</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/Writing.html#(def._((lib._racket/private/misc..rkt)._println))" class="docs" hyphens="none">println</a></span> <span class="n">x</span><span class="p">)</span> <span class="c1">; 42</span>
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpk7" data-clipboard-target="#code_49" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_7qvue&quot;)"></div><p id="a_7qvue">The corol­lary to this rule is that bind­ings intro­duced by a macro are <strong>not vis­i­ble out­side</strong> the macro. Every early-stage Rack­e­teer tries to write a vari­a­tion of the <span class="my-code" decode="exclude">make-x</span> macro below, and is flum­moxed by the error:</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_NIniF&quot;)"></div><div class="highlight-container" id="a_NIniF"><div id="code_50" form="false" decode="exclude" style="font-size:0;width:0;height:0">(define-macro (make-x)<br/>  #'(define x 42))<br/>(make-x)<br/>(println x) ; error: unbound identifier</div><div class="highlight" form="false" id="a_Ou9Oo"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="source"><pre><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br/index.html#(form._((lib._br/define..rkt)._define-macro))" class="docs" hyphens="none">define-macro</a></span> <span class="p">(</span><span class="n">make-x</span><span class="p">)</span>
  <span class="o">#&#39;</span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="n">x</span> <span class="mi">42</span><span class="p">))</span>
<span class="p">(</span><span class="n">make-x</span><span class="p">)</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/Writing.html#(def._((lib._racket/private/misc..rkt)._println))" class="docs" hyphens="none">println</a></span> <span class="n">x</span><span class="p">)</span> <span class="c1">; error: unbound identifier</span>
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpk9" data-clipboard-target="#code_50" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_j2r7L&quot;)"></div><p id="a_j2r7L">But it’s not sur­pris­ing: the <span class="my-code" decode="exclude">x</span> defined inside the macro lives inside a sep­a­rate lex­i­cal con­text, and the <span class="my-code" decode="exclude">(println x)</span> out­side the macro can’t see it. If this still annoys you, con­sider an anal­o­gous exam­ple with <span class="my-code" decode="exclude">let</span>, which won’t sur­prise any­one.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_NKqKV&quot;)"></div><div class="highlight-container" id="a_NKqKV"><div id="code_51" form="false" decode="exclude" style="font-size:0;width:0;height:0">(let ([x 42])<br/>  x)<br/>(println x) ; error: unbound identifier</div><div class="highlight" form="false" id="a_nyKMl"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="source"><pre><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))" class="docs" hyphens="none">let</a></span> <span class="p">([</span><span class="n">x</span> <span class="mi">42</span><span class="p">])</span>
  <span class="n">x</span><span class="p">)</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/Writing.html#(def._((lib._racket/private/misc..rkt)._println))" class="docs" hyphens="none">println</a></span> <span class="n">x</span><span class="p">)</span> <span class="c1">; error: unbound identifier</span>
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpka" data-clipboard-target="#code_51" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div></li><li><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_bXBds&quot;)"></div><p id="a_bXBds">Every iden­ti­fier retains its bind­ing from its orig­i­nal lex­i­cal con­text. <span class="tooltip" onclick="this.classList.toggle('tooltip_visible')"> + <span class="tooltip-inner">This is accom­plished by using <a class="explainer" href="syntax-objects.html">syn­tax objects</a> through­out the macro sys­tem.</span></span> Here, we pass the outer <span class="my-code" decode="exclude">x</span> to our macro as an argu­ment and assign it to the pat­tern vari­able <span class="my-code" decode="exclude">OUTER-X</span>. When <span class="my-code" decode="exclude">OUTER-X</span> appears in our macro code, it still refers to the <span class="my-code" decode="exclude">x</span> defined out­side the macro, while the other <span class="my-code" decode="exclude">x</span> refers to the one defined inside the macro:</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_2VZJx&quot;)"></div><div class="highlight-container" id="a_2VZJx"><div id="code_52" form="false" decode="exclude" style="font-size:0;width:0;height:0">(define x 42)<br/>(define-macro (def-print-x OUTER-X)<br/>  #'(begin<br/>      (define x 84)<br/>      (println x)<br/>      (println OUTER-X)))<br/>(def-print-x x)</div><div class="highlight" form="false" id="a_7svNi"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="source"><pre><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="n">x</span> <span class="mi">42</span><span class="p">)</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br/index.html#(form._((lib._br/define..rkt)._define-macro))" class="docs" hyphens="none">define-macro</a></span> <span class="p">(</span><span class="n">def-print-x</span> <span class="n">OUTER-X</span><span class="p">)</span>
  <span class="o">#&#39;</span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/begin.html#(form._((quote._~23~25kernel)._begin))" class="docs" hyphens="none">begin</a></span>
      <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="n">x</span> <span class="mi">84</span><span class="p">)</span>
      <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/Writing.html#(def._((lib._racket/private/misc..rkt)._println))" class="docs" hyphens="none">println</a></span> <span class="n">x</span><span class="p">)</span>
      <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/Writing.html#(def._((lib._racket/private/misc..rkt)._println))" class="docs" hyphens="none">println</a></span> <span class="n">OUTER-X</span><span class="p">)))</span>
<span class="p">(</span><span class="n">def-print-x</span> <span class="n">x</span><span class="p">)</span>
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpkb" data-clipboard-target="#code_52" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_vWwTD&quot;)"></div><div class="highlight-container" id="a_vWwTD"><div id="code_53" form="false" decode="exclude" style="font-size:0;width:0;height:0">84<br/>42</div><div class="highlight" form="false" id="a_mm0aH"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="source"><pre><span class="mi">84</span>
<span class="mi">42</span>
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpkc" data-clipboard-target="#code_53" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div></li></ol><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;breaking-hygiene&quot;)"></div><h3 anchor="breaking-hygiene" class="subhead" id="breaking-hygiene"><a href="#breaking-hygiene">Break­ing hygiene</a></h3></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_TjqPA&quot;)"></div><p id="a_TjqPA">Some­times a macro needs to intro­duce iden­ti­fiers into the lex­i­cal con­text of the call­ing site. These iden­ti­fiers are called <a class="glossary" href="../appendix/glossary.html#unhygienic"><span class="glossary-link-text">unhy­gienic</span></a>. Despite the shame­ful-sound­ing name, there’s noth­ing wrong with unhy­gienic iden­ti­fiers. On the con­trary, some­times they’re the right tool for the job. But it’s vir­tu­ous to reserve them for when they’re needed.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_dYqHi&quot;)"></div><p id="a_dYqHi">Macros rely on hygiene by default. There­fore, break­ing hygiene requires us to explic­itly inject our new iden­ti­fier into the tar­get lex­i­cal con­text.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_VZsUv&quot;)"></div><p id="a_VZsUv">A com­mon use for unhy­gienic iden­ti­fiers are macros that extend <a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a> by mod­i­fy­ing the given iden­ti­fier name. <span class="tooltip" onclick="this.classList.toggle('tooltip_visible')"> + <span class="tooltip-inner">For instance, <a href="http://docs.racket-lang.org/reference/define-struct.html#(form._((lib._racket/private/base..rkt)._struct))" class="docs" hyphens="none">struct</a> unhy­gien­i­cally cre­ates set­ter &amp; get­ter iden­ti­fiers for its fields.</span></span> As an exam­ple, let’s make <span class="my-code" decode="exclude">define-$</span>, which works like <span class="my-code" decode="exclude">define</span> except that it appends <span class="my-code" decode="exclude">$</span> to the name of the new func­tion:</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_RyPSC&quot;)"></div><div class="highlight-container" id="a_RyPSC"><div id="code_54" form="false" decode="exclude" style="font-size:0;width:0;height:0">(define-macro (define-$ (ID ARG ...) BODY ...)<br/>  (define id$-datum (format-datum '~a$ (syntax-&gt;datum #'ID)))<br/>  (with-pattern ([ID$ (datum-&gt;syntax #'ID id$-datum)])<br/>    #'(define (ID$ ARG ...)<br/>      BODY ...)))<br/>(define-$ (f x) (* x x))<br/>(f$ 5) ; 25</div><div class="highlight" form="false" id="a_ZIUzO"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="source"><pre><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br/index.html#(form._((lib._br/define..rkt)._define-macro))" class="docs" hyphens="none">define-macro</a></span> <span class="p">(</span><span class="n">define-$</span> <span class="p">(</span><span class="n">ID</span> <span class="n">ARG</span> <span class="nb"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))" class="docs" hyphens="none">...</a></span><span class="p">)</span> <span class="n">BODY</span> <span class="nb"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))" class="docs" hyphens="none">...</a></span><span class="p">)</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="n">id$-datum</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br/index.html#(def._((lib._br/datum..rkt)._format-datum))" class="docs" hyphens="none">format-datum</a></span> <span class="o">&#39;</span><span class="ss">~a$</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/stxops.html#(def._((quote._~23~25kernel)._syntax-~3edatum))" class="docs" hyphens="none">syntax-&gt;datum</a></span> <span class="o">#&#39;</span><span class="n">ID</span><span class="p">)))</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br/index.html#(form._((lib._br/syntax..rkt)._with-pattern))" class="docs" hyphens="none">with-pattern</a></span> <span class="p">([</span><span class="n">ID$</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/stxops.html#(def._((quote._~23~25kernel)._datum-~3esyntax))" class="docs" hyphens="none">datum-&gt;syntax</a></span> <span class="o">#&#39;</span><span class="n">ID</span> <span class="n">id$-datum</span><span class="p">)])</span>
    <span class="o">#&#39;</span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="p">(</span><span class="n">ID$</span> <span class="n">ARG</span> <span class="nb"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))" class="docs" hyphens="none">...</a></span><span class="p">)</span>
      <span class="n">BODY</span> <span class="nb"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))" class="docs" hyphens="none">...</a></span><span class="p">)))</span>
<span class="p">(</span><span class="n">define-$</span> <span class="p">(</span><span class="n">f</span> <span class="n">x</span><span class="p">)</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._*))" class="docs" hyphens="none">*</a></span> <span class="n">x</span> <span class="n">x</span><span class="p">))</span>
<span class="p">(</span><span class="n">f$</span> <span class="mi">5</span><span class="p">)</span> <span class="c1">; 25</span>
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpkd" data-clipboard-target="#code_54" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_a2JGe&quot;)"></div><p id="a_a2JGe">The macro starts with a syn­tax pat­tern that matches our <span class="my-code" decode="exclude">ID</span>, <span class="my-code" decode="exclude">ARG</span>s, and <span class="my-code" decode="exclude">BODY</span> expres­sions. We extract the datum from <span class="my-code" decode="exclude">#'ID</span> with <span class="my-code" decode="exclude">syntax-&gt;datum</span>. We use <a href="http://docs.racket-lang.org/br/index.html#(def._((lib._br/datum..rkt)._format-datum))" class="docs" hyphens="none">format-datum</a> to make a new datum with a <span class="my-code" decode="exclude">$</span> appended, called <span class="my-code" decode="exclude">id$-datum</span>.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_PbanO&quot;)"></div><p id="a_PbanO">The unhy­gienic iden­ti­fier is cre­ated next, with <a href="http://docs.racket-lang.org/reference/stxops.html#(def._((quote._~23~25kernel)._datum-~3esyntax))" class="docs" hyphens="none">datum-&gt;syntax</a>. The first argu­ment of <span class="my-code" decode="exclude">datum-&gt;syntax</span> is the lex­i­cal con­text for the iden­ti­fier being cre­ated. In this case, we use <span class="my-code" decode="exclude">#'ID</span> because it came from the call­ing site, and there­fore has the lex­i­cal con­text we want to bor­row. The sec­ond argu­ment is our datum. We match this new iden­ti­fier to the pat­tern vari­able <span class="my-code" decode="exclude">ID$</span>, so we can use it in the syn­tax tem­plate below. Within the tem­plate, we use <span class="my-code" decode="exclude">ID$</span> in the name posi­tion of a stan­dard <a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a> form.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_oMIfb&quot;)"></div><p id="a_oMIfb">The result is that we can then use the vari­able <span class="my-code" decode="exclude">f$</span> as if we had defined it directly. (The iden­ti­fier <span class="my-code" decode="exclude">f</span> remains unbound.)</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_KJUqa&quot;)"></div><p id="a_KJUqa">There’s no one right way to cre­ate an unhy­gienic iden­ti­fier. The mechan­ics always remain the same. For instance, if the <span class="my-code" decode="exclude">syntax-&gt;datum</span> / <span class="my-code" decode="exclude">datum-&gt;syntax</span> fan­dango gets tire­some, you can use <a href="http://docs.racket-lang.org/br/index.html#(def._((lib._br/syntax..rkt)._prefix-id))" class="docs" hyphens="none">prefix-id</a> and <a href="http://docs.racket-lang.org/br/index.html#(def._((lib._br/syntax..rkt)._suffix-id))" class="docs" hyphens="none">suffix-id</a> as helper func­tions to sim­plify cre­ation of unhy­gienic iden­ti­fiers. They cre­ate a new iden­ti­fier derived from the name and lex­i­cal con­text of an exist­ing iden­ti­fier:</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_TqeuC&quot;)"></div><div class="highlight-container" id="a_TqeuC"><div id="code_55" form="false" decode="exclude" style="font-size:0;width:0;height:0">(define-macro (define-$ (ID ARG ...) BODY ...)<br/>  (with-pattern ([ID$ (suffix-id #'ID '$)])<br/>    #'(define (ID$ ARG ...)<br/>      BODY ...)))<br/>(define-$ (f x) (* x x))<br/>(f$ 5) ; 25</div><div class="highlight" form="false" id="a_rjZsi"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="source"><pre><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br/index.html#(form._((lib._br/define..rkt)._define-macro))" class="docs" hyphens="none">define-macro</a></span> <span class="p">(</span><span class="n">define-$</span> <span class="p">(</span><span class="n">ID</span> <span class="n">ARG</span> <span class="nb"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))" class="docs" hyphens="none">...</a></span><span class="p">)</span> <span class="n">BODY</span> <span class="nb"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))" class="docs" hyphens="none">...</a></span><span class="p">)</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br/index.html#(form._((lib._br/syntax..rkt)._with-pattern))" class="docs" hyphens="none">with-pattern</a></span> <span class="p">([</span><span class="n">ID$</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br/index.html#(def._((lib._br/syntax..rkt)._suffix-id))" class="docs" hyphens="none">suffix-id</a></span> <span class="o">#&#39;</span><span class="n">ID</span> <span class="o">&#39;</span><span class="ss">$</span><span class="p">)])</span>
    <span class="o">#&#39;</span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="p">(</span><span class="n">ID$</span> <span class="n">ARG</span> <span class="nb"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))" class="docs" hyphens="none">...</a></span><span class="p">)</span>
      <span class="n">BODY</span> <span class="nb"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt)._......))" class="docs" hyphens="none">...</a></span><span class="p">)))</span>
<span class="p">(</span><span class="n">define-$</span> <span class="p">(</span><span class="n">f</span> <span class="n">x</span><span class="p">)</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._*))" class="docs" hyphens="none">*</a></span> <span class="n">x</span> <span class="n">x</span><span class="p">))</span>
<span class="p">(</span><span class="n">f$</span> <span class="mi">5</span><span class="p">)</span> <span class="c1">; 25</span>
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpke" data-clipboard-target="#code_55" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;further&quot;)"></div><h3 anchor="further" class="subhead" id="further"><a href="#further">Fur­ther</a></h3></div><ul><li><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_T0KLg&quot;)"></div><p id="a_T0KLg"><span><a href="http://docs.racket-lang.org/guide/pattern-macros.html?q=hygiene#%28part._.Lexical_.Scope%29">Lex­i­cal scope</a> in the Racket Guide</span></p></div></li><li><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_8UUdX&quot;)"></div><p id="a_8UUdX"><span><a href="http://docs.racket-lang.org/reference/syntax-model.html#%28part._macro-introduced-bindings%29">Macro-intro­duced bind­ings</a> in the Racket Ref­er­ence</span></p></div></li></ul></div>
    <a class="nav-left" href="functions.html">← prev</a>
    <a class="nav-right" href="identifiers.html">next →</a>




</body>

<script type="text/javascript">



function show_all_forms() {
 var elems = document.getElementsByClassName('has_form');
 for (var i = 0 ; i < elems.length ; i++) {
  toggle_form(elems[i].id);
 }
}

// for debugging forms only: uncomment next line
// show_all_forms();

// sets up copy-to-clipboard buttons in code boxes
var clipboard = new Clipboard('.copy-button');
clipboard.on('success', function(e) {console.log(e);});
clipboard.on('error', function(e) {console.log(e);});
</script>