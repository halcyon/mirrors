<!DOCTYPE html>
<html>
  
<!-- Mirrored from beautifulracket.com/basic-2/the-syntax-colorer.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 16 Mar 2017 05:47:50 GMT -->
<head>
    <meta charset="UTF-8">
    <title>Beautiful Racket: Into the rapids: more basic</title>
    <link rel="stylesheet" type="text/css" media="all" href="../styles.css"/>
    <script type="text/javascript" src="../functions.js"></script>
    <script type="text/javascript" src="../clipboard.min.js"></script>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-74684045-1', 'auto');
      ga('send', 'pageview');
    </script>
  </head>
<body>
<div id="alert">Thank you for your comment</div>
    <div id="doc"><h3 class="dept" anchorize="false"><a href="../index.html">Beau­ti­ful Racket</a> / <a href="../index.html#tutorials">tuto­ri­als</a></h3><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;into-the-rapids-more-basic&quot;)"></div><h1 anchor="into-the-rapids-more-basic" id="into-the-rapids-more-basic" hyphens="none">Into the rapids: more <span class="my-code" decode="exclude">basic</span></h1></div><ul class="siblinks"><li><a href="intro.html">1&emsp;intro</a></li><li><a href="specification-and-setup.html">2&emsp;spec­i­fi­ca­tion and setup</a></li><li><a class="here" href="the-syntax-colorer.html">3&emsp;the syn­tax col­orer</a></li><li><a href="better-line-errors.html">4&emsp;bet­ter line errors</a></li><li><a href="variables-and-input.html">5&emsp;vari­ables and input</a></li><li><a href="expressions.html">6&emsp;expres­sions</a></li><li><a href="conditionals.html">7&emsp;con­di­tion­als</a></li><li><a href="subroutines-and-loops.html">8&emsp;sub­rou­tines and loops</a></li><li><a href="recap.html">9&emsp;recap</a></li><li><a href="source-listing.html">10&emsp;source list­ing</a></li></ul><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_hU0Ys&quot;)"></div><p id="a_hU0Ys">As we remem­ber from the <a href="../jsonic-2/syntax-coloring.html">sec­ond <span class="my-code" decode="exclude">jsonic</span> tuto­r­ial</a>, a syn­tax col­orer is a <a class="glossary" href="../appendix/glossary.html#lexer"><span class="glossary-link-text">lexer</span></a> called by DrRacket that reads in source code, matches the code to a list of rules, and then returns the matched strings with syn­tax-col­or­ing anno­ta­tions.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_3ekMk&quot;)"></div><p id="a_3ekMk">Each anno­ta­tion con­tains five val­ues: the string to be col­ored, a col­or­ing cat­e­gory, a paren­the­sis shape, and the start­ing and end­ing posi­tion of the col­or­ing. The valid col­or­ing cat­e­gories are <span class="my-code" decode="exclude">'error</span>, <span class="my-code" decode="exclude">'comment</span>, <span class="my-code" decode="exclude">'sexp-comment</span>, <span class="my-code" decode="exclude">'white-space</span>, <span class="my-code" decode="exclude">'constant</span>, <span class="my-code" decode="exclude">'string</span>, <span class="my-code" decode="exclude">'no-color</span>, <span class="my-code" decode="exclude">'parenthesis</span>, <span class="my-code" decode="exclude">'hash-colon-keyword</span>, <span class="my-code" decode="exclude">'symbol</span>, <span class="my-code" decode="exclude">'eof</span>, or <span class="my-code" decode="exclude">'other</span>. The valid paren­the­sis shapes are <span class="my-code" decode="exclude">()[]{}</span> or <span class="my-code" decode="exclude">#f</span>.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_xLpRz&quot;)"></div><p id="a_xLpRz">Right now, our col­or­ing for our sam­ple pro­gram looks like this, using the default Racket-lan­guage col­orer and DrRacket’s default color scheme:</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_Vldpk&quot;)"></div><div id="a_Vldpk" style="text-align:center;padding:0.5rem;padding-bottom:1rem"><img style="width:90%;border:1px solid #ccc" src="colorer-01.gif"/></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_VeZAb&quot;)"></div><p id="a_VeZAb">Not every­thing is wrong—the strings, num­bers, and iden­ti­fiers look right, because they hap­pen to be writ­ten the same way in Racket. But the <span class="my-code" decode="exclude">rem</span> com­ments in lines <span class="my-code" decode="exclude">30</span> and <span class="my-code" decode="exclude">70</span> aren’t col­ored as com­ments. The value <span class="my-code" decode="exclude">'three'</span> on line <span class="my-code" decode="exclude">60</span> is not col­ored as a string. And on line <span class="my-code" decode="exclude">10</span>, the part of the line after the <span class="my-code" decode="exclude">;</span> is for­mat­ted as a com­ment—because it would be, if this were Racket code—but in BASIC, it just rep­re­sents extra argu­ments to <span class="my-code" decode="exclude">print</span>, and these should be col­ored like any other val­ues.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_qcGjA&quot;)"></div><p id="a_qcGjA">In <span class="my-code" decode="exclude">jsonic</span>, we wrote a sep­a­rate lexer for the syn­tax col­orer. This time, our col­orer will rely on the lexer we already wrote for the main lan­guage inter­preter:</p></div><div class="filebox" anchorize="false"><div class="filename" anchorize="false" decode="exclude">basic/lexer.rkt</div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_nnce4&quot;)"></div><div class="highlight-container" id="a_nnce4"><div id="code_43" form="false" decode="exclude" style="font-size:0;width:0;height:0">#lang br<br/>(require brag/support)<br/><br/>(define-lex-abbrev digits (:+ (char-set "0123456789")))<br/><br/>(define basic-lexer<br/>  (lexer-srcloc<br/>   [(eof) (return-without-srcloc eof)]<br/>   ["\n" (token 'NEWLINE lexeme)]<br/>   [whitespace (token lexeme #:skip? #t)]<br/>   [(from/stop-before "rem" "\n") (token 'REM lexeme)]<br/>   [(:or "print" "goto" "end"<br/>         "+" ":" ";") (token lexeme lexeme)]<br/>   [digits (token 'INTEGER (string-&gt;number lexeme))]<br/>   [(:or (:seq (:? digits) "." digits)<br/>         (:seq digits "."))<br/>    (token 'DECIMAL (string-&gt;number lexeme))]<br/>   [(:or (from/to "\"" "\"") (from/to "'" "'"))<br/>    (token 'STRING<br/>           (substring lexeme<br/>                      1 (sub1 (string-length lexeme))))]))<br/><br/>(provide basic-lexer)
</div><div class="highlight" form="false" id="a_DhZyZ"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23</pre></div></td><td class="code"><div class="source"><pre><span class="kn">#lang </span><span class="nn">br</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._require))" class="docs" hyphens="none">require</a></span> <span class="n">brag/support</span><span class="p">)</span>

<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._define-lex-abbrev))" class="docs" hyphens="none">define-lex-abbrev</a></span> <span class="n">digits</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(form._((lib._brag/support..rkt)._~3a+))" class="docs" hyphens="none">:+</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._char-set))" class="docs" hyphens="none">char-set</a></span> <span class="s2">"0123456789"</span><span class="p">)))</span>

<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="n">basic-lexer</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._lexer-srcloc))" class="docs" hyphens="none">lexer-srcloc</a></span>
   <span class="p">[(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/port-ops.html#(def._((quote._~23~25kernel)._eof))" class="docs" hyphens="none">eof</a></span><span class="p">)</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._return-without-srcloc))" class="docs" hyphens="none">return-without-srcloc</a></span> <span class="nb"><a href="http://docs.racket-lang.org/reference/port-ops.html#(def._((quote._~23~25kernel)._eof))" class="docs" hyphens="none">eof</a></span><span class="p">)]</span>
   <span class="p">[</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(def._((lib._brag/support..rkt)._token))" class="docs" hyphens="none">token</a></span> <span class="o">&#39;</span><span class="ss">NEWLINE</span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._lexeme))" class="docs" hyphens="none">lexeme</a></span><span class="p">)]</span>
   <span class="p">[</span><span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._whitespace))" class="docs" hyphens="none">whitespace</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(def._((lib._brag/support..rkt)._token))" class="docs" hyphens="none">token</a></span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._lexeme))" class="docs" hyphens="none">lexeme</a></span> <span class="kd">#:skip?</span> <span class="no">#t</span><span class="p">)]</span>
   <span class="p">[(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(form._((lib._brag/support..rkt)._from/stop-before))" class="docs" hyphens="none">from/stop-before</a></span> <span class="s2">"rem"</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(def._((lib._brag/support..rkt)._token))" class="docs" hyphens="none">token</a></span> <span class="o">&#39;</span><span class="ss">REM</span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._lexeme))" class="docs" hyphens="none">lexeme</a></span><span class="p">)]</span>
   <span class="p">[(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(form._((lib._brag/support..rkt)._~3aor))" class="docs" hyphens="none">:or</a></span> <span class="s2">"print"</span> <span class="s2">"goto"</span> <span class="s2">"end"</span>
         <span class="s2">"+"</span> <span class="s2">":"</span> <span class="s2">";"</span><span class="p">)</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(def._((lib._brag/support..rkt)._token))" class="docs" hyphens="none">token</a></span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._lexeme))" class="docs" hyphens="none">lexeme</a></span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._lexeme))" class="docs" hyphens="none">lexeme</a></span><span class="p">)]</span>
   <span class="p">[</span><span class="n">digits</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(def._((lib._brag/support..rkt)._token))" class="docs" hyphens="none">token</a></span> <span class="o">&#39;</span><span class="ss">INTEGER</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._string-~3enumber))" class="docs" hyphens="none">string-&gt;number</a></span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._lexeme))" class="docs" hyphens="none">lexeme</a></span><span class="p">))]</span>
   <span class="p">[(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(form._((lib._brag/support..rkt)._~3aor))" class="docs" hyphens="none">:or</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(form._((lib._brag/support..rkt)._~3aseq))" class="docs" hyphens="none">:seq</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(form._((lib._brag/support..rkt)._~3a~3f))" class="docs" hyphens="none">:?</a></span> <span class="n">digits</span><span class="p">)</span> <span class="s2">"."</span> <span class="n">digits</span><span class="p">)</span>
         <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(form._((lib._brag/support..rkt)._~3aseq))" class="docs" hyphens="none">:seq</a></span> <span class="n">digits</span> <span class="s2">"."</span><span class="p">))</span>
    <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(def._((lib._brag/support..rkt)._token))" class="docs" hyphens="none">token</a></span> <span class="o">&#39;</span><span class="ss">DECIMAL</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._string-~3enumber))" class="docs" hyphens="none">string-&gt;number</a></span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._lexeme))" class="docs" hyphens="none">lexeme</a></span><span class="p">))]</span>
   <span class="p">[(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(form._((lib._brag/support..rkt)._~3aor))" class="docs" hyphens="none">:or</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(form._((lib._brag/support..rkt)._from/to))" class="docs" hyphens="none">from/to</a></span> <span class="s2">"</span><span class="se">\"</span><span class="s2">"</span> <span class="s2">"</span><span class="se">\"</span><span class="s2">"</span><span class="p">)</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(form._((lib._brag/support..rkt)._from/to))" class="docs" hyphens="none">from/to</a></span> <span class="s2">"&#39;"</span> <span class="s2">"&#39;"</span><span class="p">))</span>
    <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(def._((lib._brag/support..rkt)._token))" class="docs" hyphens="none">token</a></span> <span class="o">&#39;</span><span class="ss">STRING</span>
           <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/strings.html#(def._((quote._~23~25kernel)._substring))" class="docs" hyphens="none">substring</a></span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._lexeme))" class="docs" hyphens="none">lexeme</a></span>
                      <span class="mi">1</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._sub1))" class="docs" hyphens="none">sub1</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/strings.html#(def._((quote._~23~25kernel)._string-length))" class="docs" hyphens="none">string-length</a></span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._lexeme))" class="docs" hyphens="none">lexeme</a></span><span class="p">))))]))</span>

<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._provide))" class="docs" hyphens="none">provide</a></span> <span class="n">basic-lexer</span><span class="p">)</span>
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpk1" data-clipboard-target="#code_43" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_dW5MN&quot;)"></div><p id="a_dW5MN">This is a con­ve­nient idea, because later, if we update this main lexer, our col­orer will auto­mat­i­cally pick up the changes.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;designing-the-colorer&quot;)"></div><h3 anchor="designing-the-colorer" class="subhead" id="designing-the-colorer"><a href="#designing-the-colorer">Design­ing the col­orer</a></h3></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_cjIIt&quot;)"></div><p id="a_cjIIt">Here’s the plan. We’ll read tokens from the lexer, each of which will be an instance of a <a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(def._((lib._br-parser-tools/lex..rkt)._srcloc-token))" class="docs" hyphens="none">srcloc-token</a> struc­ture. We’ll return one syn­tax-col­or­ing anno­ta­tion for each token. To make each anno­ta­tion, we’ll read val­ues from inside the token and use them to fig­ure what col­or­ing cat­e­gory applies and what paren­the­sis shape we should use (if any). We’ll also read the nec­es­sary source-loca­tion val­ues from inside the token, and put those into the col­or­ing anno­ta­tion.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_qFKiZ&quot;)"></div><p id="a_qFKiZ">There’s one addi­tional wrin­kle. When the lexer gets a char­ac­ter that it can’t match to any lex­ing rule, <a href="../basic/the-parser.html#error-highlighting">it raises an error</a>. When we’re try­ing to run a pro­gram, that’s the right behav­ior, because noth­ing can hap­pen until the error is cor­rected.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_ZZ2Tz&quot;)"></div><p id="a_ZZ2Tz">But in a syn­tax col­orer, it’s the wrong behav­ior. Why? Because the syn­tax col­orer is called after every key­stroke, not just when the user clicks <em>Run</em>. It’s likely that after any given key­stroke, the pro­gram can’t be lexed with­out errors. So we want to han­dle those errors when they arise, so that the user’s code edit­ing can con­tinue peace­fully.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;updating-the-main-module&quot;)"></div><h3 anchor="updating-the-main-module" class="subhead" id="updating-the-main-module"><a href="#updating-the-main-module">Updat­ing the main mod­ule</a></h3></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_0zg6H&quot;)"></div><p id="a_0zg6H">As <a href="../jsonic-2/drracket-integration.html">we did in <span class="my-code" decode="exclude">jsonic</span></a>, we make our col­orer avail­able to DrRacket by adding a <span class="my-code" decode="exclude">get-info</span> func­tion to our <span class="my-code" decode="exclude">"main.rkt"</span> mod­ule:</p></div><div class="filebox" anchorize="false"><div class="filename" anchorize="false" decode="exclude">basic/main.rkt</div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_ArR2r&quot;)"></div><div class="highlight-container" id="a_ArR2r"><div id="code_44" form="false" decode="exclude" style="font-size:0;width:0;height:0">#lang br/quicklang<br/>(require "parser.rkt" "tokenizer.rkt")<br/><br/>(module+ reader<br/>  (provide read-syntax get-info))<br/><br/>(define (read-syntax path port)<br/>  (define parse-tree (parse path (make-tokenizer port path)))<br/>  (strip-bindings<br/>   #`(module basic-mod basic/expander<br/>       #,parse-tree)))<br/><br/>(define (get-info port mod line col pos)<br/>    (define (handle-query key default)<br/>      (case key<br/>        [(color-lexer)<br/>         (dynamic-require 'basic/colorer 'basic-colorer)]<br/>        [else default]))<br/>    handle-query)</div><div class="highlight" form="false" id="a_3lGzi"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</pre></div></td><td class="code"><div class="source"><pre><span class="kn">#lang </span><span class="nn">br/quicklang</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._require))" class="docs" hyphens="none">require</a></span> <span class="s2">"parser.rkt"</span> <span class="s2">"tokenizer.rkt"</span><span class="p">)</span>

<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/module.html#(form._((lib._racket/private/base..rkt)._module+))" class="docs" hyphens="none">module+</a></span> <span class="n">reader</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._provide))" class="docs" hyphens="none">provide</a></span> <span class="nb"><a href="http://docs.racket-lang.org/reference/Reading.html#(def._((quote._~23~25kernel)._read-syntax))" class="docs" hyphens="none">read-syntax</a></span> <span class="n">get-info</span><span class="p">))</span>

<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/Reading.html#(def._((quote._~23~25kernel)._read-syntax))" class="docs" hyphens="none">read-syntax</a></span> <span class="n">path</span> <span class="n">port</span><span class="p">)</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="n">parse-tree</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(def._((lib._brag/examples/nested-word-list..rkt)._parse))" class="docs" hyphens="none">parse</a></span> <span class="n">path</span> <span class="p">(</span><span class="n">make-tokenizer</span> <span class="n">port</span> <span class="n">path</span><span class="p">)))</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br/index.html#(def._((lib._br/syntax..rkt)._strip-bindings))" class="docs" hyphens="none">strip-bindings</a></span>
   <span class="o">#`</span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/module.html#(form._((quote._~23~25kernel)._module))" class="docs" hyphens="none">module</a></span> <span class="n">basic-mod</span> <span class="n">basic/expander</span>
       <span class="o">#,</span><span class="n">parse-tree</span><span class="p">)))</span>

<span class="hll"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="p">(</span><span class="n">get-info</span> <span class="n">port</span> <span class="n">mod</span> <span class="nb"><a href="http://docs.racket-lang.org/br/index.html#(def._((lib._br/indent..rkt)._line))" class="docs" hyphens="none">line</a></span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(def._((lib._br-parser-tools/lex..rkt)._position-col))" class="docs" hyphens="none">col</a></span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(def._((lib._br-parser-tools/lex..rkt)._position-offset))" class="docs" hyphens="none">pos</a></span><span class="p">)</span>
</span><span class="hll">    <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="p">(</span><span class="n">handle-query</span> <span class="n">key</span> <span class="n">default</span><span class="p">)</span>
</span><span class="hll">      <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/case.html#(form._((lib._racket/private/more-scheme..rkt)._case))" class="docs" hyphens="none">case</a></span> <span class="n">key</span>
</span><span class="hll">        <span class="p">[(</span><span class="n">color-lexer</span><span class="p">)</span>
</span><span class="hll">         <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/Module_Names_and_Loading.html#(def._((quote._~23~25kernel)._dynamic-require))" class="docs" hyphens="none">dynamic-require</a></span> <span class="o">&#39;</span><span class="ss">basic/colorer</span> <span class="o">&#39;</span><span class="ss">basic-colorer</span><span class="p">)]</span>
</span><span class="hll">        <span class="p">[</span><span class="nb"><a href="http://docs.racket-lang.org/reference/if.html#(form._((lib._racket/private/letstx-scheme..rkt)._else))" class="docs" hyphens="none">else</a></span> <span class="n">default</span><span class="p">]))</span>
</span><span class="hll">    <span class="n">handle-query</span><span class="p">)</span>
</span></pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpk2" data-clipboard-target="#code_44" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_0SbRK&quot;)"></div><p id="a_0SbRK">When <span class="my-code" decode="exclude">get-info</span> gets the <span class="my-code" decode="exclude">color-lexer</span> key, it uses <a href="http://docs.racket-lang.org/reference/Module_Names_and_Loading.html#(def._((quote._~23~25kernel)._dynamic-require))" class="docs" hyphens="none">dynamic-require</a> to import the <span class="my-code" decode="exclude">basic-colorer</span> func­tion from the <span class="my-code" decode="exclude">basic/colorer</span> mod­ule. We’ll set up this mod­ule next.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;the-colorer-module&quot;)"></div><h3 anchor="the-colorer-module" class="subhead" id="the-colorer-module"><a href="#the-colorer-module">The col­orer mod­ule</a></h3></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_ACvhW&quot;)"></div><p id="a_ACvhW">Let’s start our new <span class="my-code" decode="exclude">"basic/colorer.rkt"</span> mod­ule. We import <span class="my-code" decode="exclude">"lexer.rkt"</span> to get our main lexer, and set up a new func­tion called <span class="my-code" decode="exclude">basic-colorer</span>:</p></div><div class="filebox" anchorize="false"><div class="filename" anchorize="false" decode="exclude">basic/colorer.rkt</div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_pKV9C&quot;)"></div><div class="highlight-container" id="a_pKV9C"><div id="code_45" form="false" decode="exclude" style="font-size:0;width:0;height:0">#lang br<br/>(require "lexer.rkt")<br/>(provide basic-colorer)<br/><br/>(define (basic-colorer port)<br/>  (define srcloc-tok (basic-lexer port))<br/>  ···)</div><div class="highlight" form="false" id="a_EvpWA"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="source"><pre><span class="kn">#lang </span><span class="nn">br</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._require))" class="docs" hyphens="none">require</a></span> <span class="s2">"lexer.rkt"</span><span class="p">)</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._provide))" class="docs" hyphens="none">provide</a></span> <span class="n">basic-colorer</span><span class="p">)</span>

<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="p">(</span><span class="n">basic-colorer</span> <span class="n">port</span><span class="p">)</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="n">srcloc-tok</span> <span class="p">(</span><span class="n">basic-lexer</span> <span class="n">port</span><span class="p">))</span>
  <span class="n">···</span><span class="p">)</span>
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpk3" data-clipboard-target="#code_45" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_uKLBs&quot;)"></div><p id="a_uKLBs">DrRacket passes our col­orer func­tion a <span class="my-code" decode="exclude">port</span> argu­ment. To start, we just pass this <span class="my-code" decode="exclude">port</span> through to <span class="my-code" decode="exclude">basic-lexer</span>, which will return an instance of <a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(def._((lib._br-parser-tools/lex..rkt)._srcloc-token))" class="docs" hyphens="none">srcloc-token</a> that we’ll use to con­struct our col­or­ing anno­ta­tion.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_2HxC8&quot;)"></div><p id="a_2HxC8">We know, how­ever, that <span class="my-code" decode="exclude">basic-lexer</span> might raise an error. We want to catch this error. As we’ve done before, we wrap our call to <span class="my-code" decode="exclude">basic-lexer</span> in a <a href="http://docs.racket-lang.org/reference/exns.html#(form._((lib._racket/private/more-scheme..rkt)._with-handlers))" class="docs" hyphens="none">with-handlers</a> expres­sion:</p></div><div class="filebox" anchorize="false"><div class="filename" anchorize="false" decode="exclude">basic/colorer.rkt</div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_Kr52L&quot;)"></div><div class="highlight-container" id="a_Kr52L"><div id="code_46" form="false" decode="exclude" style="font-size:0;width:0;height:0">#lang br<br/>(require "lexer.rkt" brag/support)<br/>(provide basic-colorer)<br/><br/>(define (basic-colorer port)<br/>  (define (handle-lexer-error excn)<br/>    (define excn-srclocs (exn:fail:read-srclocs excn))<br/>    (srcloc-token (token 'ERROR) (car excn-srclocs)))<br/>  (define srcloc-tok<br/>    (with-handlers ([exn:fail:read? handle-lexer-error])<br/>      (basic-lexer port)))<br/>  ···)</div><div class="highlight" form="false" id="a_L5G0L"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="source"><pre><span class="kn">#lang </span><span class="nn">br</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._require))" class="docs" hyphens="none">require</a></span> <span class="s2">"lexer.rkt"</span> <span class="n">brag/support</span><span class="p">)</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._provide))" class="docs" hyphens="none">provide</a></span> <span class="n">basic-colorer</span><span class="p">)</span>

<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="p">(</span><span class="n">basic-colorer</span> <span class="n">port</span><span class="p">)</span>
<span class="hll">  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="p">(</span><span class="n">handle-lexer-error</span> <span class="n">excn</span><span class="p">)</span>
</span><span class="hll">    <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="n">excn-srclocs</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/exns.html#(def._((quote._~23~25kernel)._exn~3afail~3aread-srclocs))" class="docs" hyphens="none">exn:fail:read-srclocs</a></span> <span class="n">excn</span><span class="p">))</span>
</span><span class="hll">    <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(def._((lib._br-parser-tools/lex..rkt)._srcloc-token))" class="docs" hyphens="none">srcloc-token</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(def._((lib._brag/support..rkt)._token))" class="docs" hyphens="none">token</a></span> <span class="o">&#39;</span><span class="ss">ERROR</span><span class="p">)</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._car))" class="docs" hyphens="none">car</a></span> <span class="n">excn-srclocs</span><span class="p">)))</span>
</span><span class="hll">  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="n">srcloc-tok</span>
</span><span class="hll">    <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/exns.html#(form._((lib._racket/private/more-scheme..rkt)._with-handlers))" class="docs" hyphens="none">with-handlers</a></span> <span class="p">([</span><span class="nb"><a href="http://docs.racket-lang.org/reference/exns.html#(def._((quote._~23~25kernel)._exn~3afail~3aread~3f))" class="docs" hyphens="none">exn:fail:read?</a></span> <span class="n">handle-lexer-error</span><span class="p">])</span>
</span><span class="hll">      <span class="p">(</span><span class="n">basic-lexer</span> <span class="n">port</span><span class="p">)))</span>
</span>  <span class="n">···</span><span class="p">)</span>
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpk4" data-clipboard-target="#code_46" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_UD1Ap&quot;)"></div><p id="a_UD1Ap">As we would find out from read­ing the docs for <a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._lexer-srcloc))" class="docs" hyphens="none">lexer-srcloc</a>, when it can’t match any rule, it raises an <a class="glossary" href="../appendix/glossary.html#exception"><span class="glossary-link-text">excep­tion</span></a> of type <a href="http://docs.racket-lang.org/reference/exns.html#(def._((lib._racket/private/base..rkt)._exn~3afail~3aread))" class="docs" hyphens="none">exn:fail:read</a>. There­fore, our <span class="my-code" decode="exclude">with-handlers</span> expres­sion invokes the related pred­i­cate, <a href="http://docs.racket-lang.org/reference/exns.html#(def._((quote._~23~25kernel)._exn~3afail~3aread~3f))" class="docs" hyphens="none">exn:fail:read?</a>, and passes any match­ing excep­tion to our helper func­tion <span class="my-code" decode="exclude">handle-lexer-error</span>.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_49F3h&quot;)"></div><p id="a_49F3h">To patch over the error, our helper func­tion needs to return an instance of <span class="my-code" decode="exclude">srcloc-token</span>. The <a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(def._((lib._br-parser-tools/lex..rkt)._srcloc-token))" class="docs" hyphens="none">srcloc-token</a> con­struc­tor func­tion takes two argu­ments: a plain token value, and a <a href="http://docs.racket-lang.org/reference/exns.html#(def._((lib._racket/private/base..rkt)._srcloc))" class="docs" hyphens="none">srcloc</a> struc­ture.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_VnOiY&quot;)"></div><p id="a_VnOiY">An excep­tion of type <a href="http://docs.racket-lang.org/reference/exns.html#(def._((lib._racket/private/base..rkt)._exn~3afail~3aread))" class="docs" hyphens="none">exn:fail:read</a> has a <span class="my-code" decode="exclude">srclocs</span> field that con­tains a list of <span class="my-code" decode="exclude">srcloc</span> struc­tures related to the error. <span class="tooltip" onclick="this.classList.toggle('tooltip_visible')"> + <span class="tooltip-inner">Dif­fer­ent <a class="glossary" href="../appendix/glossary.html#exception"><span class="glossary-link-text">excep­tion</span></a> types have dif­fer­ent fields that are use­ful in han­dling errors. The doc­u­men­ta­tion has details for each type.</span></span> We use <a href="http://docs.racket-lang.org/reference/exns.html#(def._((quote._~23~25kernel)._exn~3afail~3aread-srclocs))" class="docs" hyphens="none">exn:fail:read-srclocs</a> to store these in <span class="my-code" decode="exclude">excn-srclocs</span> and then use <a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._car))" class="docs" hyphens="none">car</a> to get the top­most one.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_HThyg&quot;)"></div><p id="a_HThyg">As for the token value, we just make a <a href="http://docs.racket-lang.org/brag/index.html#(def._((lib._brag/support..rkt)._token))" class="docs" hyphens="none">token</a> struc­ture with type <span class="my-code" decode="exclude">'ERROR</span>.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_S45J1&quot;)"></div><p id="a_S45J1">Taken together, our <span class="my-code" decode="exclude">srcloc-tok</span> vari­able will either get its value from <span class="my-code" decode="exclude">basic-lexer</span>, or if an error occurs, from <span class="my-code" decode="exclude">handle-lexer-error</span>.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;playing-with-matches&quot;)"></div><h3 anchor="playing-with-matches" class="subhead" id="playing-with-matches"><a href="#playing-with-matches">Play­ing with matches</a></h3></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_txPro&quot;)"></div><p id="a_txPro">The rest of our col­orer will read fields out of the <span class="my-code" decode="exclude">srcloc-tok</span> value and use them to cre­ate col­or­ing anno­ta­tions. To make this easy, we’ll use two new func­tions: <a href="http://docs.racket-lang.org/reference/match.html#(form._((lib._racket/match..rkt)._match))" class="docs" hyphens="none">match</a> and <a href="http://docs.racket-lang.org/reference/match.html#(form._((lib._racket/match..rkt)._match-define))" class="docs" hyphens="none">match-define</a>.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_YecBG&quot;)"></div><p id="a_YecBG"><span class="my-code" decode="exclude">match</span> is one of Racket’s secret weapons—an extremely clever fea­ture that doesn’t exist in other pro­gram­ming lan­guages. Just as reg­u­lar expres­sions let us decon­struct strings, or <a class="glossary" href="../appendix/glossary.html#syntax-pattern"><span class="glossary-link-text">syn­tax pat­terns</span></a> let us decon­struct <a class="glossary" href="../appendix/glossary.html#syntax-object"><span class="glossary-link-text">syn­tax objects</span></a>, <span class="my-code" decode="exclude">match</span> allows us to decon­struct <em>any</em> Racket value.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_qXX1a&quot;)"></div><p id="a_qXX1a">The basic <a href="http://docs.racket-lang.org/reference/match.html#(form._((lib._racket/match..rkt)._match))" class="docs" hyphens="none">match</a> form works like <a href="http://docs.racket-lang.org/reference/if.html#(form._((lib._racket/private/letstx-scheme..rkt)._cond))" class="docs" hyphens="none">cond</a>: it takes a value as input, plus a series of branches. If the pat­tern on the left side matches the value, then the value on the right side of the branch is returned. An optional <span class="my-code" decode="exclude">else</span> branch han­dles every­thing else:</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_DZlX1&quot;)"></div><div class="highlight-container" id="a_DZlX1"><div id="code_47" form="false" decode="exclude" style="font-size:0;width:0;height:0">(struct thing (x y))<br/><br/>(define (m in)<br/>  (match in<br/>    ["foo" 'got-foo]          ; literal match<br/>    [(? number?) 'got-number] ; predicate match<br/>    [(list a b c) (list b)]   ; list match + assignment<br/>    [(thing i j) (+ i j)]     ; structure match + assignment<br/>    [else 'no-match]))<br/><br/>(m "foo")         ; 'got-foo<br/>(m 42)            ; 'got-number<br/>(m (list 1 2 3))  ; '(2)<br/>(m (thing 25 52)) ; 77<br/>(m "bar")         ; 'no-match</div><div class="highlight" form="false" id="a_a0Xkd"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class="code"><div class="source"><pre><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define-struct.html#(form._((lib._racket/private/base..rkt)._struct))" class="docs" hyphens="none">struct</a></span> <span class="n">thing</span> <span class="p">(</span><span class="n">x</span> <span class="n">y</span><span class="p">))</span>

<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="p">(</span><span class="n">m</span> <span class="n">in</span><span class="p">)</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/match.html#(form._((lib._racket/match..rkt)._match))" class="docs" hyphens="none">match</a></span> <span class="n">in</span>
    <span class="p">[</span><span class="s2">"foo"</span> <span class="o">&#39;</span><span class="ss">got-foo</span><span class="p">]</span>          <span class="c1">; literal match</span>
    <span class="p">[(</span><span class="n">?</span> <span class="nb"><a href="http://docs.racket-lang.org/reference/number-types.html#(def._((quote._~23~25kernel)._number~3f))" class="docs" hyphens="none">number?</a></span><span class="p">)</span> <span class="o">&#39;</span><span class="ss">got-number</span><span class="p">]</span> <span class="c1">; predicate match</span>
    <span class="p">[(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._list))" class="docs" hyphens="none">list</a></span> <span class="n">a</span> <span class="n">b</span> <span class="n">c</span><span class="p">)</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._list))" class="docs" hyphens="none">list</a></span> <span class="n">b</span><span class="p">)]</span>   <span class="c1">; list match + assignment</span>
    <span class="p">[(</span><span class="n">thing</span> <span class="n">i</span> <span class="n">j</span><span class="p">)</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._+))" class="docs" hyphens="none">+</a></span> <span class="n">i</span> <span class="n">j</span><span class="p">)]</span>     <span class="c1">; structure match + assignment</span>
    <span class="p">[</span><span class="nb"><a href="http://docs.racket-lang.org/reference/if.html#(form._((lib._racket/private/letstx-scheme..rkt)._else))" class="docs" hyphens="none">else</a></span> <span class="o">&#39;</span><span class="ss">no-match</span><span class="p">]))</span>

<span class="p">(</span><span class="n">m</span> <span class="s2">"foo"</span><span class="p">)</span>         <span class="c1">; &#39;got-foo</span>
<span class="p">(</span><span class="n">m</span> <span class="mi">42</span><span class="p">)</span>            <span class="c1">; &#39;got-number</span>
<span class="p">(</span><span class="n">m</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._list))" class="docs" hyphens="none">list</a></span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span><span class="p">))</span>  <span class="c1">; &#39;(2)</span>
<span class="p">(</span><span class="n">m</span> <span class="p">(</span><span class="n">thing</span> <span class="mi">25</span> <span class="mi">52</span><span class="p">))</span> <span class="c1">; 77</span>
<span class="p">(</span><span class="n">m</span> <span class="s2">"bar"</span><span class="p">)</span>         <span class="c1">; &#39;no-match</span>
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpk5" data-clipboard-target="#code_47" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_vMy0F&quot;)"></div><p id="a_vMy0F">In this exam­ple, we see a few of the options for left-hand pat­terns. <span class="tooltip" onclick="this.classList.toggle('tooltip_visible')"> + <span class="tooltip-inner">Many more can be found in the docs for <a href="http://docs.racket-lang.org/reference/match.html#(form._((lib._racket/match..rkt)._match))" class="docs" hyphens="none">match</a>.</span></span> A lit­eral value like <span class="my-code" decode="exclude">"foo"</span> is matched exactly. A pred­i­cate like <a href="http://docs.racket-lang.org/reference/number-types.html#(def._((quote._~23~25kernel)._number~3f))" class="docs" hyphens="none">number?</a> can be matched by wrap­ping it in the <span class="my-code" decode="exclude">?</span> oper­a­tor. When <a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._list))" class="docs" hyphens="none">list</a> is used as a match pat­tern, it not only matches the input but also assigns the pieces to new iden­ti­fiers—in this case, extract­ing the mid­dle ele­ment <span class="my-code" decode="exclude">b</span> into a new list. Sim­i­larly, any struc­ture type can be used as a pat­tern, and its val­ues matched by posi­tion.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_24pHG&quot;)"></div><p id="a_24pHG">The <a href="http://docs.racket-lang.org/reference/match.html#(form._((lib._racket/match..rkt)._match-define))" class="docs" hyphens="none">match-define</a> form uses the same pat­tern-match­ing vocab­u­lary as <span class="my-code" decode="exclude">match</span> to directly cre­ate new vari­ables by “reverse engi­neer­ing” exist­ing val­ues:</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_0GbuK&quot;)"></div><div class="highlight-container" id="a_0GbuK"><div id="code_48" form="false" decode="exclude" style="font-size:0;width:0;height:0">(define xs (list 1 2 3))<br/>(match-define (list a b c) xs)<br/>a ; 1<br/>b ; 2<br/>c ; 3<br/><br/>(struct thing (x y))<br/>(define th (thing 25 52))<br/>(match-define (thing i j) th)<br/>i ; 25<br/>j ; 52</div><div class="highlight" form="false" id="a_OTcdF"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="source"><pre><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="n">xs</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._list))" class="docs" hyphens="none">list</a></span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span><span class="p">))</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/match.html#(form._((lib._racket/match..rkt)._match-define))" class="docs" hyphens="none">match-define</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._list))" class="docs" hyphens="none">list</a></span> <span class="n">a</span> <span class="n">b</span> <span class="n">c</span><span class="p">)</span> <span class="n">xs</span><span class="p">)</span>
<span class="n">a</span> <span class="c1">; 1</span>
<span class="n">b</span> <span class="c1">; 2</span>
<span class="n">c</span> <span class="c1">; 3</span>

<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define-struct.html#(form._((lib._racket/private/base..rkt)._struct))" class="docs" hyphens="none">struct</a></span> <span class="n">thing</span> <span class="p">(</span><span class="n">x</span> <span class="n">y</span><span class="p">))</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="n">th</span> <span class="p">(</span><span class="n">thing</span> <span class="mi">25</span> <span class="mi">52</span><span class="p">))</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/match.html#(form._((lib._racket/match..rkt)._match-define))" class="docs" hyphens="none">match-define</a></span> <span class="p">(</span><span class="n">thing</span> <span class="n">i</span> <span class="n">j</span><span class="p">)</span> <span class="n">th</span><span class="p">)</span>
<span class="n">i</span> <span class="c1">; 25</span>
<span class="n">j</span> <span class="c1">; 52</span>
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpk6" data-clipboard-target="#code_48" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_KpjFo&quot;)"></div><p id="a_KpjFo">In other words, when we use <span class="my-code" decode="exclude">list</span> (or <span class="my-code" decode="exclude">thing</span>) on the left side of a <span class="my-code" decode="exclude">match-define</span>, we’re not cre­at­ing a list (or instance of the <span class="my-code" decode="exclude">thing</span> struc­ture type) but rather using it as a tem­plate for decom­pos­ing the value on the right.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_i8ajj&quot;)"></div><p id="a_i8ajj">We’ll use <span class="my-code" decode="exclude">match</span> and <span class="my-code" decode="exclude">match-define</span> to help fin­ish the col­orer.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;making-coloring-annotations&quot;)"></div><h3 anchor="making-coloring-annotations" class="subhead" id="making-coloring-annotations"><a href="#making-coloring-annotations">Mak­ing col­or­ing anno­ta­tions</a></h3></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_1q6CS&quot;)"></div><p id="a_1q6CS">The rest of the col­orer will pro­ceed by match­ing against <span class="my-code" decode="exclude">srcloc-tok</span>. As usual, we need to cre­ate a spe­cial rule to han­dle the <span class="my-code" decode="exclude">eof</span> case:</p></div><div class="filebox" anchorize="false"><div class="filename" anchorize="false" decode="exclude">basic/colorer.rkt</div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_Mxq9k&quot;)"></div><div class="highlight-container" id="a_Mxq9k"><div id="code_49" form="false" decode="exclude" style="font-size:0;width:0;height:0">#lang br<br/>(require "lexer.rkt" brag/support)<br/>(provide basic-colorer)<br/><br/>(define (basic-colorer port)<br/>  (define (handle-lexer-error excn)<br/>    (define excn-srclocs (exn:fail:read-srclocs excn))<br/>    (srcloc-token (token 'ERROR) (car excn-srclocs)))<br/>  (define srcloc-tok<br/>    (with-handlers ([exn:fail:read? handle-lexer-error])<br/>      (basic-lexer port)))<br/>  (match srcloc-tok<br/>    [(? eof-object?) (values srcloc-tok 'eof #f #f #f)]<br/>    [else ···]))</div><div class="highlight" form="false" id="a_IgBms"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="source"><pre><span class="kn">#lang </span><span class="nn">br</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._require))" class="docs" hyphens="none">require</a></span> <span class="s2">"lexer.rkt"</span> <span class="n">brag/support</span><span class="p">)</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._provide))" class="docs" hyphens="none">provide</a></span> <span class="n">basic-colorer</span><span class="p">)</span>

<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="p">(</span><span class="n">basic-colorer</span> <span class="n">port</span><span class="p">)</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="p">(</span><span class="n">handle-lexer-error</span> <span class="n">excn</span><span class="p">)</span>
    <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="n">excn-srclocs</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/exns.html#(def._((quote._~23~25kernel)._exn~3afail~3aread-srclocs))" class="docs" hyphens="none">exn:fail:read-srclocs</a></span> <span class="n">excn</span><span class="p">))</span>
    <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(def._((lib._br-parser-tools/lex..rkt)._srcloc-token))" class="docs" hyphens="none">srcloc-token</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(def._((lib._brag/support..rkt)._token))" class="docs" hyphens="none">token</a></span> <span class="o">&#39;</span><span class="ss">ERROR</span><span class="p">)</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._car))" class="docs" hyphens="none">car</a></span> <span class="n">excn-srclocs</span><span class="p">)))</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="n">srcloc-tok</span>
    <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/exns.html#(form._((lib._racket/private/more-scheme..rkt)._with-handlers))" class="docs" hyphens="none">with-handlers</a></span> <span class="p">([</span><span class="nb"><a href="http://docs.racket-lang.org/reference/exns.html#(def._((quote._~23~25kernel)._exn~3afail~3aread~3f))" class="docs" hyphens="none">exn:fail:read?</a></span> <span class="n">handle-lexer-error</span><span class="p">])</span>
      <span class="p">(</span><span class="n">basic-lexer</span> <span class="n">port</span><span class="p">)))</span>
<span class="hll">  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/match.html#(form._((lib._racket/match..rkt)._match))" class="docs" hyphens="none">match</a></span> <span class="n">srcloc-tok</span>
</span><span class="hll">    <span class="p">[(</span><span class="n">?</span> <span class="nb"><a href="http://docs.racket-lang.org/reference/port-ops.html#(def._((quote._~23~25kernel)._eof-object~3f))" class="docs" hyphens="none">eof-object?</a></span><span class="p">)</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/values.html#(def._((quote._~23~25kernel)._values))" class="docs" hyphens="none">values</a></span> <span class="n">srcloc-tok</span> <span class="o">&#39;</span><span class="ss">eof</span> <span class="no">#f</span> <span class="no">#f</span> <span class="no">#f</span><span class="p">)]</span>
</span><span class="hll">    <span class="p">[</span><span class="nb"><a href="http://docs.racket-lang.org/reference/if.html#(form._((lib._racket/private/letstx-scheme..rkt)._else))" class="docs" hyphens="none">else</a></span> <span class="n">···</span><span class="p">]))</span>
</span></pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpk7" data-clipboard-target="#code_49" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_veVAC&quot;)"></div><p id="a_veVAC">We use <a href="http://docs.racket-lang.org/reference/port-ops.html#(def._((quote._~23~25kernel)._eof-object~3f))" class="docs" hyphens="none">eof-object?</a> wrapped in <span class="my-code" decode="exclude">?</span> as a left-hand match pat­tern. On the right, we return a color anno­ta­tion with <span class="my-code" decode="exclude">srcloc-tok</span> as the value and <span class="my-code" decode="exclude">'eof</span> as the cat­e­gory. The other fields will be ignored.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_CSvR3&quot;)"></div><p id="a_CSvR3">Then we can move on to the more inter­est­ing cases. First we use <a href="http://docs.racket-lang.org/reference/match.html#(form._((lib._racket/match..rkt)._match-define))" class="docs" hyphens="none">match-define</a> to decom­pose our <span class="my-code" decode="exclude">srcloc-tok</span> into fields and assign them to vari­ables:</p></div><div class="filebox" anchorize="false"><div class="filename" anchorize="false" decode="exclude">basic/colorer.rkt</div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_sgawZ&quot;)"></div><div class="highlight-container" id="a_sgawZ"><div id="code_50" form="false" decode="exclude" style="font-size:0;width:0;height:0">#lang br<br/>(require "lexer.rkt" brag/support)<br/>(provide basic-colorer)<br/><br/>(define (basic-colorer port)<br/>  (define (handle-lexer-error excn)<br/>    (define excn-srclocs (exn:fail:read-srclocs excn))<br/>    (srcloc-token (token 'ERROR) (car excn-srclocs)))<br/>  (define srcloc-tok<br/>    (with-handlers ([exn:fail:read? handle-lexer-error])<br/>      (basic-lexer port)))<br/>  (match srcloc-tok<br/>    [(? eof-object?) (values srcloc-tok 'eof #f #f #f)]<br/>    [else<br/>     (match-define<br/>       (srcloc-token<br/>        (token-struct type val _ _ _ _ _)<br/>        (srcloc _ _ _ posn span)) srcloc-tok)<br/>        ···]))</div><div class="highlight" form="false" id="a_kuyS7"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</pre></div></td><td class="code"><div class="source"><pre><span class="kn">#lang </span><span class="nn">br</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._require))" class="docs" hyphens="none">require</a></span> <span class="s2">"lexer.rkt"</span> <span class="n">brag/support</span><span class="p">)</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._provide))" class="docs" hyphens="none">provide</a></span> <span class="n">basic-colorer</span><span class="p">)</span>

<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="p">(</span><span class="n">basic-colorer</span> <span class="n">port</span><span class="p">)</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="p">(</span><span class="n">handle-lexer-error</span> <span class="n">excn</span><span class="p">)</span>
    <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="n">excn-srclocs</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/exns.html#(def._((quote._~23~25kernel)._exn~3afail~3aread-srclocs))" class="docs" hyphens="none">exn:fail:read-srclocs</a></span> <span class="n">excn</span><span class="p">))</span>
    <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(def._((lib._br-parser-tools/lex..rkt)._srcloc-token))" class="docs" hyphens="none">srcloc-token</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(def._((lib._brag/support..rkt)._token))" class="docs" hyphens="none">token</a></span> <span class="o">&#39;</span><span class="ss">ERROR</span><span class="p">)</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._car))" class="docs" hyphens="none">car</a></span> <span class="n">excn-srclocs</span><span class="p">)))</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="n">srcloc-tok</span>
    <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/exns.html#(form._((lib._racket/private/more-scheme..rkt)._with-handlers))" class="docs" hyphens="none">with-handlers</a></span> <span class="p">([</span><span class="nb"><a href="http://docs.racket-lang.org/reference/exns.html#(def._((quote._~23~25kernel)._exn~3afail~3aread~3f))" class="docs" hyphens="none">exn:fail:read?</a></span> <span class="n">handle-lexer-error</span><span class="p">])</span>
      <span class="p">(</span><span class="n">basic-lexer</span> <span class="n">port</span><span class="p">)))</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/match.html#(form._((lib._racket/match..rkt)._match))" class="docs" hyphens="none">match</a></span> <span class="n">srcloc-tok</span>
    <span class="p">[(</span><span class="n">?</span> <span class="nb"><a href="http://docs.racket-lang.org/reference/port-ops.html#(def._((quote._~23~25kernel)._eof-object~3f))" class="docs" hyphens="none">eof-object?</a></span><span class="p">)</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/values.html#(def._((quote._~23~25kernel)._values))" class="docs" hyphens="none">values</a></span> <span class="n">srcloc-tok</span> <span class="o">&#39;</span><span class="ss">eof</span> <span class="no">#f</span> <span class="no">#f</span> <span class="no">#f</span><span class="p">)]</span>
<span class="hll">    <span class="p">[</span><span class="nb"><a href="http://docs.racket-lang.org/reference/if.html#(form._((lib._racket/private/letstx-scheme..rkt)._else))" class="docs" hyphens="none">else</a></span>
</span><span class="hll">     <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/match.html#(form._((lib._racket/match..rkt)._match-define))" class="docs" hyphens="none">match-define</a></span>
</span><span class="hll">       <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(def._((lib._br-parser-tools/lex..rkt)._srcloc-token))" class="docs" hyphens="none">srcloc-token</a></span>
</span><span class="hll">        <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(def._((lib._brag/support..rkt)._token-struct))" class="docs" hyphens="none">token-struct</a></span> <span class="n">type</span> <span class="n">val</span> <span class="nb"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt).__))" class="docs" hyphens="none">_</a></span> <span class="nb"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt).__))" class="docs" hyphens="none">_</a></span> <span class="nb"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt).__))" class="docs" hyphens="none">_</a></span> <span class="nb"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt).__))" class="docs" hyphens="none">_</a></span> <span class="nb"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt).__))" class="docs" hyphens="none">_</a></span><span class="p">)</span>
</span><span class="hll">        <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/exns.html#(def._((lib._racket/private/base..rkt)._srcloc))" class="docs" hyphens="none">srcloc</a></span> <span class="nb"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt).__))" class="docs" hyphens="none">_</a></span> <span class="nb"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt).__))" class="docs" hyphens="none">_</a></span> <span class="nb"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt).__))" class="docs" hyphens="none">_</a></span> <span class="n">posn</span> <span class="n">span</span><span class="p">))</span> <span class="n">srcloc-tok</span><span class="p">)</span>
</span><span class="hll">        <span class="n">···</span><span class="p">]))</span>
</span></pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpk8" data-clipboard-target="#code_50" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_nlZ21&quot;)"></div><p id="a_nlZ21">We know each <span class="my-code" decode="exclude">srcloc-tok</span> is an instance of <a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(def._((lib._br-parser-tools/lex..rkt)._srcloc-token))" class="docs" hyphens="none">srcloc-token</a> with a <a href="http://docs.racket-lang.org/brag/index.html#(def._((lib._brag/support..rkt)._token-struct))" class="docs" hyphens="none">token-struct</a> as the first value and a <a href="http://docs.racket-lang.org/reference/exns.html#(def._((lib._racket/private/base..rkt)._srcloc))" class="docs" hyphens="none">srcloc</a> as the sec­ond. So our match pat­tern com­bines all three, let­ting us directly define vari­ables to hold the fields we need to make our col­or­ing anno­ta­tion: <span class="my-code" decode="exclude">type</span> and <span class="my-code" decode="exclude">val</span> from the token, plus the <span class="my-code" decode="exclude">posn</span> and <span class="my-code" decode="exclude">span</span> from the source loca­tion.(Each <span class="my-code" decode="exclude">_</span> in the pat­tern means “ignore this field”.)</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_wsl24&quot;)"></div><p id="a_wsl24">Now we need to assem­ble the five val­ues we need for our col­or­ing anno­ta­tion: the token value, the col­or­ing cat­e­gory, the paren­the­sis shape, and the start and end loca­tions. We already stored the token value in <span class="my-code" decode="exclude">val</span>. The <span class="my-code" decode="exclude">start</span> loca­tion is just <span class="my-code" decode="exclude">posn</span>, and the <span class="my-code" decode="exclude">end</span> loca­tion is <span class="my-code" decode="exclude">(+ start span)</span>. Then we use another <span class="my-code" decode="exclude">match-define</span> to fig­ure out the <span class="my-code" decode="exclude">cat</span> and <span class="my-code" decode="exclude">paren</span> val­ues:</p></div><div class="filebox" anchorize="false"><div class="filename" anchorize="false" decode="exclude">basic/colorer.rkt</div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_tZyFU&quot;)"></div><div class="highlight-container" id="a_tZyFU"><div id="code_51" form="false" decode="exclude" style="font-size:0;width:0;height:0">#lang br<br/>(require "lexer.rkt" brag/support)<br/>(provide basic-colorer)<br/><br/>(define (basic-colorer port)<br/>  (define (handle-lexer-error excn)<br/>    (define excn-srclocs (exn:fail:read-srclocs excn))<br/>    (srcloc-token (token 'ERROR) (car excn-srclocs)))<br/>  (define srcloc-tok<br/>    (with-handlers ([exn:fail:read? handle-lexer-error])<br/>      (basic-lexer port)))<br/>  (match srcloc-tok<br/>    [(? eof-object?) (values srcloc-tok 'eof #f #f #f)]<br/>    [else<br/>     (match-define<br/>       (srcloc-token<br/>        (token-struct type val _ _ _ _ _)<br/>        (srcloc _ _ _ posn span)) srcloc-tok)<br/>     (define start posn)<br/>     (define end (+ start span))<br/>     (match-define (list cat paren)<br/>       (match type<br/>         ['STRING '(string #f)]<br/>         ['REM '(comment #f)]<br/>         ['ERROR '(error #f)]<br/>         [else (match val<br/>                 [(? number?)'(constant #f)]<br/>                 [(? symbol?) '(symbol #f)]<br/>                 ["(" '(parenthesis |(|)]<br/>                 [")" '(parenthesis |)|)]<br/>                 [else '(no-color #f)])]))<br/>     (values val cat paren start end)]))</div><div class="highlight" form="false" id="a_yWpte"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32</pre></div></td><td class="code"><div class="source"><pre><span class="kn">#lang </span><span class="nn">br</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._require))" class="docs" hyphens="none">require</a></span> <span class="s2">"lexer.rkt"</span> <span class="n">brag/support</span><span class="p">)</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._provide))" class="docs" hyphens="none">provide</a></span> <span class="n">basic-colorer</span><span class="p">)</span>

<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="p">(</span><span class="n">basic-colorer</span> <span class="n">port</span><span class="p">)</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="p">(</span><span class="n">handle-lexer-error</span> <span class="n">excn</span><span class="p">)</span>
    <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="n">excn-srclocs</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/exns.html#(def._((quote._~23~25kernel)._exn~3afail~3aread-srclocs))" class="docs" hyphens="none">exn:fail:read-srclocs</a></span> <span class="n">excn</span><span class="p">))</span>
    <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(def._((lib._br-parser-tools/lex..rkt)._srcloc-token))" class="docs" hyphens="none">srcloc-token</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(def._((lib._brag/support..rkt)._token))" class="docs" hyphens="none">token</a></span> <span class="o">&#39;</span><span class="ss">ERROR</span><span class="p">)</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._car))" class="docs" hyphens="none">car</a></span> <span class="n">excn-srclocs</span><span class="p">)))</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="n">srcloc-tok</span>
    <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/exns.html#(form._((lib._racket/private/more-scheme..rkt)._with-handlers))" class="docs" hyphens="none">with-handlers</a></span> <span class="p">([</span><span class="nb"><a href="http://docs.racket-lang.org/reference/exns.html#(def._((quote._~23~25kernel)._exn~3afail~3aread~3f))" class="docs" hyphens="none">exn:fail:read?</a></span> <span class="n">handle-lexer-error</span><span class="p">])</span>
      <span class="p">(</span><span class="n">basic-lexer</span> <span class="n">port</span><span class="p">)))</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/match.html#(form._((lib._racket/match..rkt)._match))" class="docs" hyphens="none">match</a></span> <span class="n">srcloc-tok</span>
    <span class="p">[(</span><span class="n">?</span> <span class="nb"><a href="http://docs.racket-lang.org/reference/port-ops.html#(def._((quote._~23~25kernel)._eof-object~3f))" class="docs" hyphens="none">eof-object?</a></span><span class="p">)</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/values.html#(def._((quote._~23~25kernel)._values))" class="docs" hyphens="none">values</a></span> <span class="n">srcloc-tok</span> <span class="o">&#39;</span><span class="ss">eof</span> <span class="no">#f</span> <span class="no">#f</span> <span class="no">#f</span><span class="p">)]</span>
    <span class="p">[</span><span class="nb"><a href="http://docs.racket-lang.org/reference/if.html#(form._((lib._racket/private/letstx-scheme..rkt)._else))" class="docs" hyphens="none">else</a></span>
     <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/match.html#(form._((lib._racket/match..rkt)._match-define))" class="docs" hyphens="none">match-define</a></span>
       <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(def._((lib._br-parser-tools/lex..rkt)._srcloc-token))" class="docs" hyphens="none">srcloc-token</a></span>
        <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(def._((lib._brag/support..rkt)._token-struct))" class="docs" hyphens="none">token-struct</a></span> <span class="n">type</span> <span class="n">val</span> <span class="nb"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt).__))" class="docs" hyphens="none">_</a></span> <span class="nb"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt).__))" class="docs" hyphens="none">_</a></span> <span class="nb"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt).__))" class="docs" hyphens="none">_</a></span> <span class="nb"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt).__))" class="docs" hyphens="none">_</a></span> <span class="nb"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt).__))" class="docs" hyphens="none">_</a></span><span class="p">)</span>
        <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/exns.html#(def._((lib._racket/private/base..rkt)._srcloc))" class="docs" hyphens="none">srcloc</a></span> <span class="nb"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt).__))" class="docs" hyphens="none">_</a></span> <span class="nb"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt).__))" class="docs" hyphens="none">_</a></span> <span class="nb"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt).__))" class="docs" hyphens="none">_</a></span> <span class="n">posn</span> <span class="n">span</span><span class="p">))</span> <span class="n">srcloc-tok</span><span class="p">)</span>
<span class="hll">     <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="n">start</span> <span class="n">posn</span><span class="p">)</span>
</span><span class="hll">     <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="n">end</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._+))" class="docs" hyphens="none">+</a></span> <span class="n">start</span> <span class="n">span</span><span class="p">))</span>
</span><span class="hll">     <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/match.html#(form._((lib._racket/match..rkt)._match-define))" class="docs" hyphens="none">match-define</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/pairs.html#(def._((quote._~23~25kernel)._list))" class="docs" hyphens="none">list</a></span> <span class="n">cat</span> <span class="n">paren</span><span class="p">)</span>
</span><span class="hll">       <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/match.html#(form._((lib._racket/match..rkt)._match))" class="docs" hyphens="none">match</a></span> <span class="n">type</span>
</span><span class="hll">         <span class="p">[</span><span class="o">&#39;</span><span class="ss">STRING</span> <span class="o">&#39;</span><span class="p">(</span><span class="ss">string</span> <span class="no">#f</span><span class="p">)]</span>
</span><span class="hll">         <span class="p">[</span><span class="o">&#39;</span><span class="ss">REM</span> <span class="o">&#39;</span><span class="p">(</span><span class="ss">comment</span> <span class="no">#f</span><span class="p">)]</span>
</span><span class="hll">         <span class="p">[</span><span class="o">&#39;</span><span class="ss">ERROR</span> <span class="o">&#39;</span><span class="p">(</span><span class="ss">error</span> <span class="no">#f</span><span class="p">)]</span>
</span><span class="hll">         <span class="p">[</span><span class="nb"><a href="http://docs.racket-lang.org/reference/if.html#(form._((lib._racket/private/letstx-scheme..rkt)._else))" class="docs" hyphens="none">else</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/match.html#(form._((lib._racket/match..rkt)._match))" class="docs" hyphens="none">match</a></span> <span class="n">val</span>
</span><span class="hll">                 <span class="p">[(</span><span class="n">?</span> <span class="nb"><a href="http://docs.racket-lang.org/reference/number-types.html#(def._((quote._~23~25kernel)._number~3f))" class="docs" hyphens="none">number?</a></span><span class="p">)</span><span class="o">&#39;</span><span class="p">(</span><span class="ss">constant</span> <span class="no">#f</span><span class="p">)]</span>
</span><span class="hll">                 <span class="p">[(</span><span class="n">?</span> <span class="nb"><a href="http://docs.racket-lang.org/reference/symbols.html#(def._((quote._~23~25kernel)._symbol~3f))" class="docs" hyphens="none">symbol?</a></span><span class="p">)</span> <span class="o">&#39;</span><span class="p">(</span><span class="ss">symbol</span> <span class="no">#f</span><span class="p">)]</span>
</span><span class="hll">                 <span class="p">[</span><span class="s2">"("</span> <span class="o">&#39;</span><span class="p">(</span><span class="ss">parenthesis</span> <span class="ss">|(|</span><span class="p">)]</span>
</span><span class="hll">                 <span class="p">[</span><span class="s2">")"</span> <span class="o">&#39;</span><span class="p">(</span><span class="ss">parenthesis</span> <span class="ss">|)|</span><span class="p">)]</span>
</span><span class="hll">                 <span class="p">[</span><span class="nb"><a href="http://docs.racket-lang.org/reference/if.html#(form._((lib._racket/private/letstx-scheme..rkt)._else))" class="docs" hyphens="none">else</a></span> <span class="o">&#39;</span><span class="p">(</span><span class="ss">no-color</span> <span class="no">#f</span><span class="p">)])]))</span>
</span><span class="hll">     <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/values.html#(def._((quote._~23~25kernel)._values))" class="docs" hyphens="none">values</a></span> <span class="n">val</span> <span class="n">cat</span> <span class="n">paren</span> <span class="n">start</span> <span class="n">end</span><span class="p">)]))</span>
</span></pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpk9" data-clipboard-target="#code_51" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_JNXHR&quot;)"></div><p id="a_JNXHR">Each branch of our <span class="my-code" decode="exclude">match-define</span> for <span class="my-code" decode="exclude">(list cat paren)</span> will return a list with a cat­e­gory value and paren­the­sis shape. This list will be assigned to <span class="my-code" decode="exclude">cat</span> and <span class="my-code" decode="exclude">paren</span>, which can then be inserted into the final <a href="http://docs.racket-lang.org/reference/values.html#(def._((quote._~23~25kernel)._values))" class="docs" hyphens="none">values</a> expres­sion that returns the fin­ished col­or­ing anno­ta­tion, along with the already cal­cu­lated <span class="my-code" decode="exclude">val</span>, <span class="my-code" decode="exclude">start</span>, and <span class="my-code" decode="exclude">end</span>.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_UeMke&quot;)"></div><p id="a_UeMke">Within the <span class="my-code" decode="exclude">match-define</span>, we use two instances of <span class="my-code" decode="exclude">match</span>. The first will match against the <span class="my-code" decode="exclude">type</span>. A token of type <span class="my-code" decode="exclude">'STRING</span> gets col­ored as a <span class="my-code" decode="exclude">'string</span>, a <span class="my-code" decode="exclude">'REM</span> token gets col­ored as a <span class="my-code" decode="exclude">'comment</span>, and an <span class="my-code" decode="exclude">'ERROR</span> token gets col­ored as an <span class="my-code" decode="exclude">'error</span>. (In all cases, there is no paren­the­sis shape.) <span class="tooltip" onclick="this.classList.toggle('tooltip_visible')"> + <span class="tooltip-inner">Astute observers may have noticed that we gave our <span class="my-code" decode="exclude">'ERROR</span> tokens a type, but not a value, which defaults to <span class="my-code" decode="exclude">#f</span>. DrRacket pri­mar­ily relies on the start and end posi­tions for col­or­ing. So as long as those are cor­rect, the col­orer will work, despite the miss­ing token value.</span></span></p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_xXVxf&quot;)"></div><p id="a_xXVxf">If we don’t get a match for <span class="my-code" decode="exclude">type</span>, in its <span class="my-code" decode="exclude">else</span> branch we have a nested <span class="my-code" decode="exclude">match</span> on <span class="my-code" decode="exclude">val</span>. We use pred­i­cate matches to color tokens that are <a href="http://docs.racket-lang.org/reference/number-types.html#(def._((quote._~23~25kernel)._number~3f))" class="docs" hyphens="none">number?</a> as a <span class="my-code" decode="exclude">'constant</span>, and those that are <a href="http://docs.racket-lang.org/reference/symbols.html#(def._((quote._~23~25kernel)._symbol~3f))" class="docs" hyphens="none">symbol?</a> as a <span class="my-code" decode="exclude">'symbol</span>. We use lit­eral <span class="my-code" decode="exclude">"("</span> and <span class="my-code" decode="exclude">")"</span> matches to catch any paren­the­ses (this time fill­ing both a <span class="my-code" decode="exclude">'parenthesis</span> cat­e­gory and the cor­rect paren­the­sis shape). <span class="tooltip" onclick="this.classList.toggle('tooltip_visible')"> + <span class="tooltip-inner">Because paren­the­ses are used as list delim­iters in Racket, a paren­the­sis used a sym­bol has to be escaped with ver­ti­cal bars: thus <span class="my-code" decode="exclude">'|)|</span> rather than <span class="my-code" decode="exclude">')</span>.</span></span> Finally, any­thing else gets a <span class="my-code" decode="exclude">'no-color</span> anno­ta­tion.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_c3YXZ&quot;)"></div><p id="a_c3YXZ">And that’s the fin­ished col­orer. Keep in mind that these col­or­ing deci­sions are arbi­trary. We’re just try­ing to fig­ure out the most intu­itive map­ping from things in our lan­guage to DrRacket’s col­or­ing cat­e­gories. But DrRacket nei­ther knows and nor cares whether, for instance, some­thing col­ored as a <span class="my-code" decode="exclude">'comment</span> is in fact a com­ment. Syn­tax col­or­ing doesn’t affect how the lan­guage works. Just how it looks.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;testing-the-colorer&quot;)"></div><h3 anchor="testing-the-colorer" class="subhead" id="testing-the-colorer"><a href="#testing-the-colorer">Test­ing the col­orer</a></h3></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_KLkI5&quot;)"></div><p id="a_KLkI5">Recall how our sam­ple pro­gram looked before we wrote our col­orer:</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_Vldpka&quot;)"></div><div id="a_Vldpka" style="text-align:center;padding:0.5rem;padding-bottom:1rem"><img style="width:90%;border:1px solid #ccc" src="colorer-01.gif"/></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_yByXg&quot;)"></div><p id="a_yByXg">Some ele­ments were col­ored cor­rectly. But the <span class="my-code" decode="exclude">rem</span> com­ments in lines <span class="my-code" decode="exclude">30</span> and <span class="my-code" decode="exclude">70</span> were not col­ored as com­ments. The value <span class="my-code" decode="exclude">'three'</span> on line <span class="my-code" decode="exclude">60</span> was not col­ored as a string. And the right half of line <span class="my-code" decode="exclude">10</span> should appear nor­mally.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_kLzO5&quot;)"></div><p id="a_kLzO5">Let’s open our <span class="my-code" decode="exclude">"sample.rkt"</span> file in DrRacket. We select <em>Racket → Reload #lang Exten­sions</em>, which will reload our <span class="my-code" decode="exclude">get-info</span> func­tion and our new col­orer. (For faster per­for­mance, ordi­nar­ily DrRacket caches the result of <span class="my-code" decode="exclude">get-info</span> for each lan­guage. The <em>Reload #lang Exten­sions</em> forces a refresh.) After a moment, the code will look like this:</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_Vldpkb&quot;)"></div><div id="a_Vldpkb" style="text-align:center;padding:0.5rem;padding-bottom:1rem"><img style="width:90%;border:1px solid #ccc" src="colorer-02.gif"/></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_nWGto&quot;)"></div><p id="a_nWGto">Notice that the <span class="my-code" decode="exclude">rem</span> com­ments are now col­ored cor­rectly, <span class="my-code" decode="exclude">'three'</span> is cor­rectly col­ored as a string value, and line <span class="my-code" decode="exclude">10</span> is col­ored nor­mally.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_3MBzP&quot;)"></div><p id="a_3MBzP">If we type some non­sense char­ac­ters on the last line that are unrec­og­nized by the lexer, they’re col­ored as error char­ac­ters, but they don’t inter­rupt our edit­ing:</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_Vldpkc&quot;)"></div><div id="a_Vldpkc" style="text-align:center;padding:0.5rem;padding-bottom:1rem"><img style="width:90%;border:1px solid #ccc" src="colorer-03.gif"/></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_jbdDr&quot;)"></div><p id="a_jbdDr">If we go back and put quote marks around the non­sense, we con­vert it to a valid string, which is recol­ored accord­ingly:</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_Vldpkd&quot;)"></div><div id="a_Vldpkd" style="text-align:center;padding:0.5rem;padding-bottom:1rem"><img style="width:90%;border:1px solid #ccc" src="colorer-04.gif"/></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;thought-experiment&quot;)"></div><h3 anchor="thought-experiment" class="subhead" id="thought-experiment"><a href="#thought-experiment">Thought exper­i­ment</a></h3></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_IRtbq&quot;)"></div><p id="a_IRtbq">What are the lim­its of a lexer-based col­orer? For instance, what if we wanted to do some­thing slick, like apply a dif­fer­ent color to the line num­bers?</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_bzXsD&quot;)"></div><p id="a_bzXsD">In prin­ci­ple it’s pos­si­ble. But because the col­orer is based on a lexer, we can only apply dif­fer­ent col­ors to things that can be dif­fer­en­ti­ated from within the lexer (i.e., with dif­fer­ent rules and  token types).</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_bC0qf&quot;)"></div><p id="a_bC0qf">For instance, right now a line num­ber is deliv­ered inside a token of type <span class="my-code" decode="exclude">'INTEGER</span>. So it can’t be dif­fer­en­ti­ated from an ordi­nary num­ber that’s also deliv­ered inside an <span class="my-code" decode="exclude">'INTEGER</span> token. It’s true that these can be dif­fer­en­ti­ated by the parser—a line num­ber is in a spe­cific posi­tion in the gram­mar—but we can’t use a parser here. <span class="tooltip" onclick="this.classList.toggle('tooltip_visible')"> + <span class="tooltip-inner">Why not? Because we can’t parse some­thing unless it can first be lexed and tok­enized. As we noticed at the begin­ning, the code is often in a non-lex­able state dur­ing edit­ing.</span></span></p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_WE5oo&quot;)"></div><p id="a_WE5oo">To apply a sep­a­rate color to line num­bers, we’d have to add a rule to the lexer to spe­cially match line num­bers and wrap them in a new token type, say <span class="my-code" decode="exclude">'LINE-NUMBER</span>. Then we’d be able to apply a color to <span class="my-code" decode="exclude">'LINE-NUMBER</span> tokens that’s dif­fer­ent from <span class="my-code" decode="exclude">'INTEGER</span> tokens.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_XrC8n&quot;)"></div><p id="a_XrC8n">So what is this new lexer rule? Because every pro­gram line has to be on a sep­a­rate line of the file, we could imag­ine a lexer rule that cap­tured a sequence of a new­line and an inte­ger as a <span class="my-code" decode="exclude">'LINE-NUMBER</span>. But once we change how new­lines are tok­enized, we’d also have to adjust our parser gram­mar, as well as the source loca­tion of a <span class="my-code" decode="exclude">'LINE-NUMBER</span> token to account for the lead­ing white­space.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_Nj9IK&quot;)"></div><p id="a_Nj9IK">In short: we could do it. But it’s a long drive for a short day at the beach.</p></div><div anchorize="false" style="height:2em"></div><ul class="siblinks"><li><a href="intro.html">1&emsp;intro</a></li><li><a href="specification-and-setup.html">2&emsp;spec­i­fi­ca­tion and setup</a></li><li><a class="here" href="the-syntax-colorer.html">3&emsp;the syn­tax col­orer</a></li><li><a href="better-line-errors.html">4&emsp;bet­ter line errors</a></li><li><a href="variables-and-input.html">5&emsp;vari­ables and input</a></li><li><a href="expressions.html">6&emsp;expres­sions</a></li><li><a href="conditionals.html">7&emsp;con­di­tion­als</a></li><li><a href="subroutines-and-loops.html">8&emsp;sub­rou­tines and loops</a></li><li><a href="recap.html">9&emsp;recap</a></li><li><a href="source-listing.html">10&emsp;source list­ing</a></li></ul></div>
    <a class="nav-left" href="specification-and-setup.html">← prev</a>
    <a class="nav-right" href="better-line-errors.html">next →</a>




</body>

<script type="text/javascript">



function show_all_forms() {
 var elems = document.getElementsByClassName('has_form');
 for (var i = 0 ; i < elems.length ; i++) {
  toggle_form(elems[i].id);
 }
}

// for debugging forms only: uncomment next line
// show_all_forms();

// sets up copy-to-clipboard buttons in code boxes
var clipboard = new Clipboard('.copy-button');
clipboard.on('success', function(e) {console.log(e);});
clipboard.on('error', function(e) {console.log(e);});
</script>