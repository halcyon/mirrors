<!DOCTYPE html>
<html>
  
<!-- Mirrored from beautifulracket.com/basic-2/expressions.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 16 Mar 2017 05:48:11 GMT -->
<head>
    <meta charset="UTF-8">
    <title>Beautiful Racket: Into the rapids: more basic</title>
    <link rel="stylesheet" type="text/css" media="all" href="../styles.css"/>
    <script type="text/javascript" src="../functions.js"></script>
    <script type="text/javascript" src="../clipboard.min.js"></script>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-74684045-1', 'auto');
      ga('send', 'pageview');
    </script>
  </head>
<body>
<div id="alert">Thank you for your comment</div>
    <div id="doc"><h3 class="dept" anchorize="false"><a href="../index.html">Beau­ti­ful Racket</a> / <a href="../index.html#tutorials">tuto­ri­als</a></h3><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;into-the-rapids-more-basic&quot;)"></div><h1 anchor="into-the-rapids-more-basic" id="into-the-rapids-more-basic" hyphens="none">Into the rapids: more <span class="my-code" decode="exclude">basic</span></h1></div><ul class="siblinks"><li><a href="intro.html">1&emsp;intro</a></li><li><a href="specification-and-setup.html">2&emsp;spec­i­fi­ca­tion and setup</a></li><li><a href="the-syntax-colorer.html">3&emsp;the syn­tax col­orer</a></li><li><a href="better-line-errors.html">4&emsp;bet­ter line errors</a></li><li><a href="variables-and-input.html">5&emsp;vari­ables and input</a></li><li><a class="here" href="expressions.html">6&emsp;expres­sions</a></li><li><a href="conditionals.html">7&emsp;con­di­tion­als</a></li><li><a href="subroutines-and-loops.html">8&emsp;sub­rou­tines and loops</a></li><li><a href="recap.html">9&emsp;recap</a></li><li><a href="source-listing.html">10&emsp;source list­ing</a></li></ul><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_eW4gV&quot;)"></div><p id="a_eW4gV">Now that we’ve sup­ple­mented our exist­ing num­bers with <a href="variables-and-input.html">vari­ables and input</a>, we’d like to manip­u­late them more freely, by using them together in expres­sions.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_npQ8r&quot;)"></div><p id="a_npQ8r">In BASIC, an expres­sion is a sequence of argu­ments and oper­a­tions that can be eval­u­ated to pro­duce a result. Roughly, a BASIC expres­sion is one that relies on math­e­mat­i­cal or log­i­cal oper­a­tors:</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_UW5Bf&quot;)"></div><div class="highlight-container" id="a_UW5Bf"><div id="code_43" form="false" decode="exclude" style="font-size:0;width:0;height:0">#lang basic-demo-2<br/>10 print -1 + 2 - 3 * (4 + 5) / 6 ^ 7 + 8 mod 9</div><div class="highlight" form="false" id="a_pJG1g"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="source"><pre>#lang basic-demo-2
<span class="nl">10</span><span class="w"> </span><span class="vg">print</span><span class="w"> </span><span class="il">-1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="il">2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="il">3</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="il">4</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="il">5</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="il">6</span><span class="w"> </span><span class="o">^</span><span class="w"> </span><span class="il">7</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="il">8</span><span class="w"> </span><span class="vg">mod</span><span class="w"> </span><span class="il">9</span>
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpk" data-clipboard-target="#code_43" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_nJw5a&quot;)"></div><div class="highlight-container" id="a_nJw5a"><div id="code_44" form="false" decode="exclude" style="font-size:0;width:0;height:0">8.999903549382717</div><div class="highlight" form="false" id="a_KOMyp"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="source"><pre>8.999903549382717
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpk1" data-clipboard-target="#code_44" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_jJiR2&quot;)"></div><p id="a_jJiR2">Unlike Racket, BASIC is not made exclu­sively of expres­sions. Rather, it’s a mix of state­ments (like <span class="my-code" decode="exclude">print</span>) and expres­sions. Also, BASIC relies on stan­dard <em><a class="glossary" href="../appendix/glossary.html#infix-notation"><span class="glossary-link-text">infix nota­tion</span></a></em> (with the oper­a­tions writ­ten between the argu­ments) as opposed to Racket’s <a class="glossary" href="../appendix/glossary.html#prefix-notation"><span class="glossary-link-text">pre­fix nota­tion</span></a>.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;previous-oversimplifications&quot;)"></div><h3 anchor="previous-oversimplifications" class="subhead" id="previous-oversimplifications"><a href="#previous-oversimplifications">Pre­vi­ous over­sim­pli­fi­ca­tions</a></h3></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_aL2z8&quot;)"></div><p id="a_aL2z8">At the end of <a href="variables-and-input.html">vari­ables and input</a>, we left our parser like this, pledg­ing that we would improve our casual han­dling of expres­sions and num­bers:</p></div><div class="filebox" anchorize="false"><div class="filename" anchorize="false" decode="exclude">basic/parser.rkt</div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_tOQlU&quot;)"></div><div class="highlight-container" id="a_tOQlU"><div id="code_45" form="false" decode="exclude" style="font-size:0;width:0;height:0">#lang brag<br/>b-program : [b-line] (/NEWLINE [b-line])*<br/>b-line : b-line-num [b-statement] (/":" [b-statement])* [b-rem]<br/>@b-line-num : INTEGER<br/>@b-statement : b-end | b-print | b-goto | b-let | b-input<br/>b-rem : REM<br/>b-end : /"end"<br/>b-print : /"print" [b-printable] (/";" [b-printable])*<br/>@b-printable : STRING | b-expr<br/>b-goto : /"goto" b-expr<br/>b-let : [/"let"] b-id /"=" (b-expr | STRING)<br/>b-input : /"input" b-id<br/>@b-id : ID<br/>b-expr : b-sum<br/>b-sum : b-number (/"+" b-number)*<br/>@b-number : INTEGER | DECIMAL | b-id</div><div class="highlight" form="false" id="a_AEDKE"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="source"><pre>#lang brag
b-program : [b-line] (/NEWLINE [b-line])*
b-line : b-line-num [b-statement] (/":" [b-statement])* [b-rem]
@b-line-num : INTEGER
@b-statement : b-end | b-print | b-goto | b-let | b-input
b-rem : REM
b-end : /"end"
b-print : /"print" [b-printable] (/";" [b-printable])*
@b-printable : STRING | b-expr
b-goto : /"goto" b-expr
b-let : [/"let"] b-id /"=" (b-expr | STRING)
b-input : /"input" b-id
@b-id : ID
b-expr : b-sum
b-sum : b-number (/"+" b-number)*
@b-number : INTEGER | DECIMAL | b-id
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpk2" data-clipboard-target="#code_45" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_uFLJE&quot;)"></div><p id="a_uFLJE">So far, we’ve made some sim­pli­fy­ing but unre­al­is­tic assump­tions. Let’s look at the <span class="my-code" decode="exclude">b-expr</span> rule near the bot­tom. The only kind of expres­sion we sup­port is <span class="my-code" decode="exclude">b-sum</span>, which is a series of <span class="my-code" decode="exclude">b-number</span> ele­ments with <span class="my-code" decode="exclude">+</span> between them:</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_0zc3E&quot;)"></div><div class="highlight-container" id="a_0zc3E"><div id="code_46" form="false" decode="exclude" style="font-size:0;width:0;height:0">1 + 2 + 3 + 4 + 5 + 6 + 7 + 8</div><div class="highlight" form="false" id="a_H6siB"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="source"><pre>1 + 2 + 3 + 4 + 5 + 6 + 7 + 8
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpk3" data-clipboard-target="#code_46" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_NXiLv&quot;)"></div><p id="a_NXiLv">Once parsed, the <span class="my-code" decode="exclude">b-number</span> nodes are spliced, so in the parse tree, this expres­sion becomes:</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_5fKd6&quot;)"></div><div class="highlight-container" id="a_5fKd6"><div id="code_47" form="false" decode="exclude" style="font-size:0;width:0;height:0">(b-sum 1 2 3 4 5 6 7 8)</div><div class="highlight" form="false" id="a_KNpsS"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="source"><pre>(b-sum 1 2 3 4 5 6 7 8)
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpk4" data-clipboard-target="#code_47" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_Zb13y&quot;)"></div><p id="a_Zb13y">Our cor­re­spond­ing <span class="my-code" decode="exclude">b-sum</span> func­tion in <span class="my-code" decode="exclude">"expr.rkt"</span> is like­wise casual:</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_EJ3RE&quot;)"></div><div class="highlight-container" id="a_EJ3RE"><div id="code_48" form="false" decode="exclude" style="font-size:0;width:0;height:0">(define (b-sum . vals) (apply + vals))</div><div class="highlight" form="false" id="a_QAcOD"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="source"><pre><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="p">(</span><span class="n">b-sum</span> <span class="o">.</span> <span class="n">vals</span><span class="p">)</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/procedures.html#(def._((lib._racket/private/base..rkt)._apply))" class="docs" hyphens="none">apply</a></span> <span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._+))" class="docs" hyphens="none">+</a></span> <span class="n">vals</span><span class="p">))</span>
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpk5" data-clipboard-target="#code_48" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_yPNvV&quot;)"></div><p id="a_yPNvV">Of course, real BASIC expres­sions aren’t lim­ited to flat lists of val­ues, summed together. We have to sup­port gnarlier expres­sions with a vari­ety of oper­a­tions, and subex­pres­sions within, like the one we saw above:</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_ZnYV2&quot;)"></div><div class="highlight-container" id="a_ZnYV2"><div id="code_49" form="false" decode="exclude" style="font-size:0;width:0;height:0">-1 + 2 - 3 * (4 + 5) / 6 ^ 7 + 8 mod 9</div><div class="highlight" form="false" id="a_l7UCG"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="source"><pre>-1 + 2 - 3 * (4 + 5) / 6 ^ 7 + 8 mod 9
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpk6" data-clipboard-target="#code_49" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_etoRp&quot;)"></div><p id="a_etoRp">To do this, we obvi­ously have to add some new math oper­a­tors—namely <span class="my-code" decode="exclude">-</span> <span class="my-code" decode="exclude">*</span> <span class="my-code" decode="exclude">/</span> <span class="my-code" decode="exclude">^</span> (expo­nen­ti­a­tion) and <span class="my-code" decode="exclude">mod</span> (mod­ulo). But we also need to con­front some sub­tler con­sid­er­a­tions pre­vi­ously avoided.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;order-and-precedence&quot;)"></div><h3 anchor="order-and-precedence" class="subhead" id="order-and-precedence"><a href="#order-and-precedence">Order &amp; prece­dence</a></h3></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_6WJPn&quot;)"></div><p id="a_6WJPn">Through­out the tuto­ri­als we’ve noted the impor­tance of choos­ing wisely when mod­el­ing ele­ments of a pro­gram­ming lan­guage with Racket. Usu­ally, the best choice is the one that’s most anal­o­gous. For exam­ple, in <a href="variables-and-input.html">vari­ables and input</a>, we imple­mented BASIC vari­ables directly as Racket vari­ables (rather than indi­rectly, as a Racket <a class="glossary" href="../appendix/glossary.html#hash-table"><span class="glossary-link-text">hash table</span></a>).</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_xUrSl&quot;)"></div><p id="a_xUrSl">This time, how­ever, we have to model infix expres­sions, which have no direct ana­log in Racket—in fact they don’t exist at all. <span class="tooltip" onclick="this.classList.toggle('tooltip_visible')"> + <span class="tooltip-inner">Racket’s lim­ited <a class="glossary" href="../appendix/glossary.html#infix-notation"><span class="glossary-link-text">infix nota­tion</span></a> is just pre­fix nota­tion, cos­met­i­cally rearranged.</span></span></p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_LGEQA&quot;)"></div><p id="a_LGEQA">More­over, we can’t just casu­ally con­vert infix expres­sions to Racket expres­sions, the way we did with <span class="my-code" decode="exclude">b-sum</span>. Infix expres­sions are eval­u­ated accord­ing to cer­tain rules:</p></div><ul><li><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_d1hCN&quot;)"></div><p id="a_d1hCN"><em>Order</em>: oper­a­tions within an infix expres­sion are applied from left to right. So a infix expres­sion like this:</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_aEJSQ&quot;)"></div><div class="highlight-container" id="a_aEJSQ"><div id="code_50" form="false" decode="exclude" style="font-size:0;width:0;height:0">1 + 2 - 3 + 4 - 5 + 6</div><div class="highlight" form="false" id="a_buCBo"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="source"><pre>1 + 2 - 3 + 4 - 5 + 6
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpk7" data-clipboard-target="#code_50" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_nRTQ2&quot;)"></div><p id="a_nRTQ2">Cor­re­sponds to this Racket expres­sion, where the left-to-right infix oper­a­tions are con­verted to inner-to-outer pre­fix oper­a­tions:</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_swdF7&quot;)"></div><div class="highlight-container" id="a_swdF7"><div id="code_51" form="false" decode="exclude" style="font-size:0;width:0;height:0">(+ (- (+ (- (+ 1 2) 3) 4) 5) 6)</div><div class="highlight" form="false" id="a_wv9xQ"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="source"><pre><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._+))" class="docs" hyphens="none">+</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._-))" class="docs" hyphens="none">-</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._+))" class="docs" hyphens="none">+</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._-))" class="docs" hyphens="none">-</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._+))" class="docs" hyphens="none">+</a></span> <span class="mi">1</span> <span class="mi">2</span><span class="p">)</span> <span class="mi">3</span><span class="p">)</span> <span class="mi">4</span><span class="p">)</span> <span class="mi">5</span><span class="p">)</span> <span class="mi">6</span><span class="p">)</span>
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpk8" data-clipboard-target="#code_51" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div></li><li><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_Qh79s&quot;)"></div><p id="a_Qh79s"><em>Prece­dence</em>: cer­tain oper­a­tions need to be applied before oth­ers. We prob­a­bly remem­ber this from sixth-grade math, but just in case—if we have an infix expres­sion like this:</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_lcaiT&quot;)"></div><div class="highlight-container" id="a_lcaiT"><div id="code_52" form="false" decode="exclude" style="font-size:0;width:0;height:0">1 + 2 * 3 + 4 * 5 + 6</div><div class="highlight" form="false" id="a_Ly2JT"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="source"><pre>1 + 2 * 3 + 4 * 5 + 6
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpk9" data-clipboard-target="#code_52" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_euX2c&quot;)"></div><p id="a_euX2c">The <span class="my-code" decode="exclude">*</span> oper­a­tions have higher prece­dence than the <span class="my-code" decode="exclude">+</span>. So the expres­sion is eval­u­ated as if it were writ­ten like so, and then the oper­a­tions are applied in the usual left-to-right way:</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_2gx5b&quot;)"></div><div class="highlight-container" id="a_2gx5b"><div id="code_53" form="false" decode="exclude" style="font-size:0;width:0;height:0">1 + (2 * 3) + (4 * 5) + 6</div><div class="highlight" form="false" id="a_GaCJh"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="source"><pre>1 + (2 * 3) + (4 * 5) + 6
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpka" data-clipboard-target="#code_53" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_uTDkP&quot;)"></div><p id="a_uTDkP">In Racket, we would write the orig­i­nal expres­sion like so:</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_1aJ9T&quot;)"></div><div class="highlight-container" id="a_1aJ9T"><div id="code_54" form="false" decode="exclude" style="font-size:0;width:0;height:0">(+ (+ (+ 1 (* 2 3)) (* 4 5)) 6)</div><div class="highlight" form="false" id="a_BSpg4"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="source"><pre><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._+))" class="docs" hyphens="none">+</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._+))" class="docs" hyphens="none">+</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._+))" class="docs" hyphens="none">+</a></span> <span class="mi">1</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._*))" class="docs" hyphens="none">*</a></span> <span class="mi">2</span> <span class="mi">3</span><span class="p">))</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._*))" class="docs" hyphens="none">*</a></span> <span class="mi">4</span> <span class="mi">5</span><span class="p">))</span> <span class="mi">6</span><span class="p">)</span>
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpkb" data-clipboard-target="#code_54" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div></li><li><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_xVuA3&quot;)"></div><p id="a_xVuA3"><em>Subex­pres­sions</em>: the usual prece­dence rules can be over­rid­den by using paren­the­sized subex­pres­sions. In effect, subex­pres­sions are another layer of prece­dence. Start­ing with the pre­vi­ous exam­ple, we can force the addi­tion oper­a­tions to hap­pen first by paren­the­siz­ing them, and then the remain­ing oper­a­tions go left to right:</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_JGMHU&quot;)"></div><div class="highlight-container" id="a_JGMHU"><div id="code_55" form="false" decode="exclude" style="font-size:0;width:0;height:0">(1 + 2) * (3 + 4) * (5 + 6)</div><div class="highlight" form="false" id="a_bJhDy"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="source"><pre>(1 + 2) * (3 + 4) * (5 + 6)
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpkc" data-clipboard-target="#code_55" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_JfRPv&quot;)"></div><p id="a_JfRPv">In Racket, we’d write the expres­sion this way:</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_ZDTtz&quot;)"></div><div class="highlight-container" id="a_ZDTtz"><div id="code_56" form="false" decode="exclude" style="font-size:0;width:0;height:0">(* (* (+ 1 2) (+ 3 4)) (+ 5 6))</div><div class="highlight" form="false" id="a_4oyq2"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="source"><pre><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._*))" class="docs" hyphens="none">*</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._*))" class="docs" hyphens="none">*</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._+))" class="docs" hyphens="none">+</a></span> <span class="mi">1</span> <span class="mi">2</span><span class="p">)</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._+))" class="docs" hyphens="none">+</a></span> <span class="mi">3</span> <span class="mi">4</span><span class="p">))</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._+))" class="docs" hyphens="none">+</a></span> <span class="mi">5</span> <span class="mi">6</span><span class="p">))</span>
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpkd" data-clipboard-target="#code_56" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div></li></ul><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_R9jr9&quot;)"></div><p id="a_R9jr9">Tak­ing these rules together, our orig­i­nal gnarly exam­ple:</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_ZnYV2g&quot;)"></div><div class="highlight-container" id="a_ZnYV2g"><div id="code_57" form="false" decode="exclude" style="font-size:0;width:0;height:0">-1 + 2 - 3 * (4 + 5) / 6 ^ 7 + 8 mod 9</div><div class="highlight" form="false" id="a_l7UCGe"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="source"><pre>-1 + 2 - 3 * (4 + 5) / 6 ^ 7 + 8 mod 9
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpkf" data-clipboard-target="#code_57" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_AjEZK&quot;)"></div><p id="a_AjEZK">Would be writ­ten in Racket like so:</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_Vb3xJ&quot;)"></div><div class="highlight-container" id="a_Vb3xJ"><div id="code_58" form="false" decode="exclude" style="font-size:0;width:0;height:0">(+ (- (+ -1 2) (/ (* 3 (+ 4 5)) (expt 6 7))) (modulo 8 9))</div><div class="highlight" form="false" id="a_ed0l3"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="source"><pre><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._+))" class="docs" hyphens="none">+</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._-))" class="docs" hyphens="none">-</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._+))" class="docs" hyphens="none">+</a></span> <span class="mi">-1</span> <span class="mi">2</span><span class="p">)</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._/))" class="docs" hyphens="none">/</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._*))" class="docs" hyphens="none">*</a></span> <span class="mi">3</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._+))" class="docs" hyphens="none">+</a></span> <span class="mi">4</span> <span class="mi">5</span><span class="p">))</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._expt))" class="docs" hyphens="none">expt</a></span> <span class="mi">6</span> <span class="mi">7</span><span class="p">)))</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._modulo))" class="docs" hyphens="none">modulo</a></span> <span class="mi">8</span> <span class="mi">9</span><span class="p">))</span>
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpkh" data-clipboard-target="#code_58" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;angles-of-attack&quot;)"></div><h3 anchor="angles-of-attack" class="subhead" id="angles-of-attack"><a href="#angles-of-attack">Angles of attack</a></h3></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_y2Gs1&quot;)"></div><p id="a_y2Gs1">We need to fig­ure out a method of trans­form­ing any BASIC infix expres­sion into a Racket expres­sion that cor­rectly imple­ments the order­ing &amp; prece­dence rules. Since Racket doesn’t directly sup­port infix expres­sions, we have two choices:</p></div><ol><li><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_8188N&quot;)"></div><p id="a_8188N">Add sup­port for infix expres­sions to Racket itself. Then in our BASIC inter­preter, we can just pass through whole infix expres­sions, and our new-and-improved Racket will do the rest.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_grpXh&quot;)"></div><p id="a_grpXh">This is actu­ally a totally rea­son­able idea. It would amount to cre­at­ing a tiny domain-spe­cific lan­guage for inter­pret­ing infix expres­sions that we can invoke from within Racket. As we know, Racket itself is designed to be exten­si­ble (for instance, with <a class="explainer" href="../explainer/macros.html">macros</a>)—there is no tech­ni­cal or con­cep­tual bar­rier.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_DLCTQ&quot;)"></div><p id="a_DLCTQ">There is, how­ever, a knowl­edge bar­rier—this approach would require some lan­guage-hack­ing skills that we haven’t yet cov­ered.</p></div></li><li><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_xFMjO&quot;)"></div><p id="a_xFMjO">We could also update our parser with new rules, so it auto­mat­i­cally parses infix expres­sions into sim­pler nested expres­sions with the cor­rect order and prece­dence. Then we update our expander to sup­port the eval­u­a­tion of these smaller expres­sions.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_3zV67&quot;)"></div><p id="a_3zV67">Since we already know how to make parser rules, this will be our approach.</p></div></li></ol><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;parsing-with-order-and-precedence&quot;)"></div><h3 anchor="parsing-with-order-and-precedence" class="subhead" id="parsing-with-order-and-precedence"><a href="#parsing-with-order-and-precedence">Pars­ing with order &amp; prece­dence</a></h3></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_iRJC4&quot;)"></div><p id="a_iRJC4">We know that in Racket, <a class="glossary" href="../appendix/glossary.html#run-time"><span class="glossary-link-text">run-time</span></a> expres­sions are eval­u­ated from inner­most to out­er­most. We also know that when the parser descends into a new rule, it cre­ates a subn­ode in the parse tree inside the cur­rent node. So every new rule moves us far­ther inward.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_zCh31&quot;)"></div><p id="a_zCh31">There­fore, we can indi­rectly con­trol eval­u­a­tion pri­or­ity through pars­ing. Every time we want to give an expres­sion more pri­or­ity, we can invoke another parser rule, which will move that expres­sion deeper in the parse tree.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_VbNaJ&quot;)"></div><p id="a_VbNaJ">As for infix oper­a­tions, we can treat order and prece­dence of oper­a­tions as two vari­eties of eval­u­a­tion pri­or­ity.</p></div><div anchorize="false" style="height:1em"></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_PJdTu&quot;)"></div><p id="a_PJdTu">Order­ing of oper­a­tions can be cre­ated through <a class="glossary" href="../appendix/glossary.html#recursive"><span class="glossary-link-text">recur­sive</span></a> pars­ing rules.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_2r0DI&quot;)"></div><p id="a_2r0DI">Even though an infix expres­sion can be indef­i­nitely long, we can always break it into a series of two-argu­ment com­pu­ta­tions—the cur­rent infix oper­a­tor applied to the argu­ment on its left and right. (This is how we would pro­ceed with pen­cil &amp; paper; it’s also how we con­verted our pre­vi­ous infix exam­ples into Racket code.)</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_xCNEV&quot;)"></div><p id="a_xCNEV">We already used this idea of <a class="glossary" href="../appendix/glossary.html#dyadic"><span class="glossary-link-text">dyadic</span></a> decom­po­si­tion in the <a href="../stackerizer/index.html"><span class="my-code" decode="exclude">stackerizer</span></a> lan­guage. In that case, we con­verted <a class="glossary" href="../appendix/glossary.html#variadic"><span class="glossary-link-text">vari­adic</span></a> expres­sions into dyadic ones by recur­sively call­ing a macro.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_dsWw3&quot;)"></div><p id="a_dsWw3">In a parser, we can accom­plish some­thing sim­i­lar by recur­sively call­ing a pars­ing rule. Sup­pose we have this gram­mar:</p></div><div class="filebox" anchorize="false"><div class="filename" anchorize="false" decode="exclude">grammar.rkt</div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_eG1J7&quot;)"></div><div class="highlight-container" id="a_eG1J7"><div id="code_59" form="false" decode="exclude" style="font-size:0;width:0;height:0">#lang brag<br/>program : sum<br/>sum : var (/"+" var)*<br/>@var : "a" | "b" | "c" | "d"</div><div class="highlight" form="false" id="a_PQYDE"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="source"><pre>#lang brag
program : sum
sum : var (/"+" var)*
@var : "a" | "b" | "c" | "d"
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpki" data-clipboard-target="#code_59" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_B1j9m&quot;)"></div><p id="a_B1j9m">And we parse the string <span class="my-code" decode="exclude">a+b+c+d</span>:</p></div><div class="filebox" anchorize="false"><div class="filename" anchorize="false" decode="exclude">test.rkt</div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_gPfdM&quot;)"></div><div class="highlight-container" id="a_gPfdM"><div id="code_60" form="false" decode="exclude" style="font-size:0;width:0;height:0">(require "grammar.rkt")<br/>(parse-to-datum "a+b+c+d")</div><div class="highlight" form="false" id="a_krVzz"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="source"><pre><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._require))" class="docs" hyphens="none">require</a></span> <span class="s2">"grammar.rkt"</span><span class="p">)</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(def._((lib._brag/examples/nested-word-list..rkt)._parse-to-datum))" class="docs" hyphens="none">parse-to-datum</a></span> <span class="s2">"a+b+c+d"</span><span class="p">)</span>
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpkj" data-clipboard-target="#code_60" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_TtvzM&quot;)"></div><p id="a_TtvzM">We get this result:</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_gcvBu&quot;)"></div><div class="highlight-container" id="a_gcvBu"><div id="code_61" form="false" decode="exclude" style="font-size:0;width:0;height:0">'(program (sum "a" "b" "c" "d"))</div><div class="highlight" form="false" id="a_wuzOs"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="source"><pre>&#39;(program (sum "a" "b" "c" "d"))
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpkk" data-clipboard-target="#code_61" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_8BmX7&quot;)"></div><p id="a_8BmX7">Now sup­pose we only want <span class="my-code" decode="exclude">sum</span> nodes that are dyadic at max­i­mum. We can update the <span class="my-code" decode="exclude">sum</span> rule with a recur­sive ref­er­ence, and remove the <span class="my-code" decode="exclude">*</span> quan­ti­fier so it only matches one or two ele­ments:</p></div><div class="filebox" anchorize="false"><div class="filename" anchorize="false" decode="exclude">grammar.rkt</div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_Qb88a&quot;)"></div><div class="highlight-container" id="a_Qb88a"><div id="code_62" form="false" decode="exclude" style="font-size:0;width:0;height:0">#lang brag<br/>program : sum<br/>sum : var [/"+" sum]<br/>@var : "a" | "b" | "c" | "d"</div><div class="highlight" form="false" id="a_ydhB2"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="source"><pre>#lang brag
program : sum
sum : var [/"+" sum]
@var : "a" | "b" | "c" | "d"
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpkl" data-clipboard-target="#code_62" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_JSR43&quot;)"></div><p id="a_JSR43">Now the parse tree changes:</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_KoCKt&quot;)"></div><div class="highlight-container" id="a_KoCKt"><div id="code_63" form="false" decode="exclude" style="font-size:0;width:0;height:0">'(program (sum "a" (sum "b" (sum "c" (sum "d")))))</div><div class="highlight" form="false" id="a_Eb1zN"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="source"><pre>&#39;(program (sum "a" (sum "b" (sum "c" (sum "d")))))
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpkm" data-clipboard-target="#code_63" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_BQtHN&quot;)"></div><p id="a_BQtHN">Our recur­sive use of <span class="my-code" decode="exclude">sum</span> is on the right side of the pat­tern. There­fore, subn­odes are formed around each right-hand ele­ment. That means that we’re assign­ing eval­u­a­tion pri­or­ity from right to left: <span class="my-code" decode="exclude">(sum "d")</span> is eval­u­ated, then <span class="my-code" decode="exclude">(sum "c" ···)</span>, etc.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_GV3aC&quot;)"></div><p id="a_GV3aC">If we want to enforce left-to-right order­ing, we can just swap the posi­tion of the recur­sive <span class="my-code" decode="exclude">sum</span> in the pat­tern:</p></div><div class="filebox" anchorize="false"><div class="filename" anchorize="false" decode="exclude">grammar.rkt</div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_I1fxb&quot;)"></div><div class="highlight-container" id="a_I1fxb"><div id="code_64" form="false" decode="exclude" style="font-size:0;width:0;height:0">#lang brag<br/>program : sum<br/>sum : [sum /"+"] var<br/>@var : "a" | "b" | "c" | "d"</div><div class="highlight" form="false" id="a_VXS4k"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="source"><pre>#lang brag
program : sum
sum : [sum /"+"] var
@var : "a" | "b" | "c" | "d"
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpkn" data-clipboard-target="#code_64" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_Qundx&quot;)"></div><p id="a_Qundx">This pro­duces a parse tree with left-to-right pri­or­ity:</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_GAbyj&quot;)"></div><div class="highlight-container" id="a_GAbyj"><div id="code_65" form="false" decode="exclude" style="font-size:0;width:0;height:0">'(program (sum (sum (sum (sum "a") "b") "c") "d"))</div><div class="highlight" form="false" id="a_oXx5R"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="source"><pre>&#39;(program (sum (sum (sum (sum "a") "b") "c") "d"))
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpko" data-clipboard-target="#code_65" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div><div anchorize="false" style="height:1em"></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_UWhsF&quot;)"></div><p id="a_UWhsF">Prece­dence of oper­a­tions can be cre­ated through a chained hier­ar­chy of pars­ing rules. Again, a sim­ple exam­ple. Sup­pose we have this gram­mar:</p></div><div class="filebox" anchorize="false"><div class="filename" anchorize="false" decode="exclude">grammar.rkt</div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_mGDOz&quot;)"></div><div class="highlight-container" id="a_mGDOz"><div id="code_66" form="false" decode="exclude" style="font-size:0;width:0;height:0">#lang brag<br/>program : op*<br/>op : [op ("+" | "*")] var<br/>@var : "a" | "b" | "c"</div><div class="highlight" form="false" id="a_CH9Cn"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="source"><pre>#lang brag
program : op*
op : [op ("+" | "*")] var
@var : "a" | "b" | "c"
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpkp" data-clipboard-target="#code_66" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_CIvm8&quot;)"></div><p id="a_CIvm8">And we parse the string <span class="my-code" decode="exclude">a+b*c</span>:</p></div><div class="filebox" anchorize="false"><div class="filename" anchorize="false" decode="exclude">test.rkt</div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_mkAzr&quot;)"></div><div class="highlight-container" id="a_mkAzr"><div id="code_67" form="false" decode="exclude" style="font-size:0;width:0;height:0">(require "grammar.rkt")<br/>(parse-to-datum "a+b*c")</div><div class="highlight" form="false" id="a_Yp6or"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="source"><pre><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._require))" class="docs" hyphens="none">require</a></span> <span class="s2">"grammar.rkt"</span><span class="p">)</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(def._((lib._brag/examples/nested-word-list..rkt)._parse-to-datum))" class="docs" hyphens="none">parse-to-datum</a></span> <span class="s2">"a+b*c"</span><span class="p">)</span>
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpkq" data-clipboard-target="#code_67" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_73LKM&quot;)"></div><p id="a_73LKM">We get this parse tree:</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_efle6&quot;)"></div><div class="highlight-container" id="a_efle6"><div id="code_68" form="false" decode="exclude" style="font-size:0;width:0;height:0">'(program (op (op (op "a") "+" "b") "*" "c"))</div><div class="highlight" form="false" id="a_11qRU"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="source"><pre>&#39;(program (op (op (op "a") "+" "b") "*" "c"))
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpkr" data-clipboard-target="#code_68" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_iCjYB&quot;)"></div><p id="a_iCjYB">Fol­low­ing the tech­nique we learned above, we enforce left-to-right order­ing by recur­sively call­ing the <span class="my-code" decode="exclude">op</span> rule as the left ele­ment in its pat­tern. This means that <span class="my-code" decode="exclude">a+b</span> will be eval­u­ated first.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_JXWZQ&quot;)"></div><p id="a_JXWZQ">But sup­pose that instead, we want <span class="my-code" decode="exclude">b*c</span> to be eval­u­ated first. If we change <span class="my-code" decode="exclude">op</span> to <span class="my-code" decode="exclude">sum</span>, and insert a <span class="my-code" decode="exclude">mult</span> sub­rule into our gram­mar:</p></div><div class="filebox" anchorize="false"><div class="filename" anchorize="false" decode="exclude">grammar.rkt</div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_FtrvC&quot;)"></div><div class="highlight-container" id="a_FtrvC"><div id="code_69" form="false" decode="exclude" style="font-size:0;width:0;height:0">#lang brag<br/>program : sum*<br/>sum : [sum "+"] mult<br/>mult : [mult "*"] var<br/>@var : "a" | "b" | "c"</div><div class="highlight" form="false" id="a_UqzhT"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="source"><pre>#lang brag
program : sum*
sum : [sum "+"] mult
mult : [mult "*"] var
@var : "a" | "b" | "c"
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpks" data-clipboard-target="#code_69" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_TKsPL&quot;)"></div><p id="a_TKsPL">Then the <span class="my-code" decode="exclude">b*c</span> sub­string will be nested more deeply, and thus eval­u­ated first:</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_wRZzU&quot;)"></div><div class="highlight-container" id="a_wRZzU"><div id="code_70" form="false" decode="exclude" style="font-size:0;width:0;height:0">'(program (sum (sum (mult "a")) "+" (mult (mult "b") "*" "c")))</div><div class="highlight" form="false" id="a_deObz"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="source"><pre>&#39;(program (sum (sum (mult "a")) "+" (mult (mult "b") "*" "c")))
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpkt" data-clipboard-target="#code_70" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_seMBG&quot;)"></div><p id="a_seMBG">The key maneu­ver here is slightly coun­ter­in­tu­itive: we’re chain­ing our gram­mar rules so that every <span class="my-code" decode="exclude">sum</span> node con­tains <span class="my-code" decode="exclude">mult</span> subn­odes, and every <span class="my-code" decode="exclude">mult</span> node lives inside a <span class="my-code" decode="exclude">sum</span> par­ent node. Our string <span class="my-code" decode="exclude">a+b*c</span>, which looks like it con­tains two oper­a­tions,  becomes five oper­a­tions in our parse tree.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_r44fY&quot;)"></div><p id="a_r44fY">But we won’t panic. This chain­ing ensures that our mul­ti­pli­ca­tions always have higher eval­u­a­tion pri­or­ity than our sums, because they’re nested deeper in the parse tree. And the extra one-argu­ment instances of our oper­a­tions can be boiled out by the expander—e.g., <span class="my-code" decode="exclude">(sum (mult "a"))</span> can just become <span class="my-code" decode="exclude">"a"</span>. If we ignore these triv­ial oper­a­tions, the parse tree looks like this:</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_XBv4a&quot;)"></div><div class="highlight-container" id="a_XBv4a"><div id="code_71" form="false" decode="exclude" style="font-size:0;width:0;height:0">'(program (sum "a" "+" (mult "b" "*" "c")))</div><div class="highlight" form="false" id="a_h81hU"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="source"><pre>&#39;(program (sum "a" "+" (mult "b" "*" "c")))
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpku" data-clipboard-target="#code_71" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_4N6ZU&quot;)"></div><p id="a_4N6ZU">Which is exactly what we wanted.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_BiGVo&quot;)"></div><p id="a_BiGVo">Rely­ing on these two pars­ing tech­niques, we can now imple­ment BASIC infix expres­sions with order and prece­dence. We can also use these tech­niques to imple­ment subex­pres­sions, which we can think of as a fur­ther layer of prece­dence.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;lexer-updates&quot;)"></div><h3 anchor="lexer-updates" class="subhead" id="lexer-updates"><a href="#lexer-updates">Lexer updates</a></h3></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_YKpsP&quot;)"></div><p id="a_YKpsP">As always, we start by updat­ing <span class="my-code" decode="exclude">"lexer.rkt"</span> to rec­og­nize the new tokens we’ll be using in the source. To the <span class="my-code" decode="exclude">reserved-terms</span> list we add our other math oper­a­tors (<span class="my-code" decode="exclude">-*/^</span> and <span class="my-code" decode="exclude">mod</span>), plus paren­the­ses (to sup­port subex­pres­sions):</p></div><div class="filebox" anchorize="false"><div class="filename" anchorize="false" decode="exclude">basic/lexer.rkt</div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_3QNs9&quot;)"></div><div class="highlight-container" id="a_3QNs9"><div id="code_72" form="false" decode="exclude" style="font-size:0;width:0;height:0">#lang br<br/>(require brag/support)<br/><br/>(define-lex-abbrev digits (:+ (char-set "0123456789")))<br/><br/>(define-lex-abbrev reserved-terms (:or "print" "goto" "end" "+"<br/>":" ";" "let" "=" "input" "-" "*" "/" "^" "mod" "(" ")"))<br/><br/>(define basic-lexer<br/>  (lexer-srcloc<br/>   [(eof) (return-without-srcloc eof)]<br/>   ["\n" (token 'NEWLINE lexeme)]<br/>   [whitespace (token lexeme #:skip? #t)]<br/>   [(from/stop-before "rem" "\n") (token 'REM lexeme)]<br/>   [reserved-terms (token lexeme lexeme)]<br/>   [(:seq alphabetic (:* (:or alphabetic numeric "$")))<br/>    (token 'ID (string-&gt;symbol lexeme))]<br/>   [digits (token 'INTEGER (string-&gt;number lexeme))]<br/>   [(:or (:seq (:? digits) "." digits)<br/>         (:seq digits "."))<br/>    (token 'DECIMAL (string-&gt;number lexeme))]<br/>   [(:or (from/to "\"" "\"") (from/to "'" "'"))<br/>    (token 'STRING<br/>           (substring lexeme<br/>                      1 (sub1 (string-length lexeme))))]))<br/><br/>(provide basic-lexer)</div><div class="highlight" form="false" id="a_GgDIx"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27</pre></div></td><td class="code"><div class="source"><pre><span class="kn">#lang </span><span class="nn">br</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._require))" class="docs" hyphens="none">require</a></span> <span class="n">brag/support</span><span class="p">)</span>

<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._define-lex-abbrev))" class="docs" hyphens="none">define-lex-abbrev</a></span> <span class="n">digits</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(form._((lib._brag/support..rkt)._~3a+))" class="docs" hyphens="none">:+</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._char-set))" class="docs" hyphens="none">char-set</a></span> <span class="s2">"0123456789"</span><span class="p">)))</span>

<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._define-lex-abbrev))" class="docs" hyphens="none">define-lex-abbrev</a></span> <span class="n">reserved-terms</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(form._((lib._brag/support..rkt)._~3aor))" class="docs" hyphens="none">:or</a></span> <span class="s2">"print"</span> <span class="s2">"goto"</span> <span class="s2">"end"</span> <span class="s2">"+"</span>
<span class="hll"><span class="s2">":"</span> <span class="s2">";"</span> <span class="s2">"let"</span> <span class="s2">"="</span> <span class="s2">"input"</span> <span class="s2">"-"</span> <span class="s2">"*"</span> <span class="s2">"/"</span> <span class="s2">"^"</span> <span class="s2">"mod"</span> <span class="s2">"("</span> <span class="s2">")"</span><span class="p">))</span>
</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="n">basic-lexer</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._lexer-srcloc))" class="docs" hyphens="none">lexer-srcloc</a></span>
   <span class="p">[(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/port-ops.html#(def._((quote._~23~25kernel)._eof))" class="docs" hyphens="none">eof</a></span><span class="p">)</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._return-without-srcloc))" class="docs" hyphens="none">return-without-srcloc</a></span> <span class="nb"><a href="http://docs.racket-lang.org/reference/port-ops.html#(def._((quote._~23~25kernel)._eof))" class="docs" hyphens="none">eof</a></span><span class="p">)]</span>
   <span class="p">[</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(def._((lib._brag/support..rkt)._token))" class="docs" hyphens="none">token</a></span> <span class="o">&#39;</span><span class="ss">NEWLINE</span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._lexeme))" class="docs" hyphens="none">lexeme</a></span><span class="p">)]</span>
   <span class="p">[</span><span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._whitespace))" class="docs" hyphens="none">whitespace</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(def._((lib._brag/support..rkt)._token))" class="docs" hyphens="none">token</a></span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._lexeme))" class="docs" hyphens="none">lexeme</a></span> <span class="kd">#:skip?</span> <span class="no">#t</span><span class="p">)]</span>
   <span class="p">[(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(form._((lib._brag/support..rkt)._from/stop-before))" class="docs" hyphens="none">from/stop-before</a></span> <span class="s2">"rem"</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(def._((lib._brag/support..rkt)._token))" class="docs" hyphens="none">token</a></span> <span class="o">&#39;</span><span class="ss">REM</span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._lexeme))" class="docs" hyphens="none">lexeme</a></span><span class="p">)]</span>
   <span class="p">[</span><span class="n">reserved-terms</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(def._((lib._brag/support..rkt)._token))" class="docs" hyphens="none">token</a></span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._lexeme))" class="docs" hyphens="none">lexeme</a></span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._lexeme))" class="docs" hyphens="none">lexeme</a></span><span class="p">)]</span>
   <span class="p">[(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(form._((lib._brag/support..rkt)._~3aseq))" class="docs" hyphens="none">:seq</a></span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._alphabetic))" class="docs" hyphens="none">alphabetic</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(form._((lib._brag/support..rkt)._~3a*))" class="docs" hyphens="none">:*</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(form._((lib._brag/support..rkt)._~3aor))" class="docs" hyphens="none">:or</a></span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._alphabetic))" class="docs" hyphens="none">alphabetic</a></span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._numeric))" class="docs" hyphens="none">numeric</a></span> <span class="s2">"$"</span><span class="p">)))</span>
    <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(def._((lib._brag/support..rkt)._token))" class="docs" hyphens="none">token</a></span> <span class="o">&#39;</span><span class="ss">ID</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/symbols.html#(def._((quote._~23~25kernel)._string-~3esymbol))" class="docs" hyphens="none">string-&gt;symbol</a></span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._lexeme))" class="docs" hyphens="none">lexeme</a></span><span class="p">))]</span>
   <span class="p">[</span><span class="n">digits</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(def._((lib._brag/support..rkt)._token))" class="docs" hyphens="none">token</a></span> <span class="o">&#39;</span><span class="ss">INTEGER</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._string-~3enumber))" class="docs" hyphens="none">string-&gt;number</a></span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._lexeme))" class="docs" hyphens="none">lexeme</a></span><span class="p">))]</span>
   <span class="p">[(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(form._((lib._brag/support..rkt)._~3aor))" class="docs" hyphens="none">:or</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(form._((lib._brag/support..rkt)._~3aseq))" class="docs" hyphens="none">:seq</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(form._((lib._brag/support..rkt)._~3a~3f))" class="docs" hyphens="none">:?</a></span> <span class="n">digits</span><span class="p">)</span> <span class="s2">"."</span> <span class="n">digits</span><span class="p">)</span>
         <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(form._((lib._brag/support..rkt)._~3aseq))" class="docs" hyphens="none">:seq</a></span> <span class="n">digits</span> <span class="s2">"."</span><span class="p">))</span>
    <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(def._((lib._brag/support..rkt)._token))" class="docs" hyphens="none">token</a></span> <span class="o">&#39;</span><span class="ss">DECIMAL</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._string-~3enumber))" class="docs" hyphens="none">string-&gt;number</a></span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._lexeme))" class="docs" hyphens="none">lexeme</a></span><span class="p">))]</span>
   <span class="p">[(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(form._((lib._brag/support..rkt)._~3aor))" class="docs" hyphens="none">:or</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(form._((lib._brag/support..rkt)._from/to))" class="docs" hyphens="none">from/to</a></span> <span class="s2">"</span><span class="se">\"</span><span class="s2">"</span> <span class="s2">"</span><span class="se">\"</span><span class="s2">"</span><span class="p">)</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(form._((lib._brag/support..rkt)._from/to))" class="docs" hyphens="none">from/to</a></span> <span class="s2">"&#39;"</span> <span class="s2">"&#39;"</span><span class="p">))</span>
    <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/brag/index.html#(def._((lib._brag/support..rkt)._token))" class="docs" hyphens="none">token</a></span> <span class="o">&#39;</span><span class="ss">STRING</span>
           <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/strings.html#(def._((quote._~23~25kernel)._substring))" class="docs" hyphens="none">substring</a></span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._lexeme))" class="docs" hyphens="none">lexeme</a></span>
                      <span class="mi">1</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._sub1))" class="docs" hyphens="none">sub1</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/strings.html#(def._((quote._~23~25kernel)._string-length))" class="docs" hyphens="none">string-length</a></span> <span class="nb"><a href="http://docs.racket-lang.org/br-parser-tools/Lexers.html#(form._((lib._br-parser-tools/lex..rkt)._lexeme))" class="docs" hyphens="none">lexeme</a></span><span class="p">))))]))</span>

<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._provide))" class="docs" hyphens="none">provide</a></span> <span class="n">basic-lexer</span><span class="p">)</span>
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpkv" data-clipboard-target="#code_72" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;parser-updates&quot;)"></div><h3 anchor="parser-updates" class="subhead" id="parser-updates"><a href="#parser-updates">Parser updates</a></h3></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_Gi8Ud&quot;)"></div><p id="a_Gi8Ud">Next we add the parser rules that han­dle oper­a­tor prece­dence. In BASIC, oper­a­tions are ordered from low­est to high­est prece­dence like so:</p></div><ol><li><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_QAMSU&quot;)"></div><p id="a_QAMSU">Addi­tion (<span class="my-code" decode="exclude">+</span>) and sub­trac­tion (<span class="my-code" decode="exclude">-</span>).</p></div></li><li><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_nXXGI&quot;)"></div><p id="a_nXXGI">Mul­ti­pli­ca­tion (<span class="my-code" decode="exclude">*</span>), divi­sion (<span class="my-code" decode="exclude">/</span>), and mod­ulo (<span class="my-code" decode="exclude">mod</span>).</p></div></li><li><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_V6ubt&quot;)"></div><p id="a_V6ubt">Nega­tion (<span class="my-code" decode="exclude">-</span> with one argu­ment rather than two).</p></div></li><li><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_jkWB4&quot;)"></div><p id="a_jkWB4">Expo­nen­ti­a­tion (<span class="my-code" decode="exclude">^</span>).</p></div></li><li><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_7Y44P&quot;)"></div><p id="a_7Y44P">Paren­the­sized subex­pres­sions.</p></div></li></ol><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_sWG5y&quot;)"></div><p id="a_sWG5y">Then, within a prece­dence level, oper­a­tions are per­formed from left to right.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_AAAfk&quot;)"></div><p id="a_AAAfk">Fol­low­ing the approach we dis­cov­ered in the last sec­tion, we intro­duce a series of chained parser rules cor­re­spond­ing to each level of prece­dence. Each of these rules will call itself recur­sively on the left side of its pat­tern to enforce left-to-right order­ing:</p></div><div class="filebox" anchorize="false"><div class="filename" anchorize="false" decode="exclude">basic/parser.rkt</div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_CdMP0&quot;)"></div><div class="highlight-container" id="a_CdMP0"><div id="code_73" form="false" decode="exclude" style="font-size:0;width:0;height:0">#lang brag<br/>b-program : [b-line] (/NEWLINE [b-line])*<br/>b-line : b-line-num [b-statement] (/":" [b-statement])* [b-rem]<br/>@b-line-num : INTEGER<br/>@b-statement : b-end | b-print | b-goto | b-let | b-input<br/>b-rem : REM<br/>b-end : /"end"<br/>b-print : /"print" [b-printable] (/";" [b-printable])*<br/>@b-printable : STRING | b-expr<br/>b-goto : /"goto" b-expr<br/>b-let : [/"let"] b-id /"=" (b-expr | STRING)<br/>b-input : /"input" b-id<br/>@b-id : ID<br/>b-expr : b-sum<br/>b-sum : [b-sum ("+"|"-")] b-product<br/>b-product : [b-product ("*"|"/"|"mod")] b-neg<br/>b-neg : ["-"] b-expt<br/>b-expt : [b-expt "^"] b-value<br/>@b-value : b-number | b-id | /"(" b-expr /")"<br/>@b-number : INTEGER | DECIMAL</div><div class="highlight" form="false" id="a_2Y4Td"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</pre></div></td><td class="code"><div class="source"><pre>#lang brag
b-program : [b-line] (/NEWLINE [b-line])*
b-line : b-line-num [b-statement] (/":" [b-statement])* [b-rem]
@b-line-num : INTEGER
@b-statement : b-end | b-print | b-goto | b-let | b-input
b-rem : REM
b-end : /"end"
b-print : /"print" [b-printable] (/";" [b-printable])*
@b-printable : STRING | b-expr
b-goto : /"goto" b-expr
b-let : [/"let"] b-id /"=" (b-expr | STRING)
b-input : /"input" b-id
@b-id : ID
b-expr : b-sum
<span class="hll">b-sum : [b-sum ("+"|"-")] b-product
</span><span class="hll">b-product : [b-product ("*"|"/"|"mod")] b-neg
</span><span class="hll">b-neg : ["-"] b-expt
</span><span class="hll">b-expt : [b-expt "^"] b-value
</span><span class="hll">@b-value : b-number | b-id | /"(" b-expr /")"
</span>@b-number : INTEGER | DECIMAL
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpkw" data-clipboard-target="#code_73" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_Cw67v&quot;)"></div><p id="a_Cw67v"><span class="my-code" decode="exclude">b-sum</span> parses both addi­tion and sub­trac­tion oper­a­tions; <span class="my-code" decode="exclude">b-product</span> parses mul­ti­pli­ca­tion, divi­sion, and mod­ulo oper­a­tions. We def­i­nitely don’t want to break these indi­vid­ual oper­a­tions into chained rules, because it would improp­erly cre­ate prece­dence among them. Rather, we’ll think of <span class="my-code" decode="exclude">b-sum</span> and <span class="my-code" decode="exclude">b-product</span> as “sets of oper­a­tions at the same level of prece­dence” and sort out the details in the expander.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_powoQ&quot;)"></div><p id="a_powoQ">The nega­tion rule <span class="my-code" decode="exclude">b-neg</span> has no recur­sive ele­ment because it only takes one argu­ment.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_wBzi4&quot;)"></div><p id="a_wBzi4">Near the bot­tom, we’ve intro­duced a new <span class="my-code" decode="exclude">b-value</span> rule that encom­passes num­bers, iden­ti­fiers, and subex­pres­sions. The subex­pres­sion pat­tern recur­sively relies on <span class="my-code" decode="exclude">b-expr</span>, which means that expres­sions can be nested to any depth.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;expander-updates&quot;)"></div><h3 anchor="expander-updates" class="subhead" id="expander-updates"><a href="#expander-updates">Expander updates</a></h3></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_Gn6ZC&quot;)"></div><p id="a_Gn6ZC">In <span class="my-code" decode="exclude">"expr.rkt"</span>, we keep our pre­vi­ous <span class="my-code" decode="exclude">b-expr</span> func­tion, but every­thing else will be replaced:</p></div><div class="filebox" anchorize="false"><div class="filename" anchorize="false" decode="exclude">basic/expr.rkt</div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_LzVd7&quot;)"></div><div class="highlight-container" id="a_LzVd7"><div id="code_74" form="false" decode="exclude" style="font-size:0;width:0;height:0">#lang br<br/>(provide b-expr b-sum b-product b-neg b-expt)<br/><br/>(define (b-expr expr)<br/>  (if (integer? expr) (inexact-&gt;exact expr) expr))<br/><br/>(define-macro-cases b-sum<br/>  [(_ VAL) #'VAL]<br/>  [(_ LEFT "+" RIGHT) #'(+ LEFT RIGHT)]<br/>  [(_ LEFT "-" RIGHT) #'(- LEFT RIGHT)])<br/><br/>(define-macro-cases b-product<br/>  [(_ VAL) #'VAL]<br/>  [(_ LEFT "*" RIGHT) #'(* LEFT RIGHT)]<br/>  [(_ LEFT "/" RIGHT) #'(/ LEFT RIGHT 1.0)]<br/>  [(_ LEFT "mod" RIGHT) #'(modulo LEFT RIGHT)])<br/><br/>(define-macro-cases b-neg<br/>  [(_ VAL) #'VAL]<br/>  [(_ "-" VAL) #'(- VAL)])<br/><br/>(define-macro-cases b-expt<br/>  [(_ VAL) #'VAL]<br/>  [(_ LEFT "^" RIGHT) #'(expt LEFT RIGHT)])</div><div class="highlight" form="false" id="a_9MyTJ"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24</pre></div></td><td class="code"><div class="source"><pre><span class="kn">#lang </span><span class="nn">br</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._provide))" class="docs" hyphens="none">provide</a></span> <span class="n">b-expr</span> <span class="n">b-sum</span> <span class="n">b-product</span> <span class="n">b-neg</span> <span class="n">b-expt</span><span class="p">)</span>

<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="p">(</span><span class="n">b-expr</span> <span class="n">expr</span><span class="p">)</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/if.html#(form._((quote._~23~25kernel)._if))" class="docs" hyphens="none">if</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/number-types.html#(def._((quote._~23~25kernel)._integer~3f))" class="docs" hyphens="none">integer?</a></span> <span class="n">expr</span><span class="p">)</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/number-types.html#(def._((quote._~23~25kernel)._inexact-~3eexact))" class="docs" hyphens="none">inexact-&gt;exact</a></span> <span class="n">expr</span><span class="p">)</span> <span class="n">expr</span><span class="p">))</span>

<span class="hll"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br/index.html#(form._((lib._br/define..rkt)._define-macro-cases))" class="docs" hyphens="none">define-macro-cases</a></span> <span class="n">b-sum</span>
</span><span class="hll">  <span class="p">[(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt).__))" class="docs" hyphens="none">_</a></span> <span class="n">VAL</span><span class="p">)</span> <span class="o">#&#39;</span><span class="n">VAL</span><span class="p">]</span>
</span><span class="hll">  <span class="p">[(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt).__))" class="docs" hyphens="none">_</a></span> <span class="n">LEFT</span> <span class="s2">"+"</span> <span class="n">RIGHT</span><span class="p">)</span> <span class="o">#&#39;</span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._+))" class="docs" hyphens="none">+</a></span> <span class="n">LEFT</span> <span class="n">RIGHT</span><span class="p">)]</span>
</span><span class="hll">  <span class="p">[(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt).__))" class="docs" hyphens="none">_</a></span> <span class="n">LEFT</span> <span class="s2">"-"</span> <span class="n">RIGHT</span><span class="p">)</span> <span class="o">#&#39;</span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._-))" class="docs" hyphens="none">-</a></span> <span class="n">LEFT</span> <span class="n">RIGHT</span><span class="p">)])</span>
</span><span class="hll">
</span><span class="hll"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br/index.html#(form._((lib._br/define..rkt)._define-macro-cases))" class="docs" hyphens="none">define-macro-cases</a></span> <span class="n">b-product</span>
</span><span class="hll">  <span class="p">[(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt).__))" class="docs" hyphens="none">_</a></span> <span class="n">VAL</span><span class="p">)</span> <span class="o">#&#39;</span><span class="n">VAL</span><span class="p">]</span>
</span><span class="hll">  <span class="p">[(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt).__))" class="docs" hyphens="none">_</a></span> <span class="n">LEFT</span> <span class="s2">"*"</span> <span class="n">RIGHT</span><span class="p">)</span> <span class="o">#&#39;</span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._*))" class="docs" hyphens="none">*</a></span> <span class="n">LEFT</span> <span class="n">RIGHT</span><span class="p">)]</span>
</span><span class="hll">  <span class="p">[(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt).__))" class="docs" hyphens="none">_</a></span> <span class="n">LEFT</span> <span class="s2">"/"</span> <span class="n">RIGHT</span><span class="p">)</span> <span class="o">#&#39;</span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._/))" class="docs" hyphens="none">/</a></span> <span class="n">LEFT</span> <span class="n">RIGHT</span> <span class="mf">1.0</span><span class="p">)]</span>
</span><span class="hll">  <span class="p">[(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt).__))" class="docs" hyphens="none">_</a></span> <span class="n">LEFT</span> <span class="s2">"mod"</span> <span class="n">RIGHT</span><span class="p">)</span> <span class="o">#&#39;</span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._modulo))" class="docs" hyphens="none">modulo</a></span> <span class="n">LEFT</span> <span class="n">RIGHT</span><span class="p">)])</span>
</span><span class="hll">
</span><span class="hll"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br/index.html#(form._((lib._br/define..rkt)._define-macro-cases))" class="docs" hyphens="none">define-macro-cases</a></span> <span class="n">b-neg</span>
</span><span class="hll">  <span class="p">[(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt).__))" class="docs" hyphens="none">_</a></span> <span class="n">VAL</span><span class="p">)</span> <span class="o">#&#39;</span><span class="n">VAL</span><span class="p">]</span>
</span><span class="hll">  <span class="p">[(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt).__))" class="docs" hyphens="none">_</a></span> <span class="s2">"-"</span> <span class="n">VAL</span><span class="p">)</span> <span class="o">#&#39;</span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._-))" class="docs" hyphens="none">-</a></span> <span class="n">VAL</span><span class="p">)])</span>
</span><span class="hll">
</span><span class="hll"><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br/index.html#(form._((lib._br/define..rkt)._define-macro-cases))" class="docs" hyphens="none">define-macro-cases</a></span> <span class="n">b-expt</span>
</span><span class="hll">  <span class="p">[(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt).__))" class="docs" hyphens="none">_</a></span> <span class="n">VAL</span><span class="p">)</span> <span class="o">#&#39;</span><span class="n">VAL</span><span class="p">]</span>
</span><span class="hll">  <span class="p">[(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt).__))" class="docs" hyphens="none">_</a></span> <span class="n">LEFT</span> <span class="s2">"^"</span> <span class="n">RIGHT</span><span class="p">)</span> <span class="o">#&#39;</span><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._expt))" class="docs" hyphens="none">expt</a></span> <span class="n">LEFT</span> <span class="n">RIGHT</span><span class="p">)])</span>
</span></pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpkx" data-clipboard-target="#code_74" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_T7Rdc&quot;)"></div><p id="a_T7Rdc">In each of the macros imple­ment­ing the parse-tree rules, we start by han­dling the triv­ial one-argu­ment case. After that, we match the oper­a­tion token, and con­vert the expres­sion to the cor­re­spond­ing Racket func­tion.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_0vrfg&quot;)"></div><p id="a_0vrfg">We also intro­duce a tiny bit of new nota­tion: in a <a class="glossary" href="../appendix/glossary.html#syntax-pattern"><span class="glossary-link-text">syn­tax pat­tern</span></a>, we can use an under­score <span class="my-code" decode="exclude">_</span> to mean “match any­thing”. We use it in our macro pat­terns so that we can avoid inces­santly repeat­ing the name of the macro, which we know always appears first. <span class="tooltip" onclick="this.classList.toggle('tooltip_visible')"> + <span class="tooltip-inner">The under­score is com­monly used to indi­cate some­thing in a pat­tern that we plan to ignore. We used anal­o­gous nota­tion in <a href="http://docs.racket-lang.org/reference/match.html#(form._((lib._racket/match..rkt)._match))" class="docs" hyphens="none">match</a> when we wrote <a href="the-syntax-colorer.html">the syn­tax col­orer</a>.</span></span></p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_alN6O&quot;)"></div><p id="a_alN6O">Every­thing is straight­for­ward except divi­sion. Unlike Racket, BASIC has no con­cept of an exact ratio­nal frac­tion. It only uses float­ing-point frac­tions. So in the divi­sion expres­sion, we include <span class="my-code" decode="exclude">1.0</span> to force a float­ing-point result.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;testing-our-expressions&quot;)"></div><h3 anchor="testing-our-expressions" class="subhead" id="testing-our-expressions"><a href="#testing-our-expressions">Test­ing our expres­sions</a></h3></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_bRmDO&quot;)"></div><p id="a_bRmDO">First, let’s try our orig­i­nal gnarly expres­sion:</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_x45Wz&quot;)"></div><div class="highlight-container" id="a_x45Wz"><div id="code_75" form="false" decode="exclude" style="font-size:0;width:0;height:0">#lang basic<br/>10 print -1 + 2 - 3 * (4 + 5) / 6 ^ 7 + 8 mod 9</div><div class="highlight" form="false" id="a_7XcCo"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="source"><pre>#lang basic
<span class="nl">10</span><span class="w"> </span><span class="vg">print</span><span class="w"> </span><span class="il">-1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="il">2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="il">3</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="il">4</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="il">5</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="il">6</span><span class="w"> </span><span class="o">^</span><span class="w"> </span><span class="il">7</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="il">8</span><span class="w"> </span><span class="vg">mod</span><span class="w"> </span><span class="il">9</span>
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_Vldpky" data-clipboard-target="#code_75" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_nJw5aB&quot;)"></div><div class="highlight-container" id="a_nJw5aB"><div id="code_76" form="false" decode="exclude" style="font-size:0;width:0;height:0">8.999903549382717</div><div class="highlight" form="false" id="a_KOMypz"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="source"><pre><span class="mf">8.999903549382717</span>
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_VldpkA" data-clipboard-target="#code_76" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_UEy6A&quot;)"></div><p id="a_UEy6A">And com­pare it to the equiv­a­lent Racket code:</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_iOqgj&quot;)"></div><div class="highlight-container" id="a_iOqgj"><div id="code_77" form="false" decode="exclude" style="font-size:0;width:0;height:0">(+ (- (+ -1.0 2) (/ (* 3 (+ 4 5)) (expt 6 7))) (modulo 8 9))</div><div class="highlight" form="false" id="a_F0KKJ"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="source"><pre><span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._+))" class="docs" hyphens="none">+</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._-))" class="docs" hyphens="none">-</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._+))" class="docs" hyphens="none">+</a></span> <span class="mf">-1.0</span> <span class="mi">2</span><span class="p">)</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._/))" class="docs" hyphens="none">/</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._*))" class="docs" hyphens="none">*</a></span> <span class="mi">3</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._+))" class="docs" hyphens="none">+</a></span> <span class="mi">4</span> <span class="mi">5</span><span class="p">))</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._expt))" class="docs" hyphens="none">expt</a></span> <span class="mi">6</span> <span class="mi">7</span><span class="p">)))</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._modulo))" class="docs" hyphens="none">modulo</a></span> <span class="mi">8</span> <span class="mi">9</span><span class="p">))</span>
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_VldpkC" data-clipboard-target="#code_77" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_nJw5aF&quot;)"></div><div class="highlight-container" id="a_nJw5aF"><div id="code_78" form="false" decode="exclude" style="font-size:0;width:0;height:0">8.999903549382717</div><div class="highlight" form="false" id="a_KOMypD"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="source"><pre><span class="mf">8.999903549382717</span>
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_VldpkE" data-clipboard-target="#code_78" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_YwOdh&quot;)"></div><p id="a_YwOdh">A promis­ing start. Let’s now test our prec­dence rules, by mak­ing expres­sions that have higher-prece­dence oper­a­tions on the right:</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_8Ish2&quot;)"></div><div class="highlight-container" id="a_8Ish2"><div id="code_79" form="false" decode="exclude" style="font-size:0;width:0;height:0">#lang basic<br/>10 print 1 + 2 * 3 rem 7<br/>20 print (1 + 2) * 3 rem 9<br/>30 print 3 + - 4 rem -1<br/>40 print - 2 ^ 4 rem -16<br/>50 print (- 2) ^ 4 rem 16</div><div class="highlight" form="false" id="a_DNaxO"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="source"><pre>#lang basic
<span class="nl">10</span><span class="w"> </span><span class="vg">print</span><span class="w"> </span><span class="il">1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="il">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="il">3</span><span class="w"> </span><span class="vg">rem</span><span class="w"> </span><span class="il">7</span>
<span class="nl">20</span><span class="w"> </span><span class="vg">print</span><span class="w"> </span><span class="p">(</span><span class="il">1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="il">2</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="il">3</span><span class="w"> </span><span class="vg">rem</span><span class="w"> </span><span class="il">9</span>
<span class="nl">30</span><span class="w"> </span><span class="vg">print</span><span class="w"> </span><span class="il">3</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="il">4</span><span class="w"> </span><span class="vg">rem</span><span class="w"> </span><span class="il">-1</span>
<span class="nl">40</span><span class="w"> </span><span class="vg">print</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="il">2</span><span class="w"> </span><span class="o">^</span><span class="w"> </span><span class="il">4</span><span class="w"> </span><span class="vg">rem</span><span class="w"> </span><span class="il">-16</span>
<span class="nl">50</span><span class="w"> </span><span class="vg">print</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="w"> </span><span class="il">2</span><span class="p">)</span><span class="w"> </span><span class="o">^</span><span class="w"> </span><span class="il">4</span><span class="w"> </span><span class="vg">rem</span><span class="w"> </span><span class="il">16</span>
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_VldpkG" data-clipboard-target="#code_79" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_duScW&quot;)"></div><div class="highlight-container" id="a_duScW"><div id="code_80" form="false" decode="exclude" style="font-size:0;width:0;height:0">7<br/>9<br/>-1<br/>-16<br/>16</div><div class="highlight" form="false" id="a_nDS0P"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="source"><pre><span class="mi">7</span>
<span class="mi">9</span>
<span class="mi">-1</span>
<span class="mi">-16</span>
<span class="mi">16</span>
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_VldpkH" data-clipboard-target="#code_80" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_sVw07&quot;)"></div><p id="a_sVw07">Let’s also see if our left-to-right order­ing works:</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_yDeh3&quot;)"></div><div class="highlight-container" id="a_yDeh3"><div id="code_81" form="false" decode="exclude" style="font-size:0;width:0;height:0">#lang basic<br/>10 print 24 / 4 / 2 rem 3<br/>20 print 24 / (4 / 2) rem 12<br/>30 print 2 ^ 3 ^ 2 rem 64<br/>40 print 2 ^ (3 ^ 2) rem 512</div><div class="highlight" form="false" id="a_hCLC3"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="source"><pre>#lang basic
<span class="nl">10</span><span class="w"> </span><span class="vg">print</span><span class="w"> </span><span class="il">24</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="il">4</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="il">2</span><span class="w"> </span><span class="vg">rem</span><span class="w"> </span><span class="il">3</span>
<span class="nl">20</span><span class="w"> </span><span class="vg">print</span><span class="w"> </span><span class="il">24</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="il">4</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="il">2</span><span class="p">)</span><span class="w"> </span><span class="vg">rem</span><span class="w"> </span><span class="il">12</span>
<span class="nl">30</span><span class="w"> </span><span class="vg">print</span><span class="w"> </span><span class="il">2</span><span class="w"> </span><span class="o">^</span><span class="w"> </span><span class="il">3</span><span class="w"> </span><span class="o">^</span><span class="w"> </span><span class="il">2</span><span class="w"> </span><span class="vg">rem</span><span class="w"> </span><span class="il">64</span>
<span class="nl">40</span><span class="w"> </span><span class="vg">print</span><span class="w"> </span><span class="il">2</span><span class="w"> </span><span class="o">^</span><span class="w"> </span><span class="p">(</span><span class="il">3</span><span class="w"> </span><span class="o">^</span><span class="w"> </span><span class="il">2</span><span class="p">)</span><span class="w"> </span><span class="vg">rem</span><span class="w"> </span><span class="il">512</span>
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_VldpkI" data-clipboard-target="#code_81" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_h3lmB&quot;)"></div><div class="highlight-container" id="a_h3lmB"><div id="code_82" form="false" decode="exclude" style="font-size:0;width:0;height:0">3<br/>12<br/>64<br/>512</div><div class="highlight" form="false" id="a_SubYk"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="source"><pre><span class="mi">3</span>
<span class="mi">12</span>
<span class="mi">64</span>
<span class="mi">512</span>
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_VldpkJ" data-clipboard-target="#code_82" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_ZG3li&quot;)"></div><p id="a_ZG3li">We also check that we can do the same oper­a­tions with vari­ables instead of num­bers:</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_37Ftc&quot;)"></div><div class="highlight-container" id="a_37Ftc"><div id="code_83" form="false" decode="exclude" style="font-size:0;width:0;height:0">#lang basic<br/>5  x = 24 : d = 4 : b = 2 : c = 3<br/>10 print x / d / b rem 3<br/>20 print x / (d / b) rem 12<br/>30 print b ^ c ^ b rem 64<br/>40 print b ^ (c ^ b) rem 512</div><div class="highlight" form="false" id="a_nwBsd"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="source"><pre>#lang basic
<span class="nl">5</span><span class="w">  </span><span class="vg">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="il">24</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="vg">d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="il">4</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="vg">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="il">2</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="vg">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="il">3</span>
<span class="nl">10</span><span class="w"> </span><span class="vg">print</span><span class="w"> </span><span class="vg">x</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="vg">d</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="vg">b</span><span class="w"> </span><span class="vg">rem</span><span class="w"> </span><span class="il">3</span>
<span class="nl">20</span><span class="w"> </span><span class="vg">print</span><span class="w"> </span><span class="vg">x</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="vg">d</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="vg">b</span><span class="p">)</span><span class="w"> </span><span class="vg">rem</span><span class="w"> </span><span class="il">12</span>
<span class="nl">30</span><span class="w"> </span><span class="vg">print</span><span class="w"> </span><span class="vg">b</span><span class="w"> </span><span class="o">^</span><span class="w"> </span><span class="vg">c</span><span class="w"> </span><span class="o">^</span><span class="w"> </span><span class="vg">b</span><span class="w"> </span><span class="vg">rem</span><span class="w"> </span><span class="il">64</span>
<span class="nl">40</span><span class="w"> </span><span class="vg">print</span><span class="w"> </span><span class="vg">b</span><span class="w"> </span><span class="o">^</span><span class="w"> </span><span class="p">(</span><span class="vg">c</span><span class="w"> </span><span class="o">^</span><span class="w"> </span><span class="vg">b</span><span class="p">)</span><span class="w"> </span><span class="vg">rem</span><span class="w"> </span><span class="il">512</span>
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_VldpkK" data-clipboard-target="#code_83" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_h3lmBN&quot;)"></div><div class="highlight-container" id="a_h3lmBN"><div id="code_84" form="false" decode="exclude" style="font-size:0;width:0;height:0">3<br/>12<br/>64<br/>512</div><div class="highlight" form="false" id="a_SubYkL"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="source"><pre><span class="mi">3</span>
<span class="mi">12</span>
<span class="mi">64</span>
<span class="mi">512</span>
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_VldpkM" data-clipboard-target="#code_84" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_sZIdH&quot;)"></div><p id="a_sZIdH">Not bad. If we want to add more oper­a­tions at new lev­els of prece­dence, we can insert them into our exist­ing chain of pars­ing rules. We’ll see how this works in the next sec­tion on <a href="conditionals.html">con­di­tion­als</a>.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;using-functions-instead-of-macros&quot;)"></div><h3 anchor="using-functions-instead-of-macros" class="subhead" id="using-functions-instead-of-macros"><a href="#using-functions-instead-of-macros">Using func­tions instead of macros</a></h3></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_N4WTg&quot;)"></div><p id="a_N4WTg">By the way—in our <span class="my-code" decode="exclude">"expr.rkt"</span> mod­ule, macros aren’t manda­tory. We’re not doing any­thing tricky. If we wanted, the macros could be rewrit­ten as func­tions with­out affect­ing pro­gram behav­ior. For instance, we could use <a href="http://docs.racket-lang.org/br/index.html#(form._((lib._br/define..rkt)._define-cases))" class="docs" hyphens="none">define-cases</a> (which is like <a href="http://docs.racket-lang.org/br/index.html#(form._((lib._br/define..rkt)._define-macro-cases))" class="docs" hyphens="none">define-macro-cases</a>, but for func­tions) to han­dle the dif­fer­ent call­ing pat­terns, and <a href="http://docs.racket-lang.org/reference/case.html#(form._((lib._racket/private/more-scheme..rkt)._case))" class="docs" hyphens="none">case</a> to choose the func­tion to apply:</p></div><div class="filebox" anchorize="false"><div class="filename" anchorize="false" decode="exclude">basic/expr.rkt</div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_9BTZl&quot;)"></div><div class="highlight-container" id="a_9BTZl"><div id="code_85" form="false" decode="exclude" style="font-size:0;width:0;height:0">#lang br<br/>(provide b-expr b-sum b-product b-neg b-expt)<br/><br/>(define (b-expr expr)<br/>  (if (integer? expr) (inexact-&gt;exact expr) expr))<br/><br/>(define-cases b-sum<br/>  [(_ arg) arg]<br/>  [(_ left op right) ((case op<br/>                        [("+") +]<br/>                        [("-") -]) left right)])<br/><br/>(define-cases b-product<br/>  [(_ arg) arg]<br/>  [(_ left op right) ((case op<br/>                        [("*") *]<br/>                        [("/") (λ (l r) (/ l r 1.0))]<br/>                        [("mod") modulo]) left right)])<br/><br/>(define-cases b-neg<br/>  [(_ val) val]<br/>  [(_ _ val) (- val)])<br/><br/>(define-cases b-expt<br/>  [(_ val) val]<br/>  [(_ left _ right) (expt left right)])</div><div class="highlight" form="false" id="a_ikFtO"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26</pre></div></td><td class="code"><div class="source"><pre><span class="kn">#lang </span><span class="nn">br</span>
<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/require.html#(form._((lib._racket/private/base..rkt)._provide))" class="docs" hyphens="none">provide</a></span> <span class="n">b-expr</span> <span class="n">b-sum</span> <span class="n">b-product</span> <span class="n">b-neg</span> <span class="n">b-expt</span><span class="p">)</span>

<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/define.html#(form._((lib._racket/private/base..rkt)._define))" class="docs" hyphens="none">define</a></span> <span class="p">(</span><span class="n">b-expr</span> <span class="n">expr</span><span class="p">)</span>
  <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/if.html#(form._((quote._~23~25kernel)._if))" class="docs" hyphens="none">if</a></span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/number-types.html#(def._((quote._~23~25kernel)._integer~3f))" class="docs" hyphens="none">integer?</a></span> <span class="n">expr</span><span class="p">)</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/number-types.html#(def._((quote._~23~25kernel)._inexact-~3eexact))" class="docs" hyphens="none">inexact-&gt;exact</a></span> <span class="n">expr</span><span class="p">)</span> <span class="n">expr</span><span class="p">))</span>

<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br/index.html#(form._((lib._br/define..rkt)._define-cases))" class="docs" hyphens="none">define-cases</a></span> <span class="n">b-sum</span>
  <span class="p">[(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt).__))" class="docs" hyphens="none">_</a></span> <span class="n">arg</span><span class="p">)</span> <span class="n">arg</span><span class="p">]</span>
  <span class="p">[(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt).__))" class="docs" hyphens="none">_</a></span> <span class="n">left</span> <span class="n">op</span> <span class="n">right</span><span class="p">)</span> <span class="p">((</span><span class="nb"><a href="http://docs.racket-lang.org/reference/case.html#(form._((lib._racket/private/more-scheme..rkt)._case))" class="docs" hyphens="none">case</a></span> <span class="n">op</span>
                        <span class="p">[(</span><span class="s2">"+"</span><span class="p">)</span> <span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._+))" class="docs" hyphens="none">+</a></span><span class="p">]</span>
                        <span class="p">[(</span><span class="s2">"-"</span><span class="p">)</span> <span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._-))" class="docs" hyphens="none">-</a></span><span class="p">])</span> <span class="n">left</span> <span class="n">right</span><span class="p">)])</span>

<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br/index.html#(form._((lib._br/define..rkt)._define-cases))" class="docs" hyphens="none">define-cases</a></span> <span class="n">b-product</span>
  <span class="p">[(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt).__))" class="docs" hyphens="none">_</a></span> <span class="n">arg</span><span class="p">)</span> <span class="n">arg</span><span class="p">]</span>
  <span class="p">[(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt).__))" class="docs" hyphens="none">_</a></span> <span class="n">left</span> <span class="n">op</span> <span class="n">right</span><span class="p">)</span> <span class="p">((</span><span class="nb"><a href="http://docs.racket-lang.org/reference/case.html#(form._((lib._racket/private/more-scheme..rkt)._case))" class="docs" hyphens="none">case</a></span> <span class="n">op</span>
                        <span class="p">[(</span><span class="s2">"*"</span><span class="p">)</span> <span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._*))" class="docs" hyphens="none">*</a></span><span class="p">]</span>
                        <span class="p">[(</span><span class="s2">"/"</span><span class="p">)</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/lambda.html#(form._((lib._racket/private/base..rkt)._~ce~bb))" class="docs" hyphens="none">λ</a></span> <span class="p">(</span><span class="n">l</span> <span class="n">r</span><span class="p">)</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._/))" class="docs" hyphens="none">/</a></span> <span class="n">l</span> <span class="n">r</span> <span class="mf">1.0</span><span class="p">))]</span>
                        <span class="p">[(</span><span class="s2">"mod"</span><span class="p">)</span> <span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._modulo))" class="docs" hyphens="none">modulo</a></span><span class="p">])</span> <span class="n">left</span> <span class="n">right</span><span class="p">)])</span>

<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br/index.html#(form._((lib._br/define..rkt)._define-cases))" class="docs" hyphens="none">define-cases</a></span> <span class="n">b-neg</span>
  <span class="p">[(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt).__))" class="docs" hyphens="none">_</a></span> <span class="n">val</span><span class="p">)</span> <span class="n">val</span><span class="p">]</span>
  <span class="p">[(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt).__))" class="docs" hyphens="none">_</a></span> <span class="nb"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt).__))" class="docs" hyphens="none">_</a></span> <span class="n">val</span><span class="p">)</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._-))" class="docs" hyphens="none">-</a></span> <span class="n">val</span><span class="p">)])</span>

<span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/br/index.html#(form._((lib._br/define..rkt)._define-cases))" class="docs" hyphens="none">define-cases</a></span> <span class="n">b-expt</span>
  <span class="p">[(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt).__))" class="docs" hyphens="none">_</a></span> <span class="n">val</span><span class="p">)</span> <span class="n">val</span><span class="p">]</span>
  <span class="p">[(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt).__))" class="docs" hyphens="none">_</a></span> <span class="n">left</span> <span class="nb"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#(form._((lib._racket/private/stxcase-scheme..rkt).__))" class="docs" hyphens="none">_</a></span> <span class="n">right</span><span class="p">)</span> <span class="p">(</span><span class="nb"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#(def._((quote._~23~25kernel)._expt))" class="docs" hyphens="none">expt</a></span> <span class="n">left</span> <span class="n">right</span><span class="p">)])</span>
</pre></div>
</td></tr></tbody></table></div><div class="copy-button" form="false" onClick="notify('copied to clipboard', 1000)" id="a_VldpkO" data-clipboard-target="#code_85" data-clipboard-action="copy"><img src="../fonts/feather-v1.1/svg/download.svg" alt="copy to clipboard"/></div></div></div></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_k8png&quot;)"></div><p id="a_k8png">This imple­men­ta­tion will work the same way.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_P1xU0&quot;)"></div><p id="a_P1xU0">Which is bet­ter? The rule of thumb is that we should use func­tions where we can, and macros where we must. Why? Because macros get eval­u­ated at <a class="glossary" href="../appendix/glossary.html#compile-time"><span class="glossary-link-text">com­pile time</span></a> (which has a cost) and they cre­ate more <a class="glossary" href="../appendix/glossary.html#run-time"><span class="glossary-link-text">run-time</span></a> code, which in turn has to be com­piled and inter­preted (which also has a cost). Call­ing func­tions at run time is typ­i­cally more effi­cient.</p></div><div class="sidebar-container"><div class="sidebar has_form" onclick="toggle_form(&quot;a_VzVay&quot;)"></div><p id="a_VzVay">But claims about per­for­mance always depend on the con­text. In this case, the com­pet­ing macros and func­tions are both tiny. Some casual bench­mark­ing with a BASIC test pro­gram sug­gests they’re essen­tially equal in speed. So we’ll stick with the macro solu­tion. But the alter­na­tive exists.</p></div><div anchorize="false" style="height:2em"></div><ul class="siblinks"><li><a href="intro.html">1&emsp;intro</a></li><li><a href="specification-and-setup.html">2&emsp;spec­i­fi­ca­tion and setup</a></li><li><a href="the-syntax-colorer.html">3&emsp;the syn­tax col­orer</a></li><li><a href="better-line-errors.html">4&emsp;bet­ter line errors</a></li><li><a href="variables-and-input.html">5&emsp;vari­ables and input</a></li><li><a class="here" href="expressions.html">6&emsp;expres­sions</a></li><li><a href="conditionals.html">7&emsp;con­di­tion­als</a></li><li><a href="subroutines-and-loops.html">8&emsp;sub­rou­tines and loops</a></li><li><a href="recap.html">9&emsp;recap</a></li><li><a href="source-listing.html">10&emsp;source list­ing</a></li></ul></div>
    <a class="nav-left" href="variables-and-input.html">← prev</a>
    <a class="nav-right" href="conditionals.html">next →</a>




</body>

<script type="text/javascript">



function show_all_forms() {
 var elems = document.getElementsByClassName('has_form');
 for (var i = 0 ; i < elems.length ; i++) {
  toggle_form(elems[i].id);
 }
}

// for debugging forms only: uncomment next line
// show_all_forms();

// sets up copy-to-clipboard buttons in code boxes
var clipboard = new Clipboard('.copy-button');
clipboard.on('success', function(e) {console.log(e);});
clipboard.on('error', function(e) {console.log(e);});
</script>